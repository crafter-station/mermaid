"use strict";var crafterMermaid=(()=>{var J=Object.defineProperty;var ee=Object.getOwnPropertyDescriptor;var ne=Object.getOwnPropertyNames;var se=Object.prototype.hasOwnProperty;var re=(t,n)=>{for(var e in n)J(t,e,{get:n[e],enumerable:!0})},ie=(t,n,e,s)=>{if(n&&typeof n=="object"||typeof n=="function")for(let i of ne(n))!se.call(t,i)&&i!==e&&J(t,i,{get:()=>n[i],enumerable:!(s=ee(n,i))||s.enumerable});return t};var oe=t=>ie(J({},"__esModule",{value:!0}),t);var Ps={};re(Ps,{DEFAULTS:()=>B,THEMES:()=>ot,enableEvents:()=>qt,enableHover:()=>Ot,enableKeyboard:()=>Ft,enableMinimap:()=>Ut,enableSearch:()=>Gt,enableZoomPan:()=>Yt,getRegistry:()=>V,layout:()=>U,parse:()=>O,render:()=>jt,renderToAscii:()=>Vt,renderToDOM:()=>Xt,renderToString:()=>Z,resetRegistry:()=>ut,use:()=>ht});var ae=[[/^\s*sequenceDiagram\s*$/i,"sequence"],[/^\s*classDiagram\s*$/i,"class"],[/^\s*erDiagram\s*$/i,"er"],[/^\s*stateDiagram-v2\s*$/i,"state"],[/^\s*(?:graph|flowchart)\s+(?:TD|TB|LR|BT|RL)\s*$/i,"flowchart"],[/^\s*pie\s+(?:title\s+.+)?$/i,"pie"],[/^\s*gantt\s*$/i,"gantt"],[/^\s*mindmap\s*$/i,"mindmap"]];function At(t){let n=t.split(/[\n;]/);for(let e of n){let s=e.trim();if(!(!s||s.startsWith("%%"))){for(let[i,r]of ae)if(i.test(s))return r;break}}return null}function E(t,n,e){return{severity:"error",message:t,span:n,suggestions:e}}function P(t,n,e){return{severity:"warning",message:t,span:n,suggestions:e}}function N(t,n,e,s){return{start:{line:t,column:n,offset:e},end:{line:t,column:n+s,offset:e+s}}}function z(t,n){let e=t.split(/[\n;]/),s=0;for(let r=0;r<n&&r<e.length;r++)s+=(e[r]?.length??0)+1;let i=e[n]?.length??0;return N(n+1,1,s,i)}var St=[[/<\|--/,"inheritance"],[/\*--/,"composition"],[/o--/,"aggregation"],[/-->/,"association"],[/\.\.>/,"dependency"],[/\.\.\|>/,"realization"]];function ce(t){let n={classes:new Map,relations:[],namespaces:[],diagnostics:[],currentClass:null,currentNamespace:null},e=t.split(`
`);for(let i=0;i<e.length;i++){let o=e[i].trim();if(!o||o.startsWith("%%")||i===0&&/^classDiagram\s*$/i.test(o))continue;let a=z(t,i);if(o.startsWith("class "))le(o,a,n);else if(o==="{")n.currentClass||n.diagnostics.push(E("Unexpected '{' outside class definition",a));else if(o==="}")n.currentClass=null;else if(n.currentClass)de(o,a,n);else if(o.startsWith("namespace"))ue(o,a,n);else if(St.some(([c])=>c.test(o)))he(o,a,n);else{let c=o.indexOf(":");if(c>0){let l=o.slice(0,c).trim(),d=o.slice(c+1).trim();et(l,a,n);let h=n.classes.get(l),u=vt(d,a);u&&h.members.push(u)}else n.diagnostics.push(P(`Skipping unrecognized line: ${o}`,a))}}return{ast:{type:"class",classes:n.classes,relations:n.relations,namespaces:n.namespaces,span:N(1,1,0,t.length)},diagnostics:n.diagnostics}}function le(t,n,e){let s=t.match(/^class\s+(\w+)(?:\s+<<([^>]+)>>)?(?:\s+as\s+(.+?))?(?:\s*\{)?$/);if(!s){e.diagnostics.push(E("Invalid class definition syntax",n));return}let[,i,r,o]=s,a={id:i,label:o,annotation:r,members:[],span:n};e.classes.set(i,a),e.currentNamespace&&e.currentNamespace.classIds.push(i),t.includes("{")&&(e.currentClass=a)}function de(t,n,e){let s=vt(t,n);s&&e.currentClass&&e.currentClass.members.push(s)}function vt(t,n){let e=t.match(/^([+\-#~])?(.+)$/);if(!e)return null;let[,s,i]=e,r=s||"",o=i.trim(),a=o.includes("$"),c=o.includes("*");o=o.replace(/[$*]/g,"").trim();let l=o.match(/^(\w+)\(([^)]*)\)(?:\s*:\s*(.+))?$/);if(l){let[,u,,f]=l;return{name:u,visibility:r,isStatic:a,isAbstract:c,returnType:f,isMethod:!0,span:n}}let d=o.match(/^(\w+)\s+(\w+)$/);if(d){let[,u,f]=d;return{name:f,type:u,visibility:r,isStatic:a,isAbstract:c,isMethod:!1,span:n}}let h=o.match(/^(\w+)(?:\s*:\s*(.+))?$/);if(h){let[,u,f]=h;return{name:u,type:f,visibility:r,isStatic:a,isAbstract:c,isMethod:!1,span:n}}return null}function he(t,n,e){for(let[s,i]of St)if(s.test(t)){let r=t.split(s);if(r.length!==2){e.diagnostics.push(E("Invalid relation syntax",n));return}let o=r[0].trim(),a=r[1].trim(),c,l,d,h=o.match(/^"([^"]+)"\s+(\w+)$/);h&&(l=h[1],o=h[2]);let u=a.match(/^(\w+)\s+"([^"]+)"$/);u&&(a=u[1],d=u[2]);let f=a.match(/^(\w+)\s*:\s*(.+)$/);f&&(a=f[1],c=f[2]),et(o,n,e),et(a,n,e),e.relations.push({from:o,to:a,type:i,label:c,fromCardinality:l,toCardinality:d,span:n});return}}function ue(t,n,e){let s=t.match(/^namespace\s+(\w+)(?:\s+as\s+(.+?))?(?:\s*\{)?$/);if(!s){e.diagnostics.push(E("Invalid namespace syntax",n));return}let[,i,r]=s,o={id:i,label:r||i,classIds:[],span:n};e.namespaces.push(o),t.includes("{")&&(e.currentNamespace=o)}function et(t,n,e){e.classes.has(t)||e.classes.set(t,{id:t,members:[],span:n})}var mt={"||":"one","o|":"zero-one","}|":"many","|{":"many","o{":"zero-many","{o":"zero-many"};function fe(t){let n={entities:new Map,relations:[],diagnostics:[],currentEntity:null},e=t.split(`
`);for(let i=0;i<e.length;i++){let o=e[i].trim();if(!o||o.startsWith("%%")||i===0&&/^erDiagram\s*$/i.test(o))continue;let a=z(t,i);/^(\w+)\s*\{/.test(o)?ge(o,a,n):o==="}"?n.currentEntity=null:n.currentEntity?pe(o,a,n):/\|\||o\||}\||o\{|\|{|{o/.test(o)&&(o.includes("--")||o.includes(".."))?me(o,a,n):n.diagnostics.push(P(`Skipping unrecognized line: ${o}`,a))}return{ast:{type:"er",entities:n.entities,relations:n.relations,span:N(1,1,0,t.length)},diagnostics:n.diagnostics}}function ge(t,n,e){let s=t.match(/^(\w+)\s*\{/);if(!s){e.diagnostics.push(E("Invalid entity definition syntax",n));return}let i=s[1],r={id:i,attributes:[],span:n};e.entities.set(i,r),e.currentEntity=r}function pe(t,n,e){if(!e.currentEntity)return;let s=t.match(/^(\w+)\s+(\w+)(?:\s+(PK|FK|UK|PK,FK|FK,PK))?(?:\s+"([^"]+)")?$/);if(!s){e.diagnostics.push(E("Invalid attribute syntax",n,['Expected: type name [PK|FK|UK] ["comment"]']));return}let[,i,r,o,a]=s,c=o?o.split(","):[];e.currentEntity.attributes.push({name:r,type:i,keys:c,comment:a,span:n})}function me(t,n,e){let s=/^(\w+)\s+((?:\|\||o\||\}\||o\{|\|\{|\{o))(--|\.\.)(\|\||o\||\}\||o\{|\|\{|\{o)\s+(\w+)\s*:\s*(.+)$/,i=t.match(s);if(!i){e.diagnostics.push(E("Invalid relation syntax",n,["Expected: Entity1 ||--|| Entity2 : label"]));return}let[,r,o,a,c,l,d]=i,h=mt[o],u=mt[c],f=a==="--";if(!h||!u){e.diagnostics.push(E("Invalid cardinality syntax",n,["Expected: ||, o|, }|, |{, o{, or {o"]));return}bt(r,n,e),bt(l,n,e),e.relations.push({from:r,to:l,fromCardinality:h,toCardinality:u,label:d,identifying:f,span:n})}function bt(t,n,e){e.entities.has(t)||e.entities.set(t,{id:t,attributes:[],span:n})}var be=[{regex:/^([\w-]+)\(\(\((.+?)\)\)\)/,shape:"doublecircle"},{regex:/^([\w-]+)\(\[(.+?)\]\)/,shape:"stadium"},{regex:/^([\w-]+)\(\((.+?)\)\)/,shape:"circle"},{regex:/^([\w-]+)\[\[(.+?)\]\]/,shape:"subroutine"},{regex:/^([\w-]+)\[\((.+?)\)\]/,shape:"cylinder"},{regex:/^([\w-]+)\[\/(.+?)\\\]/,shape:"trapezoid"},{regex:/^([\w-]+)\[\\(.+?)\/\]/,shape:"trapezoid-alt"},{regex:/^([\w-]+)>(.+?)\]/,shape:"asymmetric"},{regex:/^([\w-]+)\{\{(.+?)\}\}/,shape:"hexagon"},{regex:/^([\w-]+)\[(.+?)\]/,shape:"rectangle"},{regex:/^([\w-]+)\((.+?)\)/,shape:"rounded"},{regex:/^([\w-]+)\{(.+?)\}/,shape:"diamond"}],ye=/^([\w-]+)/,xe=/^:::([\w][\w-]*)/,we=/^(<)?(-->|-.->|==>|---|-\.-|===)(?:\|([^|]*)\|)?/;function yt(t,n=!1){let e=t.split(/[\n;]/).map(r=>r.trim()).filter(r=>r.length>0&&!r.startsWith("%%"));if(e.length===0)return{ast:null,diagnostics:[E("Empty diagram",N(1,1,0,0))]};let s={nodes:new Map,edges:[],subgraphs:[],classDefs:new Map,classAssignments:new Map,nodeStyles:new Map,diagnostics:[],direction:"TD",subgraphStack:[],startCount:0,endCount:0},i=e[0];if(n)ke(e,s,t);else{let r=i.match(/^(?:graph|flowchart)\s+(TD|TB|LR|BT|RL)\s*$/i);r?s.direction=r[1].toUpperCase():s.diagnostics.push(P(`Invalid header: "${i}". Expected "graph TD", "flowchart LR", etc.`,z(t,0))),$e(e,s,t)}if(s.subgraphStack.length>0)for(s.diagnostics.push(P(`Unclosed subgraph: ${s.subgraphStack[s.subgraphStack.length-1].id}`,N(1,1,0,0)));s.subgraphStack.length>0;){let r=s.subgraphStack.pop();s.subgraphStack.length>0?s.subgraphStack[s.subgraphStack.length-1].children.push(r):s.subgraphs.push(r)}return{ast:{type:"flowchart",direction:s.direction,nodes:s.nodes,edges:s.edges,subgraphs:s.subgraphs,classDefs:s.classDefs,classAssignments:s.classAssignments,nodeStyles:s.nodeStyles,span:N(1,1,0,t.length)},diagnostics:s.diagnostics}}function $e(t,n,e){for(let s=1;s<t.length;s++){let i=t[s],r=z(e,s),o=i.match(/^classDef\s+(\w+)\s+(.+)$/);if(o){n.classDefs.set(o[1],kt(o[2]));continue}let a=i.match(/^class\s+([\w,-]+)\s+(\w+)$/);if(a){for(let h of a[1].split(",").map(u=>u.trim()))n.classAssignments.set(h,a[2]);continue}let c=i.match(/^style\s+([\w,-]+)\s+(.+)$/);if(c){let h=kt(c[2]);for(let u of c[1].split(",").map(f=>f.trim()))n.nodeStyles.set(u,{...n.nodeStyles.get(u),...h});continue}let l=i.match(/^direction\s+(TD|TB|LR|BT|RL)\s*$/i);if(l&&n.subgraphStack.length>0){n.subgraphStack[n.subgraphStack.length-1].direction=l[1].toUpperCase();continue}let d=i.match(/^subgraph\s+(.+)$/);if(d){let h=d[1].trim(),u=h.match(/^([\w-]+)\s*\[(.+)\]$/),f,g;u?(f=u[1],g=u[2]):(g=h,f=h.replace(/\s+/g,"_").replace(/[^\w]/g,""));let m={id:f,label:g,nodeIds:[],children:[],span:r};n.subgraphStack.push(m);continue}if(i==="end"){let h=n.subgraphStack.pop();h&&(n.subgraphStack.length>0?n.subgraphStack[n.subgraphStack.length-1].children.push(h):n.subgraphs.push(h));continue}Ae(i,r,n)}}function ke(t,n,e){for(let s=1;s<t.length;s++){let i=t[s],r=z(e,s),o=i.match(/^direction\s+(TD|TB|LR|BT|RL)\s*$/i);if(o){n.subgraphStack.length>0?n.subgraphStack[n.subgraphStack.length-1].direction=o[1].toUpperCase():n.direction=o[1].toUpperCase();continue}let a=i.match(/^state\s+(?:"([^"]+)"\s+as\s+)?(\w+)\s*\{$/);if(a){let h=a[1]??a[2],f={id:a[2],label:h,nodeIds:[],children:[],span:r};n.subgraphStack.push(f);continue}if(i==="}"){let h=n.subgraphStack.pop();h&&(n.subgraphStack.length>0?n.subgraphStack[n.subgraphStack.length-1].children.push(h):n.subgraphs.push(h));continue}let c=i.match(/^state\s+"([^"]+)"\s+as\s+(\w+)\s*$/);if(c){X(n,{id:c[2],label:c[1],shape:"rounded",span:r});continue}let l=i.match(/^(\[\*\]|[\w-]+)\s*(-->)\s*(\[\*\]|[\w-]+)(?:\s*:\s*(.+))?$/);if(l){let h=l[1],u=l[3],f=l[4]?.trim()||void 0;h==="[*]"?(n.startCount++,h=`_start${n.startCount>1?n.startCount:""}`,X(n,{id:h,label:"",shape:"state-start",span:r})):$t(n,h,r),u==="[*]"?(n.endCount++,u=`_end${n.endCount>1?n.endCount:""}`,X(n,{id:u,label:"",shape:"state-end",span:r})):$t(n,u,r),n.edges.push({source:h,target:u,label:f,style:"solid",hasArrowStart:!1,hasArrowEnd:!0,span:r});continue}let d=i.match(/^([\w-]+)\s*:\s*(.+)$/);if(d){X(n,{id:d[1],label:d[2].trim(),shape:"rounded",span:r});continue}}}function Ae(t,n,e){let s=t.trim(),i=xt(s,n,e);if(!i||i.ids.length===0){s.length>0&&e.diagnostics.push(P(`Skipping unrecognized line: ${t}`,n));return}s=i.remaining.trim();let r=i.ids,o=!1;for(;s.length>0;){let a=s.match(we);if(!a)break;let c=!!a[1],l=a[2],d=a[3]?.trim()||void 0;s=s.slice(a[0].length).trim();let h=Se(l),u=l.endsWith(">"),f=xt(s,n,e);if(!f||f.ids.length===0)break;s=f.remaining.trim();for(let g of r)for(let m of f.ids)e.edges.push({source:g,target:m,label:d,style:h,hasArrowStart:c,hasArrowEnd:u,span:n});o=!0,r=f.ids}(s.length>0||!o&&i.remaining.trim().length>0)&&e.diagnostics.push(P(`Skipping unrecognized line: ${t}`,n))}function xt(t,n,e){let s=wt(t,n,e);if(!s)return null;let i=[s.id],r=s.remaining.trim();for(;r.startsWith("&");){r=r.slice(1).trim();let o=wt(r,n,e);if(!o)break;i.push(o.id),r=o.remaining.trim()}return{ids:i,remaining:r}}function wt(t,n,e){let s=null,i=t;for(let{regex:o,shape:a}of be){let c=t.match(o);if(c){s=c[1];let l=c[2];X(e,{id:s,label:l,shape:a,span:n}),i=t.slice(c[0].length);break}}if(s===null){let o=t.match(ye);o&&(s=o[1],e.nodes.has(s)?nt(e,s):X(e,{id:s,label:s,shape:"rectangle",span:n}),i=t.slice(o[0].length))}if(s===null)return null;let r=i.match(xe);return r&&(e.classAssignments.set(s,r[1]),i=i.slice(r[0].length)),{id:s,remaining:i}}function X(t,n){t.nodes.has(n.id)||t.nodes.set(n.id,n),nt(t,n.id)}function nt(t,n){if(t.subgraphStack.length>0){let e=t.subgraphStack[t.subgraphStack.length-1];e.nodeIds.includes(n)||e.nodeIds.push(n)}}function $t(t,n,e){t.nodes.has(n)?nt(t,n):X(t,{id:n,label:n,shape:"rounded",span:e})}function Se(t){return t==="-.->"||t==="-.-"?"dotted":t==="==>"||t==="==="?"thick":"solid"}function kt(t){let n={};for(let e of t.split(",")){let s=e.indexOf(":");if(s>0){let i=e.slice(0,s).trim(),r=e.slice(s+1).trim();i&&r&&(n[i]=r)}}return n}function ve(t){let n={sections:new Map,currentSection:"",diagnostics:[]},e=t.split(`
`);for(let r=0;r<e.length;r++){let a=e[r].trim();if(!a||a.startsWith("%%")||r===0&&/^gantt\s*$/i.test(a))continue;let c=z(t,r);if(/^title\s+(.+)$/i.test(a)){let l=a.match(/^title\s+(.+)$/i);l&&(n.title=l[1].trim());continue}if(/^dateFormat\s+(.+)$/i.test(a)){let l=a.match(/^dateFormat\s+(.+)$/i);l&&(n.dateFormat=l[1].trim());continue}if(/^section\s+(.+)$/i.test(a)){let l=a.match(/^section\s+(.+)$/i);l&&(n.currentSection=l[1].trim(),n.sections.has(n.currentSection)||n.sections.set(n.currentSection,[]));continue}n.currentSection?Me(a,c,n):n.diagnostics.push(P(`Task defined before any section: ${a}`,c))}let s=Array.from(n.sections.entries()).map(([r,o])=>({name:r,tasks:o}));return{ast:{type:"gantt",title:n.title,dateFormat:n.dateFormat,sections:s,span:N(1,1,0,t.length)},diagnostics:n.diagnostics}}function Me(t,n,e){let s=/^(?:(done|active|crit|milestone)\s+)?([^:]+)\s*:\s*(?:(\w+),\s*)?(.+)$/,i=t.match(s);if(!i){e.diagnostics.push(E("Invalid task syntax",n,["Expected: [status] label : [id,] timing"]));return}let[,r,o,a,c]=i,l=r,d={label:o.trim(),status:l,id:a,section:e.currentSection,span:n},h=c.match(/^after\s+(\w+)(?:,\s*(.+))?$/);if(h)d.afterId=h[1],h[2]&&(d.duration=h[2].trim());else{let f=c.split(",").map(g=>g.trim());if(f.length===2){let[g,m]=f;d.startDate=g,/^\d+d$/.test(m)?d.duration=m:d.endDate=m}else f.length===1&&(d.startDate=f[0])}let u=e.sections.get(e.currentSection);u&&u.push(d)}function Ee(t){let n={root:null,nodeStack:[],diagnostics:[],nodeIdCounter:0},e=t.split(`
`);for(let i=0;i<e.length;i++){let r=e[i],o=r.trim();if(!o||o.startsWith("%%")||i===0&&/^mindmap\s*$/i.test(o))continue;let a=z(t,i),c=Ce(r),l=_e(o,a,n);l&&(n.root===null?(n.root=l,n.nodeStack=[{node:l,indent:c}]):Le(l,c,n))}return n.root?{ast:{type:"mindmap",root:n.root,span:N(1,1,0,t.length)},diagnostics:n.diagnostics}:(n.diagnostics.push(E("Mindmap must have at least one root node",N(1,1,0,0))),{ast:null,diagnostics:n.diagnostics})}function _e(t,n,e){let s={"((":"circle","(":"rounded","))":"bang",")":"cloud","{{":"hexagon"},i=t,r="default";for(let[o,a]of Object.entries(s)){let c=o.split("").reverse().join(""),l=new RegExp(`^\\${o.split("").join("\\")}(.+?)\\${c.split("").join("\\")}$`),d=t.match(l);if(d){i=d[1],r=a;break}}return i?{id:`node-${e.nodeIdCounter++}`,label:i,shape:r,children:[],span:n}:(e.diagnostics.push(P(`Empty node label: ${t}`,n)),null)}function Ce(t){let n=0;for(let e of t)if(e===" ")n++;else if(e==="	")n+=2;else break;return n}function Le(t,n,e){for(;e.nodeStack.length>0&&e.nodeStack[e.nodeStack.length-1].indent>=n;)e.nodeStack.pop();if(e.nodeStack.length===0){e.diagnostics.push(P(`Node at same or lower indent than root: ${t.label}`,t.span));return}e.nodeStack[e.nodeStack.length-1].node.children.push(t),e.nodeStack.push({node:t,indent:n})}function Ne(t){let n={slices:[],showData:!1,diagnostics:[]},e=t.split(`
`);for(let i=0;i<e.length;i++){let o=e[i].trim();if(!o||o.startsWith("%%")||i===0&&/^pie\s*$/i.test(o))continue;let a=z(t,i);if(/^pie\s+showData\s*$/i.test(o)){n.showData=!0;continue}if(/^title\s+(.+)$/i.test(o)){let l=o.match(/^title\s+(.+)$/i);l&&(n.title=l[1].trim());continue}let c=o.match(/^"([^"]+)"\s*:\s*(\d+(?:\.\d+)?)$/);if(c){let[,l,d]=c,h=Number.parseFloat(d);if(Number.isNaN(h)||h<0){n.diagnostics.push(E("Slice value must be a non-negative number",a));continue}n.slices.push({label:l,value:h,span:a});continue}n.diagnostics.push(P(`Skipping unrecognized line: ${o}`,a))}return{ast:{type:"pie",title:n.title,showData:n.showData,slices:n.slices,span:N(1,1,0,t.length)},diagnostics:n.diagnostics}}var Pe=[{pattern:/-->>/,type:"dashed"},{pattern:/->>/,type:"solid"},{pattern:/-\)/,type:"open"},{pattern:/-x/,type:"cross"}];function Ie(t){let n={participants:new Map,messages:[],diagnostics:[],blockStack:[]},e=t.split(`
`);for(let i=0;i<e.length;i++){let o=e[i].trim();if(!o||o.startsWith("%%")||i===0&&/^sequenceDiagram\s*$/i.test(o))continue;let a=z(t,i);o.startsWith("participant")||o.startsWith("actor")?De(o,a,n):o.startsWith("Note")?Re(o,a,n):o.startsWith("loop")||o.startsWith("alt")||o.startsWith("opt")||o.startsWith("par")||o.startsWith("critical")||o.startsWith("break")||o.startsWith("rect")?ze(o,a,n):o==="end"?We(a,n):o.startsWith("else")||o.startsWith("and")?He(o,a,n):o.includes("-->>")||o.includes("->>")||o.includes("-x")||o.includes("-)")?Te(o,a,n):o.startsWith("activate")||o.startsWith("deactivate")?Be(o,a,n):n.diagnostics.push(P(`Skipping unrecognized line: ${o}`,a))}return n.blockStack.length>0&&n.diagnostics.push(P(`Unclosed block: ${n.blockStack[n.blockStack.length-1].block.type}`,N(1,1,0,0))),{ast:{type:"sequence",participants:Array.from(n.participants.values()),messages:n.messages,span:N(1,1,0,t.length)},diagnostics:n.diagnostics}}function De(t,n,e){let s=t.match(/^(participant|actor)\s+(\w+)(?:\s+as\s+(.+))?$/);if(!s){e.diagnostics.push(E("Invalid participant syntax",n,["Expected: participant id as label"]));return}let[,i,r,o]=s,a={id:r,label:o||r,type:i,span:n};e.participants.set(r,a)}function Te(t,n,e){for(let{pattern:s,type:i}of Pe)if(s.test(t)){let r=t.split(s);if(r.length!==2){e.diagnostics.push(E("Invalid message syntax",n,["Expected: participant1 ->> participant2: message"]));return}let o=r[0].trim(),a=r[1].trim(),c,l,d=!1,h=!1;if(a.includes(":")){let[f,...g]=a.split(":");c=f.trim(),l=g.join(":").trim()}else c=a,l="";o.endsWith("+")&&(o=o.slice(0,-1).trim(),d=!0),o.endsWith("-")&&(o=o.slice(0,-1).trim(),h=!0),F(o,n,e),F(c,n,e);let u={from:o,to:c,label:l,arrowType:i,activate:d||void 0,deactivate:h||void 0,span:n};e.blockStack.length>0?e.blockStack[e.blockStack.length-1].currentSection.messages.push(u):e.messages.push(u);return}e.diagnostics.push(E("Invalid message arrow",n,["Expected one of: ->>, -->>, -), -x"]))}function Re(t,n,e){let s=t.match(/^Note\s+left\s+of\s+(\w+):\s*(.+)$/);if(s){let[,o,a]=s;F(o,n,e),tt({placement:"left",participants:[o],text:a,span:n},e);return}let i=t.match(/^Note\s+right\s+of\s+(\w+):\s*(.+)$/);if(i){let[,o,a]=i;F(o,n,e),tt({placement:"right",participants:[o],text:a,span:n},e);return}let r=t.match(/^Note\s+over\s+([\w,\s]+):\s*(.+)$/);if(r){let[,o,a]=r,c=o.split(",").map(d=>d.trim());for(let d of c)F(d,n,e);tt({placement:"over",participants:c,text:a,span:n},e);return}e.diagnostics.push(E("Invalid note syntax",n))}function ze(t,n,e){let s=t.match(/^(loop|alt|opt|par|critical|break|rect)(?:\s+(.+))?$/);if(!s){e.diagnostics.push(E("Invalid block syntax",n));return}let[,i,r]=s,o={type:i,label:r||"",sections:[],span:n},a={label:void 0,messages:[]};o.sections.push(a),e.blockStack.push({block:o,currentSection:a})}function He(t,n,e){if(e.blockStack.length===0){e.diagnostics.push(E("Unexpected block section outside block",n));return}let s=t.match(/^(else|and)(?:\s+(.+))?$/);if(!s){e.diagnostics.push(E("Invalid block section syntax",n));return}let[,,i]=s,r={label:i,messages:[]},o=e.blockStack[e.blockStack.length-1];o.block.sections.push(r),o.currentSection=r}function We(t,n){if(n.blockStack.length===0){n.diagnostics.push(E("Unexpected 'end' without block",t));return}let{block:e}=n.blockStack.pop();n.blockStack.length>0?n.blockStack[n.blockStack.length-1].currentSection.messages.push(e):n.messages.push(e)}function Be(t,n,e){let s=t.match(/^(activate|deactivate)\s+(\w+)$/);if(!s){e.diagnostics.push(E("Invalid activation syntax",n));return}let[,i,r]=s;F(r,n,e),e.diagnostics.push(P(`Standalone ${i} not fully supported, use +/- on messages`,n))}function F(t,n,e){e.participants.has(t)||e.participants.set(t,{id:t,label:t,type:"participant",span:n})}function tt(t,n){n.blockStack.length>0?n.blockStack[n.blockStack.length-1].currentSection.messages.push(t):n.messages.push(t)}function O(t){let n=At(t);if(!n)return{ast:null,diagnostics:[E("Unable to detect diagram type",N(1,1,0,0),["Expected first line to be one of: graph/flowchart, sequenceDiagram, classDiagram, erDiagram, stateDiagram-v2"])]};switch(n){case"flowchart":return yt(t,!1);case"state":return yt(t,!0);case"sequence":return Ie(t);case"class":return ce(t);case"er":return fe(t);case"pie":return Ne(t);case"gantt":return ve(t);case"mindmap":return Ee(t)}}var st={normal:.52,medium:.55,bold:.58};function Xe(t,n,e=400){let s=e>=600?st.bold:e>=500?st.medium:st.normal;return t.length*n*s}function rt(t,n,e=14){let s=t.split(`
`),i=Math.max(...s.map(c=>Xe(c,e))),r=s.length*e*1.2,o,a;switch(n){case"diamond":case"rhombus":{o=i*1.6+32,a=r*1.6+24;break}case"circle":case"doublecircle":{let c=Math.max(i,r)+32;o=c,a=c;break}case"stadium":case"pill":{o=i+r+16,a=r+16;break}case"hexagon":{o=i+48,a=r+24;break}case"trapezoid":case"inv-trapezoid":{o=i+56,a=r+24;break}case"odd":case"lean-right":case"lean-left":{o=i+40,a=r+24;break}default:{o=i+24,a=r+16;break}}return{width:o,height:a}}var Ye=class{nodes=new Map;edges=new Map;inEdges=new Map;outEdges=new Map;children=new Map;addNode(t,n,e=0,s=0){this.nodes.set(t,{id:t,data:n,width:e,height:s}),this.inEdges.has(t)||this.inEdges.set(t,new Set),this.outEdges.has(t)||this.outEdges.set(t,new Set)}removeNode(t){let n=this.inEdges.get(t);if(n)for(let i of n)this.removeEdge(i,t);let e=this.outEdges.get(t);if(e)for(let i of e)this.removeEdge(t,i);this.nodes.delete(t),this.inEdges.delete(t),this.outEdges.delete(t);let s=this.nodes.get(t)?.parent;s&&this.children.get(s)?.delete(t)}addEdge(t,n,e,s=1){let i=`${t}->${n}`;this.edges.set(i,{source:t,target:n,data:e,weight:s}),this.outEdges.has(t)||this.outEdges.set(t,new Set),this.inEdges.has(n)||this.inEdges.set(n,new Set),this.outEdges.get(t).add(n),this.inEdges.get(n).add(t)}removeEdge(t,n){let e=`${t}->${n}`;this.edges.delete(e),this.outEdges.get(t)?.delete(n),this.inEdges.get(n)?.delete(t)}setParent(t,n){let e=this.nodes.get(t);e&&(e.parent=n,this.children.has(n)||this.children.set(n,new Set),this.children.get(n).add(t))}getNode(t){return this.nodes.get(t)}getEdge(t,n){return this.edges.get(`${t}->${n}`)}predecessors(t){return Array.from(this.inEdges.get(t)||[])}successors(t){return Array.from(this.outEdges.get(t)||[])}sources(){let t=[];for(let n of this.nodes.keys())(this.inEdges.get(n)?.size||0)===0&&t.push(n);return t}sinks(){let t=[];for(let n of this.nodes.keys())(this.outEdges.get(n)?.size||0)===0&&t.push(n);return t}nodeIds(){return Array.from(this.nodes.keys())}getEdges(){return Array.from(this.edges.values())}getChildren(t){return Array.from(this.children.get(t)||[])}reverseEdge(t,n){let e=this.getEdge(t,n);e&&(this.removeEdge(t,n),this.addEdge(n,t,e.data,e.weight))}hasEdge(t,n){return this.edges.has(`${t}->${n}`)}nodeCount(){return this.nodes.size}edgeCount(){return this.edges.size}};function Fe(t){let n=new Set,e=new Set,s=[];function i(o){n.add(o),e.add(o);let a=t.successors(o);for(let c of a)n.has(c)?e.has(c)&&(t.reverseEdge(o,c),s.push({source:o,target:c})):i(c);e.delete(o)}let r=t.sources();if(r.length===0){let o=t.nodeIds();o.length>0&&i(o[0])}else for(let o of r)n.has(o)||i(o);for(let o of t.nodeIds())n.has(o)||i(o);return s}function Oe(t,n){for(let e of n)t.reverseEdge(e.target,e.source)}function Ue(t){let n=new Map,e=[],s=[];for(let i of t.nodeIds()){let r=t.predecessors(i).length;n.set(i,r),r===0&&e.push(i)}for(;e.length>0;){e.sort();let i=e.shift();s.push(i);for(let r of t.successors(i)){let o=n.get(r)-1;n.set(r,o),o===0&&e.push(r)}}return s}function qe(t){let n=new Map,e=Ue(t);for(let i of e){let r=t.predecessors(i);if(r.length===0)n.set(i,0);else{let o=Math.max(...r.map(a=>n.get(a)??0));n.set(i,o+1)}}let s=Math.max(...Array.from(n.values()));return{layers:n,maxLayer:s}}function Ge(t,n){let e=new Map,s=t.getEdges(),i=0;for(let r of s){let o=n.get(r.source)??0,c=(n.get(r.target)??0)-o;if(c>1){let l=[],d=r.source;for(let h=1;h<c;h++){let u=`__virtual_${i++}`;t.addNode(u,r.data,0,0),n.set(u,o+h),t.addEdge(d,u,r.data,r.weight),l.push(u),d=u}t.addEdge(d,r.target,r.data,r.weight),t.removeEdge(r.source,r.target),e.set(`${r.source}->${r.target}`,l)}}return e}function je(t,n){let e=Array.from({length:n+1},()=>[]);for(let[s,i]of t)e[i].push(s);for(let s of e)s.sort();return e}function Mt(t,n){let e=0;for(let s=0;s<n.length-1;s++){let i=n[s],r=n[s+1],o=new Map;for(let a=0;a<r.length;a++)o.set(r[a],a);for(let a=0;a<i.length;a++){let c=i[a],l=t.successors(c);for(let d=a+1;d<i.length;d++){let h=i[d],u=t.successors(h);for(let f of l){let g=o.get(f);if(g!==void 0)for(let m of u){let y=o.get(m);y!==void 0&&g>y&&e++}}}}}return e}function Et(t,n,e,s){let i=new Map;for(let o=0;o<e.length;o++)i.set(e[o],o);let r=n.map(o=>{let c=(s?t.predecessors(o):t.successors(o)).filter(d=>i.has(d));if(c.length===0)return{nodeId:o,weight:0};let l=c.reduce((d,h)=>d+i.get(h),0);return{nodeId:o,weight:l/c.length}});return r.sort((o,a)=>o.weight!==a.weight?o.weight-a.weight:o.nodeId.localeCompare(a.nodeId)),r.map(o=>o.nodeId)}function Qe(t,n){let e=n.map(o=>[...o]),s=Mt(t,e);if(s===0)return e;let i=24,r=e.map(o=>[...o]);for(let o=0;o<i;o++){if(o%2===0)for(let l=1;l<r.length;l++)r[l]=Et(t,r[l],r[l-1],!0);else for(let l=r.length-2;l>=0;l--)r[l]=Et(t,r[l],r[l+1],!1);let c=Mt(t,r);if(c<s&&(s=c,e=r.map(l=>[...l]),s===0))break}return e}function Ve(t){return t==="LR"||t==="RL"}function Ke(t,n,e,s){let i=new Map,r=0;for(let o=0;o<n.length;o++){i.set(o,r);let a=Math.max(...n[o].map(c=>{let l=t.getNode(c);return l?s?l.width:l.height:0}));r+=a+e}return i}function Ze(t,n,e,s){let i=new Map;for(let r of n){let o=0;for(let l of r){let d=t.getNode(l);if(!d)continue;let h=s?d.height:d.width;i.set(l,o+h/2),o+=h+e}let c=(o-e)/2;for(let l of r)i.set(l,i.get(l)-c)}return i}function Je(t,n,e,s,i){let r=new Map(e),o=24,a=.5;for(let c=0;c<o;c++){let l=new Map;for(let d of n)for(let h of d){let u=[...t.predecessors(h),...t.successors(h)];if(u.length===0){l.set(h,r.get(h));continue}let f=u.reduce((y,x)=>y+(r.get(x)??0),0)/u.length,g=r.get(h),m=g+(f-g)*a;l.set(h,m)}for(let d of n){let h=d.map(u=>({nodeId:u,pos:l.get(u)})).sort((u,f)=>u.pos-f.pos);for(let u=1;u<h.length;u++){let f=t.getNode(h[u-1].nodeId),g=t.getNode(h[u].nodeId);if(!f||!g)continue;let m=i?f.height:f.width,y=i?g.height:g.width,x=h[u-1].pos+m/2+s+y/2;h[u].pos<x&&(h[u].pos=x,l.set(h[u].nodeId,x))}}r.clear();for(let[d,h]of l)r.set(d,h)}return r}function tn(t,n,e,s,i){let r=new Map(e);for(let o=0;o<4;o++){for(let a of n)for(let c of a){let l=t.predecessors(c),d=t.successors(c),h=null;if(l.length===1){let u=l[0];t.successors(u).length===1&&(h=r.get(u))}if(h===null&&d.length===1){let u=d[0];t.predecessors(u).length===1&&(h=r.get(u))}h!==null&&r.set(c,h)}for(let a of n){let c=a.map(l=>({nodeId:l,pos:r.get(l)})).sort((l,d)=>l.pos-d.pos);for(let l=1;l<c.length;l++){let d=t.getNode(c[l-1].nodeId),h=t.getNode(c[l].nodeId);if(!d||!h)continue;let u=i?d.height:d.width,f=i?h.height:h.width,g=c[l-1].pos+u/2+s+f/2;c[l].pos<g&&(c[l].pos=g,r.set(c[l].nodeId,g))}}}return r}function en(t,n,e,s,i){let r=new Map(e);for(let o=0;o<4;o++){for(let a=0;a<n.length;a++){let c=n[a];for(let l of c){let d=t.successors(l);if(d.length<2)continue;let h=n[a+1];if(!h)continue;let u=d.filter(x=>h.includes(x));if(u.length<2)continue;let f=r.get(l),g=u.map(x=>r.get(x)),m=(Math.min(...g)+Math.max(...g))/2,y=f-m;if(!(Math.abs(y)<1))for(let x of u)r.set(x,r.get(x)+y)}}for(let a of n){let c=a.map(l=>({nodeId:l,pos:r.get(l)})).sort((l,d)=>l.pos-d.pos);for(let l=1;l<c.length;l++){let d=t.getNode(c[l-1].nodeId),h=t.getNode(c[l].nodeId);if(!d||!h)continue;let u=i?d.height:d.width,f=i?h.height:h.width,g=c[l-1].pos+u/2+s+f/2;c[l].pos<g&&(c[l].pos=g,r.set(c[l].nodeId,g))}}}return r}function nn(t,n){let e=Array.from(t.values()),s=Math.min(...e),i=new Map;for(let[r,o]of t)i.set(r,o-s+n);return i}function sn(t,n,e,s,i,r){let o=Ve(r),a=Ke(t,n,s,o),c=Ze(t,n,e,o),l=Je(t,n,c,e,o),d=tn(t,n,l,e,o),h=en(t,n,d,e,o),u=nn(h,i),f=new Map;for(let y=0;y<n.length;y++){let x=a.get(y)+i;for(let A of n[y]){let w=u.get(A);o?f.set(A,{x,y:w}):f.set(A,{x:w,y:x})}}if(r==="BT"||r==="RL"){let y=Math.max(...o?Array.from(f.values()).map(x=>x.x):Array.from(f.values()).map(x=>x.y));for(let[x,A]of f)o?f.set(x,{x:y-A.x+2*i,y:A.y}):f.set(x,{x:A.x,y:y-A.y+2*i})}let g=0,m=0;for(let[y,x]of f){let A=t.getNode(y);if(!A)continue;let w=x.x+A.width/2+i,$=x.y+A.height/2+i;w>g&&(g=w),$>m&&(m=$)}return{positions:f,width:g,height:m}}function rn(t,n,e){let s=new Ye;for(let w of t)s.addNode(w.id,{},w.width,w.height);for(let w of n)s.addEdge(w.source,w.target,{},w.weight??1);let i=Fe(s),{layers:r,maxLayer:o}=qe(s),a=Ge(s,r),c=je(r,o),l=Qe(s,c),d=e.direction??"TB",h=e.nodeSpacing??50,u=e.layerSpacing??100,f=e.padding??20,{positions:g,width:m,height:y}=sn(s,l,h,u,f,d);Oe(s,i);let x=new Map;for(let w of t){let $=g.get(w.id);$&&x.set(w.id,$)}let A=new Map;for(let w of n){let $=g.get(w.source),v=g.get(w.target);if(!$||!v)continue;let p=a.get(`${w.source}->${w.target}`)??[],b=[$];for(let k of p){let M=g.get(k);M&&b.push(M)}b.push(v),A.set(`${w.source}->${w.target}`,b)}return{nodePositions:x,edgeRoutes:A,width:m,height:y}}function on(t){return t==="LR"||t==="RL"}function an(t,n){if(t.length<2)return t;let e=t[0],s=t[t.length-1],i=on(n);if(t.length===2||t.length===3){if(i){if(Math.abs(e.y-s.y)<8)return[e,s];let a=(e.x+s.x)/2;return[e,{x:a,y:e.y},{x:a,y:s.y},s]}if(Math.abs(e.x-s.x)<8)return[e,s];let o=(e.y+s.y)/2;return[e,{x:e.x,y:o},{x:s.x,y:o},s]}let r=[e];for(let o=1;o<t.length-1;o++){let a=r[r.length-1],c=t[o];i?(r.push({x:c.x,y:a.y}),Math.abs(c.y-a.y)>1&&r.push({x:c.x,y:c.y})):(r.push({x:a.x,y:c.y}),Math.abs(c.x-a.x)>1&&r.push({x:c.x,y:c.y}))}return r.push(s),r}function _t(t,n,e){let s=t.x-n.x,i=t.y-n.y,r=n.width/2,o=n.height/2;switch(e){case"circle":case"doublecircle":{let a=Math.max(r,o),c=Math.atan2(i,s);return{x:n.x+a*Math.cos(c),y:n.y+a*Math.sin(c)}}case"diamond":case"rhombus":{let a=Math.atan2(i,s),c=Math.abs(a);if(c<Math.PI/4||c>3*Math.PI/4){let d=r/Math.abs(Math.cos(a)),h=n.x+d*Math.cos(a),u=n.y+d*Math.sin(a);if(Math.abs(u-n.y)<=o)return{x:h,y:u}}let l=o/Math.abs(Math.sin(a));return{x:n.x+l*Math.cos(a),y:n.y+l*Math.sin(a)}}case"hexagon":{let a=Math.atan2(i,s),c=Math.PI/3;if(Math.abs(a)<c||Math.abs(a)>Math.PI-c){let d=r/Math.abs(Math.cos(a));return{x:n.x+d*Math.cos(a),y:n.y+d*Math.sin(a)}}let l=o/Math.abs(Math.sin(a));return{x:n.x+l*Math.cos(a),y:n.y+l*Math.sin(a)}}default:{let a=Math.atan2(i,s);if(Math.abs(Math.cos(a))*o>Math.abs(Math.sin(a))*r){let l=r/Math.abs(Math.cos(a));return{x:n.x+l*Math.cos(a),y:n.y+l*Math.sin(a)}}let c=o/Math.abs(Math.sin(a));return{x:n.x+c*Math.cos(a),y:n.y+c*Math.sin(a)}}}}function cn(t,n,e,s,i,r){let o=an(e,r);if(o.length<2)return o;let a=o.length>2?o[1]:o[o.length-1],c=o.length>2?o[o.length-2]:o[0],l=_t(a,t,s),d=_t(c,n,i),h=o.length>2?o.slice(1,-1):[];return[l,...h,d]}function it(t){if(t.length===0)return{x:0,y:0};let n=0,e=[];for(let r=0;r<t.length-1;r++){let o=t[r+1].x-t[r].x,a=t[r+1].y-t[r].y,c=Math.sqrt(o*o+a*a);e.push(c),n+=c}let s=n/2,i=0;for(let r=0;r<e.length;r++){if(i+e[r]>=s){let o=(s-i)/e[r];return{x:t[r].x+(t[r+1].x-t[r].x)*o,y:t[r].y+(t[r+1].y-t[r].y)*o}}i+=e[r]}return t[Math.floor(t.length/2)]}function ln(t,n){let e=n.padding??20,s=n.nodeSpacing??60,i=n.layerSpacing??30,r=t.participants,o=120,a=40,c=[],l=new Map;for(let g=0;g<r.length;g++){let m=r[g],y=e+g*(o+s),x=e;l.set(m.id,y),c.push({id:m.id,label:m.label,shape:m.type,x:y,y:x,width:o,height:a})}let d=[],h=e+a+i;for(let g of t.messages)if("from"in g&&"to"in g){let m=g,y=l.get(m.from)??e,x=l.get(m.to)??e,A=[{x:y+o/2,y:h},{x:x+o/2,y:h}];d.push({source:m.from,target:m.to,label:m.label,style:m.arrowType==="solid"?"solid":"dotted",hasArrowStart:!1,hasArrowEnd:!0,points:A,labelPosition:it(A)}),h+=i}let u=e+r.length*o+(r.length-1)*s+e,f=h+e;for(let g of r){let y=(l.get(g.id)??e)+o/2;d.unshift({source:g.id,target:g.id,style:"dotted",hasArrowStart:!1,hasArrowEnd:!1,points:[{x:y,y:e+a},{x:y,y:f-e}]})}return{width:u,height:f,nodes:c,edges:d,groups:[]}}function dn(t,n,e){let s=e.padding??20,i=e.nodeSpacing??80,r=t.map((p,b)=>{let k=rt(p.label,p.shape),M=b/t.length*Math.PI*2,_=i*Math.sqrt(t.length);return{id:p.id,label:p.label,shape:p.shape,x:_*Math.cos(M),y:_*Math.sin(M),vx:0,vy:0,width:k.width,height:k.height}}),o=new Map(r.map(p=>[p.id,p])),a=100,c=5e3,l=.01,d=.9;for(let p=0;p<a;p++){for(let b=0;b<r.length;b++)for(let k=b+1;k<r.length;k++){let M=r[b],_=r[k],L=_.x-M.x,C=_.y-M.y,I=Math.max(Math.sqrt(L*L+C*C),1),T=c/(I*I),R=L/I*T,D=C/I*T;M.vx-=R,M.vy-=D,_.vx+=R,_.vy+=D}for(let b of n){let k=o.get(b.source),M=o.get(b.target);if(!k||!M)continue;let _=M.x-k.x,L=M.y-k.y,C=Math.sqrt(_*_+L*L),I=(C-i)*l,T=_/Math.max(C,1)*I,R=L/Math.max(C,1)*I;k.vx+=T,k.vy+=R,M.vx-=T,M.vy-=R}for(let b of r)b.vx*=d,b.vy*=d,b.x+=b.vx,b.y+=b.vy}let h=1/0,u=1/0,f=-1/0,g=-1/0;for(let p of r)h=Math.min(h,p.x-p.width/2),u=Math.min(u,p.y-p.height/2),f=Math.max(f,p.x+p.width/2),g=Math.max(g,p.y+p.height/2);let m=s-h,y=s-u,x=r.map(p=>({id:p.id,label:p.label,shape:p.shape,x:p.x-p.width/2+m,y:p.y-p.height/2+y,width:p.width,height:p.height})),A=new Map(x.map(p=>[p.id,p])),w=n.map(p=>{let b=A.get(p.source),k=A.get(p.target);if(!b||!k)return{source:p.source,target:p.target,label:p.label,style:p.style,hasArrowStart:p.hasArrowStart,hasArrowEnd:p.hasArrowEnd,points:[]};let M=[{x:b.x+b.width/2,y:b.y+b.height/2},{x:k.x+k.width/2,y:k.y+k.height/2}];return{source:p.source,target:p.target,label:p.label,style:p.style,hasArrowStart:p.hasArrowStart,hasArrowEnd:p.hasArrowEnd,points:M,labelPosition:p.label?it(M):void 0}}),$=f-h+s*2,v=g-u+s*2;return{width:$,height:v,nodes:x,edges:w,groups:[]}}function hn(t,n){let e=n.padding??20,s=120,i=e+s,r=t.title?30:0,o=e+r+s,a=t.slices.reduce((u,f)=>u+f.value,0);if(a===0)return{width:e*2,height:e*2,nodes:[],edges:[],groups:[]};let c=[],l=-Math.PI/2;for(let u=0;u<t.slices.length;u++){let f=t.slices[u],g=f.value/a*Math.PI*2,m=l+g/2,y=s*.65,x=i+y*Math.cos(m),A=o+y*Math.sin(m);c.push({id:`slice-${u}`,label:f.label,shape:"pie-slice",x:x-30,y:A-12,width:60,height:24,inlineStyle:{cx:String(i),cy:String(o),radius:String(s),startAngle:String(l),endAngle:String(l+g),value:String(f.value),percent:String(Math.round(f.value/a*100)),index:String(u)}}),l+=g}t.title&&c.unshift({id:"pie-title",label:t.title,shape:"pie-title",x:i-80,y:e,width:160,height:24});let d=i+s+e,h=o+s+e;return{width:d,height:h,nodes:c,edges:[],groups:[]}}function Lt(t,n,e,s,i,r,o,a){let c=Math.max(t.label.length*9+20,60),l=32,d={default:"rounded",rounded:"rounded",circle:"circle",bang:"hexagon",cloud:"cloud",hexagon:"hexagon"};if(o.push({id:t.id,label:t.label,shape:d[t.shape]||"rounded",x:n-c/2,y:e-l/2,width:c,height:l}),t.children.length===0)return;let h=i/Math.max(t.children.length,1),u=s-i/2+h/2,f=120+r*30;for(let g=0;g<t.children.length;g++){let m=t.children[g],y=u+g*h,x=n+f*Math.cos(y),A=e+f*Math.sin(y);a.push({source:t.id,target:m.id,style:"solid",hasArrowStart:!1,hasArrowEnd:!1,points:[{x:n,y:e},{x,y:A}]}),Lt(m,x,A,y,h*1.2,r+1,o,a)}}function un(t,n){let e=n.padding??40,s=[],i=[];Lt(t.root,300,300,0,Math.PI*2,0,s,i);let a=1/0,c=1/0,l=-1/0,d=-1/0;for(let m of s)a=Math.min(a,m.x),c=Math.min(c,m.y),l=Math.max(l,m.x+m.width),d=Math.max(d,m.y+m.height);let h=e-a,u=e-c;for(let m of s)m.x+=h,m.y+=u;for(let m of i)for(let y of m.points)y.x+=h,y.y+=u;let f=l-a+e*2,g=d-c+e*2;return{width:f,height:g,nodes:s,edges:i,groups:[]}}function fn(t,n){let e=n.padding??20,s=28,i=6,r=24,o=140,a=8,c=t.title?30:0;if(t.sections.flatMap($=>$.tasks).length===0)return{width:e*2,height:e*2,nodes:[],edges:[],groups:[]};let d=0,h=100,u=0,f=new Map;for(let $ of t.sections)for(let v of $.tasks){let p=u*15,b=30;if(v.afterId&&f.has(v.afterId)&&(p=f.get(v.afterId)),v.duration){let M=v.duration.match(/(\d+)d/);M?.[1]&&(b=parseInt(M[1]))}let k=p+b;v.id&&f.set(v.id,k),h=Math.max(h,k),u++}let g=(h-d)*a,m=[],y=[],x=e+c;u=0,t.title&&m.push({id:"gantt-title",label:t.title,shape:"gantt-title",x:e,y:e,width:o+g,height:24});for(let $ of t.sections){let v=x;m.push({id:`section-${$.name}`,label:$.name,shape:"gantt-section",x:e,y:x,width:o+g,height:r}),x+=r+i;for(let b of $.tasks){let k=u*15,M=30;if(b.afterId&&f.has(b.afterId)?k=f.get(b.afterId):b.startDate&&(k=u*15),b.duration){let C=b.duration.match(/(\d+)d/);C?.[1]&&(M=parseInt(C[1]))}let _=e+o+(k-d)*a,L=M*a;m.push({id:b.id||`task-${u}`,label:b.label,shape:"gantt-bar",x:_,y:x,width:L,height:s,inlineStyle:{status:b.status||"default",labelX:String(e),labelWidth:String(o)}}),x+=s+i,u++}let p=x-v;y.push({id:`group-${$.name}`,label:$.name,x:e,y:v,width:o+g,height:p,children:[]})}let A=e+o+g+e,w=x+e;return{width:A,height:w,nodes:m,edges:[],groups:[]}}function gn(t){let n=Array.from(t.nodes.values()).map(s=>{let i=t.classAssignments.get(s.id),r=i?t.classDefs.get(i):void 0,o=t.nodeStyles.get(s.id),a={...r,...o};return{id:s.id,label:s.label,shape:s.shape,inlineStyle:Object.keys(a).length>0?a:void 0}}),e=t.edges.map(s=>({source:s.source,target:s.target,label:s.label,style:s.style,hasArrowStart:s.hasArrowStart,hasArrowEnd:s.hasArrowEnd}));return{nodes:n,edges:e}}function pn(t){let n=Array.from(t.classes.values()).map(s=>{let i=s.label||s.id;return{id:s.id,label:i,shape:"rectangle"}}),e=t.relations.map(s=>({source:s.from,target:s.to,label:s.label,style:"solid",hasArrowStart:!1,hasArrowEnd:!0}));return{nodes:n,edges:e}}function mn(t){let n=Array.from(t.entities.values()).map(s=>({id:s.id,label:s.id,shape:"rectangle"})),e=t.relations.map(s=>({source:s.from,target:s.to,label:s.label,style:"solid",hasArrowStart:!1,hasArrowEnd:!0}));return{nodes:n,edges:e}}function Nt(t){let n=[...t.nodeIds];for(let e of t.children)n.push(...Nt(e));return n}function Pt(t,n,e){return t.map(s=>{let i=Pt(s.children,n,e),o=Nt(s).map(f=>n.get(f)).filter(Boolean);if(o.length===0&&i.length===0)return null;let a=1/0,c=1/0,l=-1/0,d=-1/0;for(let f of o)a=Math.min(a,f.x),c=Math.min(c,f.y),l=Math.max(l,f.x+f.width),d=Math.max(d,f.y+f.height);for(let f of i)a=Math.min(a,f.x),c=Math.min(c,f.y),l=Math.max(l,f.x+f.width),d=Math.max(d,f.y+f.height);let h=e,u=20;return{id:s.id,label:s.label,x:a-h,y:c-h-u,width:l-a+h*2,height:d-c+h*2+u,children:i}}).filter(Boolean)}function Ct(t,n,e,s,i){let r=e.direction??s??"TB",o=t.map(p=>{let b=rt(p.label,p.shape);return{id:p.id,width:b.width,height:b.height}}),a=n.map(p=>({source:p.source,target:p.target,weight:1})),c=rn(o,a,{...e,direction:r}),l=t.map(p=>{let b=c.nodePositions.get(p.id)??{x:0,y:0},k=rt(p.label,p.shape);return{id:p.id,label:p.label,shape:p.shape,x:b.x-k.width/2,y:b.y-k.height/2,width:k.width,height:k.height,inlineStyle:p.inlineStyle}}),d=new Map(l.map(p=>[p.id,p])),h=n.map(p=>{let b=d.get(p.source),k=d.get(p.target);if(!b||!k)return{source:p.source,target:p.target,label:p.label,style:p.style,hasArrowStart:p.hasArrowStart,hasArrowEnd:p.hasArrowEnd,points:[]};let M=c.edgeRoutes.get(`${p.source}->${p.target}`)??[{x:b.x+b.width/2,y:b.y+b.height/2},{x:k.x+k.width/2,y:k.y+k.height/2}],_={x:b.x+b.width/2,y:b.y+b.height/2,width:b.width,height:b.height},L={x:k.x+k.width/2,y:k.y+k.height/2,width:k.width,height:k.height},C=cn(_,L,M,b.shape,k.shape,r);return{source:p.source,target:p.target,label:p.label,style:p.style,hasArrowStart:p.hasArrowStart,hasArrowEnd:p.hasArrowEnd,points:C,labelPosition:p.label?it(C):void 0}}),u=1/0,f=1/0,g=-1/0,m=-1/0;for(let p of l)u=Math.min(u,p.x),f=Math.min(f,p.y),g=Math.max(g,p.x+p.width),m=Math.max(m,p.y+p.height);for(let p of h)for(let b of p.points)u=Math.min(u,b.x),f=Math.min(f,b.y),g=Math.max(g,b.x),m=Math.max(m,b.y);let y=e.padding??20,x=y-u,A=y-f;for(let p of l)p.x+=x,p.y+=A;for(let p of h){for(let b of p.points)b.x+=x,b.y+=A;p.labelPosition&&(p.labelPosition.x+=x,p.labelPosition.y+=A)}let w=g-u+y*2,$=m-f+y*2,v=i?Pt(i,d,12):[];return{width:w,height:$,nodes:l,edges:h,groups:v}}function U(t,n={}){let e={nodeSpacing:40,layerSpacing:60,padding:20,...n};if(t.type==="sequence")return ln(t,e);if(t.type==="flowchart"){let{nodes:s,edges:i}=gn(t);return Ct(s,i,e,t.direction,t.subgraphs)}if(t.type==="class"){let{nodes:s,edges:i}=pn(t);return Ct(s,i,e,"TB")}if(t.type==="er"){let{nodes:s,edges:i}=mn(t);return dn(s,i,e)}if(t.type==="pie")return hn(t,e);if(t.type==="gantt")return fn(t,e);if(t.type==="mindmap")return un(t,e);throw new Error(`Unsupported diagram type: ${t.type}`)}function W(t,n,e){let s=It(t),i=It(n),r=e/100,o=Math.round(s.r*r+i.r*(1-r)),a=Math.round(s.g*r+i.g*(1-r)),c=Math.round(s.b*r+i.b*(1-r));return bn(o,a,c)}function It(t){let n=t.replace("#",""),e=Number.parseInt(n.slice(0,2),16),s=Number.parseInt(n.slice(2,4),16),i=Number.parseInt(n.slice(4,6),16);return{r:e,g:s,b:i}}function bn(t,n,e){return`#${[t,n,e].map(s=>s.toString(16).padStart(2,"0")).join("")}`}function G(t){let n=t.bg,e=t.fg,s=t.accent??W(e,n,50);return{bg:n,fg:e,text:e,line:t.line??W(e,n,30),arrow:s,muted:t.muted??W(e,n,50),nodeFill:t.surface??W(e,n,12),nodeStroke:t.border??W(s,n,65),groupFill:W(e,n,5),groupStroke:W(e,n,15),groupText:W(e,n,60),font:t.font??"ui-sans-serif, system-ui, sans-serif",monoFont:t.monoFont??"ui-monospace, monospace"}}var ot={"zinc-dark":{bg:"#18181B",fg:"#FAFAFA"},"zinc-light":{bg:"#FAFAFA",fg:"#18181B"},"tokyo-night":{bg:"#1a1b26",fg:"#a9b1d6",line:"#3d59a1",accent:"#7aa2f7"},"catppuccin-mocha":{bg:"#1e1e2e",fg:"#cdd6f4",accent:"#cba6f7",line:"#585b70"},"catppuccin-latte":{bg:"#eff1f5",fg:"#4c4f69",accent:"#8839ef",line:"#9ca0b0"},nord:{bg:"#2e3440",fg:"#d8dee9",accent:"#88c0d0",line:"#4c566a"},dracula:{bg:"#282a36",fg:"#f8f8f2",accent:"#bd93f9",line:"#6272a4"},"github-light":{bg:"#ffffff",fg:"#1f2328",accent:"#0969da",line:"#d1d9e0"},"github-dark":{bg:"#0d1117",fg:"#e6edf3",accent:"#58a6ff",line:"#30363d"},"one-dark":{bg:"#282c34",fg:"#abb2bf",accent:"#c678dd",line:"#3e4451"},"solarized-dark":{bg:"#002b36",fg:"#839496",accent:"#268bd2",line:"#073642"},"solarized-light":{bg:"#fdf6e3",fg:"#657b83",accent:"#268bd2",line:"#eee8d5"},monokai:{bg:"#272822",fg:"#f8f8f2",accent:"#a6e22e",line:"#49483e"},"gruvbox-dark":{bg:"#282828",fg:"#ebdbb2",accent:"#fabd2f",line:"#504945"},"gruvbox-light":{bg:"#fbf1c7",fg:"#3c3836",accent:"#d79921",line:"#d5c4a1"},"rose-pine":{bg:"#191724",fg:"#e0def4",accent:"#c4a7e7",line:"#26233a"},"rose-pine-dawn":{bg:"#faf4ed",fg:"#575279",accent:"#907aa9",line:"#f2e9e1"},"ayu-dark":{bg:"#0a0e14",fg:"#b3b1ad",accent:"#ffb454",line:"#11151c"},"ayu-light":{bg:"#fafafa",fg:"#575f66",accent:"#ff9940",line:"#f0f0f0"},vesper:{bg:"#101010",fg:"#ffffff",accent:"#ffc799",line:"#232323"},"vitesse-dark":{bg:"#121212",fg:"#dbd7caee",accent:"#4d9375",line:"#282828"},"vitesse-light":{bg:"#ffffff",fg:"#393a34",accent:"#1e754f",line:"#f1f1f1"},kanagawa:{bg:"#1f1f28",fg:"#dcd7ba",accent:"#7e9cd8",line:"#2a2a37"},"everforest-dark":{bg:"#2d353b",fg:"#d3c6aa",accent:"#a7c080",line:"#3d484d"},"everforest-light":{bg:"#fdf6e3",fg:"#5c6a72",accent:"#8da101",line:"#efebd4"},"material-dark":{bg:"#263238",fg:"#eeffff",accent:"#82aaff",line:"#37474f"},"material-light":{bg:"#fafafa",fg:"#546e7a",accent:"#6182b8",line:"#e7e7e8"},poimandres:{bg:"#1b1e28",fg:"#a6accd",accent:"#add7ff",line:"#303340"},"night-owl":{bg:"#011627",fg:"#d6deeb",accent:"#82aaff",line:"#122d42"},"one-hunter":{bg:"#1e2127",fg:"#c0c5cf",accent:"#e06c75",line:"#2c313a",surface:"#282c34",border:"#3e4451"}},B={bg:"#ffffff",fg:"#27272a"};function yn(t,n){let{points:e,style:s,hasArrowStart:i,hasArrowEnd:r}=t;if(e.length<2)return"";let o=e.map((h,u)=>`${u===0?"M":"L"} ${h.x} ${h.y}`).join(" "),a="",c="1.5";return s==="dotted"?a='stroke-dasharray="6 4"':s==="thick"&&(c="2.5"),`<path d="${o}" stroke="var(--_line)" stroke-width="${c}" fill="none" stroke-linejoin="round" stroke-linecap="round" ${a} ${i?'marker-start="url(#arrowhead-start)"':""} ${r?'marker-end="url(#arrowhead)"':""}/>`}function lt(t){return t.split(/<br\s*\/?>|\n/)}function xn(t,n){if(t.shape==="pie-slice"){let l=t.x+t.width/2,d=t.y+t.height/2,h=t.inlineStyle?.percent||"";return`<text x="${l}" y="${d}" text-anchor="middle" dominant-baseline="middle" fill="var(--_text)" font-family="${n.font}" font-size="11" font-weight="600">${H(t.label)} ${h}%</text>`}if(t.shape==="pie-title"){let l=t.x+t.width/2,d=t.y+t.height/2;return`<text x="${l}" y="${d}" text-anchor="middle" dominant-baseline="middle" fill="var(--_text)" font-family="${n.font}" font-size="16" font-weight="600">${H(t.label)}</text>`}if(t.shape==="gantt-title"){let l=t.x+t.width/2,d=t.y+t.height/2;return`<text x="${l}" y="${d}" text-anchor="middle" dominant-baseline="middle" fill="var(--_text)" font-family="${n.font}" font-size="16" font-weight="600">${H(t.label)}</text>`}if(t.shape==="gantt-section"){let l=t.x+8,d=t.y+t.height/2;return`<text x="${l}" y="${d}" dominant-baseline="middle" fill="var(--_group-text)" font-family="${n.font}" font-size="12" font-weight="600">${H(t.label)}</text>`}if(t.shape==="gantt-bar"){let l=parseFloat(t.inlineStyle?.labelX||"0")+4,d=t.y+t.height/2,h=`<text x="${t.x+6}" y="${d}" dominant-baseline="middle" fill="var(--bg)" font-family="${n.font}" font-size="11" font-weight="500">${H(t.label)}</text>`;return`<text x="${l}" y="${d}" dominant-baseline="middle" fill="var(--_text)" font-family="${n.font}" font-size="11" font-weight="400">${H(t.label)}</text>`+h}let e=lt(t.label),s=t.x+t.width/2,i=t.y+t.height/2,r=16,o=e.length*r,a=i-o/2+r/2,c=e.map((l,d)=>{let h=a+d*r;return`<tspan x="${s}" y="${h}" text-anchor="middle" dominant-baseline="middle">${H(l)}</tspan>`}).join("");return`<text fill="var(--_text)" font-family="${n.font}" font-size="14" font-weight="400">${c}</text>`}function wn(t,n){if(!t.label||!t.labelPosition)return"";let{x:e,y:s}=t.labelPosition,i=lt(t.label),r=14,o=i.length*r,a=4,c=Math.max(...i.map(y=>y.length*7))+a*2,l=o+a*2,d=e-c/2,h=s-l/2,u=`<rect x="${d}" y="${h}" width="${c}" height="${l}" fill="var(--bg)" stroke="var(--_line)" stroke-width="0.75" rx="3"/>`,f=s-o/2+r/2,g=i.map((y,x)=>{let A=f+x*r;return`<tspan x="${e}" y="${A}" text-anchor="middle" dominant-baseline="middle">${H(y)}</tspan>`}).join(""),m=`<text fill="var(--_text)" font-family="${n.font}" font-size="11" font-weight="500">${g}</text>`;return u+m}function $n(t,n){let e=lt(t.label),s=t.x+8,i=t.y+8,r=14,o=e.map((a,c)=>{let l=i+c*r;return`<tspan x="${s}" y="${l}">${H(a)}</tspan>`}).join("");return`<text fill="var(--_group-text)" font-family="${n.font}" font-size="12" font-weight="600">${o}</text>`}function H(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}function kn(t){return`
		<defs>
			<marker id="arrowhead" markerWidth="12" markerHeight="8" refX="11" refY="4" orient="auto" markerUnits="userSpaceOnUse">
				<path d="M1,1 L11,4 L1,7 z" fill="var(--_arrow)" />
			</marker>
			<marker id="arrowhead-start" markerWidth="12" markerHeight="8" refX="1" refY="4" orient="auto" markerUnits="userSpaceOnUse">
				<path d="M11,1 L1,4 L11,7 z" fill="var(--_arrow)" />
			</marker>
			<marker id="arrowhead-open" markerWidth="12" markerHeight="8" refX="11" refY="4" orient="auto" markerUnits="userSpaceOnUse">
				<path d="M1,1 L11,4 L1,7" fill="none" stroke="var(--_arrow)" stroke-width="1.5" stroke-linejoin="round" />
			</marker>
			<marker id="arrowhead-cross" markerWidth="12" markerHeight="12" refX="6" refY="6" orient="auto" markerUnits="userSpaceOnUse">
				<path d="M3,3 L9,9 M9,3 L3,9" stroke="var(--_arrow)" stroke-width="1.5" stroke-linecap="round" />
			</marker>
		</defs>
	`}function An(t,n){return`<rect x="${t.x}" y="${t.y}" width="${t.width}" height="${t.height}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="1.5" rx="0"/>`}function zt(t,n){return`<rect x="${t.x}" y="${t.y}" width="${t.width}" height="${t.height}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="1.5" rx="8"/>`}function Sn(t,n){let e=t.x+t.width/2,s=t.y+t.height/2,i=t.width/2,r=t.height/2;return`<polygon points="${`${e},${s-r} ${e+i},${s} ${e},${s+r} ${e-i},${s}`}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="1.5"/>`}function vn(t,n){let e=Math.min(t.height/2,t.width/2);return`<rect x="${t.x}" y="${t.y}" width="${t.width}" height="${t.height}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="1.5" rx="${e}"/>`}function Mn(t,n){let e=t.x+t.width/2,s=t.y+t.height/2,i=Math.min(t.width,t.height)/2;return`<circle cx="${e}" cy="${s}" r="${i}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="1.5"/>`}function En(t,n){let e=`<rect x="${t.x}" y="${t.y}" width="${t.width}" height="${t.height}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="1.5" rx="0"/>`,s=4,i=`<rect x="${t.x+s}" y="${t.y+s}" width="${t.width-s*2}" height="${t.height-s*2}" fill="none" stroke="var(--_node-stroke)" stroke-width="1.5" rx="0"/>`;return e+i}function _n(t,n){let e=t.x+t.width/2,s=t.y+t.height/2,i=Math.min(t.width,t.height)/2,r=i-4;return`<circle cx="${e}" cy="${s}" r="${i}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="1.5"/><circle cx="${e}" cy="${s}" r="${r}" fill="none" stroke="var(--_node-stroke)" stroke-width="1.5"/>`}function Cn(t,n){let e=t.x+t.width/2,s=t.y+t.height/2,i=t.width/2,r=t.height/2,o=i*.3;return`<polygon points="${`${e-i+o},${s-r} ${e+i-o},${s-r} ${e+i},${s} ${e+i-o},${s+r} ${e-i+o},${s+r} ${e-i},${s}`}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="1.5"/>`}function Ln(t,n){let e=t.height*.1,s=t.x,i=t.y,r=t.width,o=t.height,a=`M ${s} ${i+e}
		Q ${s} ${i}, ${s+r/2} ${i}
		T ${s+r} ${i+e}
		L ${s+r} ${i+o-e}
		Q ${s+r} ${i+o}, ${s+r/2} ${i+o}
		T ${s} ${i+o-e}
		Z`,c=`<ellipse cx="${s+r/2}" cy="${i+e}" rx="${r/2}" ry="${e}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="1.5"/>`;return`<path d="${a}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="1.5"/>`+c}function Nn(t,n){let e=t.x,s=t.y,i=t.width,r=t.height,o=i*.15;return`<polygon points="${`${e},${s+r/2} ${e+o},${s} ${e+i},${s} ${e+i-o},${s+r} ${e},${s+r}`}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="1.5"/>`}function Pn(t,n){let e=t.x,s=t.y,i=t.width,r=t.height,o=i*.15;return`<polygon points="${`${e+o},${s} ${e+i-o},${s} ${e+i},${s+r} ${e},${s+r}`}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="1.5"/>`}function In(t,n){let e=t.x,s=t.y,i=t.width,r=t.height,o=i*.15;return`<polygon points="${`${e},${s} ${e+i},${s} ${e+i-o},${s+r} ${e+o},${s+r}`}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="1.5"/>`}function Dn(t,n){let e=t.x,s=t.y,i=t.width,r=t.height,o=i*.15;return`<polygon points="${`${e+o},${s} ${e+i},${s} ${e+i-o},${s+r} ${e},${s+r}`}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="1.5"/>`}function Tn(t,n){let e=t.x,s=t.y,i=t.width,r=t.height,o=Math.min(i,r)*.15;return`<path d="${`M ${e} ${s} L ${e+i-o} ${s} L ${e+i} ${s+o} L ${e+i} ${s+r} L ${e} ${s+r} Z M ${e+i-o} ${s} L ${e+i-o} ${s+o} L ${e+i} ${s+o}`}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="1.5"/>`}function Rn(t,n){let e=t.x,s=t.y,i=t.width,r=t.height;return`<path d="${`M ${e+i*.25} ${s+r*.4}
		Q ${e} ${s+r*.4}, ${e} ${s+r*.6}
		Q ${e} ${s+r}, ${e+i*.2} ${s+r}
		Q ${e+i*.3} ${s+r}, ${e+i*.5} ${s+r*.95}
		Q ${e+i*.7} ${s+r}, ${e+i*.8} ${s+r}
		Q ${e+i} ${s+r}, ${e+i} ${s+r*.6}
		Q ${e+i} ${s+r*.4}, ${e+i*.75} ${s+r*.4}
		Q ${e+i*.8} ${s}, ${e+i*.5} ${s}
		Q ${e+i*.2} ${s}, ${e+i*.25} ${s+r*.4}
		Z`}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="1.5"/>`}function zn(t,n){let e=t.x+t.width/2,s=t.y+t.height/2,i=Math.min(t.width,t.height)/4;return`<circle cx="${e}" cy="${s}" r="${i}" fill="var(--_text)" stroke="none"/>`}function Hn(t,n){let e=t.x+t.width/2,s=t.y+t.height/2,i=Math.min(t.width,t.height)/3,r=i*.6;return`<circle cx="${e}" cy="${s}" r="${i}" fill="none" stroke="var(--_text)" stroke-width="2"/><circle cx="${e}" cy="${s}" r="${r}" fill="var(--_text)" stroke="none"/>`}var Dt=["#4e79a7","#f28e2b","#e15759","#76b7b2","#59a14f","#edc948","#b07aa1","#ff9da7","#9c755f","#bab0ac"];function Wn(t,n){if(!t.inlineStyle)return"";let e=parseFloat(t.inlineStyle.cx),s=parseFloat(t.inlineStyle.cy),i=parseFloat(t.inlineStyle.radius),r=parseFloat(t.inlineStyle.startAngle),o=parseFloat(t.inlineStyle.endAngle),a=parseInt(t.inlineStyle.index),c=Dt[a%Dt.length],l=e+i*Math.cos(r),d=s+i*Math.sin(r),h=e+i*Math.cos(o),u=s+i*Math.sin(o),f=o-r>Math.PI?1:0;return`<path d="${`M ${e} ${s} L ${l} ${d} A ${i} ${i} 0 ${f} 1 ${h} ${u} Z`}" fill="${c}" stroke="var(--bg)" stroke-width="2"/>`}function Bn(t,n){return""}function Xn(t,n){return`<rect x="${t.x}" y="${t.y}" width="${t.width}" height="${t.height}" fill="var(--_group-fill)" stroke="none" rx="2"/>`}function Yn(t,n){let e=t.inlineStyle?.status||"default",s="var(--_node-fill)",i="var(--_node-stroke)";return e==="done"&&(s="var(--_muted)"),e==="active"&&(s="var(--_node-stroke)"),e==="crit"&&(s="#e15759",i="#c44040"),`<rect x="${t.x}" y="${t.y}" width="${t.width}" height="${t.height}" fill="${s}" stroke="${i}" stroke-width="1" rx="4"/>`}function Fn(t,n){return""}var On={rectangle:An,rounded:zt,diamond:Sn,stadium:vn,circle:Mn,subroutine:En,doublecircle:_n,hexagon:Cn,cylinder:Ln,asymmetric:Nn,trapezoid:Pn,"trapezoid-alt":In,parallelogram:Dn,note:Tn,cloud:Rn,"state-start":zn,"state-end":Hn,"pie-slice":Wn,"pie-title":Bn,"gantt-section":Xn,"gantt-bar":Yn,"gantt-title":Fn};function Un(t,n){let e=On[t.shape];return e?e(t,n):zt(t)}function qn(t,n){return`<rect x="${t.x}" y="${t.y}" width="${t.width}" height="${t.height}" fill="var(--_group-fill)" stroke="var(--_group-stroke)" stroke-width="1.5" rx="4"/>`}function Ht(t,n){return t.flatMap(e=>{let s=e.children.length>0?Ht(e.children,n):"";return qn(e)+$n(e,n)+s}).join("")}function Gn(t,n){if(!n.debug)return"";let e=[],s=50,i=t.width+n.padding*2,r=t.height+n.padding*2;for(let o=0;o<=i;o+=s)e.push(`<line x1="${o}" y1="0" x2="${o}" y2="${r}" stroke="rgba(255,255,255,0.08)" stroke-width="0.5"/>`),e.push(`<text x="${o+2}" y="10" fill="rgba(255,255,255,0.3)" font-size="8" font-family="monospace">${o}</text>`);for(let o=0;o<=r;o+=s)e.push(`<line x1="0" y1="${o}" x2="${i}" y2="${o}" stroke="rgba(255,255,255,0.08)" stroke-width="0.5"/>`),e.push(`<text x="2" y="${o-2}" fill="rgba(255,255,255,0.3)" font-size="8" font-family="monospace">${o}</text>`);for(let o of t.nodes)e.push(`<rect x="${o.x}" y="${o.y}" width="${o.width}" height="${o.height}" fill="none" stroke="rgba(239,68,68,0.5)" stroke-width="0.5" stroke-dasharray="3 2"/>`),e.push(`<text x="${o.x}" y="${o.y-4}" fill="rgba(239,68,68,0.7)" font-size="9" font-family="monospace">${o.id}</text>`);for(let o of t.edges)for(let a of o.points)e.push(`<circle cx="${a.x}" cy="${a.y}" r="3" fill="rgba(59,130,246,0.6)" stroke="rgba(59,130,246,0.8)" stroke-width="0.5"/>`);return`<g class="debug-overlays">${e.join("")}</g>`}function Z(t,n){let e=n?.theme??B,s=n?.padding??16,i=n?.transparent??!1,r=n?.debug??!1,o=G(e),a={colors:o,padding:s,transparent:i,debug:r,font:o.font},c=t.width+s*2,l=t.height+s*2,d=i?"none":o.bg,h=`cm-${Math.random().toString(36).slice(2,8)}`,f=`
		<style>
			@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap');
			#${h} {
				--bg: ${o.bg};
				--fg: ${o.fg};
				--_text: ${o.text};
				--_line: ${o.line};
				--_arrow: ${o.arrow};
				--_node-fill: ${o.nodeFill};
				--_node-stroke: ${o.nodeStroke};
				--_muted: ${o.muted};
				--_group-fill: ${o.groupFill};
				--_group-stroke: ${o.groupStroke};
				--_group-text: ${o.groupText};
			}
		</style>
	`,g=kn(),m=Ht(t.groups,a),y=t.edges.map(v=>yn(v)).join(""),x=t.edges.map(v=>wn(v,a)).join(""),A=t.nodes.map(v=>{let p=Un(v,a),b=xn(v,a);return p+b}).join(""),w=Gn(t,a);return`
		<svg id="${h}" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 ${c} ${l}" width="${c}" height="${l}">
			${f}
			<rect width="${c}" height="${l}" fill="${d}"/>
			${g}
			<g transform="translate(${s}, ${s})">
				${m}
				${y}
				${x}
				${A}
			</g>
			${w}
		</svg>
	`.split(`
`).map(v=>v.trim()).filter(Boolean).join(`
`)}var Wt="http://www.w3.org/2000/svg";function S(t){return document.createElementNS(Wt,t)}function dt(t){return t.split(/<br\s*\/?>|\n/)}function jn(t,n){let e=S("rect");return e.setAttribute("x",String(t.x)),e.setAttribute("y",String(t.y)),e.setAttribute("width",String(t.width)),e.setAttribute("height",String(t.height)),e.setAttribute("fill","var(--_group-fill)"),e.setAttribute("stroke","var(--_group-stroke)"),e.setAttribute("stroke-width","1.5"),e.setAttribute("rx","4"),e}function Qn(t,n){let e=dt(t.label),s=t.x+8,i=t.y+8,r=14,o=S("text");return o.setAttribute("fill","var(--_group-text)"),o.setAttribute("font-family",n.font),o.setAttribute("font-size","12"),o.setAttribute("font-weight","600"),e.forEach((a,c)=>{let l=S("tspan");l.setAttribute("x",String(s)),l.setAttribute("y",String(i+c*r)),l.textContent=a,o.appendChild(l)}),o}function Bt(t,n,e){t.forEach(s=>{e.appendChild(jn(s)),e.appendChild(Qn(s,n)),s.children.length>0&&Bt(s.children,n,e)})}function Vn(t,n){let e=t.x,s=t.y,i=t.width,r=t.height,o=e+i/2,a=s+r/2;switch(t.shape){case"rectangle":{let c=S("rect");return c.setAttribute("x",String(e)),c.setAttribute("y",String(s)),c.setAttribute("width",String(i)),c.setAttribute("height",String(r)),c.setAttribute("fill","var(--_node-fill)"),c.setAttribute("stroke","var(--_node-stroke)"),c.setAttribute("stroke-width","1.5"),c.setAttribute("rx","0"),c}case"rounded":{let c=S("rect");return c.setAttribute("x",String(e)),c.setAttribute("y",String(s)),c.setAttribute("width",String(i)),c.setAttribute("height",String(r)),c.setAttribute("fill","var(--_node-fill)"),c.setAttribute("stroke","var(--_node-stroke)"),c.setAttribute("stroke-width","1.5"),c.setAttribute("rx","8"),c}case"diamond":{let c=i/2,l=r/2,d=`${o},${a-l} ${o+c},${a} ${o},${a+l} ${o-c},${a}`,h=S("polygon");return h.setAttribute("points",d),h.setAttribute("fill","var(--_node-fill)"),h.setAttribute("stroke","var(--_node-stroke)"),h.setAttribute("stroke-width","1.5"),h}case"stadium":{let c=Math.min(r/2,i/2),l=S("rect");return l.setAttribute("x",String(e)),l.setAttribute("y",String(s)),l.setAttribute("width",String(i)),l.setAttribute("height",String(r)),l.setAttribute("fill","var(--_node-fill)"),l.setAttribute("stroke","var(--_node-stroke)"),l.setAttribute("stroke-width","1.5"),l.setAttribute("rx",String(c)),l}case"circle":{let c=Math.min(i,r)/2,l=S("circle");return l.setAttribute("cx",String(o)),l.setAttribute("cy",String(a)),l.setAttribute("r",String(c)),l.setAttribute("fill","var(--_node-fill)"),l.setAttribute("stroke","var(--_node-stroke)"),l.setAttribute("stroke-width","1.5"),l}case"subroutine":{let c=S("g"),l=S("rect");l.setAttribute("x",String(e)),l.setAttribute("y",String(s)),l.setAttribute("width",String(i)),l.setAttribute("height",String(r)),l.setAttribute("fill","var(--_node-fill)"),l.setAttribute("stroke","var(--_node-stroke)"),l.setAttribute("stroke-width","1.5"),l.setAttribute("rx","0");let d=4,h=S("rect");return h.setAttribute("x",String(e+d)),h.setAttribute("y",String(s+d)),h.setAttribute("width",String(i-d*2)),h.setAttribute("height",String(r-d*2)),h.setAttribute("fill","none"),h.setAttribute("stroke","var(--_node-stroke)"),h.setAttribute("stroke-width","1.5"),h.setAttribute("rx","0"),c.appendChild(l),c.appendChild(h),c}case"doublecircle":{let c=S("g"),l=Math.min(i,r)/2,d=l-4,h=S("circle");h.setAttribute("cx",String(o)),h.setAttribute("cy",String(a)),h.setAttribute("r",String(l)),h.setAttribute("fill","var(--_node-fill)"),h.setAttribute("stroke","var(--_node-stroke)"),h.setAttribute("stroke-width","1.5");let u=S("circle");return u.setAttribute("cx",String(o)),u.setAttribute("cy",String(a)),u.setAttribute("r",String(d)),u.setAttribute("fill","none"),u.setAttribute("stroke","var(--_node-stroke)"),u.setAttribute("stroke-width","1.5"),c.appendChild(h),c.appendChild(u),c}case"hexagon":{let c=i/2,l=r/2,d=c*.3,h=`${o-c+d},${a-l} ${o+c-d},${a-l} ${o+c},${a} ${o+c-d},${a+l} ${o-c+d},${a+l} ${o-c},${a}`,u=S("polygon");return u.setAttribute("points",h),u.setAttribute("fill","var(--_node-fill)"),u.setAttribute("stroke","var(--_node-stroke)"),u.setAttribute("stroke-width","1.5"),u}case"cylinder":{let c=S("g"),l=r*.1,d=`M ${e} ${s+l}
				Q ${e} ${s}, ${e+i/2} ${s}
				T ${e+i} ${s+l}
				L ${e+i} ${s+r-l}
				Q ${e+i} ${s+r}, ${e+i/2} ${s+r}
				T ${e} ${s+r-l}
				Z`,h=S("path");h.setAttribute("d",d),h.setAttribute("fill","var(--_node-fill)"),h.setAttribute("stroke","var(--_node-stroke)"),h.setAttribute("stroke-width","1.5");let u=S("ellipse");return u.setAttribute("cx",String(e+i/2)),u.setAttribute("cy",String(s+l)),u.setAttribute("rx",String(i/2)),u.setAttribute("ry",String(l)),u.setAttribute("fill","var(--_node-fill)"),u.setAttribute("stroke","var(--_node-stroke)"),u.setAttribute("stroke-width","1.5"),c.appendChild(h),c.appendChild(u),c}case"asymmetric":{let c=i*.15,l=`${e},${s+r/2} ${e+c},${s} ${e+i},${s} ${e+i-c},${s+r} ${e},${s+r}`,d=S("polygon");return d.setAttribute("points",l),d.setAttribute("fill","var(--_node-fill)"),d.setAttribute("stroke","var(--_node-stroke)"),d.setAttribute("stroke-width","1.5"),d}case"trapezoid":{let c=i*.15,l=`${e+c},${s} ${e+i-c},${s} ${e+i},${s+r} ${e},${s+r}`,d=S("polygon");return d.setAttribute("points",l),d.setAttribute("fill","var(--_node-fill)"),d.setAttribute("stroke","var(--_node-stroke)"),d.setAttribute("stroke-width","1.5"),d}case"trapezoid-alt":{let c=i*.15,l=`${e},${s} ${e+i},${s} ${e+i-c},${s+r} ${e+c},${s+r}`,d=S("polygon");return d.setAttribute("points",l),d.setAttribute("fill","var(--_node-fill)"),d.setAttribute("stroke","var(--_node-stroke)"),d.setAttribute("stroke-width","1.5"),d}case"parallelogram":{let c=i*.15,l=`${e+c},${s} ${e+i},${s} ${e+i-c},${s+r} ${e},${s+r}`,d=S("polygon");return d.setAttribute("points",l),d.setAttribute("fill","var(--_node-fill)"),d.setAttribute("stroke","var(--_node-stroke)"),d.setAttribute("stroke-width","1.5"),d}case"note":{let c=Math.min(i,r)*.15,l=`M ${e} ${s} L ${e+i-c} ${s} L ${e+i} ${s+c} L ${e+i} ${s+r} L ${e} ${s+r} Z M ${e+i-c} ${s} L ${e+i-c} ${s+c} L ${e+i} ${s+c}`,d=S("path");return d.setAttribute("d",l),d.setAttribute("fill","var(--_node-fill)"),d.setAttribute("stroke","var(--_node-stroke)"),d.setAttribute("stroke-width","1.5"),d}case"cloud":{let c=`M ${e+i*.25} ${s+r*.4}
				Q ${e} ${s+r*.4}, ${e} ${s+r*.6}
				Q ${e} ${s+r}, ${e+i*.2} ${s+r}
				Q ${e+i*.3} ${s+r}, ${e+i*.5} ${s+r*.95}
				Q ${e+i*.7} ${s+r}, ${e+i*.8} ${s+r}
				Q ${e+i} ${s+r}, ${e+i} ${s+r*.6}
				Q ${e+i} ${s+r*.4}, ${e+i*.75} ${s+r*.4}
				Q ${e+i*.8} ${s}, ${e+i*.5} ${s}
				Q ${e+i*.2} ${s}, ${e+i*.25} ${s+r*.4}
				Z`,l=S("path");return l.setAttribute("d",c),l.setAttribute("fill","var(--_node-fill)"),l.setAttribute("stroke","var(--_node-stroke)"),l.setAttribute("stroke-width","1.5"),l}case"state-start":{let c=Math.min(i,r)/4,l=S("circle");return l.setAttribute("cx",String(o)),l.setAttribute("cy",String(a)),l.setAttribute("r",String(c)),l.setAttribute("fill","var(--_text)"),l.setAttribute("stroke","none"),l}case"state-end":{let c=S("g"),l=Math.min(i,r)/3,d=l*.6,h=S("circle");h.setAttribute("cx",String(o)),h.setAttribute("cy",String(a)),h.setAttribute("r",String(l)),h.setAttribute("fill","none"),h.setAttribute("stroke","var(--_text)"),h.setAttribute("stroke-width","2");let u=S("circle");return u.setAttribute("cx",String(o)),u.setAttribute("cy",String(a)),u.setAttribute("r",String(d)),u.setAttribute("fill","var(--_text)"),u.setAttribute("stroke","none"),c.appendChild(h),c.appendChild(u),c}default:{let c=S("rect");return c.setAttribute("x",String(e)),c.setAttribute("y",String(s)),c.setAttribute("width",String(i)),c.setAttribute("height",String(r)),c.setAttribute("fill","var(--_node-fill)"),c.setAttribute("stroke","var(--_node-stroke)"),c.setAttribute("stroke-width","1.5"),c.setAttribute("rx","8"),c}}}function Kn(t,n){let e=dt(t.label),s=t.x+t.width/2,i=t.y+t.height/2,r=16,o=e.length*r,a=i-o/2+r/2,c=S("text");return c.setAttribute("fill","var(--_text)"),c.setAttribute("font-family",n.font),c.setAttribute("font-size","14"),c.setAttribute("font-weight","400"),e.forEach((l,d)=>{let h=S("tspan");h.setAttribute("x",String(s)),h.setAttribute("y",String(a+d*r)),h.setAttribute("text-anchor","middle"),h.setAttribute("dominant-baseline","middle"),h.textContent=l,c.appendChild(h)}),c}function Zn(t,n,e){let s=S("g");return s.setAttribute("data-node-id",t.id),s.setAttribute("role","img"),s.setAttribute("aria-label",t.label),e.interactive&&(s.style.cursor="pointer",e.onNodeClick&&s.addEventListener("click",i=>{e.onNodeClick?.(t.id,i)}),e.onNodeHover&&(s.addEventListener("mouseenter",i=>{e.onNodeHover?.(t.id,i)}),s.addEventListener("mouseleave",i=>{e.onNodeHover?.(null,i)}))),s.appendChild(Vn(t)),s.appendChild(Kn(t,n)),s}function Jn(t,n,e){let s=S("g");if(s.setAttribute("data-edge-source",t.source),s.setAttribute("data-edge-target",t.target),t.points.length<2)return s;let i=t.points.map((o,a)=>`${a===0?"M":"L"} ${o.x} ${o.y}`).join(" "),r=S("path");return r.setAttribute("d",i),r.setAttribute("stroke","var(--_line)"),r.setAttribute("fill","none"),r.setAttribute("stroke-linejoin","round"),r.setAttribute("stroke-linecap","round"),t.style==="dotted"?(r.setAttribute("stroke-dasharray","6 4"),r.setAttribute("stroke-width","1.5")):t.style==="thick"?r.setAttribute("stroke-width","2.5"):r.setAttribute("stroke-width","1.5"),t.hasArrowStart&&r.setAttribute("marker-start","url(#arrowhead-start)"),t.hasArrowEnd&&r.setAttribute("marker-end","url(#arrowhead)"),e.interactive&&e.onEdgeClick&&(r.style.cursor="pointer",r.addEventListener("click",o=>{e.onEdgeClick?.(t.source,t.target,o)})),s.appendChild(r),s}function ts(t,n){let e=S("g");if(!t.label||!t.labelPosition)return e;let{x:s,y:i}=t.labelPosition,r=dt(t.label),o=14,a=r.length*o,c=4,l=Math.max(...r.map(y=>y.length*7))+c*2,d=a+c*2,h=s-l/2,u=i-d/2,f=S("rect");f.setAttribute("x",String(h)),f.setAttribute("y",String(u)),f.setAttribute("width",String(l)),f.setAttribute("height",String(d)),f.setAttribute("fill","var(--bg)"),f.setAttribute("stroke","var(--_line)"),f.setAttribute("stroke-width","0.75"),f.setAttribute("rx","3");let g=S("text");g.setAttribute("fill","var(--_text)"),g.setAttribute("font-family",n.font),g.setAttribute("font-size","11"),g.setAttribute("font-weight","500");let m=i-a/2+o/2;return r.forEach((y,x)=>{let A=S("tspan");A.setAttribute("x",String(s)),A.setAttribute("y",String(m+x*o)),A.setAttribute("text-anchor","middle"),A.setAttribute("dominant-baseline","middle"),A.textContent=y,g.appendChild(A)}),e.appendChild(f),e.appendChild(g),e}function es(t){let n=S("defs"),e=S("marker");e.setAttribute("id","arrowhead"),e.setAttribute("markerWidth","12"),e.setAttribute("markerHeight","8"),e.setAttribute("refX","11"),e.setAttribute("refY","4"),e.setAttribute("orient","auto"),e.setAttribute("markerUnits","userSpaceOnUse");let s=S("path");s.setAttribute("d","M1,1 L11,4 L1,7 z"),s.setAttribute("fill","var(--_arrow)"),e.appendChild(s);let i=S("marker");i.setAttribute("id","arrowhead-start"),i.setAttribute("markerWidth","12"),i.setAttribute("markerHeight","8"),i.setAttribute("refX","1"),i.setAttribute("refY","4"),i.setAttribute("orient","auto"),i.setAttribute("markerUnits","userSpaceOnUse");let r=S("path");r.setAttribute("d","M11,1 L1,4 L11,7 z"),r.setAttribute("fill","var(--_arrow)"),i.appendChild(r);let o=S("marker");o.setAttribute("id","arrowhead-open"),o.setAttribute("markerWidth","12"),o.setAttribute("markerHeight","8"),o.setAttribute("refX","11"),o.setAttribute("refY","4"),o.setAttribute("orient","auto"),o.setAttribute("markerUnits","userSpaceOnUse");let a=S("path");a.setAttribute("d","M1,1 L11,4 L1,7"),a.setAttribute("fill","none"),a.setAttribute("stroke","var(--_arrow)"),a.setAttribute("stroke-width","1.5"),a.setAttribute("stroke-linejoin","round"),o.appendChild(a);let c=S("marker");c.setAttribute("id","arrowhead-cross"),c.setAttribute("markerWidth","12"),c.setAttribute("markerHeight","12"),c.setAttribute("refX","6"),c.setAttribute("refY","6"),c.setAttribute("orient","auto"),c.setAttribute("markerUnits","userSpaceOnUse");let l=S("path");return l.setAttribute("d","M3,3 L9,9 M9,3 L3,9"),l.setAttribute("stroke","var(--_arrow)"),l.setAttribute("stroke-width","1.5"),l.setAttribute("stroke-linecap","round"),c.appendChild(l),n.appendChild(e),n.appendChild(i),n.appendChild(o),n.appendChild(c),n}function Xt(t,n){if(typeof document>"u")throw new Error("renderToDOM can only be used in browser environments");let e=n?.theme??B,s=n?.padding??16,i=n?.transparent??!1;n?.debug;let r=G(e),o={font:r.font},a=t.width+s*2,c=t.height+s*2,l=i?"none":r.bg,d=S("svg"),h=`cm-${Math.random().toString(36).slice(2,8)}`;d.setAttribute("id",h),d.setAttribute("xmlns",Wt),d.setAttribute("viewBox",`0 0 ${a} ${c}`),d.setAttribute("width",String(a)),d.setAttribute("height",String(c));let u="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap",f=S("style");f.textContent=`
		@import url('${u}');
		#${h} {
			--bg: ${r.bg};
			--fg: ${r.fg};
			--_text: ${r.text};
			--_line: ${r.line};
			--_arrow: ${r.arrow};
			--_node-fill: ${r.nodeFill};
			--_node-stroke: ${r.nodeStroke};
			--_muted: ${r.muted};
			--_group-fill: ${r.groupFill};
			--_group-stroke: ${r.groupStroke};
			--_group-text: ${r.groupText};
		}
	`,d.appendChild(f);let g=S("rect");g.setAttribute("width",String(a)),g.setAttribute("height",String(c)),g.setAttribute("fill",l),d.appendChild(g),d.appendChild(es());let m=S("g");return m.setAttribute("transform",`translate(${s}, ${s})`),Bt(t.groups,o,m),t.edges.forEach(y=>{m.appendChild(Jn(y,o,n||{}))}),t.edges.forEach(y=>{m.appendChild(ts(y,o))}),t.nodes.forEach(y=>{m.appendChild(Zn(y,o,n||{}))}),d.appendChild(m),n?.container&&n.container.appendChild(d),d}function q(t){let n=t.getAttribute("viewBox");if(!n){let s=Number.parseFloat(t.getAttribute("width")||"0"),i=Number.parseFloat(t.getAttribute("height")||"0");return{x:0,y:0,width:s,height:i}}let e=n.split(/\s+/).map(Number.parseFloat);return{x:e[0]??0,y:e[1]??0,width:e[2]??0,height:e[3]??0}}function j(t,n){t.setAttribute("viewBox",`${n.x} ${n.y} ${n.width} ${n.height}`)}function Q(t,n){let e=t.getBoundingClientRect(),s=q(t),i=s.width/e.width,r=s.height/e.height,o=(n.clientX-e.left)*i+s.x,a=(n.clientY-e.top)*r+s.y;return{x:o,y:a}}function Tt(t,n){let e=n.clientX-t.clientX,s=n.clientY-t.clientY;return Math.sqrt(e*e+s*s)}function ns(t,n){return{x:(t.clientX+n.clientX)/2,y:(t.clientY+n.clientY)/2}}function Yt(t,n){let e=n?.minZoom??.1,s=n?.maxZoom??5,i=n?.zoomSpeed??.1,r=q(t),o=!1,a={x:0,y:0},c={...r},l=0,d={...r};function h(w){w.preventDefault();let $=q(t),v=Q(t,w),p=w.deltaY>0?1+i:1-i,b=$.width*p,k=$.height*p,M=r.width*s,_=r.height*s,L=r.width*e,C=r.height*e;if(b>M||b<L||k>_||k<C)return;let I=v.x-(v.x-$.x)*b/$.width,T=v.y-(v.y-$.y)*k/$.height;j(t,{x:I,y:T,width:b,height:k})}function u(w){w.button===0&&(o=!0,a=Q(t,w),c=q(t),t.style.cursor="grabbing")}function f(w){if(!o)return;let $=Q(t,w),v=$.x-a.x,p=$.y-a.y;j(t,{x:c.x-v,y:c.y-p,width:c.width,height:c.height})}function g(){o=!1,t.style.cursor="grab"}function m(){j(t,r)}function y(w){if(w.touches.length===2){w.preventDefault();let $=w.touches[0],v=w.touches[1];l=Tt($,v),d=q(t)}else if(w.touches.length===1){let $=w.touches[0];a=Q(t,{clientX:$.clientX,clientY:$.clientY}),c=q(t),o=!0}}function x(w){if(w.touches.length===2){w.preventDefault();let $=w.touches[0],v=w.touches[1],p=Tt($,v),b=l/p,k=d.width*b,M=d.height*b,_=r.width*s,L=r.height*s,C=r.width*e,I=r.height*e;if(k>_||k<C||M>L||M<I)return;let T=ns($,v),R=t.getBoundingClientRect(),D=d,Kt=D.width/R.width,Zt=D.height/R.height,gt=(T.x-R.left)*Kt+D.x,pt=(T.y-R.top)*Zt+D.y,Jt=gt-(gt-D.x)*k/D.width,te=pt-(pt-D.y)*M/D.height;j(t,{x:Jt,y:te,width:k,height:M})}else if(w.touches.length===1&&o){w.preventDefault();let $=w.touches[0],v=Q(t,{clientX:$.clientX,clientY:$.clientY}),p=v.x-a.x,b=v.y-a.y;j(t,{x:c.x-p,y:c.y-b,width:c.width,height:c.height})}}function A(){o=!1,l=0}return t.style.cursor="grab",t.addEventListener("wheel",h,{passive:!1}),t.addEventListener("mousedown",u),document.addEventListener("mousemove",f),document.addEventListener("mouseup",g),t.addEventListener("dblclick",m),t.addEventListener("touchstart",y,{passive:!1}),t.addEventListener("touchmove",x,{passive:!1}),t.addEventListener("touchend",A),()=>{t.style.cursor="",t.removeEventListener("wheel",h),t.removeEventListener("mousedown",u),document.removeEventListener("mousemove",f),document.removeEventListener("mouseup",g),t.removeEventListener("dblclick",m),t.removeEventListener("touchstart",y),t.removeEventListener("touchmove",x),t.removeEventListener("touchend",A)}}function ss(t){let n=new Map,e=[];return t.querySelectorAll("[data-node-id]").forEach(s=>{let i=s.getAttribute("data-node-id");i&&n.set(i,{element:s,connections:new Set})}),t.querySelectorAll("[data-edge-source]").forEach(s=>{let i=s.getAttribute("data-edge-source"),r=s.getAttribute("data-edge-target");i&&r&&(e.push({source:i,target:r}),n.get(i)?.connections.add(r),n.get(r)?.connections.add(i))}),{nodes:n,edges:e}}function at(t){if(t.setAttribute("tabindex","0"),t.focus(),t.querySelector(".focus-ring"))return;let s=t.getBBox(),i=4,r=document.createElementNS("http://www.w3.org/2000/svg","rect");r.classList.add("focus-ring"),r.setAttribute("x",String(s.x-i)),r.setAttribute("y",String(s.y-i)),r.setAttribute("width",String(s.width+i*2)),r.setAttribute("height",String(s.height+i*2)),r.setAttribute("fill","none"),r.setAttribute("stroke","#3b82f6"),r.setAttribute("stroke-width","2"),r.setAttribute("stroke-dasharray","4 2"),r.setAttribute("rx","4"),r.setAttribute("pointer-events","none"),t.insertBefore(r,t.firstChild)}function K(t){t.removeAttribute("tabindex");let n=t.querySelector(".focus-ring");n&&n.remove()}function rs(t){let n=new CustomEvent("nodeselect",{detail:{nodeId:t.getAttribute("data-node-id")},bubbles:!0});t.dispatchEvent(n)}function is(t,n,e){let s=e.nodes.get(t);if(!s)return null;let i=s.element.getBoundingClientRect(),r=[];for(let o of s.connections){let a=e.nodes.get(o);if(!a)continue;let c=a.element.getBoundingClientRect(),l=!1,d=0;switch(n){case"up":l=c.top<i.top,d=i.top-c.top;break;case"down":l=c.bottom>i.bottom,d=c.bottom-i.bottom;break;case"left":l=c.left<i.left,d=i.left-c.left;break;case"right":l=c.right>i.right,d=c.right-i.right;break}l&&d>0&&r.push({id:o,distance:d})}return r.length===0?null:(r.sort((o,a)=>o.distance-a.distance),r[0].id)}function Ft(t){let n=ss(t),e=null,s=Array.from(n.nodes.keys());if(s.length===0)return()=>{};let i={ArrowUp:"up",ArrowDown:"down",ArrowLeft:"left",ArrowRight:"right"};function r(o){switch(o.key){case"Tab":{if(o.preventDefault(),e){let l=n.nodes.get(e);l&&K(l.element)}let a=e?s.indexOf(e):-1,c=o.shiftKey?a<=0?s.length-1:a-1:(a+1)%s.length;if(e=s[c]??null,e){let l=n.nodes.get(e);l&&at(l.element)}break}case"Enter":{if(e){let a=n.nodes.get(e);a&&rs(a.element)}break}case"Escape":{if(e){let a=n.nodes.get(e);a&&K(a.element),e=null}break}case"ArrowUp":case"ArrowDown":case"ArrowLeft":case"ArrowRight":{if(o.preventDefault(),!e){if(e=s[0]??null,e){let l=n.nodes.get(e);l&&at(l.element)}return}let a=i[o.key];if(!a)return;let c=is(e,a,n);if(c){let l=n.nodes.get(e);l&&K(l.element),e=c;let d=n.nodes.get(e);d&&at(d.element)}break}}}return t.addEventListener("keydown",r),t.setAttribute("tabindex","0"),()=>{t.removeEventListener("keydown",r),t.removeAttribute("tabindex"),n.nodes.forEach(({element:o})=>{K(o)})}}function os(t){let n=new Map;return t.querySelectorAll("[data-node-id]").forEach(e=>{let s=e.getAttribute("data-node-id");s&&n.set(s,{id:s,element:e,connectedEdges:new Set})}),t.querySelectorAll("[data-edge-source]").forEach(e=>{let s=e.getAttribute("data-edge-source"),i=e.getAttribute("data-edge-target");if(s&&i){let r=e;n.get(s)?.connectedEdges.add(r),n.get(i)?.connectedEdges.add(r)}}),n}function as(){let t=document.createElement("div");return t.style.position="absolute",t.style.padding="8px 12px",t.style.background="rgba(0, 0, 0, 0.9)",t.style.color="white",t.style.fontSize="12px",t.style.fontFamily="Inter, system-ui, sans-serif",t.style.borderRadius="6px",t.style.pointerEvents="none",t.style.zIndex="10000",t.style.opacity="0",t.style.transition="opacity 0.2s ease",t.style.maxWidth="300px",t.style.wordWrap="break-word",t.style.boxShadow="0 4px 6px rgba(0, 0, 0, 0.3)",t}function cs(t,n,e){t.textContent=n,t.style.left=`${e.pageX+10}px`,t.style.top=`${e.pageY+10}px`,t.style.opacity="1"}function ls(t){t.style.opacity="0"}function ds(t,n){let e=new Set;t.connectedEdges.forEach(s=>{let i=s.getAttribute("data-edge-source"),r=s.getAttribute("data-edge-target");i&&i!==t.id&&e.add(i),r&&r!==t.id&&e.add(r)}),n.forEach(s=>{s.id===t.id||e.has(s.id)?s.element.style.opacity="1":s.element.style.opacity="0.3"}),t.connectedEdges.forEach(s=>{s.style.opacity="1",s.style.strokeWidth="2.5"})}function Rt(t,n){t.forEach(e=>{e.element.style.opacity="1"}),n.querySelectorAll("[data-edge-source]").forEach(e=>{let s=e;s.style.opacity="1",s.style.strokeWidth=""})}function Ot(t){let n=os(t),e=as();document.body.appendChild(e);let s=null;function i(a){let c=a.currentTarget,l=c.getAttribute("data-node-id");if(!l)return;s=l;let d=n.get(l);if(!d)return;let h=c.getAttribute("aria-label")||l;cs(e,h,a),ds(d,n)}function r(a){if(s){let c=a;e.style.left=`${c.pageX+10}px`,e.style.top=`${c.pageY+10}px`}}function o(){s=null,ls(e),Rt(n,t)}return n.forEach(a=>{a.element.addEventListener("mouseenter",i),a.element.addEventListener("mousemove",r),a.element.addEventListener("mouseleave",o)}),()=>{n.forEach(a=>{a.element.removeEventListener("mouseenter",i),a.element.removeEventListener("mousemove",r),a.element.removeEventListener("mouseleave",o)}),e.remove(),Rt(n,t)}}function ct(t){let n=t.getAttribute("viewBox");if(!n){let s=Number.parseFloat(t.getAttribute("width")||"0"),i=Number.parseFloat(t.getAttribute("height")||"0");return{x:0,y:0,width:s,height:i}}let e=n.split(/\s+/).map(Number.parseFloat);return{x:e[0]??0,y:e[1]??0,width:e[2]??0,height:e[3]??0}}function hs(t){let n=t.querySelector("g");if(!n)return ct(t);let e=n.getBBox(),s=20;return{x:e.x-s,y:e.y-s,width:e.width+s*2,height:e.height+s*2}}function us(t){return getComputedStyle(t).position==="static"?(t.style.position="relative",!0):!1}function fs(t,n,e){let s=document.createElement("div");s.style.position="absolute",s.style.width=`${t}px`,s.style.height=`${n}px`,s.style.border="1px solid rgba(255, 255, 255, 0.2)",s.style.borderRadius="4px",s.style.overflow="hidden",s.style.background="rgba(0, 0, 0, 0.8)",s.style.zIndex="9999",s.style.pointerEvents="auto";let i="8px";switch(e){case"top-left":s.style.top=i,s.style.left=i;break;case"top-right":s.style.top=i,s.style.right=i;break;case"bottom-left":s.style.bottom=i,s.style.left=i;break;case"bottom-right":s.style.bottom=i,s.style.right=i;break}return s}function gs(t,n,e){let s=document.createElementNS("http://www.w3.org/2000/svg","svg");return s.setAttribute("width",String(n)),s.setAttribute("height",String(e)),s.setAttribute("viewBox",`${t.x} ${t.y} ${t.width} ${t.height}`),s.style.display="block",s.style.pointerEvents="none",s}function ps(t,n){let e=t.querySelector("g");if(!e)return;let s=e.cloneNode(!0);s.style.pointerEvents="none",n.appendChild(s)}function ms(){let t=document.createElementNS("http://www.w3.org/2000/svg","rect");return t.setAttribute("fill","rgba(59, 130, 246, 0.3)"),t.setAttribute("stroke","#3b82f6"),t.setAttribute("stroke-width","2"),t.style.pointerEvents="none",t}function bs(t,n){t.setAttribute("x",String(n.x)),t.setAttribute("y",String(n.y)),t.setAttribute("width",String(n.width)),t.setAttribute("height",String(n.height))}function ys(t,n,e,s,i,r){let o=n.getBoundingClientRect(),a=(t.clientX-o.left)/i,c=(t.clientY-o.top)/r,l=e.x+a*e.width,d=e.y+c*e.height;return{x:l-s.width/2,y:d-s.height/2,width:s.width,height:s.height}}function Ut(t,n){let e=n?.width??150,s=n?.height??100,i=n?.position??"bottom-right",r=t.parentElement;if(!r)return()=>{};let o=us(r),a=hs(t),c=fs(e,s,i),l=gs(a,e,s),d=ms();ps(t,l),l.appendChild(d),c.appendChild(l),r.appendChild(c);let h=()=>{let g=ct(t);bs(d,g)};h();let u=new MutationObserver(g=>{for(let m of g)m.type==="attributes"&&m.attributeName==="viewBox"&&h()});u.observe(t,{attributes:!0,attributeFilter:["viewBox"]});let f=g=>{let m=ct(t),y=ys(g,c,a,m,e,s);t.setAttribute("viewBox",`${y.x} ${y.y} ${y.width} ${y.height}`)};return c.addEventListener("click",f),c.style.cursor="pointer",()=>{u.disconnect(),c.removeEventListener("click",f),c.remove(),o&&(r.style.position="")}}function xs(t,n){let e=[];return t.querySelectorAll("[data-node-id]").forEach(i=>{let r=i.getAttribute("data-node-id");if(r){if(i.style.cursor="pointer",n.onNodeClick){let o=(a=>{n.onNodeClick?.(r,a)});e.push({element:i,type:"click",handler:o})}if(n.onNodeHover){let o=(c=>{n.onNodeHover?.(r,c)});e.push({element:i,type:"mouseenter",handler:o});let a=(c=>{n.onNodeHover?.(null,c)});e.push({element:i,type:"mouseleave",handler:a})}}}),e}function ws(t,n){let e=[];return t.querySelectorAll("[data-edge-source]").forEach(i=>{let r=i.getAttribute("data-edge-source"),o=i.getAttribute("data-edge-target");if(!(!r||!o)){if(i.style.cursor="pointer",n.onEdgeClick){let a=(c=>{n.onEdgeClick?.(r,o,c)});e.push({element:i,type:"click",handler:a})}if(n.onEdgeHover){let a=(l=>{n.onEdgeHover?.(r,o,l)});e.push({element:i,type:"mouseenter",handler:a});let c=(l=>{n.onEdgeHover?.(r,null,l)});e.push({element:i,type:"mouseleave",handler:c})}}}),e}function qt(t,n){let e=xs(t,n),s=ws(t,n),i=[...e,...s];for(let{element:r,type:o,handler:a}of i)r.addEventListener(o,a);return()=>{for(let{element:r,type:o,handler:a}of i)r.removeEventListener(o,a);t.querySelectorAll("[data-node-id]").forEach(r=>{r.style.cursor=""}),t.querySelectorAll("[data-edge-source]").forEach(r=>{r.style.cursor=""})}}function $s(){let t=document.createElement("div");return t.style.position="absolute",t.style.top="8px",t.style.left="50%",t.style.transform="translateX(-50%)",t.style.background="rgba(0, 0, 0, 0.9)",t.style.border="1px solid #3b82f6",t.style.borderRadius="8px",t.style.padding="8px 12px",t.style.display="flex",t.style.alignItems="center",t.style.gap="8px",t.style.zIndex="10000",t}function ks(){let t=document.createElement("input");return t.type="text",t.placeholder="Search nodes...",t.style.background="transparent",t.style.border="none",t.style.color="white",t.style.outline="none",t.style.fontSize="14px",t.style.fontFamily="Inter, system-ui, sans-serif",t.style.width="200px",t}function As(){let t=document.createElement("span");return t.style.color="rgba(255, 255, 255, 0.6)",t.style.fontSize="12px",t.style.whiteSpace="nowrap",t}function Ss(t,n){let s=t.getBBox(),i=4,r=document.createElementNS("http://www.w3.org/2000/svg","rect");return r.setAttribute("x",String(s.x-i)),r.setAttribute("y",String(s.y-i)),r.setAttribute("width",String(s.width+i*2)),r.setAttribute("height",String(s.height+i*2)),r.setAttribute("fill","none"),r.setAttribute("stroke",n),r.setAttribute("stroke-width","3"),r.setAttribute("rx","4"),r.setAttribute("pointer-events","none"),r.classList.add("search-highlight"),r}function vs(t,n){let e=[],s=n.toLowerCase();return t.querySelectorAll("[data-node-id]").forEach(i=>{let r=i,o=r.getAttribute("data-node-id");if(!o)return;(r.getAttribute("aria-label")||o).toLowerCase().includes(s)&&e.push({element:r,nodeId:o})}),e}function Ms(t,n,e){t.querySelectorAll("[data-node-id]").forEach(s=>{let i=s,r=i.getAttribute("data-node-id");i.style.opacity=r&&n.has(r)?"1":String(e)}),t.querySelectorAll("[data-edge-source]").forEach(s=>{let i=s,r=i.getAttribute("data-edge-source"),o=i.getAttribute("data-edge-target"),a=r&&n.has(r)||o&&n.has(o);i.style.opacity=a?"1":String(e)})}function Es(t){t.querySelectorAll("[data-node-id]").forEach(n=>{n.style.opacity="1"}),t.querySelectorAll("[data-edge-source]").forEach(n=>{n.style.opacity="1"})}function _s(t){t.querySelectorAll(".search-highlight").forEach(n=>n.remove())}function Gt(t,n){let e=n?.highlightColor??"#3b82f6",s=n?.dimOpacity??.2,i=t.parentElement;if(!i)return()=>{};let r=getComputedStyle(i),o=!1;r.position==="static"&&(i.style.position="relative",o=!0);let a=null,c=null,l=null,d=[],h=-1,u=!1;function f(){l&&(d.length===0&&c&&c.value.length>0?l.textContent="No results":d.length>0?l.textContent=`${h+1} of ${d.length}`:l.textContent="")}function g(){_s(t),Es(t),d=[],h=-1}function m($){if(g(),$.length===0){f();return}let v=vs(t,$),p=new Set(v.map(b=>b.nodeId));d=v.map(({element:b,nodeId:k})=>{let M=Ss(b,e);return b.appendChild(M),{element:b,nodeId:k,highlight:M}}),d.length>0&&(h=0,Ms(t,p,s),d[0]?.element.scrollIntoView({behavior:"smooth",block:"center"})),f()}function y(){if(d.length===0)return;h=(h+1)%d.length;let $=d[h];$&&$.element.scrollIntoView({behavior:"smooth",block:"center"}),f()}function x(){if(u){c?.focus();return}u=!0,a=$s(),c=ks(),l=As(),a.appendChild(c),a.appendChild(l),i?.appendChild(a),c.focus(),c.addEventListener("input",()=>{c&&m(c.value)}),c.addEventListener("keydown",$=>{$.key==="Enter"&&($.preventDefault(),y()),$.key==="Escape"&&($.preventDefault(),A())})}function A(){u&&(u=!1,g(),a&&(a.remove(),a=null),c=null,l=null)}function w($){($.metaKey||$.ctrlKey)&&$.key==="f"&&($.preventDefault(),x())}return t.addEventListener("keydown",w),document.addEventListener("keydown",w),()=>{t.removeEventListener("keydown",w),document.removeEventListener("keydown",w),A(),o&&(i.style.position="")}}var Y={shapes:new Map,diagrams:new Map,themes:new Map};function ht(t){if(t.shapes)for(let n of t.shapes)Y.shapes.set(n.name,n);if(t.diagrams)for(let n of t.diagrams)Y.diagrams.set(n.type,n);if(t.themes)for(let n of t.themes)Y.themes.set(n.name,n)}function V(){return Y}function ut(){Y.shapes.clear(),Y.diagrams.clear(),Y.themes.clear()}function jt(t,n={}){let{theme:e,padding:s,transparent:i,debug:r,...o}=n,a=V(),c=null,l=null,d=t.split(/[\n;]/)[0]?.trim()||"";for(let[,h]of a.diagrams)if(h.detect(d)&&(c=h.parse(t),c?.ast)){h.layout&&(l=h.layout(c.ast,{direction:o.direction,nodeSpacing:o.nodeSpacing,layerSpacing:o.layerSpacing,padding:s}));break}if(!c&&(c=O(t),!c.ast)){let h=c.diagnostics.map(u=>u.message).join(`
`);throw new Error(`Failed to parse diagram:
${h}`)}return l||(l=U(c.ast,{direction:o.direction,nodeSpacing:o.nodeSpacing,layerSpacing:o.layerSpacing,padding:s})),Z(l,{theme:e,padding:s,transparent:i,debug:r})}var ft=class{buffer;width;height;constructor(n,e){this.width=n,this.height=e,this.buffer=Array.from({length:e},()=>Array.from({length:n},()=>({char:" "})))}set(n,e,s,i){let r=Math.round(n),o=Math.round(e);r<0||r>=this.width||o<0||o>=this.height||(this.buffer[o][r]={char:s,color:i})}line(n,e,s,i,r,o){let a=Math.round(n),c=Math.round(e),l=Math.round(s),d=Math.round(i),h=Math.abs(l-a),u=Math.abs(d-c),f=a<l?1:-1,g=c<d?1:-1,m=h-u,y=a,x=c;for(;;){let A=r??(h>u?"\u2500":u>h?"\u2502":"\u2500");if(this.set(y,x,A,o),y===l&&x===d)break;let w=2*m;w>-u&&(m-=u,y+=f),w<h&&(m+=h,x+=g)}}box(n,e,s,i,r){let o=Math.round(n),a=Math.round(e),c=Math.round(s),l=Math.round(i);this.set(o,a,"\u250C",r),this.set(o+c-1,a,"\u2510",r),this.set(o,a+l-1,"\u2514",r),this.set(o+c-1,a+l-1,"\u2518",r);for(let d=1;d<c-1;d++)this.set(o+d,a,"\u2500",r),this.set(o+d,a+l-1,"\u2500",r);for(let d=1;d<l-1;d++)this.set(o,a+d,"\u2502",r),this.set(o+c-1,a+d,"\u2502",r)}roundedBox(n,e,s,i,r){let o=Math.round(n),a=Math.round(e),c=Math.round(s),l=Math.round(i);this.set(o,a,"\u256D",r),this.set(o+c-1,a,"\u256E",r),this.set(o,a+l-1,"\u2570",r),this.set(o+c-1,a+l-1,"\u256F",r);for(let d=1;d<c-1;d++)this.set(o+d,a,"\u2500",r),this.set(o+d,a+l-1,"\u2500",r);for(let d=1;d<l-1;d++)this.set(o,a+d,"\u2502",r),this.set(o+c-1,a+d,"\u2502",r)}diamond(n,e,s,i,r){let o=Math.round(n),a=Math.round(e),c=Math.max(1,Math.floor(Math.round(s)/2)),l=Math.max(1,Math.floor(Math.round(i)/2)),d=o-c,h=a-l,u=c*2+1,f=l*2+1;this.set(d,h,"\u25C6",r),this.set(d+u-1,h,"\u25C6",r),this.set(d,h+f-1,"\u25C6",r),this.set(d+u-1,h+f-1,"\u25C6",r);for(let g=1;g<u-1;g++)this.set(d+g,h,"\u2500",r),this.set(d+g,h+f-1,"\u2500",r);for(let g=1;g<f-1;g++)this.set(d,h+g,"\u2502",r),this.set(d+u-1,h+g,"\u2502",r)}text(n,e,s,i){let r=Math.round(n),o=Math.round(e);for(let a=0;a<s.length;a++)this.set(r+a,o,s[a],i)}toHtml(){let n=[];for(let e of this.buffer){let s="",i;for(let r of e){let o=r.char==="<"?"&lt;":r.char===">"?"&gt;":r.char==="&"?"&amp;":r.char;r.color!==i&&(i&&(s+="</span>"),i=r.color,r.color&&(s+=`<span style="color:${r.color}">`)),s+=o}i&&(s+="</span>"),n.push(s)}return n.join(`
`)}};function Cs(t,n,e,s){let i=e-t,r=s-n;return Math.abs(i)>Math.abs(r)?i>0?"\u2192":"\u2190":r>0?"\u2193":"\u2191"}function Ls(t,n,e,s){let i=n.x*e,r=n.y*e,o=n.width*e,a=n.height*e,c=s.nodeStroke,l=s.text;switch(n.shape){case"rounded":case"stadium":t.roundedBox(i,r,o,a,c);break;case"diamond":t.diamond(i+o/2,r+a/2,o,a,c);break;case"circle":t.roundedBox(i,r,o,a,c);break;case"hexagon":t.diamond(i+o/2,r+a/2,o,a,c);break;default:t.box(i,r,o,a,c);break}let h=(n.label||n.id).split(`
`),u=r+Math.floor(a/2)-Math.floor(h.length/2);for(let f=0;f<h.length;f++){let g=h[f],m=i+Math.floor(o/2)-Math.floor(g.length/2);t.text(m,u+f,g,l)}}function Ns(t,n,e,s){if(!(n.points.length<2)){for(let i=0;i<n.points.length-1;i++){let r=n.points[i],o=n.points[i+1];t.line(r.x*e,r.y*e,o.x*e,o.y*e,n.style==="dotted"?"\xB7":void 0,s.line)}if(n.hasArrowEnd&&n.points.length>=2){let i=n.points[n.points.length-1],r=n.points[n.points.length-2];t.set(i.x*e,i.y*e,Cs(r.x*e,r.y*e,i.x*e,i.y*e),s.arrow)}n.label&&n.labelPosition&&t.text(n.labelPosition.x*e,n.labelPosition.y*e,n.label,s.muted)}}function Qt(t,n,e,s){t.roundedBox(n.x*e,n.y*e,n.width*e,n.height*e,s.groupStroke),n.label&&t.text(n.x*e+2,n.y*e,n.label,s.groupText);for(let i of n.children)Qt(t,i,e,s)}function Vt(t,n={}){let e=O(t);if(!e.ast){let h=e.diagnostics.map(u=>u.message).join(`
`);throw new Error(`Parse error:
${h}`)}let s=U(e.ast),i=n.width??80,r=Math.min(.15,i/s.width),o=Math.ceil(s.width*r),a=Math.ceil(s.height*r),c=new ft(o,a),l=n.theme??B,d=G(l);for(let h of s.groups)Qt(c,h,r,d);for(let h of s.edges)Ns(c,h,r,d);for(let h of s.nodes)Ls(c,h,r,d);return c.toHtml()}return oe(Ps);})();
