"use strict";var crafterMermaid=(()=>{var ct=Object.defineProperty;var ae=Object.getOwnPropertyDescriptor;var ce=Object.getOwnPropertyNames;var le=Object.prototype.hasOwnProperty;var he=(t,n)=>{for(var e in n)ct(t,e,{get:n[e],enumerable:!0})},de=(t,n,e,r)=>{if(n&&typeof n=="object"||typeof n=="function")for(let i of ce(n))!le.call(t,i)&&i!==e&&ct(t,i,{get:()=>n[i],enumerable:!(r=ae(n,i))||r.enumerable});return t};var ue=t=>de(ct({},"__esModule",{value:!0}),t);var Fr={};he(Fr,{DEFAULTS:()=>W,THEMES:()=>pt,enableEvents:()=>ee,enableHover:()=>Jt,enableKeyboard:()=>Zt,enableMinimap:()=>te,enableSearch:()=>ne,enableZoomPan:()=>Qt,getRegistry:()=>tt,layout:()=>G,parse:()=>F,render:()=>re,renderToAscii:()=>ie,renderToDOM:()=>Vt,renderToString:()=>ot,resetRegistry:()=>wt,use:()=>xt});var fe=[[/^\s*sequenceDiagram\s*$/i,"sequence"],[/^\s*classDiagram\s*$/i,"class"],[/^\s*erDiagram\s*$/i,"er"],[/^\s*stateDiagram-v2\s*$/i,"state"],[/^\s*(?:graph|flowchart)\s+(?:TD|TB|LR|BT|RL)\s*$/i,"flowchart"],[/^\s*pie\s+(?:title\s+.+)?$/i,"pie"],[/^\s*gantt\s*$/i,"gantt"],[/^\s*mindmap\s*$/i,"mindmap"]];function Ct(t){let n=t.split(/[\n;]/);for(let e of n){let r=e.trim();if(!(!r||r.startsWith("%%"))){for(let[i,s]of fe)if(i.test(r))return s;break}}return null}function C(t,n,e){return{severity:"error",message:t,span:n,suggestions:e}}function z(t,n,e){return{severity:"warning",message:t,span:n,suggestions:e}}function T(t,n,e,r){return{start:{line:t,column:n,offset:e},end:{line:t,column:n+r,offset:e+r}}}function R(t,n){let e=t.split(/[\n;]/),r=0;for(let s=0;s<n&&s<e.length;s++)r+=(e[s]?.length??0)+1;let i=e[n]?.length??0;return T(n+1,1,r,i)}var Lt=[[/<\|--/,"inheritance"],[/\*--/,"composition"],[/o--/,"aggregation"],[/-->/,"association"],[/\.\.>/,"dependency"],[/\.\.\|>/,"realization"]];function ge(t){let n={classes:new Map,relations:[],namespaces:[],diagnostics:[],currentClass:null,currentNamespace:null},e=t.split(`
`);for(let i=0;i<e.length;i++){let o=e[i].trim();if(!o||o.startsWith("%%")||i===0&&/^classDiagram\s*$/i.test(o))continue;let a=R(t,i);if(o.startsWith("class "))pe(o,a,n);else if(o==="{")n.currentClass||n.diagnostics.push(C("Unexpected '{' outside class definition",a));else if(o==="}")n.currentClass=null;else if(n.currentClass)me(o,a,n);else if(o.startsWith("namespace"))ye(o,a,n);else if(Lt.some(([c])=>c.test(o)))be(o,a,n);else{let c=o.indexOf(":");if(c>0){let l=o.slice(0,c).trim(),h=o.slice(c+1).trim();ht(l,a,n);let d=n.classes.get(l),u=Pt(h,a);u&&d.members.push(u)}else n.diagnostics.push(z(`Skipping unrecognized line: ${o}`,a))}}return{ast:{type:"class",classes:n.classes,relations:n.relations,namespaces:n.namespaces,span:T(1,1,0,t.length)},diagnostics:n.diagnostics}}function pe(t,n,e){let r=t.match(/^class\s+(\w+)(?:\s+<<([^>]+)>>)?(?:\s+as\s+(.+?))?(?:\s*\{)?$/);if(!r){e.diagnostics.push(C("Invalid class definition syntax",n));return}let[,i,s,o]=r,a={id:i,label:o,annotation:s,members:[],span:n};e.classes.set(i,a),e.currentNamespace&&e.currentNamespace.classIds.push(i),t.includes("{")&&(e.currentClass=a)}function me(t,n,e){let r=Pt(t,n);r&&e.currentClass&&e.currentClass.members.push(r)}function Pt(t,n){let e=t.match(/^([+\-#~])?(.+)$/);if(!e)return null;let[,r,i]=e,s=r||"",o=i.trim(),a=o.includes("$"),c=o.includes("*");o=o.replace(/[$*]/g,"").trim();let l=o.match(/^(\w+)\(([^)]*)\)(?:\s*:\s*(.+))?$/);if(l){let[,u,,f]=l;return{name:u,visibility:s,isStatic:a,isAbstract:c,returnType:f,isMethod:!0,span:n}}let h=o.match(/^(\w+)\s+(\w+)$/);if(h){let[,u,f]=h;return{name:f,type:u,visibility:s,isStatic:a,isAbstract:c,isMethod:!1,span:n}}let d=o.match(/^(\w+)(?:\s*:\s*(.+))?$/);if(d){let[,u,f]=d;return{name:u,type:f,visibility:s,isStatic:a,isAbstract:c,isMethod:!1,span:n}}return null}function be(t,n,e){for(let[r,i]of Lt)if(r.test(t)){let s=t.split(r);if(s.length!==2){e.diagnostics.push(C("Invalid relation syntax",n));return}let o=s[0].trim(),a=s[1].trim(),c,l,h,d=o.match(/^"([^"]+)"\s+(\w+)$/);d&&(l=d[1],o=d[2]);let u=a.match(/^(\w+)\s+"([^"]+)"$/);u&&(a=u[1],h=u[2]);let f=a.match(/^(\w+)\s*:\s*(.+)$/);f&&(a=f[1],c=f[2]),ht(o,n,e),ht(a,n,e),e.relations.push({from:o,to:a,type:i,label:c,fromCardinality:l,toCardinality:h,span:n});return}}function ye(t,n,e){let r=t.match(/^namespace\s+(\w+)(?:\s+as\s+(.+?))?(?:\s*\{)?$/);if(!r){e.diagnostics.push(C("Invalid namespace syntax",n));return}let[,i,s]=r,o={id:i,label:s||i,classIds:[],span:n};e.namespaces.push(o),t.includes("{")&&(e.currentNamespace=o)}function ht(t,n,e){e.classes.has(t)||e.classes.set(t,{id:t,members:[],span:n})}var $t={"||":"one","o|":"zero-one","}|":"many","|{":"many","o{":"zero-many","{o":"zero-many"};function xe(t){let n={entities:new Map,relations:[],diagnostics:[],currentEntity:null},e=t.split(`
`);for(let i=0;i<e.length;i++){let o=e[i].trim();if(!o||o.startsWith("%%")||i===0&&/^erDiagram\s*$/i.test(o))continue;let a=R(t,i);/^(\w+)\s*\{/.test(o)?we(o,a,n):o==="}"?n.currentEntity=null:n.currentEntity?ke(o,a,n):/\|\||o\||}\||o\{|\|{|{o/.test(o)&&(o.includes("--")||o.includes(".."))?$e(o,a,n):n.diagnostics.push(z(`Skipping unrecognized line: ${o}`,a))}return{ast:{type:"er",entities:n.entities,relations:n.relations,span:T(1,1,0,t.length)},diagnostics:n.diagnostics}}function we(t,n,e){let r=t.match(/^(\w+)\s*\{/);if(!r){e.diagnostics.push(C("Invalid entity definition syntax",n));return}let i=r[1],s={id:i,attributes:[],span:n};e.entities.set(i,s),e.currentEntity=s}function ke(t,n,e){if(!e.currentEntity)return;let r=t.match(/^(\w+)\s+(\w+)(?:\s+(PK|FK|UK|PK,FK|FK,PK))?(?:\s+"([^"]+)")?$/);if(!r){e.diagnostics.push(C("Invalid attribute syntax",n,['Expected: type name [PK|FK|UK] ["comment"]']));return}let[,i,s,o,a]=r,c=o?o.split(","):[];e.currentEntity.attributes.push({name:s,type:i,keys:c,comment:a,span:n})}function $e(t,n,e){let r=/^(\w+)\s+((?:\|\||o\||\}\||o\{|\|\{|\{o))(--|\.\.)(\|\||o\||\}\||o\{|\|\{|\{o)\s+(\w+)\s*:\s*(.+)$/,i=t.match(r);if(!i){e.diagnostics.push(C("Invalid relation syntax",n,["Expected: Entity1 ||--|| Entity2 : label"]));return}let[,s,o,a,c,l,h]=i,d=$t[o],u=$t[c],f=a==="--";if(!d||!u){e.diagnostics.push(C("Invalid cardinality syntax",n,["Expected: ||, o|, }|, |{, o{, or {o"]));return}At(s,n,e),At(l,n,e),e.relations.push({from:s,to:l,fromCardinality:d,toCardinality:u,label:h,identifying:f,span:n})}function At(t,n,e){e.entities.has(t)||e.entities.set(t,{id:t,attributes:[],span:n})}var Ae=[{regex:/^([\w-]+)\(\(\((.+?)\)\)\)/,shape:"doublecircle"},{regex:/^([\w-]+)\(\[(.+?)\]\)/,shape:"stadium"},{regex:/^([\w-]+)\(\((.+?)\)\)/,shape:"circle"},{regex:/^([\w-]+)\[\[(.+?)\]\]/,shape:"subroutine"},{regex:/^([\w-]+)\[\((.+?)\)\]/,shape:"cylinder"},{regex:/^([\w-]+)\[\/(.+?)\\\]/,shape:"trapezoid"},{regex:/^([\w-]+)\[\\(.+?)\/\]/,shape:"trapezoid-alt"},{regex:/^([\w-]+)>(.+?)\]/,shape:"asymmetric"},{regex:/^([\w-]+)\{\{(.+?)\}\}/,shape:"hexagon"},{regex:/^([\w-]+)\[(.+?)\]/,shape:"rectangle"},{regex:/^([\w-]+)\((.+?)\)/,shape:"rounded"},{regex:/^([\w-]+)\{(.+?)\}/,shape:"diamond"}],Se=/^([\w-]+)/,ve=/^:::([\w][\w-]*)/,Me=/^(<)?(-->|-.->|==>|---|-\.-|===)(?:\|([^|]*)\|)?/;function St(t,n=!1){let e=t.split(/[\n;]/).map(s=>s.trim()).filter(s=>s.length>0&&!s.startsWith("%%"));if(e.length===0)return{ast:null,diagnostics:[C("Empty diagram",T(1,1,0,0))]};let r={nodes:new Map,edges:[],subgraphs:[],classDefs:new Map,classAssignments:new Map,nodeStyles:new Map,diagnostics:[],direction:"TD",subgraphStack:[],startCount:0,endCount:0},i=e[0];if(n)_e(e,r,t);else{let s=i.match(/^(?:graph|flowchart)\s+(TD|TB|LR|BT|RL)\s*$/i);s?r.direction=s[1].toUpperCase():r.diagnostics.push(z(`Invalid header: "${i}". Expected "graph TD", "flowchart LR", etc.`,R(t,0))),Ee(e,r,t)}if(r.subgraphStack.length>0)for(r.diagnostics.push(z(`Unclosed subgraph: ${r.subgraphStack[r.subgraphStack.length-1].id}`,T(1,1,0,0)));r.subgraphStack.length>0;){let s=r.subgraphStack.pop();r.subgraphStack.length>0?r.subgraphStack[r.subgraphStack.length-1].children.push(s):r.subgraphs.push(s)}return{ast:{type:"flowchart",direction:r.direction,nodes:r.nodes,edges:r.edges,subgraphs:r.subgraphs,classDefs:r.classDefs,classAssignments:r.classAssignments,nodeStyles:r.nodeStyles,span:T(1,1,0,t.length)},diagnostics:r.diagnostics}}function Ee(t,n,e){for(let r=1;r<t.length;r++){let i=t[r],s=R(e,r),o=i.match(/^classDef\s+(\w+)\s+(.+)$/);if(o){n.classDefs.set(o[1],_t(o[2]));continue}let a=i.match(/^class\s+([\w,-]+)\s+(\w+)$/);if(a){for(let d of a[1].split(",").map(u=>u.trim()))n.classAssignments.set(d,a[2]);continue}let c=i.match(/^style\s+([\w,-]+)\s+(.+)$/);if(c){let d=_t(c[2]);for(let u of c[1].split(",").map(f=>f.trim()))n.nodeStyles.set(u,{...n.nodeStyles.get(u),...d});continue}let l=i.match(/^direction\s+(TD|TB|LR|BT|RL)\s*$/i);if(l&&n.subgraphStack.length>0){n.subgraphStack[n.subgraphStack.length-1].direction=l[1].toUpperCase();continue}let h=i.match(/^subgraph\s+(.+)$/);if(h){let d=h[1].trim(),u=d.match(/^([\w-]+)\s*\[(.+)\]$/),f,g;u?(f=u[1],g=u[2]):(g=d,f=d.replace(/\s+/g,"_").replace(/[^\w]/g,""));let m={id:f,label:g,nodeIds:[],children:[],span:s};n.subgraphStack.push(m);continue}if(i==="end"){let d=n.subgraphStack.pop();d&&(n.subgraphStack.length>0?n.subgraphStack[n.subgraphStack.length-1].children.push(d):n.subgraphs.push(d));continue}Ce(i,s,n)}}function _e(t,n,e){for(let r=1;r<t.length;r++){let i=t[r],s=R(e,r),o=i.match(/^direction\s+(TD|TB|LR|BT|RL)\s*$/i);if(o){n.subgraphStack.length>0?n.subgraphStack[n.subgraphStack.length-1].direction=o[1].toUpperCase():n.direction=o[1].toUpperCase();continue}let a=i.match(/^state\s+(?:"([^"]+)"\s+as\s+)?(\w+)\s*\{$/);if(a){let d=a[1]??a[2],f={id:a[2],label:d,nodeIds:[],children:[],span:s};n.subgraphStack.push(f);continue}if(i==="}"){let d=n.subgraphStack.pop();d&&(n.subgraphStack.length>0?n.subgraphStack[n.subgraphStack.length-1].children.push(d):n.subgraphs.push(d));continue}let c=i.match(/^state\s+"([^"]+)"\s+as\s+(\w+)\s*$/);if(c){X(n,{id:c[2],label:c[1],shape:"rounded",span:s});continue}let l=i.match(/^(\[\*\]|[\w-]+)\s*(-->)\s*(\[\*\]|[\w-]+)(?:\s*:\s*(.+))?$/);if(l){let d=l[1],u=l[3],f=l[4]?.trim()||void 0;d==="[*]"?(n.startCount++,d=`_start${n.startCount>1?n.startCount:""}`,X(n,{id:d,label:"",shape:"state-start",span:s})):Et(n,d,s),u==="[*]"?(n.endCount++,u=`_end${n.endCount>1?n.endCount:""}`,X(n,{id:u,label:"",shape:"state-end",span:s})):Et(n,u,s),n.edges.push({source:d,target:u,label:f,style:"solid",hasArrowStart:!1,hasArrowEnd:!0,span:s});continue}let h=i.match(/^([\w-]+)\s*:\s*(.+)$/);if(h){X(n,{id:h[1],label:h[2].trim(),shape:"rounded",span:s});continue}}}function Ce(t,n,e){let r=t.trim(),i=vt(r,n,e);if(!i||i.ids.length===0){r.length>0&&e.diagnostics.push(z(`Skipping unrecognized line: ${t}`,n));return}r=i.remaining.trim();let s=i.ids,o=!1;for(;r.length>0;){let a=r.match(Me);if(!a)break;let c=!!a[1],l=a[2],h=a[3]?.trim()||void 0;r=r.slice(a[0].length).trim();let d=Le(l),u=l.endsWith(">"),f=vt(r,n,e);if(!f||f.ids.length===0)break;r=f.remaining.trim();for(let g of s)for(let m of f.ids)e.edges.push({source:g,target:m,label:h,style:d,hasArrowStart:c,hasArrowEnd:u,span:n});o=!0,s=f.ids}(r.length>0||!o&&i.remaining.trim().length>0)&&e.diagnostics.push(z(`Skipping unrecognized line: ${t}`,n))}function vt(t,n,e){let r=Mt(t,n,e);if(!r)return null;let i=[r.id],s=r.remaining.trim();for(;s.startsWith("&");){s=s.slice(1).trim();let o=Mt(s,n,e);if(!o)break;i.push(o.id),s=o.remaining.trim()}return{ids:i,remaining:s}}function Mt(t,n,e){let r=null,i=t;for(let{regex:o,shape:a}of Ae){let c=t.match(o);if(c){r=c[1];let l=c[2];X(e,{id:r,label:l,shape:a,span:n}),i=t.slice(c[0].length);break}}if(r===null){let o=t.match(Se);o&&(r=o[1],e.nodes.has(r)?dt(e,r):X(e,{id:r,label:r,shape:"rectangle",span:n}),i=t.slice(o[0].length))}if(r===null)return null;let s=i.match(ve);return s&&(e.classAssignments.set(r,s[1]),i=i.slice(s[0].length)),{id:r,remaining:i}}function X(t,n){t.nodes.has(n.id)||t.nodes.set(n.id,n),dt(t,n.id)}function dt(t,n){if(t.subgraphStack.length>0){let e=t.subgraphStack[t.subgraphStack.length-1];e.nodeIds.includes(n)||e.nodeIds.push(n)}}function Et(t,n,e){t.nodes.has(n)?dt(t,n):X(t,{id:n,label:n,shape:"rounded",span:e})}function Le(t){return t==="-.->"||t==="-.-"?"dotted":t==="==>"||t==="==="?"thick":"solid"}function _t(t){let n={};for(let e of t.split(",")){let r=e.indexOf(":");if(r>0){let i=e.slice(0,r).trim(),s=e.slice(r+1).trim();i&&s&&(n[i]=s)}}return n}function Pe(t){let n={sections:new Map,currentSection:"",diagnostics:[]},e=t.split(`
`);for(let s=0;s<e.length;s++){let a=e[s].trim();if(!a||a.startsWith("%%")||s===0&&/^gantt\s*$/i.test(a))continue;let c=R(t,s);if(/^title\s+(.+)$/i.test(a)){let l=a.match(/^title\s+(.+)$/i);l&&(n.title=l[1].trim());continue}if(/^dateFormat\s+(.+)$/i.test(a)){let l=a.match(/^dateFormat\s+(.+)$/i);l&&(n.dateFormat=l[1].trim());continue}if(/^section\s+(.+)$/i.test(a)){let l=a.match(/^section\s+(.+)$/i);l&&(n.currentSection=l[1].trim(),n.sections.has(n.currentSection)||n.sections.set(n.currentSection,[]));continue}n.currentSection?Ie(a,c,n):n.diagnostics.push(z(`Task defined before any section: ${a}`,c))}let r=Array.from(n.sections.entries()).map(([s,o])=>({name:s,tasks:o}));return{ast:{type:"gantt",title:n.title,dateFormat:n.dateFormat,sections:r,span:T(1,1,0,t.length)},diagnostics:n.diagnostics}}function Ie(t,n,e){let r=/^(?:(done|active|crit|milestone)\s+)?([^:]+)\s*:\s*(?:(\w+),\s*)?(.+)$/,i=t.match(r);if(!i){e.diagnostics.push(C("Invalid task syntax",n,["Expected: [status] label : [id,] timing"]));return}let[,s,o,a,c]=i,l=s,h={label:o.trim(),status:l,id:a,section:e.currentSection,span:n},d=c.match(/^after\s+(\w+)(?:,\s*(.+))?$/);if(d)h.afterId=d[1],d[2]&&(h.duration=d[2].trim());else{let f=c.split(",").map(g=>g.trim());if(f.length===2){let[g,m]=f;h.startDate=g,/^\d+d$/.test(m)?h.duration=m:h.endDate=m}else f.length===1&&(h.startDate=f[0])}let u=e.sections.get(e.currentSection);u&&u.push(h)}function Ne(t){let n={root:null,nodeStack:[],diagnostics:[],nodeIdCounter:0},e=t.split(`
`);for(let i=0;i<e.length;i++){let s=e[i],o=s.trim();if(!o||o.startsWith("%%")||i===0&&/^mindmap\s*$/i.test(o))continue;let a=R(t,i),c=Te(s),l=De(o,a,n);l&&(n.root===null?(n.root=l,n.nodeStack=[{node:l,indent:c}]):ze(l,c,n))}return n.root?{ast:{type:"mindmap",root:n.root,span:T(1,1,0,t.length)},diagnostics:n.diagnostics}:(n.diagnostics.push(C("Mindmap must have at least one root node",T(1,1,0,0))),{ast:null,diagnostics:n.diagnostics})}function De(t,n,e){let r={"((":"circle","(":"rounded","))":"bang",")":"cloud","{{":"hexagon"},i=t,s="default";for(let[o,a]of Object.entries(r)){let c=o.split("").reverse().join(""),l=new RegExp(`^\\${o.split("").join("\\")}(.+?)\\${c.split("").join("\\")}$`),h=t.match(l);if(h){i=h[1],s=a;break}}return i?{id:`node-${e.nodeIdCounter++}`,label:i,shape:s,children:[],span:n}:(e.diagnostics.push(z(`Empty node label: ${t}`,n)),null)}function Te(t){let n=0;for(let e of t)if(e===" ")n++;else if(e==="	")n+=2;else break;return n}function ze(t,n,e){for(;e.nodeStack.length>0&&e.nodeStack[e.nodeStack.length-1].indent>=n;)e.nodeStack.pop();if(e.nodeStack.length===0){e.diagnostics.push(z(`Node at same or lower indent than root: ${t.label}`,t.span));return}e.nodeStack[e.nodeStack.length-1].node.children.push(t),e.nodeStack.push({node:t,indent:n})}function He(t){let n={slices:[],showData:!1,diagnostics:[]},e=t.split(`
`);for(let i=0;i<e.length;i++){let o=e[i].trim();if(!o||o.startsWith("%%")||i===0&&/^pie\s*$/i.test(o))continue;let a=R(t,i);if(/^pie\s+showData\s*$/i.test(o)){n.showData=!0;continue}if(/^title\s+(.+)$/i.test(o)){let l=o.match(/^title\s+(.+)$/i);l&&(n.title=l[1].trim());continue}let c=o.match(/^"([^"]+)"\s*:\s*(\d+(?:\.\d+)?)$/);if(c){let[,l,h]=c,d=Number.parseFloat(h);if(Number.isNaN(d)||d<0){n.diagnostics.push(C("Slice value must be a non-negative number",a));continue}n.slices.push({label:l,value:d,span:a});continue}n.diagnostics.push(z(`Skipping unrecognized line: ${o}`,a))}return{ast:{type:"pie",title:n.title,showData:n.showData,slices:n.slices,span:T(1,1,0,t.length)},diagnostics:n.diagnostics}}var Re=[{pattern:/-->>/,type:"dashed"},{pattern:/->>/,type:"solid"},{pattern:/-\)/,type:"open"},{pattern:/-x/,type:"cross"}];function Ye(t){let n={participants:new Map,messages:[],diagnostics:[],blockStack:[]},e=t.split(`
`);for(let i=0;i<e.length;i++){let o=e[i].trim();if(!o||o.startsWith("%%")||i===0&&/^sequenceDiagram\s*$/i.test(o))continue;let a=R(t,i);o.startsWith("participant")||o.startsWith("actor")?We(o,a,n):o.startsWith("Note")?Oe(o,a,n):o.startsWith("loop")||o.startsWith("alt")||o.startsWith("opt")||o.startsWith("par")||o.startsWith("critical")||o.startsWith("break")||o.startsWith("rect")?Be(o,a,n):o==="end"?Fe(a,n):o.startsWith("else")||o.startsWith("and")?Ue(o,a,n):o.includes("-->>")||o.includes("->>")||o.includes("-x")||o.includes("-)")?Xe(o,a,n):o.startsWith("activate")||o.startsWith("deactivate")?Ge(o,a,n):n.diagnostics.push(z(`Skipping unrecognized line: ${o}`,a))}return n.blockStack.length>0&&n.diagnostics.push(z(`Unclosed block: ${n.blockStack[n.blockStack.length-1].block.type}`,T(1,1,0,0))),{ast:{type:"sequence",participants:Array.from(n.participants.values()),messages:n.messages,span:T(1,1,0,t.length)},diagnostics:n.diagnostics}}function We(t,n,e){let r=t.match(/^(participant|actor)\s+(\w+)(?:\s+as\s+(.+))?$/);if(!r){e.diagnostics.push(C("Invalid participant syntax",n,["Expected: participant id as label"]));return}let[,i,s,o]=r,a={id:s,label:o||s,type:i,span:n};e.participants.set(s,a)}function Xe(t,n,e){for(let{pattern:r,type:i}of Re)if(r.test(t)){let s=t.split(r);if(s.length!==2){e.diagnostics.push(C("Invalid message syntax",n,["Expected: participant1 ->> participant2: message"]));return}let o=s[0].trim(),a=s[1].trim(),c,l,h=!1,d=!1;if(a.includes(":")){let[f,...g]=a.split(":");c=f.trim(),l=g.join(":").trim()}else c=a,l="";o.endsWith("+")&&(o=o.slice(0,-1).trim(),h=!0),o.endsWith("-")&&(o=o.slice(0,-1).trim(),d=!0),U(o,n,e),U(c,n,e);let u={from:o,to:c,label:l,arrowType:i,activate:h||void 0,deactivate:d||void 0,span:n};e.blockStack.length>0?e.blockStack[e.blockStack.length-1].currentSection.messages.push(u):e.messages.push(u);return}e.diagnostics.push(C("Invalid message arrow",n,["Expected one of: ->>, -->>, -), -x"]))}function Oe(t,n,e){let r=t.match(/^Note\s+left\s+of\s+(\w+):\s*(.+)$/);if(r){let[,o,a]=r;U(o,n,e),lt({placement:"left",participants:[o],text:a,span:n},e);return}let i=t.match(/^Note\s+right\s+of\s+(\w+):\s*(.+)$/);if(i){let[,o,a]=i;U(o,n,e),lt({placement:"right",participants:[o],text:a,span:n},e);return}let s=t.match(/^Note\s+over\s+([\w,\s]+):\s*(.+)$/);if(s){let[,o,a]=s,c=o.split(",").map(h=>h.trim());for(let h of c)U(h,n,e);lt({placement:"over",participants:c,text:a,span:n},e);return}e.diagnostics.push(C("Invalid note syntax",n))}function Be(t,n,e){let r=t.match(/^(loop|alt|opt|par|critical|break|rect)(?:\s+(.+))?$/);if(!r){e.diagnostics.push(C("Invalid block syntax",n));return}let[,i,s]=r,o={type:i,label:s||"",sections:[],span:n},a={label:void 0,messages:[]};o.sections.push(a),e.blockStack.push({block:o,currentSection:a})}function Ue(t,n,e){if(e.blockStack.length===0){e.diagnostics.push(C("Unexpected block section outside block",n));return}let r=t.match(/^(else|and)(?:\s+(.+))?$/);if(!r){e.diagnostics.push(C("Invalid block section syntax",n));return}let[,,i]=r,s={label:i,messages:[]},o=e.blockStack[e.blockStack.length-1];o.block.sections.push(s),o.currentSection=s}function Fe(t,n){if(n.blockStack.length===0){n.diagnostics.push(C("Unexpected 'end' without block",t));return}let{block:e}=n.blockStack.pop();n.blockStack.length>0?n.blockStack[n.blockStack.length-1].currentSection.messages.push(e):n.messages.push(e)}function Ge(t,n,e){let r=t.match(/^(activate|deactivate)\s+(\w+)$/);if(!r){e.diagnostics.push(C("Invalid activation syntax",n));return}let[,i,s]=r;U(s,n,e),e.diagnostics.push(z(`Standalone ${i} not fully supported, use +/- on messages`,n))}function U(t,n,e){e.participants.has(t)||e.participants.set(t,{id:t,label:t,type:"participant",span:n})}function lt(t,n){n.blockStack.length>0?n.blockStack[n.blockStack.length-1].currentSection.messages.push(t):n.messages.push(t)}function F(t){let n=Ct(t);if(!n)return{ast:null,diagnostics:[C("Unable to detect diagram type",T(1,1,0,0),["Expected first line to be one of: graph/flowchart, sequenceDiagram, classDiagram, erDiagram, stateDiagram-v2"])]};switch(n){case"flowchart":return St(t,!1);case"state":return St(t,!0);case"sequence":return Ye(t);case"class":return ge(t);case"er":return xe(t);case"pie":return He(t);case"gantt":return Pe(t);case"mindmap":return Ne(t)}}var ut={normal:.52,medium:.55,bold:.58};function nt(t,n,e=400){let r=e>=600?ut.bold:e>=500?ut.medium:ut.normal;return t.length*n*r}function ft(t,n,e=14){let r=t.split(`
`),i=Math.max(...r.map(c=>nt(c,e))),s=r.length*e*1.2,o,a;switch(n){case"state-start":{o=28,a=28;break}case"state-end":{o=32,a=32;break}case"diamond":case"rhombus":{o=i*1.6+32,a=s*1.6+24;break}case"circle":case"doublecircle":{let c=Math.max(i,s)+32;o=c,a=c;break}case"stadium":case"pill":{o=i+s+16,a=s+16;break}case"hexagon":{o=i+48,a=s+24;break}case"trapezoid":case"inv-trapezoid":{o=i+56,a=s+24;break}case"odd":case"lean-right":case"lean-left":{o=i+40,a=s+24;break}case"class-box":{o=i+32,a=s+24;break}case"er-entity":{let c=t.split(`
`),l=c.includes("---"),h=e*1.2+16;if(l){let d=c.filter(b=>b!=="---"&&b!==c[0]),u=nt(c[0]||"",e,600),f=d.map(b=>nt(b,e-2)),g=f.length>0?Math.max(...f):0;o=Math.max(u,g)+48;let m=d.length*(e-2)*1.4+12;a=h+m}else{let d=nt(c[0]||"",e,600);o=Math.max(d+40,120),a=h+24}break}default:{o=i+24,a=s+16;break}}return{width:o,height:a}}var je=class{nodes=new Map;edges=new Map;inEdges=new Map;outEdges=new Map;children=new Map;addNode(t,n,e=0,r=0){this.nodes.set(t,{id:t,data:n,width:e,height:r}),this.inEdges.has(t)||this.inEdges.set(t,new Set),this.outEdges.has(t)||this.outEdges.set(t,new Set)}removeNode(t){let n=this.inEdges.get(t);if(n)for(let i of n)this.removeEdge(i,t);let e=this.outEdges.get(t);if(e)for(let i of e)this.removeEdge(t,i);this.nodes.delete(t),this.inEdges.delete(t),this.outEdges.delete(t);let r=this.nodes.get(t)?.parent;r&&this.children.get(r)?.delete(t)}addEdge(t,n,e,r=1){let i=`${t}->${n}`;this.edges.set(i,{source:t,target:n,data:e,weight:r}),this.outEdges.has(t)||this.outEdges.set(t,new Set),this.inEdges.has(n)||this.inEdges.set(n,new Set),this.outEdges.get(t).add(n),this.inEdges.get(n).add(t)}removeEdge(t,n){let e=`${t}->${n}`;this.edges.delete(e),this.outEdges.get(t)?.delete(n),this.inEdges.get(n)?.delete(t)}setParent(t,n){let e=this.nodes.get(t);e&&(e.parent=n,this.children.has(n)||this.children.set(n,new Set),this.children.get(n).add(t))}getNode(t){return this.nodes.get(t)}getEdge(t,n){return this.edges.get(`${t}->${n}`)}predecessors(t){return Array.from(this.inEdges.get(t)||[])}successors(t){return Array.from(this.outEdges.get(t)||[])}sources(){let t=[];for(let n of this.nodes.keys())(this.inEdges.get(n)?.size||0)===0&&t.push(n);return t}sinks(){let t=[];for(let n of this.nodes.keys())(this.outEdges.get(n)?.size||0)===0&&t.push(n);return t}nodeIds(){return Array.from(this.nodes.keys())}getEdges(){return Array.from(this.edges.values())}getChildren(t){return Array.from(this.children.get(t)||[])}reverseEdge(t,n){let e=this.getEdge(t,n);e&&(this.removeEdge(t,n),this.addEdge(n,t,e.data,e.weight))}hasEdge(t,n){return this.edges.has(`${t}->${n}`)}nodeCount(){return this.nodes.size}edgeCount(){return this.edges.size}};function qe(t){let n=new Set,e=new Set,r=[];function i(o){n.add(o),e.add(o);let a=t.successors(o);for(let c of a)n.has(c)?e.has(c)&&(t.reverseEdge(o,c),r.push({source:o,target:c})):i(c);e.delete(o)}let s=t.sources();if(s.length===0){let o=t.nodeIds();o.length>0&&i(o[0])}else for(let o of s)n.has(o)||i(o);for(let o of t.nodeIds())n.has(o)||i(o);return r}function Ke(t,n){for(let e of n)t.reverseEdge(e.target,e.source)}function Ve(t){let n=new Map,e=[],r=[];for(let i of t.nodeIds()){let s=t.predecessors(i).length;n.set(i,s),s===0&&e.push(i)}for(;e.length>0;){e.sort();let i=e.shift();r.push(i);for(let s of t.successors(i)){let o=n.get(s)-1;n.set(s,o),o===0&&e.push(s)}}return r}function Qe(t){let n=new Map,e=Ve(t);for(let i of e){let s=t.predecessors(i);if(s.length===0)n.set(i,0);else{let o=Math.max(...s.map(a=>n.get(a)??0));n.set(i,o+1)}}let r=Math.max(...Array.from(n.values()));return{layers:n,maxLayer:r}}function Ze(t,n){let e=new Map,r=t.getEdges(),i=0;for(let s of r){let o=n.get(s.source)??0,c=(n.get(s.target)??0)-o;if(c>1){let l=[],h=s.source;for(let d=1;d<c;d++){let u=`__virtual_${i++}`;t.addNode(u,s.data,0,0),n.set(u,o+d),t.addEdge(h,u,s.data,s.weight),l.push(u),h=u}t.addEdge(h,s.target,s.data,s.weight),t.removeEdge(s.source,s.target),e.set(`${s.source}->${s.target}`,l)}}return e}function Je(t,n){let e=Array.from({length:n+1},()=>[]);for(let[r,i]of t)e[i].push(r);for(let r of e)r.sort();return e}function It(t,n){let e=0;for(let r=0;r<n.length-1;r++){let i=n[r],s=n[r+1],o=new Map;for(let a=0;a<s.length;a++)o.set(s[a],a);for(let a=0;a<i.length;a++){let c=i[a],l=t.successors(c);for(let h=a+1;h<i.length;h++){let d=i[h],u=t.successors(d);for(let f of l){let g=o.get(f);if(g!==void 0)for(let m of u){let b=o.get(m);b!==void 0&&g>b&&e++}}}}}return e}function Nt(t,n,e,r){let i=new Map;for(let o=0;o<e.length;o++)i.set(e[o],o);let s=n.map(o=>{let c=(r?t.predecessors(o):t.successors(o)).filter(h=>i.has(h));if(c.length===0)return{nodeId:o,weight:0};let l=c.reduce((h,d)=>h+i.get(d),0);return{nodeId:o,weight:l/c.length}});return s.sort((o,a)=>o.weight!==a.weight?o.weight-a.weight:o.nodeId.localeCompare(a.nodeId)),s.map(o=>o.nodeId)}function tn(t,n){let e=n.map(o=>[...o]),r=It(t,e);if(r===0)return e;let i=24,s=e.map(o=>[...o]);for(let o=0;o<i;o++){if(o%2===0)for(let l=1;l<s.length;l++)s[l]=Nt(t,s[l],s[l-1],!0);else for(let l=s.length-2;l>=0;l--)s[l]=Nt(t,s[l],s[l+1],!1);let c=It(t,s);if(c<r&&(r=c,e=s.map(l=>[...l]),r===0))break}return e}function en(t){return t==="LR"||t==="RL"}function nn(t,n,e,r){let i=new Map,s=0;for(let o=0;o<n.length;o++){i.set(o,s);let a=Math.max(...n[o].map(c=>{let l=t.getNode(c);return l?r?l.width:l.height:0}));s+=a+e}return i}function rn(t,n,e,r){let i=new Map;for(let s of n){let o=0;for(let l of s){let h=t.getNode(l);if(!h)continue;let d=r?h.height:h.width;i.set(l,o+d/2),o+=d+e}let c=(o-e)/2;for(let l of s)i.set(l,i.get(l)-c)}return i}function rt(t,n,e,r,i){for(let s of n){let o=s.map(a=>({nodeId:a,pos:e.get(a)})).sort((a,c)=>a.pos-c.pos);for(let a=1;a<o.length;a++){let c=t.getNode(o[a-1].nodeId),l=t.getNode(o[a].nodeId);if(!c||!l)continue;let h=i?c.height:c.width,d=i?l.height:l.width,u=o[a-1].pos+h/2+r+d/2;o[a].pos<u&&(o[a].pos=u,e.set(o[a].nodeId,u))}}}function sn(t,n,e,r,i){let s=new Map(e),o=24,a=.5,c=h=>h.startsWith("__virtual_"),l=.2;for(let h=0;h<o;h++){let d=new Map;for(let u of n)for(let f of u){let g=[...t.predecessors(f),...t.successors(f)];if(g.length===0){d.set(f,s.get(f));continue}let m=0,b=0;for(let w of g){let S=c(w)&&!c(f)?l:1;m+=(s.get(w)??0)*S,b+=S}let k=m/b,A=s.get(f),y=A+(k-A)*a;d.set(f,y)}rt(t,n,d,r,i),s.clear();for(let[u,f]of d)s.set(u,f)}return s}function on(t,n,e,r,i){let s=new Map(e);for(let o=0;o<4;o++){for(let a of n)for(let c of a){let l=t.predecessors(c),h=t.successors(c),d=null;if(l.length===1){let u=l[0];t.successors(u).length===1&&(d=s.get(u))}if(d===null&&h.length===1){let u=h[0];t.predecessors(u).length===1&&(d=s.get(u))}d!==null&&s.set(c,d)}rt(t,n,s,r,i)}return s}function an(t,n,e,r,i){let s=new Map(e),o=a=>a.startsWith("__virtual_");for(let a=0;a<8;a++){if(a%2===0)for(let l=0;l<n.length;l++){let h=n[l];for(let d of h){let u=t.successors(d);if(u.length<2)continue;let f=n[l+1];if(!f)continue;let g=u.filter(S=>f.includes(S));if(g.length<2)continue;let m=g.filter(S=>!o(S)),b=m.length>=2?m:g,k=s.get(d),A=b.map(S=>s.get(S)),y=(Math.min(...A)+Math.max(...A))/2,w=k-y;if(!(Math.abs(w)<1))for(let S of g)s.set(S,s.get(S)+w)}}else for(let l=n.length-1;l>=0;l--){let h=n[l];for(let d of h){if(o(d))continue;let u=t.predecessors(d);if(u.length<2)continue;let f=n[l-1];if(!f)continue;let g=u.filter(y=>f.includes(y)),m=g.filter(y=>!o(y)),b=m.length>=2?m:g;if(b.length<2)continue;let k=b.map(y=>s.get(y)),A=(Math.min(...k)+Math.max(...k))/2;s.set(d,A)}}rt(t,n,s,r,i)}return s}function cn(t,n,e,r,i){let s=new Map(e),o=a=>a.startsWith("__virtual_");for(let a=0;a<8;a++){for(let c=0;c<n.length;c++){let l=n[c];for(let h of l){if(o(h))continue;let u=t.successors(h).filter(f=>!o(f)&&n[c+1]?.includes(f));if(u.length>=2){let f=s.get(h),g=u.map(k=>s.get(k)),m=(Math.min(...g)+Math.max(...g))/2,b=f-m;if(Math.abs(b)>1)for(let k of u)s.set(k,s.get(k)+b)}}}for(let c=n.length-1;c>=0;c--){let l=n[c];for(let h of l){if(o(h))continue;let d=t.predecessors(h),u=d.filter(f=>!o(f)&&n[c-1]?.includes(f));if(u.length>=2){let f=u.map(m=>s.get(m)),g=(Math.min(...f)+Math.max(...f))/2;s.set(h,g)}if(l.length===1){let f=d.filter(b=>!o(b)),g=t.successors(h).filter(b=>!o(b)),m=[...f,...g];if(m.length>0){let b=m.reduce((A,y)=>A+(s.get(y)??0),0)/m.length,k=s.get(h);s.set(h,k+(b-k)*.5)}}}}rt(t,n,s,r,i)}return s}function ln(t,n){let e=Array.from(t.values()),r=Math.min(...e),i=new Map;for(let[s,o]of t)i.set(s,o-r+n);return i}function hn(t,n,e,r,i,s){let o=en(s),a=nn(t,n,r,o),c=rn(t,n,e,o),l=sn(t,n,c,e,o),h=on(t,n,l,e,o),d=an(t,n,h,e,o),u=cn(t,n,d,e,o),f=ln(u,i),g=new Map;for(let k=0;k<n.length;k++){let A=a.get(k)+i;for(let y of n[k]){let w=f.get(y);o?g.set(y,{x:A,y:w}):g.set(y,{x:w,y:A})}}if(s==="BT"||s==="RL"){let k=Math.max(...o?Array.from(g.values()).map(A=>A.x):Array.from(g.values()).map(A=>A.y));for(let[A,y]of g)o?g.set(A,{x:k-y.x+2*i,y:y.y}):g.set(A,{x:y.x,y:k-y.y+2*i})}let m=0,b=0;for(let[k,A]of g){let y=t.getNode(k);if(!y)continue;let w=A.x+y.width/2+i,S=A.y+y.height/2+i;w>m&&(m=w),S>b&&(b=S)}return{positions:g,width:m,height:b}}function dn(t,n,e){let r=new je;for(let y of t)r.addNode(y.id,{},y.width,y.height);for(let y of n)r.addEdge(y.source,y.target,{},y.weight??1);let i=qe(r),{layers:s,maxLayer:o}=Qe(r),a=Ze(r,s),c=Je(s,o),l=tn(r,c),h=e.direction??"TB",d=e.nodeSpacing??50,u=e.layerSpacing??100,f=e.padding??20,{positions:g,width:m,height:b}=hn(r,l,d,u,f,h);Ke(r,i);let k=new Map;for(let y of t){let w=g.get(y.id);w&&k.set(y.id,w)}let A=new Map;for(let y of n){let w=g.get(y.source),S=g.get(y.target);if(!w||!S)continue;let x=a.get(`${y.source}->${y.target}`)??[],p=[w];for(let v of x){let M=g.get(v);M&&p.push(M)}p.push(S),A.set(`${y.source}->${y.target}`,p)}return{nodePositions:k,edgeRoutes:A,width:m,height:b}}function un(t){return t==="LR"||t==="RL"}function fn(t,n){if(t.length<2)return t;let e=t[0],r=t[t.length-1],i=un(n);if(t.length===2||t.length===3){if(i){if(Math.abs(e.y-r.y)<8)return[e,r];let a=(e.x+r.x)/2;return[e,{x:a,y:e.y},{x:a,y:r.y},r]}if(Math.abs(e.x-r.x)<8)return[e,r];let o=(e.y+r.y)/2;return[e,{x:e.x,y:o},{x:r.x,y:o},r]}let s=[e];for(let o=1;o<t.length-1;o++){let a=s[s.length-1],c=t[o];i?(s.push({x:c.x,y:a.y}),Math.abs(c.y-a.y)>1&&s.push({x:c.x,y:c.y})):(s.push({x:a.x,y:c.y}),Math.abs(c.x-a.x)>1&&s.push({x:c.x,y:c.y}))}return s.push(r),s}function Dt(t,n,e){let r=t.x-n.x,i=t.y-n.y,s=n.width/2,o=n.height/2;switch(e){case"circle":case"doublecircle":case"state-start":case"state-end":{let a=Math.max(s,o),c=Math.atan2(i,r);return{x:n.x+a*Math.cos(c),y:n.y+a*Math.sin(c)}}case"diamond":case"rhombus":{let a=Math.atan2(i,r),c=Math.abs(a);if(c<Math.PI/4||c>3*Math.PI/4){let h=s/Math.abs(Math.cos(a)),d=n.x+h*Math.cos(a),u=n.y+h*Math.sin(a);if(Math.abs(u-n.y)<=o)return{x:d,y:u}}let l=o/Math.abs(Math.sin(a));return{x:n.x+l*Math.cos(a),y:n.y+l*Math.sin(a)}}case"hexagon":{let a=Math.atan2(i,r),c=Math.PI/3;if(Math.abs(a)<c||Math.abs(a)>Math.PI-c){let h=s/Math.abs(Math.cos(a));return{x:n.x+h*Math.cos(a),y:n.y+h*Math.sin(a)}}let l=o/Math.abs(Math.sin(a));return{x:n.x+l*Math.cos(a),y:n.y+l*Math.sin(a)}}default:{let a=Math.atan2(i,r);if(Math.abs(Math.cos(a))*o>Math.abs(Math.sin(a))*s){let l=s/Math.abs(Math.cos(a));return{x:n.x+l*Math.cos(a),y:n.y+l*Math.sin(a)}}let c=o/Math.abs(Math.sin(a));return{x:n.x+c*Math.cos(a),y:n.y+c*Math.sin(a)}}}}function gn(t,n,e,r,i,s){let o=fn(e,s);if(o.length<2)return o;let a=o.length>2?o[1]:o[o.length-1],c=o.length>2?o[o.length-2]:o[0],l=Dt(a,t,r),h=Dt(c,n,i),d=o.length>2?o.slice(1,-1):[];return[l,...d,h]}function gt(t){if(t.length===0)return{x:0,y:0};let n=0,e=[];for(let s=0;s<t.length-1;s++){let o=t[s+1].x-t[s].x,a=t[s+1].y-t[s].y,c=Math.sqrt(o*o+a*a);e.push(c),n+=c}let r=n/2,i=0;for(let s=0;s<e.length;s++){if(i+e[s]>=r){let o=(r-i)/e[s];return{x:t[s].x+(t[s+1].x-t[s].x)*o,y:t[s].y+(t[s+1].y-t[s].y)*o}}i+=e[s]}return t[Math.floor(t.length/2)]}function pn(t,n){let e=n.padding??20,r=n.nodeSpacing??60,i=n.layerSpacing??30,s=t.participants,o=120,a=40,c=[],l=new Map;for(let g=0;g<s.length;g++){let m=s[g],b=e+g*(o+r),k=e;l.set(m.id,b),c.push({id:m.id,label:m.label,shape:m.type,x:b,y:k,width:o,height:a})}let h=[],d=e+a+i;for(let g of t.messages)if("from"in g&&"to"in g){let m=g,b=l.get(m.from)??e,k=l.get(m.to)??e,A=[{x:b+o/2,y:d},{x:k+o/2,y:d}];h.push({source:m.from,target:m.to,label:m.label,style:m.arrowType==="solid"?"solid":"dotted",hasArrowStart:!1,hasArrowEnd:!0,points:A,labelPosition:gt(A)}),d+=i}let u=e+s.length*o+(s.length-1)*r+e,f=d+e;for(let g of s){let b=(l.get(g.id)??e)+o/2;h.unshift({source:g.id,target:g.id,style:"dotted",hasArrowStart:!1,hasArrowEnd:!1,points:[{x:b,y:e+a},{x:b,y:f-e}]})}return{width:u,height:f,nodes:c,edges:h,groups:[]}}function Tt(t,n,e,r,i,s){let o=i-t,a=s-n;if(o===0&&a===0)return{x:t,y:n};let c=e/2,l=r/2,h=Math.abs(o),d=Math.abs(a),u;return h*l>d*c?u=c/h:u=l/d,{x:t+o*u,y:n+a*u}}function mn(t,n,e){let r=e.padding??20,i=e.nodeSpacing??80,s=t.map((p,v)=>{let M=ft(p.label,p.shape),E=v/t.length*Math.PI*2,_=i*Math.sqrt(t.length);return{id:p.id,label:p.label,shape:p.shape,x:_*Math.cos(E),y:_*Math.sin(E),vx:0,vy:0,width:M.width,height:M.height,inlineStyle:p.inlineStyle}}),o=new Map(s.map(p=>[p.id,p])),a=150,c=8e3,l=.008,h=.85,d=20;for(let p=0;p<a;p++){for(let v=0;v<s.length;v++)for(let M=v+1;M<s.length;M++){let E=s[v],_=s[M],L=_.x-E.x,N=_.y-E.y,I=Math.max(Math.sqrt(L*L+N*N),1),H=(E.width+_.width)/2+d,D=Math.max(I,1),B=c/(D*D),at=I<H?(H-I)*.5:0,q=B+at,K=L/I*q,et=N/I*q;E.vx-=K,E.vy-=et,_.vx+=K,_.vy+=et}for(let v of n){let M=o.get(v.source),E=o.get(v.target);if(!M||!E)continue;let _=E.x-M.x,L=E.y-M.y,N=Math.sqrt(_*_+L*L),I=(M.width+E.width)/2+i,H=(N-I)*l,D=_/Math.max(N,1)*H,B=L/Math.max(N,1)*H;M.vx+=D,M.vy+=B,E.vx-=D,E.vy-=B}for(let v of s)v.vx*=h,v.vy*=h,v.x+=v.vx,v.y+=v.vy}let u=1/0,f=1/0,g=-1/0,m=-1/0;for(let p of s)u=Math.min(u,p.x-p.width/2),f=Math.min(f,p.y-p.height/2),g=Math.max(g,p.x+p.width/2),m=Math.max(m,p.y+p.height/2);let b=r-u,k=r-f,A=s.map(p=>({id:p.id,label:p.label,shape:p.shape,x:p.x-p.width/2+b,y:p.y-p.height/2+k,width:p.width,height:p.height,inlineStyle:p.inlineStyle})),y=new Map(A.map(p=>[p.id,p])),w=n.map(p=>{let v=y.get(p.source),M=y.get(p.target);if(!v||!M)return{source:p.source,target:p.target,label:p.label,style:p.style,hasArrowStart:p.hasArrowStart,hasArrowEnd:p.hasArrowEnd,points:[],inlineStyle:p.inlineStyle};let E=v.x+v.width/2,_=v.y+v.height/2,L=M.x+M.width/2,N=M.y+M.height/2,I=[Tt(E,_,v.width,v.height,L,N),Tt(L,N,M.width,M.height,E,_)];return{source:p.source,target:p.target,label:p.label,style:p.style,hasArrowStart:p.hasArrowStart,hasArrowEnd:p.hasArrowEnd,points:I,labelPosition:p.label?gt(I):void 0,inlineStyle:p.inlineStyle}}),S=g-u+r*2,x=m-f+r*2;return{width:S,height:x,nodes:A,edges:w,groups:[]}}function bn(t,n){let e=n.padding??20,r=120,i=e+r,s=t.title?30:0,o=e+s+r,a=t.slices.reduce((u,f)=>u+f.value,0);if(a===0)return{width:e*2,height:e*2,nodes:[],edges:[],groups:[]};let c=[],l=-Math.PI/2;for(let u=0;u<t.slices.length;u++){let f=t.slices[u],g=f.value/a*Math.PI*2,m=l+g/2,b=r*.65,k=i+b*Math.cos(m),A=o+b*Math.sin(m);c.push({id:`slice-${u}`,label:f.label,shape:"pie-slice",x:k-30,y:A-12,width:60,height:24,inlineStyle:{cx:String(i),cy:String(o),radius:String(r),startAngle:String(l),endAngle:String(l+g),value:String(f.value),percent:String(Math.round(f.value/a*100)),index:String(u)}}),l+=g}t.title&&c.unshift({id:"pie-title",label:t.title,shape:"pie-title",x:i-80,y:e,width:160,height:24});let h=i+r+e,d=o+r+e;return{width:h,height:d,nodes:c,edges:[],groups:[]}}function Rt(t,n,e,r,i,s,o,a){let c=Math.max(t.label.length*9+20,60),l=32,h={default:"rounded",rounded:"rounded",circle:"circle",bang:"hexagon",cloud:"cloud",hexagon:"hexagon"};if(o.push({id:t.id,label:t.label,shape:h[t.shape]||"rounded",x:n-c/2,y:e-l/2,width:c,height:l}),t.children.length===0)return;let d=i/Math.max(t.children.length,1),u=r-i/2+d/2,f=120+s*30;for(let g=0;g<t.children.length;g++){let m=t.children[g],b=u+g*d,k=n+f*Math.cos(b),A=e+f*Math.sin(b);a.push({source:t.id,target:m.id,style:"solid",hasArrowStart:!1,hasArrowEnd:!1,points:[{x:n,y:e},{x:k,y:A}]}),Rt(m,k,A,b,d*1.2,s+1,o,a)}}function yn(t,n){let e=n.padding??40,r=[],i=[];Rt(t.root,300,300,0,Math.PI*2,0,r,i);let a=1/0,c=1/0,l=-1/0,h=-1/0;for(let m of r)a=Math.min(a,m.x),c=Math.min(c,m.y),l=Math.max(l,m.x+m.width),h=Math.max(h,m.y+m.height);let d=e-a,u=e-c;for(let m of r)m.x+=d,m.y+=u;for(let m of i)for(let b of m.points)b.x+=d,b.y+=u;let f=l-a+e*2,g=h-c+e*2;return{width:f,height:g,nodes:r,edges:i,groups:[]}}function xn(t,n){let e=n.padding??20,r=28,i=6,s=24,o=140,a=8,c=t.title?30:0;if(t.sections.flatMap(w=>w.tasks).length===0)return{width:e*2,height:e*2,nodes:[],edges:[],groups:[]};let h=0,d=100,u=0,f=new Map;for(let w of t.sections)for(let S of w.tasks){let x=u*15,p=30;if(S.afterId&&f.has(S.afterId)&&(x=f.get(S.afterId)),S.duration){let M=S.duration.match(/(\d+)d/);M?.[1]&&(p=parseInt(M[1]))}let v=x+p;S.id&&f.set(S.id,v),d=Math.max(d,v),u++}let g=(d-h)*a,m=[],b=[],k=e+c;u=0,t.title&&m.push({id:"gantt-title",label:t.title,shape:"gantt-title",x:e,y:e,width:o+g,height:24});for(let w of t.sections){let S=k;m.push({id:`section-${w.name}`,label:w.name,shape:"gantt-section",x:e,y:k,width:o+g,height:s}),k+=s+i;for(let p of w.tasks){let v=u*15,M=30;if(p.afterId&&f.has(p.afterId)?v=f.get(p.afterId):p.startDate&&(v=u*15),p.duration){let L=p.duration.match(/(\d+)d/);L?.[1]&&(M=parseInt(L[1]))}let E=e+o+(v-h)*a,_=M*a;m.push({id:p.id||`task-${u}`,label:p.label,shape:"gantt-bar",x:E,y:k,width:_,height:r,inlineStyle:{status:p.status||"default",labelX:String(e),labelWidth:String(o)}}),k+=r+i,u++}let x=k-S;b.push({id:`group-${w.name}`,label:w.name,x:e,y:S,width:o+g,height:x,children:[]})}let A=e+o+g+e,y=k+e;return{width:A,height:y,nodes:m,edges:[],groups:[]}}function wn(t){let n=Array.from(t.nodes.values()).map(r=>{let i=t.classAssignments.get(r.id),s=i?t.classDefs.get(i):void 0,o=t.nodeStyles.get(r.id),a={...s,...o};return{id:r.id,label:r.label,shape:r.shape,inlineStyle:Object.keys(a).length>0?a:void 0}}),e=t.edges.map(r=>({source:r.source,target:r.target,label:r.label,style:r.style,hasArrowStart:r.hasArrowStart,hasArrowEnd:r.hasArrowEnd}));return{nodes:n,edges:e}}function zt(t){let n=t.visibility||"";if(t.isMethod){let r=t.returnType?`: ${t.returnType}`:"";return`${n}${t.name}()${r}`}let e=t.type?`: ${t.type}`:"";return`${n}${t.name}${e}`}function kn(t){let n=Array.from(t.classes.values()).map(r=>{let i=r.label||r.id,s=r.members.filter(d=>!d.isMethod).map(zt),o=r.members.filter(d=>d.isMethod).map(zt),a=[i];(s.length>0||o.length>0)&&(a.push("---"),a.push(...s)),o.length>0&&(a.push("---"),a.push(...o));let c=a.join(`
`),l=s.length,h=o.length;return{id:r.id,label:c,shape:"class-box",inlineStyle:{className:i,attrCount:String(l),methodCount:String(h)}}}),e=t.relations.map(r=>({source:r.from,target:r.to,label:r.label,style:r.type==="dependency"||r.type==="realization"?"dotted":"solid",hasArrowStart:!1,hasArrowEnd:r.type==="association"||r.type==="dependency",inlineStyle:{relationType:r.type}}));return{nodes:n,edges:e}}function $n(t){let n=t.keys.length>0?t.keys.join(","):"";return n?`${n} ${t.type} ${t.name}`:`${t.type} ${t.name}`}function An(t){let n=Array.from(t.entities.values()).map(r=>{let i=r.attributes.map($n),s=[r.id];i.length>0&&(s.push("---"),s.push(...i));let o=s.join(`
`);return{id:r.id,label:o,shape:"er-entity",inlineStyle:{entityName:r.id,attrCount:String(r.attributes.length)}}}),e=t.relations.map(r=>({source:r.from,target:r.to,label:r.label,style:r.identifying?"solid":"dotted",hasArrowStart:!1,hasArrowEnd:!1,inlineStyle:{fromCardinality:r.fromCardinality,toCardinality:r.toCardinality}}));return{nodes:n,edges:e}}function Yt(t){let n=[...t.nodeIds];for(let e of t.children)n.push(...Yt(e));return n}function Wt(t,n,e){return t.map(r=>{let i=Wt(r.children,n,e),o=Yt(r).map(f=>n.get(f)).filter(Boolean);if(o.length===0&&i.length===0)return null;let a=1/0,c=1/0,l=-1/0,h=-1/0;for(let f of o)a=Math.min(a,f.x),c=Math.min(c,f.y),l=Math.max(l,f.x+f.width),h=Math.max(h,f.y+f.height);for(let f of i)a=Math.min(a,f.x),c=Math.min(c,f.y),l=Math.max(l,f.x+f.width),h=Math.max(h,f.y+f.height);let d=e,u=20;return{id:r.id,label:r.label,x:a-d,y:c-d-u,width:l-a+d*2,height:h-c+d*2+u,children:i}}).filter(Boolean)}function Ht(t,n,e,r,i){let s=e.direction??r??"TB",o=t.map(x=>{let p=ft(x.label,x.shape);return{id:x.id,width:p.width,height:p.height}}),a=n.map(x=>({source:x.source,target:x.target,weight:1})),c=dn(o,a,{...e,direction:s}),l=t.map(x=>{let p=c.nodePositions.get(x.id)??{x:0,y:0},v=ft(x.label,x.shape);return{id:x.id,label:x.label,shape:x.shape,x:p.x-v.width/2,y:p.y-v.height/2,width:v.width,height:v.height,inlineStyle:x.inlineStyle}}),h=new Map(l.map(x=>[x.id,x])),d=n.map(x=>{let p=h.get(x.source),v=h.get(x.target);if(!p||!v)return{source:x.source,target:x.target,label:x.label,style:x.style,hasArrowStart:x.hasArrowStart,hasArrowEnd:x.hasArrowEnd,points:[],inlineStyle:x.inlineStyle};let M=c.edgeRoutes.get(`${x.source}->${x.target}`)??[{x:p.x+p.width/2,y:p.y+p.height/2},{x:v.x+v.width/2,y:v.y+v.height/2}],E={x:p.x+p.width/2,y:p.y+p.height/2,width:p.width,height:p.height},_={x:v.x+v.width/2,y:v.y+v.height/2,width:v.width,height:v.height},L=gn(E,_,M,p.shape,v.shape,s);return{source:x.source,target:x.target,label:x.label,style:x.style,hasArrowStart:x.hasArrowStart,hasArrowEnd:x.hasArrowEnd,points:L,labelPosition:x.label?gt(L):void 0,inlineStyle:x.inlineStyle}}),u=1/0,f=1/0,g=-1/0,m=-1/0;for(let x of l)u=Math.min(u,x.x),f=Math.min(f,x.y),g=Math.max(g,x.x+x.width),m=Math.max(m,x.y+x.height);for(let x of d)for(let p of x.points)u=Math.min(u,p.x),f=Math.min(f,p.y),g=Math.max(g,p.x),m=Math.max(m,p.y);let b=e.padding??20,k=b-u,A=b-f;for(let x of l)x.x+=k,x.y+=A;for(let x of d){for(let p of x.points)p.x+=k,p.y+=A;x.labelPosition&&(x.labelPosition.x+=k,x.labelPosition.y+=A)}let y=g-u+b*2,w=m-f+b*2,S=i?Wt(i,h,12):[];return{width:y,height:w,nodes:l,edges:d,groups:S}}function G(t,n={}){let e={nodeSpacing:40,layerSpacing:60,padding:20,...n};if(t.type==="sequence")return pn(t,e);if(t.type==="flowchart"){let{nodes:r,edges:i}=wn(t),o=r.some(a=>a.shape==="state-start"||a.shape==="state-end")?{...e,layerSpacing:45,nodeSpacing:30}:e;return Ht(r,i,o,t.direction,t.subgraphs)}if(t.type==="class"){let{nodes:r,edges:i}=kn(t);return Ht(r,i,e,"TB")}if(t.type==="er"){let{nodes:r,edges:i}=An(t);return mn(r,i,e)}if(t.type==="pie")return bn(t,e);if(t.type==="gantt")return xn(t,e);if(t.type==="mindmap")return yn(t,e);throw new Error(`Unsupported diagram type: ${t.type}`)}function Y(t,n,e){let r=Xt(t),i=Xt(n),s=e/100,o=Math.round(r.r*s+i.r*(1-s)),a=Math.round(r.g*s+i.g*(1-s)),c=Math.round(r.b*s+i.b*(1-s));return Sn(o,a,c)}function Xt(t){let n=t.replace("#",""),e=Number.parseInt(n.slice(0,2),16),r=Number.parseInt(n.slice(2,4),16),i=Number.parseInt(n.slice(4,6),16);return{r:e,g:r,b:i}}function Sn(t,n,e){return`#${[t,n,e].map(r=>r.toString(16).padStart(2,"0")).join("")}`}function V(t){let n=t.bg,e=t.fg,r=t.accent??Y(e,n,50);return{bg:n,fg:e,text:e,line:t.line??Y(e,n,30),arrow:r,muted:t.muted??Y(e,n,50),nodeFill:t.surface??Y(e,n,12),nodeStroke:t.border??Y(r,n,65),groupFill:Y(e,n,5),groupStroke:Y(e,n,15),groupText:Y(e,n,60),font:t.font??"ui-sans-serif, system-ui, sans-serif",monoFont:t.monoFont??"ui-monospace, monospace"}}var pt={"zinc-dark":{bg:"#18181B",fg:"#FAFAFA"},"zinc-light":{bg:"#FAFAFA",fg:"#18181B"},"tokyo-night":{bg:"#1a1b26",fg:"#a9b1d6",line:"#3d59a1",accent:"#7aa2f7"},"catppuccin-mocha":{bg:"#1e1e2e",fg:"#cdd6f4",accent:"#cba6f7",line:"#585b70"},"catppuccin-latte":{bg:"#eff1f5",fg:"#4c4f69",accent:"#8839ef",line:"#9ca0b0"},nord:{bg:"#2e3440",fg:"#d8dee9",accent:"#88c0d0",line:"#4c566a"},dracula:{bg:"#282a36",fg:"#f8f8f2",accent:"#bd93f9",line:"#6272a4"},"github-light":{bg:"#ffffff",fg:"#1f2328",accent:"#0969da",line:"#d1d9e0"},"github-dark":{bg:"#0d1117",fg:"#e6edf3",accent:"#58a6ff",line:"#30363d"},"one-dark":{bg:"#282c34",fg:"#abb2bf",accent:"#c678dd",line:"#3e4451"},"solarized-dark":{bg:"#002b36",fg:"#839496",accent:"#268bd2",line:"#073642"},"solarized-light":{bg:"#fdf6e3",fg:"#657b83",accent:"#268bd2",line:"#eee8d5"},monokai:{bg:"#272822",fg:"#f8f8f2",accent:"#a6e22e",line:"#49483e"},"gruvbox-dark":{bg:"#282828",fg:"#ebdbb2",accent:"#fabd2f",line:"#504945"},"gruvbox-light":{bg:"#fbf1c7",fg:"#3c3836",accent:"#d79921",line:"#d5c4a1"},"rose-pine":{bg:"#191724",fg:"#e0def4",accent:"#c4a7e7",line:"#26233a"},"rose-pine-dawn":{bg:"#faf4ed",fg:"#575279",accent:"#907aa9",line:"#f2e9e1"},"ayu-dark":{bg:"#0a0e14",fg:"#b3b1ad",accent:"#ffb454",line:"#11151c"},"ayu-light":{bg:"#fafafa",fg:"#575f66",accent:"#ff9940",line:"#f0f0f0"},vesper:{bg:"#101010",fg:"#ffffff",accent:"#ffc799",line:"#232323"},"vitesse-dark":{bg:"#121212",fg:"#dbd7caee",accent:"#4d9375",line:"#282828"},"vitesse-light":{bg:"#ffffff",fg:"#393a34",accent:"#1e754f",line:"#f1f1f1"},kanagawa:{bg:"#1f1f28",fg:"#dcd7ba",accent:"#7e9cd8",line:"#2a2a37"},"everforest-dark":{bg:"#2d353b",fg:"#d3c6aa",accent:"#a7c080",line:"#3d484d"},"everforest-light":{bg:"#fdf6e3",fg:"#5c6a72",accent:"#8da101",line:"#efebd4"},"material-dark":{bg:"#263238",fg:"#eeffff",accent:"#82aaff",line:"#37474f"},"material-light":{bg:"#fafafa",fg:"#546e7a",accent:"#6182b8",line:"#e7e7e8"},poimandres:{bg:"#1b1e28",fg:"#a6accd",accent:"#add7ff",line:"#303340"},"night-owl":{bg:"#011627",fg:"#d6deeb",accent:"#82aaff",line:"#122d42"},"one-hunter":{bg:"#1e2127",fg:"#c0c5cf",accent:"#e06c75",line:"#2c313a",surface:"#282c34",border:"#3e4451"}},W={bg:"#ffffff",fg:"#27272a"};var st={one:{start:"er-one-start",end:"er-one"},many:{start:"er-many-start",end:"er-many"},"zero-one":{start:"er-zero-one-start",end:"er-zero-one"},"zero-many":{start:"er-zero-many-start",end:"er-zero-many"}},Ot={inheritance:"cls-inheritance",realization:"cls-inheritance",composition:"cls-composition",aggregation:"cls-aggregation"};function vn(t,n){let{points:e,style:r,hasArrowStart:i,hasArrowEnd:s}=t;if(e.length<2)return"";let o=e.map((g,m)=>`${m===0?"M":"L"} ${g.x} ${g.y}`).join(" "),a="",c="1.5";r==="dotted"?a='stroke-dasharray="6 4"':r==="thick"&&(c="2.5");let l=t.inlineStyle?.fromCardinality,h=t.inlineStyle?.toCardinality,d=t.inlineStyle?.relationType,u="",f="";return d&&Ot[d]?u=`marker-start="url(#${Ot[d]})"`:l&&st[l]?u=`marker-start="url(#${st[l].start})"`:i&&(u='marker-start="url(#arrowhead-start)"'),h&&st[h]?f=`marker-end="url(#${st[h].end})"`:s&&(f='marker-end="url(#arrowhead)"'),`<path d="${o}" stroke="var(--_line)" stroke-width="${c}" fill="none" stroke-linejoin="round" stroke-linecap="round" ${a} ${u} ${f}/>`}function yt(t){return t.split(/<br\s*\/?>|\n/)}function Mn(t,n){if(t.shape==="state-start"||t.shape==="state-end")return"";if(t.shape==="pie-slice"){let l=t.x+t.width/2,h=t.y+t.height/2,d=t.inlineStyle?.percent||"";return`<text x="${l}" y="${h}" text-anchor="middle" dominant-baseline="middle" fill="var(--_text)" font-family="${n.font}" font-size="11" font-weight="600">${P(t.label)} ${d}%</text>`}if(t.shape==="pie-title"){let l=t.x+t.width/2,h=t.y+t.height/2;return`<text x="${l}" y="${h}" text-anchor="middle" dominant-baseline="middle" fill="var(--_text)" font-family="${n.font}" font-size="16" font-weight="600">${P(t.label)}</text>`}if(t.shape==="gantt-title"){let l=t.x+t.width/2,h=t.y+t.height/2;return`<text x="${l}" y="${h}" text-anchor="middle" dominant-baseline="middle" fill="var(--_text)" font-family="${n.font}" font-size="16" font-weight="600">${P(t.label)}</text>`}if(t.shape==="gantt-section"){let l=t.x+8,h=t.y+t.height/2;return`<text x="${l}" y="${h}" dominant-baseline="middle" fill="var(--_group-text)" font-family="${n.font}" font-size="12" font-weight="600">${P(t.label)}</text>`}if(t.shape==="gantt-bar"){let l=parseFloat(t.inlineStyle?.labelX||"0")+4,h=t.y+t.height/2,d=`<text x="${t.x+6}" y="${h}" dominant-baseline="middle" fill="var(--bg)" font-family="${n.font}" font-size="11" font-weight="500">${P(t.label)}</text>`;return`<text x="${l}" y="${h}" dominant-baseline="middle" fill="var(--_text)" font-family="${n.font}" font-size="11" font-weight="400">${P(t.label)}</text>`+d}if(t.shape==="class-box")return En(t,n);if(t.shape==="er-entity")return Ln(t,n);let e=yt(t.label),r=t.x+t.width/2,i=t.y+t.height/2,s=16,o=e.length*s,a=i-o/2+s/2,c=e.map((l,h)=>{let d=a+h*s;return`<tspan x="${r}" y="${d}" text-anchor="middle" dominant-baseline="middle">${P(l)}</tspan>`}).join("");return`<text fill="var(--_text)" font-family="${n.font}" font-size="14" font-weight="400">${c}</text>`}function En(t,n){let e=t.label.split(`
`),r=16,i=12,s=t.x,o=t.x+t.width/2,a=t.y,c="",l=0,h=e[l]||"";if(a+=i/2+r/2,c+=`<text x="${o}" y="${a}" text-anchor="middle" dominant-baseline="middle" fill="var(--_text)" font-family="${n.font}" font-size="14" font-weight="600">${P(h)}</text>`,l++,l<e.length&&e[l]==="---")for(l++,a=t.y+r+i;l<e.length&&e[l]!=="---";)a+=r*.8,c+=`<text x="${s+i}" y="${a}" dominant-baseline="middle" fill="var(--_text)" font-family="${n.font}" font-size="12" font-weight="400">${P(e[l])}</text>`,l++;if(l<e.length&&e[l]==="---"){l++;let d=parseInt(t.inlineStyle?.attrCount||"0"),u=d>0?d*r+i:0;for(a=t.y+r+i+u;l<e.length;)a+=r*.8,c+=`<text x="${s+i}" y="${a}" dominant-baseline="middle" fill="var(--_text)" font-family="${n.font}" font-size="12" font-weight="400">${P(e[l])}</text>`,l++}return c}function _n(t,n){if(!t.label||!t.labelPosition)return"";let{x:e,y:r}=t.labelPosition,i=yt(t.label),s=14,o=i.length*s,a=4,c=Math.max(...i.map(b=>b.length*7))+a*2,l=o+a*2,h=e-c/2,d=r-l/2,u=`<rect x="${h}" y="${d}" width="${c}" height="${l}" fill="var(--bg)" stroke="var(--_line)" stroke-width="0.75" rx="3"/>`,f=r-o/2+s/2,g=i.map((b,k)=>{let A=f+k*s;return`<tspan x="${e}" y="${A}" text-anchor="middle" dominant-baseline="middle">${P(b)}</tspan>`}).join(""),m=`<text fill="var(--_text)" font-family="${n.font}" font-size="11" font-weight="500">${g}</text>`;return u+m}function Cn(t,n){let e=yt(t.label),r=t.x+8,i=t.y+8,s=14,o=e.map((a,c)=>{let l=i+c*s;return`<tspan x="${r}" y="${l}">${P(a)}</tspan>`}).join("");return`<text fill="var(--_group-text)" font-family="${n.font}" font-size="12" font-weight="600">${o}</text>`}function Ln(t,n){let e=t.label.split(`
`),r=t.x,i=t.width,s=r+i/2,o=14,a=12,c=o*1.2+16,l="",h=e[0]||"",d=t.y+c/2;l+=`<text x="${s}" y="${d}" text-anchor="middle" dominant-baseline="middle" fill="var(--_text)" font-family="${n.font}" font-size="${o}" font-weight="600">${P(h)}</text>`;let u=1;if(u<e.length&&e[u]==="---"){u++;let g=t.y+c+8,m=a*1.4,b=0;for(;u<e.length&&e[u]!=="---";){let k=e[u]||"",A=g+b*m+a/2,y=k.match(/^(PK|FK|UK|PK,FK|FK,PK)\s+/);if(y){let w=y[1],S=k.slice(y[0].length);l+=`<text x="${r+8}" y="${A}" dominant-baseline="middle" fill="var(--_node-stroke)" font-family="${n.font}" font-size="10" font-weight="600">${P(w)}</text>`,l+=`<text x="${r+34}" y="${A}" dominant-baseline="middle" fill="var(--_text)" font-family="${n.font}" font-size="${a}" font-weight="400">${P(S)}</text>`}else l+=`<text x="${r+34}" y="${A}" dominant-baseline="middle" fill="var(--_text)" font-family="${n.font}" font-size="${a}" font-weight="400">${P(k)}</text>`;b++,u++}}if(parseInt(t.inlineStyle?.attrCount||"0")===0){let g=t.y+c+10;l+=`<text x="${s}" y="${g}" text-anchor="middle" dominant-baseline="middle" fill="var(--_muted)" font-family="${n.font}" font-size="11" font-style="italic">(no attributes)</text>`}return l}function P(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}function Pn(t){return`
		<defs>
			<marker id="arrowhead" markerWidth="12" markerHeight="8" refX="11" refY="4" orient="auto" markerUnits="userSpaceOnUse">
				<path d="M1,1 L11,4 L1,7 z" fill="var(--_arrow)" />
			</marker>
			<marker id="arrowhead-start" markerWidth="12" markerHeight="8" refX="1" refY="4" orient="auto" markerUnits="userSpaceOnUse">
				<path d="M11,1 L1,4 L11,7 z" fill="var(--_arrow)" />
			</marker>
			<marker id="arrowhead-open" markerWidth="12" markerHeight="8" refX="11" refY="4" orient="auto" markerUnits="userSpaceOnUse">
				<path d="M1,1 L11,4 L1,7" fill="none" stroke="var(--_arrow)" stroke-width="1.5" stroke-linejoin="round" />
			</marker>
			<marker id="arrowhead-cross" markerWidth="12" markerHeight="12" refX="6" refY="6" orient="auto" markerUnits="userSpaceOnUse">
				<path d="M3,3 L9,9 M9,3 L3,9" stroke="var(--_arrow)" stroke-width="1.5" stroke-linecap="round" />
			</marker>
			<marker id="er-one" markerWidth="20" markerHeight="16" refX="18" refY="8" orient="auto" markerUnits="userSpaceOnUse">
				<line x1="18" y1="2" x2="18" y2="14" stroke="var(--_line)" stroke-width="1.5"/>
				<line x1="14" y1="2" x2="14" y2="14" stroke="var(--_line)" stroke-width="1.5"/>
			</marker>
			<marker id="er-one-start" markerWidth="20" markerHeight="16" refX="2" refY="8" orient="auto" markerUnits="userSpaceOnUse">
				<line x1="2" y1="2" x2="2" y2="14" stroke="var(--_line)" stroke-width="1.5"/>
				<line x1="6" y1="2" x2="6" y2="14" stroke="var(--_line)" stroke-width="1.5"/>
			</marker>
			<marker id="er-many" markerWidth="20" markerHeight="16" refX="18" refY="8" orient="auto" markerUnits="userSpaceOnUse">
				<line x1="18" y1="2" x2="18" y2="14" stroke="var(--_line)" stroke-width="1.5"/>
				<path d="M18,8 L6,2 M18,8 L6,14" stroke="var(--_line)" stroke-width="1.5" fill="none"/>
			</marker>
			<marker id="er-many-start" markerWidth="20" markerHeight="16" refX="2" refY="8" orient="auto" markerUnits="userSpaceOnUse">
				<line x1="2" y1="2" x2="2" y2="14" stroke="var(--_line)" stroke-width="1.5"/>
				<path d="M2,8 L14,2 M2,8 L14,14" stroke="var(--_line)" stroke-width="1.5" fill="none"/>
			</marker>
			<marker id="er-zero-one" markerWidth="24" markerHeight="16" refX="22" refY="8" orient="auto" markerUnits="userSpaceOnUse">
				<line x1="22" y1="2" x2="22" y2="14" stroke="var(--_line)" stroke-width="1.5"/>
				<circle cx="14" cy="8" r="4" fill="none" stroke="var(--_line)" stroke-width="1.5"/>
			</marker>
			<marker id="er-zero-one-start" markerWidth="24" markerHeight="16" refX="2" refY="8" orient="auto" markerUnits="userSpaceOnUse">
				<line x1="2" y1="2" x2="2" y2="14" stroke="var(--_line)" stroke-width="1.5"/>
				<circle cx="10" cy="8" r="4" fill="none" stroke="var(--_line)" stroke-width="1.5"/>
			</marker>
			<marker id="er-zero-many" markerWidth="24" markerHeight="16" refX="22" refY="8" orient="auto" markerUnits="userSpaceOnUse">
				<path d="M22,8 L10,2 M22,8 L10,14" stroke="var(--_line)" stroke-width="1.5" fill="none"/>
				<circle cx="6" cy="8" r="4" fill="none" stroke="var(--_line)" stroke-width="1.5"/>
			</marker>
			<marker id="er-zero-many-start" markerWidth="24" markerHeight="16" refX="2" refY="8" orient="auto" markerUnits="userSpaceOnUse">
				<path d="M2,8 L14,2 M2,8 L14,14" stroke="var(--_line)" stroke-width="1.5" fill="none"/>
				<circle cx="18" cy="8" r="4" fill="none" stroke="var(--_line)" stroke-width="1.5"/>
			</marker>
			<marker id="cls-inheritance" markerWidth="16" markerHeight="14" refX="1" refY="7" orient="auto" markerUnits="userSpaceOnUse">
				<path d="M15,1 L1,7 L15,13 z" fill="var(--_node-fill)" stroke="var(--_line)" stroke-width="1.5" stroke-linejoin="round"/>
			</marker>
			<marker id="cls-composition" markerWidth="14" markerHeight="14" refX="1" refY="7" orient="auto" markerUnits="userSpaceOnUse">
				<path d="M1,7 L7,1 L13,7 L7,13 z" fill="var(--_line)" stroke="var(--_line)" stroke-width="1"/>
			</marker>
			<marker id="cls-aggregation" markerWidth="14" markerHeight="14" refX="1" refY="7" orient="auto" markerUnits="userSpaceOnUse">
				<path d="M1,7 L7,1 L13,7 L7,13 z" fill="var(--_node-fill)" stroke="var(--_line)" stroke-width="1.5"/>
			</marker>
		</defs>
	`}function In(t,n){return`<rect x="${t.x}" y="${t.y}" width="${t.width}" height="${t.height}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="1.5" rx="0"/>`}function Gt(t,n){return`<rect x="${t.x}" y="${t.y}" width="${t.width}" height="${t.height}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="1.5" rx="8"/>`}function Nn(t,n){let e=t.x+t.width/2,r=t.y+t.height/2,i=t.width/2,s=t.height/2;return`<polygon points="${`${e},${r-s} ${e+i},${r} ${e},${r+s} ${e-i},${r}`}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="1.5"/>`}function Dn(t,n){let e=Math.min(t.height/2,t.width/2);return`<rect x="${t.x}" y="${t.y}" width="${t.width}" height="${t.height}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="1.5" rx="${e}"/>`}function Tn(t,n){let e=t.x+t.width/2,r=t.y+t.height/2,i=Math.min(t.width,t.height)/2;return`<circle cx="${e}" cy="${r}" r="${i}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="1.5"/>`}function zn(t,n){let e=`<rect x="${t.x}" y="${t.y}" width="${t.width}" height="${t.height}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="1.5" rx="0"/>`,r=4,i=`<rect x="${t.x+r}" y="${t.y+r}" width="${t.width-r*2}" height="${t.height-r*2}" fill="none" stroke="var(--_node-stroke)" stroke-width="1.5" rx="0"/>`;return e+i}function Hn(t,n){let e=t.x+t.width/2,r=t.y+t.height/2,i=Math.min(t.width,t.height)/2,s=i-4;return`<circle cx="${e}" cy="${r}" r="${i}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="1.5"/><circle cx="${e}" cy="${r}" r="${s}" fill="none" stroke="var(--_node-stroke)" stroke-width="1.5"/>`}function Rn(t,n){let e=t.x+t.width/2,r=t.y+t.height/2,i=t.width/2,s=t.height/2,o=i*.3;return`<polygon points="${`${e-i+o},${r-s} ${e+i-o},${r-s} ${e+i},${r} ${e+i-o},${r+s} ${e-i+o},${r+s} ${e-i},${r}`}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="1.5"/>`}function Yn(t,n){let e=t.height*.1,r=t.x,i=t.y,s=t.width,o=t.height,a=`M ${r} ${i+e}
		Q ${r} ${i}, ${r+s/2} ${i}
		T ${r+s} ${i+e}
		L ${r+s} ${i+o-e}
		Q ${r+s} ${i+o}, ${r+s/2} ${i+o}
		T ${r} ${i+o-e}
		Z`,c=`<ellipse cx="${r+s/2}" cy="${i+e}" rx="${s/2}" ry="${e}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="1.5"/>`;return`<path d="${a}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="1.5"/>`+c}function Wn(t,n){let e=t.x,r=t.y,i=t.width,s=t.height,o=i*.15;return`<polygon points="${`${e},${r+s/2} ${e+o},${r} ${e+i},${r} ${e+i-o},${r+s} ${e},${r+s}`}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="1.5"/>`}function Xn(t,n){let e=t.x,r=t.y,i=t.width,s=t.height,o=i*.15;return`<polygon points="${`${e+o},${r} ${e+i-o},${r} ${e+i},${r+s} ${e},${r+s}`}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="1.5"/>`}function On(t,n){let e=t.x,r=t.y,i=t.width,s=t.height,o=i*.15;return`<polygon points="${`${e},${r} ${e+i},${r} ${e+i-o},${r+s} ${e+o},${r+s}`}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="1.5"/>`}function Bn(t,n){let e=t.x,r=t.y,i=t.width,s=t.height,o=i*.15;return`<polygon points="${`${e+o},${r} ${e+i},${r} ${e+i-o},${r+s} ${e},${r+s}`}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="1.5"/>`}function Un(t,n){let e=t.x,r=t.y,i=t.width,s=t.height,o=Math.min(i,s)*.15;return`<path d="${`M ${e} ${r} L ${e+i-o} ${r} L ${e+i} ${r+o} L ${e+i} ${r+s} L ${e} ${r+s} Z M ${e+i-o} ${r} L ${e+i-o} ${r+o} L ${e+i} ${r+o}`}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="1.5"/>`}function Fn(t,n){let e=t.x,r=t.y,i=t.width,s=t.height;return`<path d="${`M ${e+i*.25} ${r+s*.4}
		Q ${e} ${r+s*.4}, ${e} ${r+s*.6}
		Q ${e} ${r+s}, ${e+i*.2} ${r+s}
		Q ${e+i*.3} ${r+s}, ${e+i*.5} ${r+s*.95}
		Q ${e+i*.7} ${r+s}, ${e+i*.8} ${r+s}
		Q ${e+i} ${r+s}, ${e+i} ${r+s*.6}
		Q ${e+i} ${r+s*.4}, ${e+i*.75} ${r+s*.4}
		Q ${e+i*.8} ${r}, ${e+i*.5} ${r}
		Q ${e+i*.2} ${r}, ${e+i*.25} ${r+s*.4}
		Z`}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="1.5"/>`}function Gn(t,n){let e=t.x+t.width/2,r=t.y+t.height/2,i=Math.min(t.width,t.height)/4;return`<circle cx="${e}" cy="${r}" r="${i}" fill="var(--_text)" stroke="none"/>`}function jn(t,n){let e=t.x+t.width/2,r=t.y+t.height/2,i=Math.min(t.width,t.height)/3,s=i*.6;return`<circle cx="${e}" cy="${r}" r="${i}" fill="none" stroke="var(--_text)" stroke-width="2"/><circle cx="${e}" cy="${r}" r="${s}" fill="var(--_text)" stroke="none"/>`}var Bt=["#4e79a7","#f28e2b","#e15759","#76b7b2","#59a14f","#edc948","#b07aa1","#ff9da7","#9c755f","#bab0ac"];function qn(t,n){if(!t.inlineStyle)return"";let e=parseFloat(t.inlineStyle.cx),r=parseFloat(t.inlineStyle.cy),i=parseFloat(t.inlineStyle.radius),s=parseFloat(t.inlineStyle.startAngle),o=parseFloat(t.inlineStyle.endAngle),a=parseInt(t.inlineStyle.index),c=Bt[a%Bt.length],l=e+i*Math.cos(s),h=r+i*Math.sin(s),d=e+i*Math.cos(o),u=r+i*Math.sin(o),f=o-s>Math.PI?1:0;return`<path d="${`M ${e} ${r} L ${l} ${h} A ${i} ${i} 0 ${f} 1 ${d} ${u} Z`}" fill="${c}" stroke="var(--bg)" stroke-width="2"/>`}function Kn(t,n){return""}function Vn(t,n){return`<rect x="${t.x}" y="${t.y}" width="${t.width}" height="${t.height}" fill="var(--_group-fill)" stroke="none" rx="2"/>`}function Qn(t,n){let e=t.inlineStyle?.status||"default",r="var(--_node-fill)",i="var(--_node-stroke)";return e==="done"&&(r="var(--_muted)"),e==="active"&&(r="var(--_node-stroke)"),e==="crit"&&(r="#e15759",i="#c44040"),`<rect x="${t.x}" y="${t.y}" width="${t.width}" height="${t.height}" fill="${r}" stroke="${i}" stroke-width="1" rx="4"/>`}function Zn(t,n){return""}function Jn(t,n){let e=t.x,r=t.y,i=t.width,s=t.height,o=parseInt(t.inlineStyle?.attrCount||"0"),a=`<rect x="${e}" y="${r}" width="${i}" height="${s}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="1.5" rx="0"/>`;if(o>0){let l=r+32.8;a+=`<line x1="${e}" y1="${l}" x2="${e+i}" y2="${l}" stroke="var(--_node-stroke)" stroke-width="1"/>`}return a}function tr(t,n){let e=t.x,r=t.y,i=t.width,s=t.height,o=16,a=12,c=parseInt(t.inlineStyle?.attrCount||"0"),l=parseInt(t.inlineStyle?.methodCount||"0"),h=`<rect x="${e}" y="${r}" width="${i}" height="${s}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="1.5" rx="0"/>`,d=o+a,u=c>0?c*o+a:0;if(c>0||l>0){let f=r+d;h+=`<line x1="${e}" y1="${f}" x2="${e+i}" y2="${f}" stroke="var(--_node-stroke)" stroke-width="1"/>`}if(l>0&&c>0){let f=r+d+u;h+=`<line x1="${e}" y1="${f}" x2="${e+i}" y2="${f}" stroke="var(--_node-stroke)" stroke-width="1"/>`}return h}var er={rectangle:In,rounded:Gt,diamond:Nn,stadium:Dn,circle:Tn,subroutine:zn,doublecircle:Hn,hexagon:Rn,cylinder:Yn,asymmetric:Wn,trapezoid:Xn,"trapezoid-alt":On,parallelogram:Bn,note:Un,cloud:Fn,"state-start":Gn,"state-end":jn,"pie-slice":qn,"pie-title":Kn,"gantt-section":Vn,"gantt-bar":Qn,"gantt-title":Zn,"class-box":tr,"er-entity":Jn};function nr(t,n){let e=er[t.shape];return e?e(t,n):Gt(t)}function rr(t,n){return`<rect x="${t.x}" y="${t.y}" width="${t.width}" height="${t.height}" fill="var(--_group-fill)" stroke="var(--_group-stroke)" stroke-width="1.5" rx="4"/>`}function jt(t,n){return t.flatMap(e=>{let r=e.children.length>0?jt(e.children,n):"";return rr(e)+Cn(e,n)+r}).join("")}function sr(t,n){if(!n.debug)return"";let e=[],r=50,i=t.width+n.padding*2,s=t.height+n.padding*2;for(let o=0;o<=i;o+=r)e.push(`<line x1="${o}" y1="0" x2="${o}" y2="${s}" stroke="rgba(255,255,255,0.08)" stroke-width="0.5"/>`),e.push(`<text x="${o+2}" y="10" fill="rgba(255,255,255,0.3)" font-size="8" font-family="monospace">${o}</text>`);for(let o=0;o<=s;o+=r)e.push(`<line x1="0" y1="${o}" x2="${i}" y2="${o}" stroke="rgba(255,255,255,0.08)" stroke-width="0.5"/>`),e.push(`<text x="2" y="${o-2}" fill="rgba(255,255,255,0.3)" font-size="8" font-family="monospace">${o}</text>`);for(let o of t.nodes)e.push(`<rect x="${o.x}" y="${o.y}" width="${o.width}" height="${o.height}" fill="none" stroke="rgba(239,68,68,0.5)" stroke-width="0.5" stroke-dasharray="3 2"/>`),e.push(`<text x="${o.x}" y="${o.y-4}" fill="rgba(239,68,68,0.7)" font-size="9" font-family="monospace">${o.id}</text>`);for(let o of t.edges)for(let a of o.points)e.push(`<circle cx="${a.x}" cy="${a.y}" r="3" fill="rgba(59,130,246,0.6)" stroke="rgba(59,130,246,0.8)" stroke-width="0.5"/>`);return`<g class="debug-overlays">${e.join("")}</g>`}function ot(t,n){let e=n?.theme??W,r=n?.padding??16,i=n?.transparent??!1,s=n?.debug??!1,o=V(e),a={colors:o,padding:r,transparent:i,debug:s,font:o.font},c=t.width+r*2,l=t.height+r*2,h=i?"none":o.bg,d=`cm-${Math.random().toString(36).slice(2,8)}`,f=`
		<style>
			@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap');
			#${d} {
				--bg: ${o.bg};
				--fg: ${o.fg};
				--_text: ${o.text};
				--_line: ${o.line};
				--_arrow: ${o.arrow};
				--_node-fill: ${o.nodeFill};
				--_node-stroke: ${o.nodeStroke};
				--_muted: ${o.muted};
				--_group-fill: ${o.groupFill};
				--_group-stroke: ${o.groupStroke};
				--_group-text: ${o.groupText};
			}
		</style>
	`,g=Pn(),m=jt(t.groups,a),b=t.edges.map(S=>vn(S)).join(""),k=t.edges.map(S=>_n(S,a)).join(""),A=t.nodes.map(S=>{let x=nr(S,a),p=Mn(S,a);return x+p}).join(""),y=sr(t,a);return`
		<svg id="${d}" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 ${c} ${l}" width="${c}" height="${l}">
			${f}
			<rect width="${c}" height="${l}" fill="${h}"/>
			${g}
			<g transform="translate(${r}, ${r})">
				${m}
				${b}
				${k}
				${A}
			</g>
			${y}
		</svg>
	`.split(`
`).map(S=>S.trim()).filter(Boolean).join(`
`)}var qt="http://www.w3.org/2000/svg";function $(t){return document.createElementNS(qt,t)}function J(t){return t.split(/<br\s*\/?>|\n/)}function ir(t,n){let e=$("rect");return e.setAttribute("x",String(t.x)),e.setAttribute("y",String(t.y)),e.setAttribute("width",String(t.width)),e.setAttribute("height",String(t.height)),e.setAttribute("fill","var(--_group-fill)"),e.setAttribute("stroke","var(--_group-stroke)"),e.setAttribute("stroke-width","1.5"),e.setAttribute("rx","4"),e}function or(t,n){let e=J(t.label),r=t.x+8,i=t.y+8,s=14,o=$("text");return o.setAttribute("fill","var(--_group-text)"),o.setAttribute("font-family",n.font),o.setAttribute("font-size","12"),o.setAttribute("font-weight","600"),e.forEach((a,c)=>{let l=$("tspan");l.setAttribute("x",String(r)),l.setAttribute("y",String(i+c*s)),l.textContent=a,o.appendChild(l)}),o}function Kt(t,n,e){t.forEach(r=>{e.appendChild(ir(r)),e.appendChild(or(r,n)),r.children.length>0&&Kt(r.children,n,e)})}function ar(t,n){let e=t.x,r=t.y,i=t.width,s=t.height,o=e+i/2,a=r+s/2;switch(t.shape){case"rectangle":{let c=$("rect");return c.setAttribute("x",String(e)),c.setAttribute("y",String(r)),c.setAttribute("width",String(i)),c.setAttribute("height",String(s)),c.setAttribute("fill","var(--_node-fill)"),c.setAttribute("stroke","var(--_node-stroke)"),c.setAttribute("stroke-width","1.5"),c.setAttribute("rx","0"),c}case"rounded":{let c=$("rect");return c.setAttribute("x",String(e)),c.setAttribute("y",String(r)),c.setAttribute("width",String(i)),c.setAttribute("height",String(s)),c.setAttribute("fill","var(--_node-fill)"),c.setAttribute("stroke","var(--_node-stroke)"),c.setAttribute("stroke-width","1.5"),c.setAttribute("rx","8"),c}case"diamond":{let c=i/2,l=s/2,h=`${o},${a-l} ${o+c},${a} ${o},${a+l} ${o-c},${a}`,d=$("polygon");return d.setAttribute("points",h),d.setAttribute("fill","var(--_node-fill)"),d.setAttribute("stroke","var(--_node-stroke)"),d.setAttribute("stroke-width","1.5"),d}case"stadium":{let c=Math.min(s/2,i/2),l=$("rect");return l.setAttribute("x",String(e)),l.setAttribute("y",String(r)),l.setAttribute("width",String(i)),l.setAttribute("height",String(s)),l.setAttribute("fill","var(--_node-fill)"),l.setAttribute("stroke","var(--_node-stroke)"),l.setAttribute("stroke-width","1.5"),l.setAttribute("rx",String(c)),l}case"circle":{let c=Math.min(i,s)/2,l=$("circle");return l.setAttribute("cx",String(o)),l.setAttribute("cy",String(a)),l.setAttribute("r",String(c)),l.setAttribute("fill","var(--_node-fill)"),l.setAttribute("stroke","var(--_node-stroke)"),l.setAttribute("stroke-width","1.5"),l}case"subroutine":{let c=$("g"),l=$("rect");l.setAttribute("x",String(e)),l.setAttribute("y",String(r)),l.setAttribute("width",String(i)),l.setAttribute("height",String(s)),l.setAttribute("fill","var(--_node-fill)"),l.setAttribute("stroke","var(--_node-stroke)"),l.setAttribute("stroke-width","1.5"),l.setAttribute("rx","0");let h=4,d=$("rect");return d.setAttribute("x",String(e+h)),d.setAttribute("y",String(r+h)),d.setAttribute("width",String(i-h*2)),d.setAttribute("height",String(s-h*2)),d.setAttribute("fill","none"),d.setAttribute("stroke","var(--_node-stroke)"),d.setAttribute("stroke-width","1.5"),d.setAttribute("rx","0"),c.appendChild(l),c.appendChild(d),c}case"doublecircle":{let c=$("g"),l=Math.min(i,s)/2,h=l-4,d=$("circle");d.setAttribute("cx",String(o)),d.setAttribute("cy",String(a)),d.setAttribute("r",String(l)),d.setAttribute("fill","var(--_node-fill)"),d.setAttribute("stroke","var(--_node-stroke)"),d.setAttribute("stroke-width","1.5");let u=$("circle");return u.setAttribute("cx",String(o)),u.setAttribute("cy",String(a)),u.setAttribute("r",String(h)),u.setAttribute("fill","none"),u.setAttribute("stroke","var(--_node-stroke)"),u.setAttribute("stroke-width","1.5"),c.appendChild(d),c.appendChild(u),c}case"hexagon":{let c=i/2,l=s/2,h=c*.3,d=`${o-c+h},${a-l} ${o+c-h},${a-l} ${o+c},${a} ${o+c-h},${a+l} ${o-c+h},${a+l} ${o-c},${a}`,u=$("polygon");return u.setAttribute("points",d),u.setAttribute("fill","var(--_node-fill)"),u.setAttribute("stroke","var(--_node-stroke)"),u.setAttribute("stroke-width","1.5"),u}case"cylinder":{let c=$("g"),l=s*.1,h=`M ${e} ${r+l}
				Q ${e} ${r}, ${e+i/2} ${r}
				T ${e+i} ${r+l}
				L ${e+i} ${r+s-l}
				Q ${e+i} ${r+s}, ${e+i/2} ${r+s}
				T ${e} ${r+s-l}
				Z`,d=$("path");d.setAttribute("d",h),d.setAttribute("fill","var(--_node-fill)"),d.setAttribute("stroke","var(--_node-stroke)"),d.setAttribute("stroke-width","1.5");let u=$("ellipse");return u.setAttribute("cx",String(e+i/2)),u.setAttribute("cy",String(r+l)),u.setAttribute("rx",String(i/2)),u.setAttribute("ry",String(l)),u.setAttribute("fill","var(--_node-fill)"),u.setAttribute("stroke","var(--_node-stroke)"),u.setAttribute("stroke-width","1.5"),c.appendChild(d),c.appendChild(u),c}case"asymmetric":{let c=i*.15,l=`${e},${r+s/2} ${e+c},${r} ${e+i},${r} ${e+i-c},${r+s} ${e},${r+s}`,h=$("polygon");return h.setAttribute("points",l),h.setAttribute("fill","var(--_node-fill)"),h.setAttribute("stroke","var(--_node-stroke)"),h.setAttribute("stroke-width","1.5"),h}case"trapezoid":{let c=i*.15,l=`${e+c},${r} ${e+i-c},${r} ${e+i},${r+s} ${e},${r+s}`,h=$("polygon");return h.setAttribute("points",l),h.setAttribute("fill","var(--_node-fill)"),h.setAttribute("stroke","var(--_node-stroke)"),h.setAttribute("stroke-width","1.5"),h}case"trapezoid-alt":{let c=i*.15,l=`${e},${r} ${e+i},${r} ${e+i-c},${r+s} ${e+c},${r+s}`,h=$("polygon");return h.setAttribute("points",l),h.setAttribute("fill","var(--_node-fill)"),h.setAttribute("stroke","var(--_node-stroke)"),h.setAttribute("stroke-width","1.5"),h}case"parallelogram":{let c=i*.15,l=`${e+c},${r} ${e+i},${r} ${e+i-c},${r+s} ${e},${r+s}`,h=$("polygon");return h.setAttribute("points",l),h.setAttribute("fill","var(--_node-fill)"),h.setAttribute("stroke","var(--_node-stroke)"),h.setAttribute("stroke-width","1.5"),h}case"note":{let c=Math.min(i,s)*.15,l=`M ${e} ${r} L ${e+i-c} ${r} L ${e+i} ${r+c} L ${e+i} ${r+s} L ${e} ${r+s} Z M ${e+i-c} ${r} L ${e+i-c} ${r+c} L ${e+i} ${r+c}`,h=$("path");return h.setAttribute("d",l),h.setAttribute("fill","var(--_node-fill)"),h.setAttribute("stroke","var(--_node-stroke)"),h.setAttribute("stroke-width","1.5"),h}case"cloud":{let c=`M ${e+i*.25} ${r+s*.4}
				Q ${e} ${r+s*.4}, ${e} ${r+s*.6}
				Q ${e} ${r+s}, ${e+i*.2} ${r+s}
				Q ${e+i*.3} ${r+s}, ${e+i*.5} ${r+s*.95}
				Q ${e+i*.7} ${r+s}, ${e+i*.8} ${r+s}
				Q ${e+i} ${r+s}, ${e+i} ${r+s*.6}
				Q ${e+i} ${r+s*.4}, ${e+i*.75} ${r+s*.4}
				Q ${e+i*.8} ${r}, ${e+i*.5} ${r}
				Q ${e+i*.2} ${r}, ${e+i*.25} ${r+s*.4}
				Z`,l=$("path");return l.setAttribute("d",c),l.setAttribute("fill","var(--_node-fill)"),l.setAttribute("stroke","var(--_node-stroke)"),l.setAttribute("stroke-width","1.5"),l}case"state-start":{let c=Math.min(i,s)/4,l=$("circle");return l.setAttribute("cx",String(o)),l.setAttribute("cy",String(a)),l.setAttribute("r",String(c)),l.setAttribute("fill","var(--_text)"),l.setAttribute("stroke","none"),l}case"er-entity":{let c=$("g"),l=$("rect");if(l.setAttribute("x",String(e)),l.setAttribute("y",String(r)),l.setAttribute("width",String(i)),l.setAttribute("height",String(s)),l.setAttribute("fill","var(--_node-fill)"),l.setAttribute("stroke","var(--_node-stroke)"),l.setAttribute("stroke-width","1.5"),l.setAttribute("rx","0"),c.appendChild(l),parseInt(t.inlineStyle?.attrCount||"0")>0){let u=$("line");u.setAttribute("x1",String(e)),u.setAttribute("y1",String(r+32.8)),u.setAttribute("x2",String(e+i)),u.setAttribute("y2",String(r+32.8)),u.setAttribute("stroke","var(--_node-stroke)"),u.setAttribute("stroke-width","1"),c.appendChild(u)}return c}case"class-box":{let c=$("g"),l=$("rect");l.setAttribute("x",String(e)),l.setAttribute("y",String(r)),l.setAttribute("width",String(i)),l.setAttribute("height",String(s)),l.setAttribute("fill","var(--_node-fill)"),l.setAttribute("stroke","var(--_node-stroke)"),l.setAttribute("stroke-width","1.5"),l.setAttribute("rx","0"),c.appendChild(l);let h=16,d=12,u=parseInt(t.inlineStyle?.attrCount||"0"),f=parseInt(t.inlineStyle?.methodCount||"0"),g=h+d,m=u>0?u*h+d:0;if(u>0||f>0){let b=$("line");b.setAttribute("x1",String(e)),b.setAttribute("y1",String(r+g)),b.setAttribute("x2",String(e+i)),b.setAttribute("y2",String(r+g)),b.setAttribute("stroke","var(--_node-stroke)"),b.setAttribute("stroke-width","1"),c.appendChild(b)}if(f>0&&u>0){let b=$("line");b.setAttribute("x1",String(e)),b.setAttribute("y1",String(r+g+m)),b.setAttribute("x2",String(e+i)),b.setAttribute("y2",String(r+g+m)),b.setAttribute("stroke","var(--_node-stroke)"),b.setAttribute("stroke-width","1"),c.appendChild(b)}return c}case"state-end":{let c=$("g"),l=Math.min(i,s)/3,h=l*.6,d=$("circle");d.setAttribute("cx",String(o)),d.setAttribute("cy",String(a)),d.setAttribute("r",String(l)),d.setAttribute("fill","none"),d.setAttribute("stroke","var(--_text)"),d.setAttribute("stroke-width","2");let u=$("circle");return u.setAttribute("cx",String(o)),u.setAttribute("cy",String(a)),u.setAttribute("r",String(h)),u.setAttribute("fill","var(--_text)"),u.setAttribute("stroke","none"),c.appendChild(d),c.appendChild(u),c}default:{let c=$("rect");return c.setAttribute("x",String(e)),c.setAttribute("y",String(r)),c.setAttribute("width",String(i)),c.setAttribute("height",String(s)),c.setAttribute("fill","var(--_node-fill)"),c.setAttribute("stroke","var(--_node-stroke)"),c.setAttribute("stroke-width","1.5"),c.setAttribute("rx","8"),c}}}function cr(t,n){let e=$("g"),r=J(t.label),i=t.x,s=t.width,o=i+s/2,a=14,c=12,l=a*1.2+16,h=r[0]||"",d=$("text");d.setAttribute("x",String(o)),d.setAttribute("y",String(t.y+l/2)),d.setAttribute("text-anchor","middle"),d.setAttribute("dominant-baseline","middle"),d.setAttribute("fill","var(--_text)"),d.setAttribute("font-family",n.font),d.setAttribute("font-size",String(a)),d.setAttribute("font-weight","600"),d.textContent=h,e.appendChild(d);let u=1;if(u<r.length&&r[u]==="---"){u++;let g=t.y+l+8,m=c*1.4,b=0;for(;u<r.length&&r[u]!=="---";){let k=r[u]??"",A=g+b*m+c/2,y=k.match(/^(PK|FK|UK|PK,FK|FK,PK)\s+/);if(y){let w=y[1],S=k.slice(y[0].length),x=$("text");x.setAttribute("x",String(i+8)),x.setAttribute("y",String(A)),x.setAttribute("dominant-baseline","middle"),x.setAttribute("fill","var(--_node-stroke)"),x.setAttribute("font-family",n.font),x.setAttribute("font-size","10"),x.setAttribute("font-weight","600"),x.textContent=w,e.appendChild(x);let p=$("text");p.setAttribute("x",String(i+34)),p.setAttribute("y",String(A)),p.setAttribute("dominant-baseline","middle"),p.setAttribute("fill","var(--_text)"),p.setAttribute("font-family",n.font),p.setAttribute("font-size",String(c)),p.setAttribute("font-weight","400"),p.textContent=S,e.appendChild(p)}else{let w=$("text");w.setAttribute("x",String(i+34)),w.setAttribute("y",String(A)),w.setAttribute("dominant-baseline","middle"),w.setAttribute("fill","var(--_text)"),w.setAttribute("font-family",n.font),w.setAttribute("font-size",String(c)),w.setAttribute("font-weight","400"),w.textContent=k,e.appendChild(w)}b++,u++}}if(parseInt(t.inlineStyle?.attrCount||"0")===0){let g=$("text");g.setAttribute("x",String(o)),g.setAttribute("y",String(t.y+l+10)),g.setAttribute("text-anchor","middle"),g.setAttribute("dominant-baseline","middle"),g.setAttribute("fill","var(--_muted)"),g.setAttribute("font-family",n.font),g.setAttribute("font-size","11"),g.setAttribute("font-style","italic"),g.textContent="(no attributes)",e.appendChild(g)}return e}function lr(t,n){let e=$("g"),r=J(t.label),i=16,s=12,o=t.x,a=t.x+t.width/2,c=t.y,l=0,h=r[l]||"";c+=s/2+i/2;let d=$("text");if(d.setAttribute("x",String(a)),d.setAttribute("y",String(c)),d.setAttribute("text-anchor","middle"),d.setAttribute("dominant-baseline","middle"),d.setAttribute("fill","var(--_text)"),d.setAttribute("font-family",n.font),d.setAttribute("font-size","14"),d.setAttribute("font-weight","600"),d.textContent=h,e.appendChild(d),l++,l<r.length&&r[l]==="---")for(l++,c=t.y+i+s;l<r.length&&r[l]!=="---";){c+=i*.8;let u=$("text");u.setAttribute("x",String(o+s)),u.setAttribute("y",String(c)),u.setAttribute("dominant-baseline","middle"),u.setAttribute("fill","var(--_text)"),u.setAttribute("font-family",n.font),u.setAttribute("font-size","12"),u.setAttribute("font-weight","400"),u.textContent=r[l]??"",e.appendChild(u),l++}if(l<r.length&&r[l]==="---"){l++;let u=parseInt(t.inlineStyle?.attrCount||"0"),f=u>0?u*i+s:0;for(c=t.y+i+s+f;l<r.length;){c+=i*.8;let g=$("text");g.setAttribute("x",String(o+s)),g.setAttribute("y",String(c)),g.setAttribute("dominant-baseline","middle"),g.setAttribute("fill","var(--_text)"),g.setAttribute("font-family",n.font),g.setAttribute("font-size","12"),g.setAttribute("font-weight","400"),g.textContent=r[l]??"",e.appendChild(g),l++}}return e}function hr(t,n){if(t.shape==="state-start"||t.shape==="state-end")return $("g");if(t.shape==="class-box")return lr(t,n);if(t.shape==="er-entity")return cr(t,n);let e=J(t.label),r=t.x+t.width/2,i=t.y+t.height/2,s=16,o=e.length*s,a=i-o/2+s/2,c=$("text");return c.setAttribute("fill","var(--_text)"),c.setAttribute("font-family",n.font),c.setAttribute("font-size","14"),c.setAttribute("font-weight","400"),e.forEach((l,h)=>{let d=$("tspan");d.setAttribute("x",String(r)),d.setAttribute("y",String(a+h*s)),d.setAttribute("text-anchor","middle"),d.setAttribute("dominant-baseline","middle"),d.textContent=l,c.appendChild(d)}),c}function dr(t,n,e){let r=$("g");return r.setAttribute("data-node-id",t.id),r.setAttribute("role","img"),r.setAttribute("aria-label",t.label),e.interactive&&(r.style.cursor="pointer",e.onNodeClick&&r.addEventListener("click",i=>{e.onNodeClick?.(t.id,i)}),e.onNodeHover&&(r.addEventListener("mouseenter",i=>{e.onNodeHover?.(t.id,i)}),r.addEventListener("mouseleave",i=>{e.onNodeHover?.(null,i)}))),r.appendChild(ar(t)),r.appendChild(hr(t,n)),r}function ur(t,n,e){let r=$("g");if(r.setAttribute("data-edge-source",t.source),r.setAttribute("data-edge-target",t.target),t.points.length<2)return r;let i=t.points.map((d,u)=>`${u===0?"M":"L"} ${d.x} ${d.y}`).join(" "),s=$("path");s.setAttribute("d",i),s.setAttribute("stroke","var(--_line)"),s.setAttribute("fill","none"),s.setAttribute("stroke-linejoin","round"),s.setAttribute("stroke-linecap","round"),t.style==="dotted"?(s.setAttribute("stroke-dasharray","6 4"),s.setAttribute("stroke-width","1.5")):t.style==="thick"?s.setAttribute("stroke-width","2.5"):s.setAttribute("stroke-width","1.5");let o=t.inlineStyle?.fromCardinality,a=t.inlineStyle?.toCardinality,c=t.inlineStyle?.relationType,l={one:{start:"er-one-start",end:"er-one"},many:{start:"er-many-start",end:"er-many"},"zero-one":{start:"er-zero-one-start",end:"er-zero-one"},"zero-many":{start:"er-zero-many-start",end:"er-zero-many"}},h={inheritance:"cls-inheritance",realization:"cls-inheritance",composition:"cls-composition",aggregation:"cls-aggregation"};return c&&h[c]?s.setAttribute("marker-start",`url(#${h[c]})`):o&&l[o]?s.setAttribute("marker-start",`url(#${l[o].start})`):t.hasArrowStart&&s.setAttribute("marker-start","url(#arrowhead-start)"),a&&l[a]?s.setAttribute("marker-end",`url(#${l[a].end})`):t.hasArrowEnd&&s.setAttribute("marker-end","url(#arrowhead)"),e.interactive&&e.onEdgeClick&&(s.style.cursor="pointer",s.addEventListener("click",d=>{e.onEdgeClick?.(t.source,t.target,d)})),r.appendChild(s),r}function fr(t,n){let e=$("g");if(!t.label||!t.labelPosition)return e;let{x:r,y:i}=t.labelPosition,s=J(t.label),o=14,a=s.length*o,c=4,l=Math.max(...s.map(b=>b.length*7))+c*2,h=a+c*2,d=r-l/2,u=i-h/2,f=$("rect");f.setAttribute("x",String(d)),f.setAttribute("y",String(u)),f.setAttribute("width",String(l)),f.setAttribute("height",String(h)),f.setAttribute("fill","var(--bg)"),f.setAttribute("stroke","var(--_line)"),f.setAttribute("stroke-width","0.75"),f.setAttribute("rx","3");let g=$("text");g.setAttribute("fill","var(--_text)"),g.setAttribute("font-family",n.font),g.setAttribute("font-size","11"),g.setAttribute("font-weight","500");let m=i-a/2+o/2;return s.forEach((b,k)=>{let A=$("tspan");A.setAttribute("x",String(r)),A.setAttribute("y",String(m+k*o)),A.setAttribute("text-anchor","middle"),A.setAttribute("dominant-baseline","middle"),A.textContent=b,g.appendChild(A)}),e.appendChild(f),e.appendChild(g),e}function gr(t){let n=$("defs"),e=$("marker");e.setAttribute("id","arrowhead"),e.setAttribute("markerWidth","12"),e.setAttribute("markerHeight","8"),e.setAttribute("refX","11"),e.setAttribute("refY","4"),e.setAttribute("orient","auto"),e.setAttribute("markerUnits","userSpaceOnUse");let r=$("path");r.setAttribute("d","M1,1 L11,4 L1,7 z"),r.setAttribute("fill","var(--_arrow)"),e.appendChild(r);let i=$("marker");i.setAttribute("id","arrowhead-start"),i.setAttribute("markerWidth","12"),i.setAttribute("markerHeight","8"),i.setAttribute("refX","1"),i.setAttribute("refY","4"),i.setAttribute("orient","auto"),i.setAttribute("markerUnits","userSpaceOnUse");let s=$("path");s.setAttribute("d","M11,1 L1,4 L11,7 z"),s.setAttribute("fill","var(--_arrow)"),i.appendChild(s);let o=$("marker");o.setAttribute("id","arrowhead-open"),o.setAttribute("markerWidth","12"),o.setAttribute("markerHeight","8"),o.setAttribute("refX","11"),o.setAttribute("refY","4"),o.setAttribute("orient","auto"),o.setAttribute("markerUnits","userSpaceOnUse");let a=$("path");a.setAttribute("d","M1,1 L11,4 L1,7"),a.setAttribute("fill","none"),a.setAttribute("stroke","var(--_arrow)"),a.setAttribute("stroke-width","1.5"),a.setAttribute("stroke-linejoin","round"),o.appendChild(a);let c=$("marker");c.setAttribute("id","arrowhead-cross"),c.setAttribute("markerWidth","12"),c.setAttribute("markerHeight","12"),c.setAttribute("refX","6"),c.setAttribute("refY","6"),c.setAttribute("orient","auto"),c.setAttribute("markerUnits","userSpaceOnUse");let l=$("path");l.setAttribute("d","M3,3 L9,9 M9,3 L3,9"),l.setAttribute("stroke","var(--_arrow)"),l.setAttribute("stroke-width","1.5"),l.setAttribute("stroke-linecap","round"),c.appendChild(l),n.appendChild(e),n.appendChild(i),n.appendChild(o),n.appendChild(c);let d=[...[{id:"er-one",w:20,h:16,refX:18,refY:8,content:'<line x1="18" y1="2" x2="18" y2="14" stroke="var(--_line)" stroke-width="1.5"/><line x1="14" y1="2" x2="14" y2="14" stroke="var(--_line)" stroke-width="1.5"/>'},{id:"er-one-start",w:20,h:16,refX:2,refY:8,content:'<line x1="2" y1="2" x2="2" y2="14" stroke="var(--_line)" stroke-width="1.5"/><line x1="6" y1="2" x2="6" y2="14" stroke="var(--_line)" stroke-width="1.5"/>'},{id:"er-many",w:20,h:16,refX:18,refY:8,content:'<line x1="18" y1="2" x2="18" y2="14" stroke="var(--_line)" stroke-width="1.5"/><path d="M18,8 L6,2 M18,8 L6,14" stroke="var(--_line)" stroke-width="1.5" fill="none"/>'},{id:"er-many-start",w:20,h:16,refX:2,refY:8,content:'<line x1="2" y1="2" x2="2" y2="14" stroke="var(--_line)" stroke-width="1.5"/><path d="M2,8 L14,2 M2,8 L14,14" stroke="var(--_line)" stroke-width="1.5" fill="none"/>'},{id:"er-zero-one",w:24,h:16,refX:22,refY:8,content:'<line x1="22" y1="2" x2="22" y2="14" stroke="var(--_line)" stroke-width="1.5"/><circle cx="14" cy="8" r="4" fill="none" stroke="var(--_line)" stroke-width="1.5"/>'},{id:"er-zero-one-start",w:24,h:16,refX:2,refY:8,content:'<line x1="2" y1="2" x2="2" y2="14" stroke="var(--_line)" stroke-width="1.5"/><circle cx="10" cy="8" r="4" fill="none" stroke="var(--_line)" stroke-width="1.5"/>'},{id:"er-zero-many",w:24,h:16,refX:22,refY:8,content:'<path d="M22,8 L10,2 M22,8 L10,14" stroke="var(--_line)" stroke-width="1.5" fill="none"/><circle cx="6" cy="8" r="4" fill="none" stroke="var(--_line)" stroke-width="1.5"/>'},{id:"er-zero-many-start",w:24,h:16,refX:2,refY:8,content:'<path d="M2,8 L14,2 M2,8 L14,14" stroke="var(--_line)" stroke-width="1.5" fill="none"/><circle cx="18" cy="8" r="4" fill="none" stroke="var(--_line)" stroke-width="1.5"/>'}],{id:"cls-inheritance",w:16,h:14,refX:1,refY:7,content:'<path d="M15,1 L1,7 L15,13 z" fill="var(--_node-fill)" stroke="var(--_line)" stroke-width="1.5" stroke-linejoin="round"/>'},{id:"cls-composition",w:14,h:14,refX:1,refY:7,content:'<path d="M1,7 L7,1 L13,7 L7,13 z" fill="var(--_line)" stroke="var(--_line)" stroke-width="1"/>'},{id:"cls-aggregation",w:14,h:14,refX:1,refY:7,content:'<path d="M1,7 L7,1 L13,7 L7,13 z" fill="var(--_node-fill)" stroke="var(--_line)" stroke-width="1.5"/>'}];for(let u of d){let f=$("marker");f.setAttribute("id",u.id),f.setAttribute("markerWidth",String(u.w)),f.setAttribute("markerHeight",String(u.h)),f.setAttribute("refX",String(u.refX)),f.setAttribute("refY",String(u.refY)),f.setAttribute("orient","auto"),f.setAttribute("markerUnits","userSpaceOnUse"),f.innerHTML=u.content,n.appendChild(f)}return n}function Vt(t,n){if(typeof document>"u")throw new Error("renderToDOM can only be used in browser environments");let e=n?.theme??W,r=n?.padding??16,i=n?.transparent??!1;n?.debug;let s=V(e),o={font:s.font},a=t.width+r*2,c=t.height+r*2,l=i?"none":s.bg,h=$("svg"),d=`cm-${Math.random().toString(36).slice(2,8)}`;h.setAttribute("id",d),h.setAttribute("xmlns",qt),h.setAttribute("viewBox",`0 0 ${a} ${c}`),h.setAttribute("width",String(a)),h.setAttribute("height",String(c));let u="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap",f=$("style");f.textContent=`
		@import url('${u}');
		#${d} {
			--bg: ${s.bg};
			--fg: ${s.fg};
			--_text: ${s.text};
			--_line: ${s.line};
			--_arrow: ${s.arrow};
			--_node-fill: ${s.nodeFill};
			--_node-stroke: ${s.nodeStroke};
			--_muted: ${s.muted};
			--_group-fill: ${s.groupFill};
			--_group-stroke: ${s.groupStroke};
			--_group-text: ${s.groupText};
		}
	`,h.appendChild(f);let g=$("rect");g.setAttribute("width",String(a)),g.setAttribute("height",String(c)),g.setAttribute("fill",l),h.appendChild(g),h.appendChild(gr());let m=$("g");return m.setAttribute("transform",`translate(${r}, ${r})`),Kt(t.groups,o,m),t.edges.forEach(b=>{m.appendChild(ur(b,o,n||{}))}),t.edges.forEach(b=>{m.appendChild(fr(b,o))}),t.nodes.forEach(b=>{m.appendChild(dr(b,o,n||{}))}),h.appendChild(m),n?.container&&n.container.appendChild(h),h}function j(t){let n=t.getAttribute("viewBox");if(!n){let r=Number.parseFloat(t.getAttribute("width")||"0"),i=Number.parseFloat(t.getAttribute("height")||"0");return{x:0,y:0,width:r,height:i}}let e=n.split(/\s+/).map(Number.parseFloat);return{x:e[0]??0,y:e[1]??0,width:e[2]??0,height:e[3]??0}}function Q(t,n){t.setAttribute("viewBox",`${n.x} ${n.y} ${n.width} ${n.height}`)}function Z(t,n){let e=t.getBoundingClientRect(),r=j(t),i=r.width/e.width,s=r.height/e.height,o=(n.clientX-e.left)*i+r.x,a=(n.clientY-e.top)*s+r.y;return{x:o,y:a}}function Ut(t,n){let e=n.clientX-t.clientX,r=n.clientY-t.clientY;return Math.sqrt(e*e+r*r)}function pr(t,n){return{x:(t.clientX+n.clientX)/2,y:(t.clientY+n.clientY)/2}}function Qt(t,n){let e=n?.minZoom??.1,r=n?.maxZoom??5,i=n?.zoomSpeed??.1,s=j(t),o=!1,a={x:0,y:0},c={...s},l=0,h={...s};function d(y){y.preventDefault();let w=j(t),S=Z(t,y),x=y.deltaY>0?1+i:1-i,p=w.width*x,v=w.height*x,M=s.width*r,E=s.height*r,_=s.width*e,L=s.height*e;if(p>M||p<_||v>E||v<L)return;let N=S.x-(S.x-w.x)*p/w.width,I=S.y-(S.y-w.y)*v/w.height;Q(t,{x:N,y:I,width:p,height:v})}function u(y){y.button===0&&(o=!0,a=Z(t,y),c=j(t),t.style.cursor="grabbing")}function f(y){if(!o)return;let w=Z(t,y),S=w.x-a.x,x=w.y-a.y;Q(t,{x:c.x-S,y:c.y-x,width:c.width,height:c.height})}function g(){o=!1,t.style.cursor="grab"}function m(){Q(t,s)}function b(y){if(y.touches.length===2){y.preventDefault();let w=y.touches[0],S=y.touches[1];l=Ut(w,S),h=j(t)}else if(y.touches.length===1){let w=y.touches[0];a=Z(t,{clientX:w.clientX,clientY:w.clientY}),c=j(t),o=!0}}function k(y){if(y.touches.length===2){y.preventDefault();let w=y.touches[0],S=y.touches[1],x=Ut(w,S),p=l/x,v=h.width*p,M=h.height*p,E=s.width*r,_=s.height*r,L=s.width*e,N=s.height*e;if(v>E||v<L||M>_||M<N)return;let I=pr(w,S),H=t.getBoundingClientRect(),D=h,B=D.width/H.width,at=D.height/H.height,q=(I.x-H.left)*B+D.x,K=(I.y-H.top)*at+D.y,et=q-(q-D.x)*v/D.width,oe=K-(K-D.y)*M/D.height;Q(t,{x:et,y:oe,width:v,height:M})}else if(y.touches.length===1&&o){y.preventDefault();let w=y.touches[0],S=Z(t,{clientX:w.clientX,clientY:w.clientY}),x=S.x-a.x,p=S.y-a.y;Q(t,{x:c.x-x,y:c.y-p,width:c.width,height:c.height})}}function A(){o=!1,l=0}return t.style.cursor="grab",t.addEventListener("wheel",d,{passive:!1}),t.addEventListener("mousedown",u),document.addEventListener("mousemove",f),document.addEventListener("mouseup",g),t.addEventListener("dblclick",m),t.addEventListener("touchstart",b,{passive:!1}),t.addEventListener("touchmove",k,{passive:!1}),t.addEventListener("touchend",A),()=>{t.style.cursor="",t.removeEventListener("wheel",d),t.removeEventListener("mousedown",u),document.removeEventListener("mousemove",f),document.removeEventListener("mouseup",g),t.removeEventListener("dblclick",m),t.removeEventListener("touchstart",b),t.removeEventListener("touchmove",k),t.removeEventListener("touchend",A)}}function mr(t){let n=new Map,e=[];return t.querySelectorAll("[data-node-id]").forEach(r=>{let i=r.getAttribute("data-node-id");i&&n.set(i,{element:r,connections:new Set})}),t.querySelectorAll("[data-edge-source]").forEach(r=>{let i=r.getAttribute("data-edge-source"),s=r.getAttribute("data-edge-target");i&&s&&(e.push({source:i,target:s}),n.get(i)?.connections.add(s),n.get(s)?.connections.add(i))}),{nodes:n,edges:e}}function mt(t){if(t.setAttribute("tabindex","0"),t.focus(),t.querySelector(".focus-ring"))return;let r=t.getBBox(),i=4,s=document.createElementNS("http://www.w3.org/2000/svg","rect");s.classList.add("focus-ring"),s.setAttribute("x",String(r.x-i)),s.setAttribute("y",String(r.y-i)),s.setAttribute("width",String(r.width+i*2)),s.setAttribute("height",String(r.height+i*2)),s.setAttribute("fill","none"),s.setAttribute("stroke","#3b82f6"),s.setAttribute("stroke-width","2"),s.setAttribute("stroke-dasharray","4 2"),s.setAttribute("rx","4"),s.setAttribute("pointer-events","none"),t.insertBefore(s,t.firstChild)}function it(t){t.removeAttribute("tabindex");let n=t.querySelector(".focus-ring");n&&n.remove()}function br(t){let n=new CustomEvent("nodeselect",{detail:{nodeId:t.getAttribute("data-node-id")},bubbles:!0});t.dispatchEvent(n)}function yr(t,n,e){let r=e.nodes.get(t);if(!r)return null;let i=r.element.getBoundingClientRect(),s=[];for(let o of r.connections){let a=e.nodes.get(o);if(!a)continue;let c=a.element.getBoundingClientRect(),l=!1,h=0;switch(n){case"up":l=c.top<i.top,h=i.top-c.top;break;case"down":l=c.bottom>i.bottom,h=c.bottom-i.bottom;break;case"left":l=c.left<i.left,h=i.left-c.left;break;case"right":l=c.right>i.right,h=c.right-i.right;break}l&&h>0&&s.push({id:o,distance:h})}return s.length===0?null:(s.sort((o,a)=>o.distance-a.distance),s[0].id)}function Zt(t){let n=mr(t),e=null,r=Array.from(n.nodes.keys());if(r.length===0)return()=>{};let i={ArrowUp:"up",ArrowDown:"down",ArrowLeft:"left",ArrowRight:"right"};function s(o){switch(o.key){case"Tab":{if(o.preventDefault(),e){let l=n.nodes.get(e);l&&it(l.element)}let a=e?r.indexOf(e):-1,c=o.shiftKey?a<=0?r.length-1:a-1:(a+1)%r.length;if(e=r[c]??null,e){let l=n.nodes.get(e);l&&mt(l.element)}break}case"Enter":{if(e){let a=n.nodes.get(e);a&&br(a.element)}break}case"Escape":{if(e){let a=n.nodes.get(e);a&&it(a.element),e=null}break}case"ArrowUp":case"ArrowDown":case"ArrowLeft":case"ArrowRight":{if(o.preventDefault(),!e){if(e=r[0]??null,e){let l=n.nodes.get(e);l&&mt(l.element)}return}let a=i[o.key];if(!a)return;let c=yr(e,a,n);if(c){let l=n.nodes.get(e);l&&it(l.element),e=c;let h=n.nodes.get(e);h&&mt(h.element)}break}}}return t.addEventListener("keydown",s),t.setAttribute("tabindex","0"),()=>{t.removeEventListener("keydown",s),t.removeAttribute("tabindex"),n.nodes.forEach(({element:o})=>{it(o)})}}function xr(t){let n=new Map;return t.querySelectorAll("[data-node-id]").forEach(e=>{let r=e.getAttribute("data-node-id");r&&n.set(r,{id:r,element:e,connectedEdges:new Set})}),t.querySelectorAll("[data-edge-source]").forEach(e=>{let r=e.getAttribute("data-edge-source"),i=e.getAttribute("data-edge-target");if(r&&i){let s=e;n.get(r)?.connectedEdges.add(s),n.get(i)?.connectedEdges.add(s)}}),n}function wr(){let t=document.createElement("div");return t.style.position="absolute",t.style.padding="8px 12px",t.style.background="rgba(0, 0, 0, 0.9)",t.style.color="white",t.style.fontSize="12px",t.style.fontFamily="Inter, system-ui, sans-serif",t.style.borderRadius="6px",t.style.pointerEvents="none",t.style.zIndex="10000",t.style.opacity="0",t.style.transition="opacity 0.2s ease",t.style.maxWidth="300px",t.style.wordWrap="break-word",t.style.boxShadow="0 4px 6px rgba(0, 0, 0, 0.3)",t}function kr(t,n,e){t.textContent=n,t.style.left=`${e.pageX+10}px`,t.style.top=`${e.pageY+10}px`,t.style.opacity="1"}function $r(t){t.style.opacity="0"}function Ar(t,n){let e=new Set;t.connectedEdges.forEach(r=>{let i=r.getAttribute("data-edge-source"),s=r.getAttribute("data-edge-target");i&&i!==t.id&&e.add(i),s&&s!==t.id&&e.add(s)}),n.forEach(r=>{r.id===t.id||e.has(r.id)?r.element.style.opacity="1":r.element.style.opacity="0.3"}),t.connectedEdges.forEach(r=>{r.style.opacity="1",r.style.strokeWidth="2.5"})}function Ft(t,n){t.forEach(e=>{e.element.style.opacity="1"}),n.querySelectorAll("[data-edge-source]").forEach(e=>{let r=e;r.style.opacity="1",r.style.strokeWidth=""})}function Jt(t){let n=xr(t),e=wr();document.body.appendChild(e);let r=null;function i(a){let c=a.currentTarget,l=c.getAttribute("data-node-id");if(!l)return;r=l;let h=n.get(l);if(!h)return;let d=c.getAttribute("aria-label")||l;kr(e,d,a),Ar(h,n)}function s(a){if(r){let c=a;e.style.left=`${c.pageX+10}px`,e.style.top=`${c.pageY+10}px`}}function o(){r=null,$r(e),Ft(n,t)}return n.forEach(a=>{a.element.addEventListener("mouseenter",i),a.element.addEventListener("mousemove",s),a.element.addEventListener("mouseleave",o)}),()=>{n.forEach(a=>{a.element.removeEventListener("mouseenter",i),a.element.removeEventListener("mousemove",s),a.element.removeEventListener("mouseleave",o)}),e.remove(),Ft(n,t)}}function bt(t){let n=t.getAttribute("viewBox");if(!n){let r=Number.parseFloat(t.getAttribute("width")||"0"),i=Number.parseFloat(t.getAttribute("height")||"0");return{x:0,y:0,width:r,height:i}}let e=n.split(/\s+/).map(Number.parseFloat);return{x:e[0]??0,y:e[1]??0,width:e[2]??0,height:e[3]??0}}function Sr(t){let n=t.querySelector("g");if(!n)return bt(t);let e=n.getBBox(),r=20;return{x:e.x-r,y:e.y-r,width:e.width+r*2,height:e.height+r*2}}function vr(t){return getComputedStyle(t).position==="static"?(t.style.position="relative",!0):!1}function Mr(t,n,e){let r=document.createElement("div");r.style.position="absolute",r.style.width=`${t}px`,r.style.height=`${n}px`,r.style.border="1px solid rgba(255, 255, 255, 0.2)",r.style.borderRadius="4px",r.style.overflow="hidden",r.style.background="rgba(0, 0, 0, 0.8)",r.style.zIndex="9999",r.style.pointerEvents="auto";let i="8px";switch(e){case"top-left":r.style.top=i,r.style.left=i;break;case"top-right":r.style.top=i,r.style.right=i;break;case"bottom-left":r.style.bottom=i,r.style.left=i;break;case"bottom-right":r.style.bottom=i,r.style.right=i;break}return r}function Er(t,n,e){let r=document.createElementNS("http://www.w3.org/2000/svg","svg");return r.setAttribute("width",String(n)),r.setAttribute("height",String(e)),r.setAttribute("viewBox",`${t.x} ${t.y} ${t.width} ${t.height}`),r.style.display="block",r.style.pointerEvents="none",r}function _r(t,n){let e=t.querySelector("g");if(!e)return;let r=e.cloneNode(!0);r.style.pointerEvents="none",n.appendChild(r)}function Cr(){let t=document.createElementNS("http://www.w3.org/2000/svg","rect");return t.setAttribute("fill","rgba(59, 130, 246, 0.3)"),t.setAttribute("stroke","#3b82f6"),t.setAttribute("stroke-width","2"),t.style.pointerEvents="none",t}function Lr(t,n){t.setAttribute("x",String(n.x)),t.setAttribute("y",String(n.y)),t.setAttribute("width",String(n.width)),t.setAttribute("height",String(n.height))}function Pr(t,n,e,r,i,s){let o=n.getBoundingClientRect(),a=(t.clientX-o.left)/i,c=(t.clientY-o.top)/s,l=e.x+a*e.width,h=e.y+c*e.height;return{x:l-r.width/2,y:h-r.height/2,width:r.width,height:r.height}}function te(t,n){let e=n?.width??150,r=n?.height??100,i=n?.position??"bottom-right",s=t.parentElement;if(!s)return()=>{};let o=vr(s),a=Sr(t),c=Mr(e,r,i),l=Er(a,e,r),h=Cr();_r(t,l),l.appendChild(h),c.appendChild(l),s.appendChild(c);let d=()=>{let g=bt(t);Lr(h,g)};d();let u=new MutationObserver(g=>{for(let m of g)m.type==="attributes"&&m.attributeName==="viewBox"&&d()});u.observe(t,{attributes:!0,attributeFilter:["viewBox"]});let f=g=>{let m=bt(t),b=Pr(g,c,a,m,e,r);t.setAttribute("viewBox",`${b.x} ${b.y} ${b.width} ${b.height}`)};return c.addEventListener("click",f),c.style.cursor="pointer",()=>{u.disconnect(),c.removeEventListener("click",f),c.remove(),o&&(s.style.position="")}}function Ir(t,n){let e=[];return t.querySelectorAll("[data-node-id]").forEach(i=>{let s=i.getAttribute("data-node-id");if(s){if(i.style.cursor="pointer",n.onNodeClick){let o=(a=>{n.onNodeClick?.(s,a)});e.push({element:i,type:"click",handler:o})}if(n.onNodeHover){let o=(c=>{n.onNodeHover?.(s,c)});e.push({element:i,type:"mouseenter",handler:o});let a=(c=>{n.onNodeHover?.(null,c)});e.push({element:i,type:"mouseleave",handler:a})}}}),e}function Nr(t,n){let e=[];return t.querySelectorAll("[data-edge-source]").forEach(i=>{let s=i.getAttribute("data-edge-source"),o=i.getAttribute("data-edge-target");if(!(!s||!o)){if(i.style.cursor="pointer",n.onEdgeClick){let a=(c=>{n.onEdgeClick?.(s,o,c)});e.push({element:i,type:"click",handler:a})}if(n.onEdgeHover){let a=(l=>{n.onEdgeHover?.(s,o,l)});e.push({element:i,type:"mouseenter",handler:a});let c=(l=>{n.onEdgeHover?.(s,null,l)});e.push({element:i,type:"mouseleave",handler:c})}}}),e}function ee(t,n){let e=Ir(t,n),r=Nr(t,n),i=[...e,...r];for(let{element:s,type:o,handler:a}of i)s.addEventListener(o,a);return()=>{for(let{element:s,type:o,handler:a}of i)s.removeEventListener(o,a);t.querySelectorAll("[data-node-id]").forEach(s=>{s.style.cursor=""}),t.querySelectorAll("[data-edge-source]").forEach(s=>{s.style.cursor=""})}}function Dr(){let t=document.createElement("div");return t.style.position="absolute",t.style.top="8px",t.style.left="50%",t.style.transform="translateX(-50%)",t.style.background="rgba(0, 0, 0, 0.9)",t.style.border="1px solid #3b82f6",t.style.borderRadius="8px",t.style.padding="8px 12px",t.style.display="flex",t.style.alignItems="center",t.style.gap="8px",t.style.zIndex="10000",t}function Tr(){let t=document.createElement("input");return t.type="text",t.placeholder="Search nodes...",t.style.background="transparent",t.style.border="none",t.style.color="white",t.style.outline="none",t.style.fontSize="14px",t.style.fontFamily="Inter, system-ui, sans-serif",t.style.width="200px",t}function zr(){let t=document.createElement("span");return t.style.color="rgba(255, 255, 255, 0.6)",t.style.fontSize="12px",t.style.whiteSpace="nowrap",t}function Hr(t,n){let r=t.getBBox(),i=4,s=document.createElementNS("http://www.w3.org/2000/svg","rect");return s.setAttribute("x",String(r.x-i)),s.setAttribute("y",String(r.y-i)),s.setAttribute("width",String(r.width+i*2)),s.setAttribute("height",String(r.height+i*2)),s.setAttribute("fill","none"),s.setAttribute("stroke",n),s.setAttribute("stroke-width","3"),s.setAttribute("rx","4"),s.setAttribute("pointer-events","none"),s.classList.add("search-highlight"),s}function Rr(t,n){let e=[],r=n.toLowerCase();return t.querySelectorAll("[data-node-id]").forEach(i=>{let s=i,o=s.getAttribute("data-node-id");if(!o)return;(s.getAttribute("aria-label")||o).toLowerCase().includes(r)&&e.push({element:s,nodeId:o})}),e}function Yr(t,n,e){t.querySelectorAll("[data-node-id]").forEach(r=>{let i=r,s=i.getAttribute("data-node-id");i.style.opacity=s&&n.has(s)?"1":String(e)}),t.querySelectorAll("[data-edge-source]").forEach(r=>{let i=r,s=i.getAttribute("data-edge-source"),o=i.getAttribute("data-edge-target"),a=s&&n.has(s)||o&&n.has(o);i.style.opacity=a?"1":String(e)})}function Wr(t){t.querySelectorAll("[data-node-id]").forEach(n=>{n.style.opacity="1"}),t.querySelectorAll("[data-edge-source]").forEach(n=>{n.style.opacity="1"})}function Xr(t){t.querySelectorAll(".search-highlight").forEach(n=>n.remove())}function ne(t,n){let e=n?.highlightColor??"#3b82f6",r=n?.dimOpacity??.2,i=t.parentElement;if(!i)return()=>{};let s=getComputedStyle(i),o=!1;s.position==="static"&&(i.style.position="relative",o=!0);let a=null,c=null,l=null,h=[],d=-1,u=!1;function f(){l&&(h.length===0&&c&&c.value.length>0?l.textContent="No results":h.length>0?l.textContent=`${d+1} of ${h.length}`:l.textContent="")}function g(){Xr(t),Wr(t),h=[],d=-1}function m(w){if(g(),w.length===0){f();return}let S=Rr(t,w),x=new Set(S.map(p=>p.nodeId));h=S.map(({element:p,nodeId:v})=>{let M=Hr(p,e);return p.appendChild(M),{element:p,nodeId:v,highlight:M}}),h.length>0&&(d=0,Yr(t,x,r),h[0]?.element.scrollIntoView({behavior:"smooth",block:"center"})),f()}function b(){if(h.length===0)return;d=(d+1)%h.length;let w=h[d];w&&w.element.scrollIntoView({behavior:"smooth",block:"center"}),f()}function k(){if(u){c?.focus();return}u=!0,a=Dr(),c=Tr(),l=zr(),a.appendChild(c),a.appendChild(l),i?.appendChild(a),c.focus(),c.addEventListener("input",()=>{c&&m(c.value)}),c.addEventListener("keydown",w=>{w.key==="Enter"&&(w.preventDefault(),b()),w.key==="Escape"&&(w.preventDefault(),A())})}function A(){u&&(u=!1,g(),a&&(a.remove(),a=null),c=null,l=null)}function y(w){(w.metaKey||w.ctrlKey)&&w.key==="f"&&(w.preventDefault(),k())}return t.addEventListener("keydown",y),document.addEventListener("keydown",y),()=>{t.removeEventListener("keydown",y),document.removeEventListener("keydown",y),A(),o&&(i.style.position="")}}var O={shapes:new Map,diagrams:new Map,themes:new Map};function xt(t){if(t.shapes)for(let n of t.shapes)O.shapes.set(n.name,n);if(t.diagrams)for(let n of t.diagrams)O.diagrams.set(n.type,n);if(t.themes)for(let n of t.themes)O.themes.set(n.name,n)}function tt(){return O}function wt(){O.shapes.clear(),O.diagrams.clear(),O.themes.clear()}function re(t,n={}){let{theme:e,padding:r,transparent:i,debug:s,...o}=n,a=tt(),c=null,l=null,h=t.split(/[\n;]/)[0]?.trim()||"";for(let[,d]of a.diagrams)if(d.detect(h)&&(c=d.parse(t),c?.ast)){d.layout&&(l=d.layout(c.ast,{direction:o.direction,nodeSpacing:o.nodeSpacing,layerSpacing:o.layerSpacing,padding:r}));break}if(!c&&(c=F(t),!c.ast)){let d=c.diagnostics.map(u=>u.message).join(`
`);throw new Error(`Failed to parse diagram:
${d}`)}return l||(l=G(c.ast,{direction:o.direction,nodeSpacing:o.nodeSpacing,layerSpacing:o.layerSpacing,padding:r})),ot(l,{theme:e,padding:r,transparent:i,debug:s})}var kt=class{buffer;width;height;constructor(n,e){this.width=n,this.height=e,this.buffer=Array.from({length:e},()=>Array.from({length:n},()=>({char:" "})))}set(n,e,r,i){let s=Math.round(n),o=Math.round(e);s<0||s>=this.width||o<0||o>=this.height||(this.buffer[o][s]={char:r,color:i})}line(n,e,r,i,s,o){let a=Math.round(n),c=Math.round(e),l=Math.round(r),h=Math.round(i),d=Math.abs(l-a),u=Math.abs(h-c),f=a<l?1:-1,g=c<h?1:-1,m=d-u,b=a,k=c;for(;;){let A=s??(d>u?"\u2500":u>d?"\u2502":"\u2500");if(this.set(b,k,A,o),b===l&&k===h)break;let y=2*m;y>-u&&(m-=u,b+=f),y<d&&(m+=d,k+=g)}}box(n,e,r,i,s){let o=Math.round(n),a=Math.round(e),c=Math.round(r),l=Math.round(i);this.set(o,a,"\u250C",s),this.set(o+c-1,a,"\u2510",s),this.set(o,a+l-1,"\u2514",s),this.set(o+c-1,a+l-1,"\u2518",s);for(let h=1;h<c-1;h++)this.set(o+h,a,"\u2500",s),this.set(o+h,a+l-1,"\u2500",s);for(let h=1;h<l-1;h++)this.set(o,a+h,"\u2502",s),this.set(o+c-1,a+h,"\u2502",s)}roundedBox(n,e,r,i,s){let o=Math.round(n),a=Math.round(e),c=Math.round(r),l=Math.round(i);this.set(o,a,"\u256D",s),this.set(o+c-1,a,"\u256E",s),this.set(o,a+l-1,"\u2570",s),this.set(o+c-1,a+l-1,"\u256F",s);for(let h=1;h<c-1;h++)this.set(o+h,a,"\u2500",s),this.set(o+h,a+l-1,"\u2500",s);for(let h=1;h<l-1;h++)this.set(o,a+h,"\u2502",s),this.set(o+c-1,a+h,"\u2502",s)}diamond(n,e,r,i,s){let o=Math.round(n),a=Math.round(e),c=Math.max(1,Math.floor(Math.round(r)/2)),l=Math.max(1,Math.floor(Math.round(i)/2)),h=o-c,d=a-l,u=c*2+1,f=l*2+1;this.set(h,d,"\u25C6",s),this.set(h+u-1,d,"\u25C6",s),this.set(h,d+f-1,"\u25C6",s),this.set(h+u-1,d+f-1,"\u25C6",s);for(let g=1;g<u-1;g++)this.set(h+g,d,"\u2500",s),this.set(h+g,d+f-1,"\u2500",s);for(let g=1;g<f-1;g++)this.set(h,d+g,"\u2502",s),this.set(h+u-1,d+g,"\u2502",s)}text(n,e,r,i){let s=Math.round(n),o=Math.round(e);for(let a=0;a<r.length;a++)this.set(s+a,o,r[a],i)}toHtml(){let n=[];for(let e of this.buffer){let r="",i;for(let s of e){let o=s.char==="<"?"&lt;":s.char===">"?"&gt;":s.char==="&"?"&amp;":s.char;s.color!==i&&(i&&(r+="</span>"),i=s.color,s.color&&(r+=`<span style="color:${s.color}">`)),r+=o}i&&(r+="</span>"),n.push(r)}return n.join(`
`)}};function Or(t,n,e,r){let i=e-t,s=r-n;return Math.abs(i)>Math.abs(s)?i>0?"\u2192":"\u2190":s>0?"\u2193":"\u2191"}function Br(t,n,e,r){let i=n.x*e,s=n.y*e,o=n.width*e,a=n.height*e,c=r.nodeStroke,l=r.text;switch(n.shape){case"state-start":{let f=Math.round(i+o/2),g=Math.round(s+a/2);t.set(f,g,"\u25CF",c);return}case"state-end":{let f=Math.round(i+o/2),g=Math.round(s+a/2);t.set(f,g,"\u25C9",c);return}case"rounded":case"stadium":t.roundedBox(i,s,o,a,c);break;case"diamond":t.diamond(i+o/2,s+a/2,o,a,c);break;case"circle":t.roundedBox(i,s,o,a,c);break;case"hexagon":t.diamond(i+o/2,s+a/2,o,a,c);break;default:t.box(i,s,o,a,c);break}let d=(n.label||n.id).split(`
`),u=s+Math.floor(a/2)-Math.floor(d.length/2);for(let f=0;f<d.length;f++){let g=d[f],m=i+Math.floor(o/2)-Math.floor(g.length/2);t.text(m,u+f,g,l)}}function Ur(t,n,e,r){if(!(n.points.length<2)){for(let i=0;i<n.points.length-1;i++){let s=n.points[i],o=n.points[i+1];t.line(s.x*e,s.y*e,o.x*e,o.y*e,n.style==="dotted"?"\xB7":void 0,r.line)}if(n.hasArrowEnd&&n.points.length>=2){let i=n.points[n.points.length-1],s=n.points[n.points.length-2];t.set(i.x*e,i.y*e,Or(s.x*e,s.y*e,i.x*e,i.y*e),r.arrow)}n.label&&n.labelPosition&&t.text(n.labelPosition.x*e,n.labelPosition.y*e,n.label,r.muted)}}function se(t,n,e,r){t.roundedBox(n.x*e,n.y*e,n.width*e,n.height*e,r.groupStroke),n.label&&t.text(n.x*e+2,n.y*e,n.label,r.groupText);for(let i of n.children)se(t,i,e,r)}function ie(t,n={}){let e=F(t);if(!e.ast){let d=e.diagnostics.map(u=>u.message).join(`
`);throw new Error(`Parse error:
${d}`)}let r=G(e.ast),i=n.width??80,s=Math.min(.15,i/r.width),o=Math.ceil(r.width*s),a=Math.ceil(r.height*s),c=new kt(o,a),l=n.theme??W,h=V(l);for(let d of r.groups)se(c,d,s,h);for(let d of r.edges)Ur(c,d,s,h);for(let d of r.nodes)Br(c,d,s,h);return c.toHtml()}return ue(Fr);})();
