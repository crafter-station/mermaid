"use strict";var crafterMermaid=(()=>{var lt=Object.defineProperty;var le=Object.getOwnPropertyDescriptor;var de=Object.getOwnPropertyNames;var he=Object.prototype.hasOwnProperty;var ue=(t,n)=>{for(var e in n)lt(t,e,{get:n[e],enumerable:!0})},fe=(t,n,e,r)=>{if(n&&typeof n=="object"||typeof n=="function")for(let s of de(n))!he.call(t,s)&&s!==e&&lt(t,s,{get:()=>n[s],enumerable:!(r=le(n,s))||r.enumerable});return t};var ge=t=>fe(lt({},"__esModule",{value:!0}),t);var Gr={};ue(Gr,{DEFAULTS:()=>O,THEMES:()=>yt,enableEvents:()=>ie,enableHover:()=>ne,enableKeyboard:()=>ee,enableMinimap:()=>re,enableSearch:()=>se,enableZoomPan:()=>te,getRegistry:()=>et,layout:()=>q,parse:()=>j,render:()=>oe,renderToAscii:()=>ce,renderToDOM:()=>Jt,renderToString:()=>ct,resetRegistry:()=>At,use:()=>$t});var pe=[[/^\s*sequenceDiagram\s*$/i,"sequence"],[/^\s*classDiagram\s*$/i,"class"],[/^\s*erDiagram\s*$/i,"er"],[/^\s*stateDiagram-v2\s*$/i,"state"],[/^\s*(?:graph|flowchart)\s+(?:TD|TB|LR|BT|RL)\s*$/i,"flowchart"],[/^\s*pie\s+(?:title\s+.+)?$/i,"pie"],[/^\s*gantt\s*$/i,"gantt"],[/^\s*mindmap\s*$/i,"mindmap"]];function It(t){let n=t.split(/[\n;]/);for(let e of n){let r=e.trim();if(!(!r||r.startsWith("%%"))){for(let[s,i]of pe)if(s.test(r))return i;break}}return null}function L(t,n,e){return{severity:"error",message:t,span:n,suggestions:e}}function H(t,n,e){return{severity:"warning",message:t,span:n,suggestions:e}}function z(t,n,e,r){return{start:{line:t,column:n,offset:e},end:{line:t,column:n+r,offset:e+r}}}function Y(t,n){let e=t.split(/[\n;]/),r=0;for(let i=0;i<n&&i<e.length;i++)r+=(e[i]?.length??0)+1;let s=e[n]?.length??0;return z(n+1,1,r,s)}var Nt=[[/<\|--/,"inheritance"],[/\*--/,"composition"],[/o--/,"aggregation"],[/-->/,"association"],[/\.\.>/,"dependency"],[/\.\.\|>/,"realization"]];function me(t){let n={classes:new Map,relations:[],namespaces:[],diagnostics:[],currentClass:null,currentNamespace:null},e=t.split(`
`);for(let s=0;s<e.length;s++){let o=e[s].trim();if(!o||o.startsWith("%%")||s===0&&/^classDiagram\s*$/i.test(o))continue;let a=Y(t,s);if(o.startsWith("class "))be(o,a,n);else if(o==="{")n.currentClass||n.diagnostics.push(L("Unexpected '{' outside class definition",a));else if(o==="}")n.currentClass=null;else if(n.currentClass)ye(o,a,n);else if(o.startsWith("namespace"))we(o,a,n);else if(Nt.some(([c])=>c.test(o)))xe(o,a,n);else{let c=o.indexOf(":");if(c>0){let l=o.slice(0,c).trim(),d=o.slice(c+1).trim();ht(l,a,n);let h=n.classes.get(l),u=Tt(d,a);u&&h.members.push(u)}else n.diagnostics.push(H(`Skipping unrecognized line: ${o}`,a))}}return{ast:{type:"class",classes:n.classes,relations:n.relations,namespaces:n.namespaces,span:z(1,1,0,t.length)},diagnostics:n.diagnostics}}function be(t,n,e){let r=t.match(/^class\s+(\w+)(?:\s+<<([^>]+)>>)?(?:\s+as\s+(.+?))?(?:\s*\{)?$/);if(!r){e.diagnostics.push(L("Invalid class definition syntax",n));return}let[,s,i,o]=r,a={id:s,label:o,annotation:i,members:[],span:n};e.classes.set(s,a),e.currentNamespace&&e.currentNamespace.classIds.push(s),t.includes("{")&&(e.currentClass=a)}function ye(t,n,e){let r=Tt(t,n);r&&e.currentClass&&e.currentClass.members.push(r)}function Tt(t,n){let e=t.match(/^([+\-#~])?(.+)$/);if(!e)return null;let[,r,s]=e,i=r||"",o=s.trim(),a=o.includes("$"),c=o.includes("*");o=o.replace(/[$*]/g,"").trim();let l=o.match(/^(\w+)\(([^)]*)\)(?:\s*:\s*(.+))?$/);if(l){let[,u,,f]=l;return{name:u,visibility:i,isStatic:a,isAbstract:c,returnType:f,isMethod:!0,span:n}}let d=o.match(/^(\w+)\s+(\w+)$/);if(d){let[,u,f]=d;return{name:f,type:u,visibility:i,isStatic:a,isAbstract:c,isMethod:!1,span:n}}let h=o.match(/^(\w+)(?:\s*:\s*(.+))?$/);if(h){let[,u,f]=h;return{name:u,type:f,visibility:i,isStatic:a,isAbstract:c,isMethod:!1,span:n}}return null}function xe(t,n,e){for(let[r,s]of Nt)if(r.test(t)){let i=t.split(r);if(i.length!==2){e.diagnostics.push(L("Invalid relation syntax",n));return}let o=i[0].trim(),a=i[1].trim(),c,l,d,h=o.match(/^"([^"]+)"\s+(\w+)$/);h&&(l=h[1],o=h[2]);let u=a.match(/^(\w+)\s+"([^"]+)"$/);u&&(a=u[1],d=u[2]);let f=a.match(/^(\w+)\s*:\s*(.+)$/);f&&(a=f[1],c=f[2]),ht(o,n,e),ht(a,n,e),e.relations.push({from:o,to:a,type:s,label:c,fromCardinality:l,toCardinality:d,span:n});return}}function we(t,n,e){let r=t.match(/^namespace\s+(\w+)(?:\s+as\s+(.+?))?(?:\s*\{)?$/);if(!r){e.diagnostics.push(L("Invalid namespace syntax",n));return}let[,s,i]=r,o={id:s,label:i||s,classIds:[],span:n};e.namespaces.push(o),t.includes("{")&&(e.currentNamespace=o)}function ht(t,n,e){e.classes.has(t)||e.classes.set(t,{id:t,members:[],span:n})}var vt={"||":"one","o|":"zero-one","|o":"zero-one","}|":"many","|{":"many","}o":"zero-many","o{":"zero-many","{o":"zero-many"};function ke(t){let n={entities:new Map,relations:[],diagnostics:[],currentEntity:null},e=t.split(`
`);for(let s=0;s<e.length;s++){let o=e[s].trim();if(!o||o.startsWith("%%")||s===0&&/^erDiagram\s*$/i.test(o))continue;let a=Y(t,s);/^(\w+)\s*\{/.test(o)?$e(o,a,n):o==="}"?n.currentEntity=null:n.currentEntity?Ae(o,a,n):/\|\||o\||\|o|}\|}o|o\{|\|{|{o/.test(o)&&(o.includes("--")||o.includes(".."))?Se(o,a,n):n.diagnostics.push(H(`Skipping unrecognized line: ${o}`,a))}return{ast:{type:"er",entities:n.entities,relations:n.relations,span:z(1,1,0,t.length)},diagnostics:n.diagnostics}}function $e(t,n,e){let r=t.match(/^(\w+)\s*\{/);if(!r){e.diagnostics.push(L("Invalid entity definition syntax",n));return}let s=r[1],i={id:s,attributes:[],span:n};e.entities.set(s,i),e.currentEntity=i}function Ae(t,n,e){if(!e.currentEntity)return;let r=t.match(/^(\w+)\s+(\w+)(?:\s+(PK|FK|UK|PK,FK|FK,PK))?(?:\s+"([^"]+)")?$/);if(!r){e.diagnostics.push(L("Invalid attribute syntax",n,['Expected: type name [PK|FK|UK] ["comment"]']));return}let[,s,i,o,a]=r,c=o?o.split(","):[];e.currentEntity.attributes.push({name:i,type:s,keys:c,comment:a,span:n})}function Se(t,n,e){let r=/^(\w+)\s+((?:\|\||o\||\|o|\}\||\}o|o\{|\|\{|\{o))(--|\.\.)(\|\||o\||\|o|\}\||\}o|o\{|\|\{|\{o)\s+(\w+)\s*:\s*(.+)$/,s=t.match(r);if(!s){e.diagnostics.push(L("Invalid relation syntax",n,["Expected: Entity1 ||--|| Entity2 : label"]));return}let[,i,o,a,c,l,d]=s,h=vt[o],u=vt[c],f=a==="--";if(!h||!u){e.diagnostics.push(L("Invalid cardinality syntax",n,["Expected: ||, o|, }|, |{, o{, or {o"]));return}Mt(i,n,e),Mt(l,n,e),e.relations.push({from:i,to:l,fromCardinality:h,toCardinality:u,label:d,identifying:f,span:n})}function Mt(t,n,e){e.entities.has(t)||e.entities.set(t,{id:t,attributes:[],span:n})}var ve=[{regex:/^([\w-]+)\(\(\((.+?)\)\)\)/,shape:"doublecircle"},{regex:/^([\w-]+)\(\[(.+?)\]\)/,shape:"stadium"},{regex:/^([\w-]+)\(\((.+?)\)\)/,shape:"circle"},{regex:/^([\w-]+)\[\[(.+?)\]\]/,shape:"subroutine"},{regex:/^([\w-]+)\[\((.+?)\)\]/,shape:"cylinder"},{regex:/^([\w-]+)\[\/(.+?)\\\]/,shape:"trapezoid"},{regex:/^([\w-]+)\[\\(.+?)\/\]/,shape:"trapezoid-alt"},{regex:/^([\w-]+)>(.+?)\]/,shape:"asymmetric"},{regex:/^([\w-]+)\{\{(.+?)\}\}/,shape:"hexagon"},{regex:/^([\w-]+)\[(.+?)\]/,shape:"rectangle"},{regex:/^([\w-]+)\((.+?)\)/,shape:"rounded"},{regex:/^([\w-]+)\{(.+?)\}/,shape:"diamond"}],Me=/^([\w-]+)/,_e=/^:::([\w][\w-]*)/,Ee=/^(<)?(-->|-.->|==>|---|-\.-|===)(?:\|([^|]*)\|)?/;function _t(t,n=!1){let e=t.split(/[\n;]/).map(i=>i.trim()).filter(i=>i.length>0&&!i.startsWith("%%"));if(e.length===0)return{ast:null,diagnostics:[L("Empty diagram",z(1,1,0,0))]};let r={nodes:new Map,edges:[],subgraphs:[],classDefs:new Map,classAssignments:new Map,nodeStyles:new Map,diagnostics:[],direction:"TD",subgraphStack:[],startCount:0,endCount:0},s=e[0];if(n)Le(e,r,t);else{let i=s.match(/^(?:graph|flowchart)\s+(TD|TB|LR|BT|RL)\s*$/i);i?r.direction=i[1].toUpperCase():r.diagnostics.push(H(`Invalid header: "${s}". Expected "graph TD", "flowchart LR", etc.`,Y(t,0))),Ce(e,r,t)}if(r.subgraphStack.length>0)for(r.diagnostics.push(H(`Unclosed subgraph: ${r.subgraphStack[r.subgraphStack.length-1].id}`,z(1,1,0,0)));r.subgraphStack.length>0;){let i=r.subgraphStack.pop();r.subgraphStack.length>0?r.subgraphStack[r.subgraphStack.length-1].children.push(i):r.subgraphs.push(i)}return{ast:{type:"flowchart",direction:r.direction,nodes:r.nodes,edges:r.edges,subgraphs:r.subgraphs,classDefs:r.classDefs,classAssignments:r.classAssignments,nodeStyles:r.nodeStyles,span:z(1,1,0,t.length)},diagnostics:r.diagnostics}}function Ce(t,n,e){for(let r=1;r<t.length;r++){let s=t[r],i=Y(e,r),o=s.match(/^classDef\s+(\w+)\s+(.+)$/);if(o){n.classDefs.set(o[1],Pt(o[2]));continue}let a=s.match(/^class\s+([\w,-]+)\s+(\w+)$/);if(a){for(let h of a[1].split(",").map(u=>u.trim()))n.classAssignments.set(h,a[2]);continue}let c=s.match(/^style\s+([\w,-]+)\s+(.+)$/);if(c){let h=Pt(c[2]);for(let u of c[1].split(",").map(f=>f.trim()))n.nodeStyles.set(u,{...n.nodeStyles.get(u),...h});continue}let l=s.match(/^direction\s+(TD|TB|LR|BT|RL)\s*$/i);if(l&&n.subgraphStack.length>0){n.subgraphStack[n.subgraphStack.length-1].direction=l[1].toUpperCase();continue}let d=s.match(/^subgraph\s+(.+)$/);if(d){let h=d[1].trim(),u=h.match(/^([\w-]+)\s*\[(.+)\]$/),f,g;u?(f=u[1],g=u[2]):(g=h,f=h.replace(/\s+/g,"_").replace(/[^\w]/g,""));let m={id:f,label:g,nodeIds:[],children:[],span:i};n.subgraphStack.push(m);continue}if(s==="end"){let h=n.subgraphStack.pop();h&&(n.subgraphStack.length>0?n.subgraphStack[n.subgraphStack.length-1].children.push(h):n.subgraphs.push(h));continue}Pe(s,i,n)}}function Le(t,n,e){for(let r=1;r<t.length;r++){let s=t[r],i=Y(e,r),o=s.match(/^direction\s+(TD|TB|LR|BT|RL)\s*$/i);if(o){n.subgraphStack.length>0?n.subgraphStack[n.subgraphStack.length-1].direction=o[1].toUpperCase():n.direction=o[1].toUpperCase();continue}let a=s.match(/^state\s+(?:"([^"]+)"\s+as\s+)?(\w+)\s*\{$/);if(a){let h=a[1]??a[2],f={id:a[2],label:h,nodeIds:[],children:[],span:i};n.subgraphStack.push(f);continue}if(s==="}"){let h=n.subgraphStack.pop();h&&(n.subgraphStack.length>0?n.subgraphStack[n.subgraphStack.length-1].children.push(h):n.subgraphs.push(h));continue}let c=s.match(/^state\s+"([^"]+)"\s+as\s+(\w+)\s*$/);if(c){U(n,{id:c[2],label:c[1],shape:"rounded",span:i});continue}let l=s.match(/^(\[\*\]|[\w-]+)\s*(-->)\s*(\[\*\]|[\w-]+)(?:\s*:\s*(.+))?$/);if(l){let h=l[1],u=l[3],f=l[4]?.trim()||void 0;h==="[*]"?(n.startCount++,h=`_start${n.startCount>1?n.startCount:""}`,U(n,{id:h,label:"",shape:"state-start",span:i})):Lt(n,h,i),u==="[*]"?(n.endCount++,u=`_end${n.endCount>1?n.endCount:""}`,U(n,{id:u,label:"",shape:"state-end",span:i})):Lt(n,u,i),n.edges.push({source:h,target:u,label:f,style:"solid",hasArrowStart:!1,hasArrowEnd:!0,span:i});continue}let d=s.match(/^([\w-]+)\s*:\s*(.+)$/);if(d){U(n,{id:d[1],label:d[2].trim(),shape:"rounded",span:i});continue}}}function Pe(t,n,e){let r=t.trim(),s=Et(r,n,e);if(!s||s.ids.length===0){r.length>0&&e.diagnostics.push(H(`Skipping unrecognized line: ${t}`,n));return}r=s.remaining.trim();let i=s.ids,o=!1;for(;r.length>0;){let a=r.match(Ee);if(!a)break;let c=!!a[1],l=a[2],d=a[3]?.trim()||void 0;r=r.slice(a[0].length).trim();let h=Ie(l),u=l.endsWith(">"),f=Et(r,n,e);if(!f||f.ids.length===0)break;r=f.remaining.trim();for(let g of i)for(let m of f.ids)e.edges.push({source:g,target:m,label:d,style:h,hasArrowStart:c,hasArrowEnd:u,span:n});o=!0,i=f.ids}(r.length>0||!o&&s.remaining.trim().length>0)&&e.diagnostics.push(H(`Skipping unrecognized line: ${t}`,n))}function Et(t,n,e){let r=Ct(t,n,e);if(!r)return null;let s=[r.id],i=r.remaining.trim();for(;i.startsWith("&");){i=i.slice(1).trim();let o=Ct(i,n,e);if(!o)break;s.push(o.id),i=o.remaining.trim()}return{ids:s,remaining:i}}function Ct(t,n,e){let r=null,s=t;for(let{regex:o,shape:a}of ve){let c=t.match(o);if(c){r=c[1];let l=c[2];U(e,{id:r,label:l,shape:a,span:n}),s=t.slice(c[0].length);break}}if(r===null){let o=t.match(Me);o&&(r=o[1],e.nodes.has(r)?ut(e,r):U(e,{id:r,label:r,shape:"rectangle",span:n}),s=t.slice(o[0].length))}if(r===null)return null;let i=s.match(_e);return i&&(e.classAssignments.set(r,i[1]),s=s.slice(i[0].length)),{id:r,remaining:s}}function U(t,n){t.nodes.has(n.id)||t.nodes.set(n.id,n),ut(t,n.id)}function ut(t,n){if(t.subgraphStack.length>0){let e=t.subgraphStack[t.subgraphStack.length-1];e.nodeIds.includes(n)||e.nodeIds.push(n)}}function Lt(t,n,e){t.nodes.has(n)?ut(t,n):U(t,{id:n,label:n,shape:"rounded",span:e})}function Ie(t){return t==="-.->"||t==="-.-"?"dotted":t==="==>"||t==="==="?"thick":"solid"}function Pt(t){let n={};for(let e of t.split(",")){let r=e.indexOf(":");if(r>0){let s=e.slice(0,r).trim(),i=e.slice(r+1).trim();s&&i&&(n[s]=i)}}return n}function Ne(t){let n={sections:new Map,currentSection:"",diagnostics:[]},e=t.split(`
`);for(let i=0;i<e.length;i++){let a=e[i].trim();if(!a||a.startsWith("%%")||i===0&&/^gantt\s*$/i.test(a))continue;let c=Y(t,i);if(/^title\s+(.+)$/i.test(a)){let l=a.match(/^title\s+(.+)$/i);l&&(n.title=l[1].trim());continue}if(/^dateFormat\s+(.+)$/i.test(a)){let l=a.match(/^dateFormat\s+(.+)$/i);l&&(n.dateFormat=l[1].trim());continue}if(/^section\s+(.+)$/i.test(a)){let l=a.match(/^section\s+(.+)$/i);l&&(n.currentSection=l[1].trim(),n.sections.has(n.currentSection)||n.sections.set(n.currentSection,[]));continue}n.currentSection?Te(a,c,n):n.diagnostics.push(H(`Task defined before any section: ${a}`,c))}let r=Array.from(n.sections.entries()).map(([i,o])=>({name:i,tasks:o}));return{ast:{type:"gantt",title:n.title,dateFormat:n.dateFormat,sections:r,span:z(1,1,0,t.length)},diagnostics:n.diagnostics}}function Te(t,n,e){let r=/^(?:(done|active|crit|milestone)\s+)?([^:]+)\s*:\s*(?:(\w+),\s*)?(.+)$/,s=t.match(r);if(!s){e.diagnostics.push(L("Invalid task syntax",n,["Expected: [status] label : [id,] timing"]));return}let[,i,o,a,c]=s,l=i,d={label:o.trim(),status:l,id:a,section:e.currentSection,span:n},h=c.match(/^after\s+(\w+)(?:,\s*(.+))?$/);if(h)d.afterId=h[1],h[2]&&(d.duration=h[2].trim());else{let f=c.split(",").map(g=>g.trim());if(f.length===2){let[g,m]=f;d.startDate=g,/^\d+d$/.test(m)?d.duration=m:d.endDate=m}else f.length===1&&(d.startDate=f[0])}let u=e.sections.get(e.currentSection);u&&u.push(d)}function De(t){let n={root:null,nodeStack:[],diagnostics:[],nodeIdCounter:0},e=t.split(`
`);for(let s=0;s<e.length;s++){let i=e[s],o=i.trim();if(!o||o.startsWith("%%")||s===0&&/^mindmap\s*$/i.test(o))continue;let a=Y(t,s),c=He(i),l=ze(o,a,n);l&&(n.root===null?(n.root=l,n.nodeStack=[{node:l,indent:c}]):Re(l,c,n))}return n.root?{ast:{type:"mindmap",root:n.root,span:z(1,1,0,t.length)},diagnostics:n.diagnostics}:(n.diagnostics.push(L("Mindmap must have at least one root node",z(1,1,0,0))),{ast:null,diagnostics:n.diagnostics})}function ze(t,n,e){let r={"((":"circle","(":"rounded","))":"bang",")":"cloud","{{":"hexagon"},s=t,i="default";for(let[o,a]of Object.entries(r)){let c=o.split("").reverse().join(""),l=new RegExp(`^\\${o.split("").join("\\")}(.+?)\\${c.split("").join("\\")}$`),d=t.match(l);if(d){s=d[1],i=a;break}}return s?{id:`node-${e.nodeIdCounter++}`,label:s,shape:i,children:[],span:n}:(e.diagnostics.push(H(`Empty node label: ${t}`,n)),null)}function He(t){let n=0;for(let e of t)if(e===" ")n++;else if(e==="	")n+=2;else break;return n}function Re(t,n,e){for(;e.nodeStack.length>0&&e.nodeStack[e.nodeStack.length-1].indent>=n;)e.nodeStack.pop();if(e.nodeStack.length===0){e.diagnostics.push(H(`Node at same or lower indent than root: ${t.label}`,t.span));return}e.nodeStack[e.nodeStack.length-1].node.children.push(t),e.nodeStack.push({node:t,indent:n})}function We(t){let n={slices:[],showData:!1,diagnostics:[]},e=t.split(`
`);for(let s=0;s<e.length;s++){let o=e[s].trim();if(!o||o.startsWith("%%")||s===0&&/^pie\s*$/i.test(o))continue;let a=Y(t,s);if(/^pie\s+showData\s*$/i.test(o)){n.showData=!0;continue}if(/^title\s+(.+)$/i.test(o)){let l=o.match(/^title\s+(.+)$/i);l&&(n.title=l[1].trim());continue}let c=o.match(/^"([^"]+)"\s*:\s*(\d+(?:\.\d+)?)$/);if(c){let[,l,d]=c,h=Number.parseFloat(d);if(Number.isNaN(h)||h<0){n.diagnostics.push(L("Slice value must be a non-negative number",a));continue}n.slices.push({label:l,value:h,span:a});continue}n.diagnostics.push(H(`Skipping unrecognized line: ${o}`,a))}return{ast:{type:"pie",title:n.title,showData:n.showData,slices:n.slices,span:z(1,1,0,t.length)},diagnostics:n.diagnostics}}var Ye=[{pattern:/-->>/,type:"dashed"},{pattern:/->>/,type:"solid"},{pattern:/-\)/,type:"open"},{pattern:/-x/,type:"cross"}];function Xe(t){let n={participants:new Map,messages:[],diagnostics:[],blockStack:[]},e=t.split(`
`);for(let s=0;s<e.length;s++){let o=e[s].trim();if(!o||o.startsWith("%%")||s===0&&/^sequenceDiagram\s*$/i.test(o))continue;let a=Y(t,s);o.startsWith("participant")||o.startsWith("actor")?Oe(o,a,n):o.startsWith("Note")?Fe(o,a,n):o.startsWith("loop")||o.startsWith("alt")||o.startsWith("opt")||o.startsWith("par")||o.startsWith("critical")||o.startsWith("break")||o.startsWith("rect")?Ue(o,a,n):o==="end"?Ke(a,n):o.startsWith("else")||o.startsWith("and")?Ge(o,a,n):o.includes("-->>")||o.includes("->>")||o.includes("-x")||o.includes("-)")?Be(o,a,n):o.startsWith("activate")||o.startsWith("deactivate")?je(o,a,n):n.diagnostics.push(H(`Skipping unrecognized line: ${o}`,a))}return n.blockStack.length>0&&n.diagnostics.push(H(`Unclosed block: ${n.blockStack[n.blockStack.length-1].block.type}`,z(1,1,0,0))),{ast:{type:"sequence",participants:Array.from(n.participants.values()),messages:n.messages,span:z(1,1,0,t.length)},diagnostics:n.diagnostics}}function Oe(t,n,e){let r=t.match(/^(participant|actor)\s+(\w+)(?:\s+as\s+(.+))?$/);if(!r){e.diagnostics.push(L("Invalid participant syntax",n,["Expected: participant id as label"]));return}let[,s,i,o]=r,a={id:i,label:o||i,type:s,span:n};e.participants.set(i,a)}function Be(t,n,e){for(let{pattern:r,type:s}of Ye)if(r.test(t)){let i=t.split(r);if(i.length!==2){e.diagnostics.push(L("Invalid message syntax",n,["Expected: participant1 ->> participant2: message"]));return}let o=i[0].trim(),a=i[1].trim(),c,l,d=!1,h=!1;if(a.includes(":")){let[f,...g]=a.split(":");c=f.trim(),l=g.join(":").trim()}else c=a,l="";o.endsWith("+")&&(o=o.slice(0,-1).trim(),d=!0),o.endsWith("-")&&(o=o.slice(0,-1).trim(),h=!0),K(o,n,e),K(c,n,e);let u={from:o,to:c,label:l,arrowType:s,activate:d||void 0,deactivate:h||void 0,span:n};e.blockStack.length>0?e.blockStack[e.blockStack.length-1].currentSection.messages.push(u):e.messages.push(u);return}e.diagnostics.push(L("Invalid message arrow",n,["Expected one of: ->>, -->>, -), -x"]))}function Fe(t,n,e){let r=t.match(/^Note\s+left\s+of\s+(\w+):\s*(.+)$/);if(r){let[,o,a]=r;K(o,n,e),dt({placement:"left",participants:[o],text:a,span:n},e);return}let s=t.match(/^Note\s+right\s+of\s+(\w+):\s*(.+)$/);if(s){let[,o,a]=s;K(o,n,e),dt({placement:"right",participants:[o],text:a,span:n},e);return}let i=t.match(/^Note\s+over\s+([\w,\s]+):\s*(.+)$/);if(i){let[,o,a]=i,c=o.split(",").map(d=>d.trim());for(let d of c)K(d,n,e);dt({placement:"over",participants:c,text:a,span:n},e);return}e.diagnostics.push(L("Invalid note syntax",n))}function Ue(t,n,e){let r=t.match(/^(loop|alt|opt|par|critical|break|rect)(?:\s+(.+))?$/);if(!r){e.diagnostics.push(L("Invalid block syntax",n));return}let[,s,i]=r,o={type:s,label:i||"",sections:[],span:n},a={label:void 0,messages:[]};o.sections.push(a),e.blockStack.push({block:o,currentSection:a})}function Ge(t,n,e){if(e.blockStack.length===0){e.diagnostics.push(L("Unexpected block section outside block",n));return}let r=t.match(/^(else|and)(?:\s+(.+))?$/);if(!r){e.diagnostics.push(L("Invalid block section syntax",n));return}let[,,s]=r,i={label:s,messages:[]},o=e.blockStack[e.blockStack.length-1];o.block.sections.push(i),o.currentSection=i}function Ke(t,n){if(n.blockStack.length===0){n.diagnostics.push(L("Unexpected 'end' without block",t));return}let{block:e}=n.blockStack.pop();n.blockStack.length>0?n.blockStack[n.blockStack.length-1].currentSection.messages.push(e):n.messages.push(e)}function je(t,n,e){let r=t.match(/^(activate|deactivate)\s+(\w+)$/);if(!r){e.diagnostics.push(L("Invalid activation syntax",n));return}let[,s,i]=r;K(i,n,e),e.diagnostics.push(H(`Standalone ${s} not fully supported, use +/- on messages`,n))}function K(t,n,e){e.participants.has(t)||e.participants.set(t,{id:t,label:t,type:"participant",span:n})}function dt(t,n){n.blockStack.length>0?n.blockStack[n.blockStack.length-1].currentSection.messages.push(t):n.messages.push(t)}function j(t){let n=It(t);if(!n)return{ast:null,diagnostics:[L("Unable to detect diagram type",z(1,1,0,0),["Expected first line to be one of: graph/flowchart, sequenceDiagram, classDiagram, erDiagram, stateDiagram-v2"])]};switch(n){case"flowchart":return _t(t,!1);case"state":return _t(t,!0);case"sequence":return Xe(t);case"class":return me(t);case"er":return ke(t);case"pie":return We(t);case"gantt":return Ne(t);case"mindmap":return De(t)}}var ft={normal:.52,medium:.55,bold:.58};function it(t,n,e=400){let r=e>=600?ft.bold:e>=500?ft.medium:ft.normal;return t.length*n*r}function Dt(t,n,e=14){let r=t.split(`
`),s=Math.max(...r.map(c=>it(c,e))),i=r.length*e*1.2,o,a;switch(n){case"state-start":{o=28,a=28;break}case"state-end":{o=32,a=32;break}case"diamond":case"rhombus":{o=s*1.6+32,a=i*1.6+24;break}case"circle":case"doublecircle":{let c=Math.max(s,i)+32;o=c,a=c;break}case"stadium":case"pill":{o=s+i+16,a=i+16;break}case"hexagon":{o=s+48,a=i+24;break}case"trapezoid":case"inv-trapezoid":{o=s+56,a=i+24;break}case"odd":case"lean-right":case"lean-left":{o=s+40,a=i+24;break}case"class-box":{o=s+32,a=i+24;break}case"er-entity":{let c=t.split(`
`),l=c.includes("---"),d=e*1.2+16;if(l){let h=c.filter(b=>b!=="---"&&b!==c[0]),u=it(c[0]||"",e,600),f=h.map(b=>it(b,e-2)),g=f.length>0?Math.max(...f):0;o=Math.max(u,g)+48;let m=h.length*(e-2)*1.4+12;a=d+m}else{let h=it(c[0]||"",e,600);o=Math.max(h+40,120),a=d+24}break}default:{o=s+24,a=i+16;break}}return{width:o,height:a}}var qe=class{nodes=new Map;edges=new Map;inEdges=new Map;outEdges=new Map;children=new Map;addNode(t,n,e=0,r=0){this.nodes.set(t,{id:t,data:n,width:e,height:r}),this.inEdges.has(t)||this.inEdges.set(t,new Set),this.outEdges.has(t)||this.outEdges.set(t,new Set)}removeNode(t){let n=this.inEdges.get(t);if(n)for(let s of n)this.removeEdge(s,t);let e=this.outEdges.get(t);if(e)for(let s of e)this.removeEdge(t,s);this.nodes.delete(t),this.inEdges.delete(t),this.outEdges.delete(t);let r=this.nodes.get(t)?.parent;r&&this.children.get(r)?.delete(t)}addEdge(t,n,e,r=1){let s=`${t}->${n}`;this.edges.set(s,{source:t,target:n,data:e,weight:r}),this.outEdges.has(t)||this.outEdges.set(t,new Set),this.inEdges.has(n)||this.inEdges.set(n,new Set),this.outEdges.get(t).add(n),this.inEdges.get(n).add(t)}removeEdge(t,n){let e=`${t}->${n}`;this.edges.delete(e),this.outEdges.get(t)?.delete(n),this.inEdges.get(n)?.delete(t)}setParent(t,n){let e=this.nodes.get(t);e&&(e.parent=n,this.children.has(n)||this.children.set(n,new Set),this.children.get(n).add(t))}getNode(t){return this.nodes.get(t)}getEdge(t,n){return this.edges.get(`${t}->${n}`)}predecessors(t){return Array.from(this.inEdges.get(t)||[])}successors(t){return Array.from(this.outEdges.get(t)||[])}sources(){let t=[];for(let n of this.nodes.keys())(this.inEdges.get(n)?.size||0)===0&&t.push(n);return t}sinks(){let t=[];for(let n of this.nodes.keys())(this.outEdges.get(n)?.size||0)===0&&t.push(n);return t}nodeIds(){return Array.from(this.nodes.keys())}getEdges(){return Array.from(this.edges.values())}getChildren(t){return Array.from(this.children.get(t)||[])}reverseEdge(t,n){let e=this.getEdge(t,n);e&&(this.removeEdge(t,n),this.addEdge(n,t,e.data,e.weight))}hasEdge(t,n){return this.edges.has(`${t}->${n}`)}nodeCount(){return this.nodes.size}edgeCount(){return this.edges.size}};function Ve(t){let n=new Set,e=new Set,r=[];function s(o){n.add(o),e.add(o);let a=t.successors(o);for(let c of a)n.has(c)?e.has(c)&&(t.reverseEdge(o,c),r.push({source:o,target:c})):s(c);e.delete(o)}let i=t.sources();if(i.length===0){let o=t.nodeIds();o.length>0&&s(o[0])}else for(let o of i)n.has(o)||s(o);for(let o of t.nodeIds())n.has(o)||s(o);return r}function Qe(t,n){for(let e of n)t.reverseEdge(e.target,e.source)}function Ze(t){let n=new Map,e=[],r=[];for(let s of t.nodeIds()){let i=t.predecessors(s).length;n.set(s,i),i===0&&e.push(s)}for(;e.length>0;){e.sort();let s=e.shift();r.push(s);for(let i of t.successors(s)){let o=n.get(i)-1;n.set(i,o),o===0&&e.push(i)}}return r}function Je(t){let n=new Map,e=Ze(t);for(let s of e){let i=t.predecessors(s);if(i.length===0)n.set(s,0);else{let o=Math.max(...i.map(a=>n.get(a)??0));n.set(s,o+1)}}let r=Math.max(...Array.from(n.values()));return{layers:n,maxLayer:r}}function tn(t,n){let e=new Map,r=t.getEdges(),s=0;for(let i of r){let o=n.get(i.source)??0,c=(n.get(i.target)??0)-o;if(c>1){let l=[],d=i.source;for(let h=1;h<c;h++){let u=`__virtual_${s++}`;t.addNode(u,i.data,0,0),n.set(u,o+h),t.addEdge(d,u,i.data,i.weight),l.push(u),d=u}t.addEdge(d,i.target,i.data,i.weight),t.removeEdge(i.source,i.target),e.set(`${i.source}->${i.target}`,l)}}return e}function en(t,n){let e=Array.from({length:n+1},()=>[]);for(let[r,s]of t)e[s].push(r);for(let r of e)r.sort();return e}function zt(t,n){let e=0;for(let r=0;r<n.length-1;r++){let s=n[r],i=n[r+1],o=new Map;for(let a=0;a<i.length;a++)o.set(i[a],a);for(let a=0;a<s.length;a++){let c=s[a],l=t.successors(c);for(let d=a+1;d<s.length;d++){let h=s[d],u=t.successors(h);for(let f of l){let g=o.get(f);if(g!==void 0)for(let m of u){let b=o.get(m);b!==void 0&&g>b&&e++}}}}}return e}function Ht(t,n,e,r){let s=new Map;for(let o=0;o<e.length;o++)s.set(e[o],o);let i=n.map(o=>{let c=(r?t.predecessors(o):t.successors(o)).filter(d=>s.has(d));if(c.length===0)return{nodeId:o,weight:0};let l=c.reduce((d,h)=>d+s.get(h),0);return{nodeId:o,weight:l/c.length}});return i.sort((o,a)=>o.weight!==a.weight?o.weight-a.weight:o.nodeId.localeCompare(a.nodeId)),i.map(o=>o.nodeId)}function nn(t,n){let e=n.map(o=>[...o]),r=zt(t,e);if(r===0)return e;let s=24,i=e.map(o=>[...o]);for(let o=0;o<s;o++){if(o%2===0)for(let l=1;l<i.length;l++)i[l]=Ht(t,i[l],i[l-1],!0);else for(let l=i.length-2;l>=0;l--)i[l]=Ht(t,i[l],i[l+1],!1);let c=zt(t,i);if(c<r&&(r=c,e=i.map(l=>[...l]),r===0))break}return e}function rn(t){return t==="LR"||t==="RL"}function sn(t,n,e,r){let s=new Map,i=[];for(let a=0;a<n.length;a++){let c=Math.max(...n[a].map(l=>{let d=t.getNode(l);return d?r?d.width:d.height:0}));i.push(c)}let o=i[0]/2;for(let a=0;a<n.length;a++)a>0&&(o+=i[a-1]/2+e+i[a]/2),s.set(a,o);return s}function on(t,n,e,r){let s=new Map;for(let i of n){let o=0;for(let l of i){let d=t.getNode(l);if(!d)continue;let h=r?d.height:d.width;s.set(l,o+h/2),o+=h+e}let c=(o-e)/2;for(let l of i)s.set(l,s.get(l)-c)}return s}function st(t,n,e,r,s){for(let i of n){let o=i.map(a=>({nodeId:a,pos:e.get(a)})).sort((a,c)=>a.pos-c.pos);for(let a=1;a<o.length;a++){let c=t.getNode(o[a-1].nodeId),l=t.getNode(o[a].nodeId);if(!c||!l)continue;let d=s?c.height:c.width,h=s?l.height:l.width,u=o[a-1].pos+d/2+r+h/2;o[a].pos<u&&(o[a].pos=u,e.set(o[a].nodeId,u))}}}function an(t,n,e,r,s){let i=new Map(e),o=24,a=.5,c=d=>d.startsWith("__virtual_"),l=.2;for(let d=0;d<o;d++){let h=new Map;for(let u of n)for(let f of u){let g=[...t.predecessors(f),...t.successors(f)];if(g.length===0){h.set(f,i.get(f));continue}let m=0,b=0;for(let w of g){let k=c(w)&&!c(f)?l:1;m+=(i.get(w)??0)*k,b+=k}let p=m/b,x=i.get(f),y=x+(p-x)*a;h.set(f,y)}st(t,n,h,r,s),i.clear();for(let[u,f]of h)i.set(u,f)}return i}function cn(t,n,e,r,s){let i=new Map(e);for(let o=0;o<4;o++){for(let a of n)for(let c of a){let l=t.predecessors(c),d=t.successors(c),h=null;if(l.length===1){let u=l[0];t.successors(u).length===1&&(h=i.get(u))}if(h===null&&d.length===1){let u=d[0];t.predecessors(u).length===1&&(h=i.get(u))}h!==null&&i.set(c,h)}st(t,n,i,r,s)}return i}function ln(t,n,e,r,s){let i=new Map(e),o=a=>a.startsWith("__virtual_");for(let a=0;a<8;a++){if(a%2===0)for(let l=0;l<n.length;l++){let d=n[l];for(let h of d){let u=t.successors(h);if(u.length<2)continue;let f=n[l+1];if(!f)continue;let g=u.filter(k=>f.includes(k));if(g.length<2)continue;let m=g.filter(k=>!o(k)),b=m.length>=2?m:g,p=i.get(h),x=b.map(k=>i.get(k)),y=(Math.min(...x)+Math.max(...x))/2,w=p-y;if(!(Math.abs(w)<1))for(let k of g)i.set(k,i.get(k)+w)}}else for(let l=n.length-1;l>=0;l--){let d=n[l];for(let h of d){if(o(h))continue;let u=t.predecessors(h);if(u.length<2)continue;let f=n[l-1];if(!f)continue;let g=u.filter(y=>f.includes(y)),m=g.filter(y=>!o(y)),b=m.length>=2?m:g;if(b.length<2)continue;let p=b.map(y=>i.get(y)),x=(Math.min(...p)+Math.max(...p))/2;i.set(h,x)}}st(t,n,i,r,s)}return i}function dn(t,n,e,r,s){let i=new Map(e),o=a=>a.startsWith("__virtual_");for(let a=0;a<8;a++){for(let c=0;c<n.length;c++){let l=n[c];for(let d of l){if(o(d))continue;let u=t.successors(d).filter(f=>!o(f)&&n[c+1]?.includes(f));if(u.length>=2){let f=i.get(d),g=u.map(p=>i.get(p)),m=(Math.min(...g)+Math.max(...g))/2,b=f-m;if(Math.abs(b)>1)for(let p of u)i.set(p,i.get(p)+b)}}}for(let c=n.length-1;c>=0;c--){let l=n[c];for(let d of l){if(o(d))continue;let h=t.predecessors(d),u=h.filter(f=>!o(f)&&n[c-1]?.includes(f));if(u.length>=2){let f=u.map(m=>i.get(m)),g=(Math.min(...f)+Math.max(...f))/2;i.set(d,g)}if(l.length===1){let f=h.filter(b=>!o(b)),g=t.successors(d).filter(b=>!o(b)),m=[...f,...g];if(m.length>0){let b=m.reduce((x,y)=>x+(i.get(y)??0),0)/m.length,p=i.get(d);i.set(d,p+(b-p)*.5)}}}}st(t,n,i,r,s)}return i}function hn(t,n){let e=Array.from(t.values()),r=Math.min(...e),s=new Map;for(let[i,o]of t)s.set(i,o-r+n);return s}function un(t,n,e,r,s,i){let o=rn(i),a=sn(t,n,r,o),c=on(t,n,e,o),l=an(t,n,c,e,o),d=cn(t,n,l,e,o),h=ln(t,n,d,e,o),u=dn(t,n,h,e,o),f=hn(u,s),g=new Map;for(let p=0;p<n.length;p++){let x=a.get(p)+s;for(let y of n[p]){let w=f.get(y);o?g.set(y,{x,y:w}):g.set(y,{x:w,y:x})}}if(i==="BT"||i==="RL"){let p=Math.max(...o?Array.from(g.values()).map(x=>x.x):Array.from(g.values()).map(x=>x.y));for(let[x,y]of g)o?g.set(x,{x:p-y.x+2*s,y:y.y}):g.set(x,{x:y.x,y:p-y.y+2*s})}let m=0,b=0;for(let[p,x]of g){let y=t.getNode(p);if(!y)continue;let w=x.x+y.width/2+s,k=x.y+y.height/2+s;w>m&&(m=w),k>b&&(b=k)}return{positions:g,width:m,height:b}}function fn(t,n,e){let r=new qe;for(let y of t)r.addNode(y.id,{},y.width,y.height);for(let y of n)r.addEdge(y.source,y.target,{},y.weight??1);let s=Ve(r),{layers:i,maxLayer:o}=Je(r),a=tn(r,i),c=en(i,o),l=nn(r,c),d=e.direction??"TB",h=e.nodeSpacing??50,u=e.layerSpacing??100,f=e.padding??20,{positions:g,width:m,height:b}=un(r,l,h,u,f,d);Qe(r,s);let p=new Map;for(let y of t){let w=g.get(y.id);w&&p.set(y.id,w)}let x=new Map;for(let y of n){let w=g.get(y.source),k=g.get(y.target);if(!w||!k)continue;let v=a.get(`${y.source}->${y.target}`)??[],S=[w];for(let _ of v){let C=g.get(_);C&&S.push(C)}S.push(k),x.set(`${y.source}->${y.target}`,S)}return{nodePositions:p,edgeRoutes:x,width:m,height:b}}function gn(t){return t==="LR"||t==="RL"}function pn(t,n){if(t.length<2)return t;let e=t[0],r=t[t.length-1],s=gn(n);if(t.length===2||t.length===3){if(s){if(Math.abs(e.y-r.y)<8)return[e,r];let a=(e.x+r.x)/2;return[e,{x:a,y:e.y},{x:a,y:r.y},r]}if(Math.abs(e.x-r.x)<8)return[e,r];let o=(e.y+r.y)/2;return[e,{x:e.x,y:o},{x:r.x,y:o},r]}let i=[e];for(let o=1;o<t.length-1;o++){let a=i[i.length-1],c=t[o];s?(i.push({x:c.x,y:a.y}),Math.abs(c.y-a.y)>1&&i.push({x:c.x,y:c.y})):(i.push({x:a.x,y:c.y}),Math.abs(c.x-a.x)>1&&i.push({x:c.x,y:c.y}))}return i.push(r),i}function Rt(t,n,e){let r=t.x-n.x,s=t.y-n.y,i=n.width/2,o=n.height/2;switch(e){case"circle":case"doublecircle":case"state-start":case"state-end":{let a=Math.max(i,o),c=Math.atan2(s,r);return{x:n.x+a*Math.cos(c),y:n.y+a*Math.sin(c)}}case"diamond":case"rhombus":{let a=Math.atan2(s,r),c=Math.abs(a);if(c<Math.PI/4||c>3*Math.PI/4){let d=i/Math.abs(Math.cos(a)),h=n.x+d*Math.cos(a),u=n.y+d*Math.sin(a);if(Math.abs(u-n.y)<=o)return{x:h,y:u}}let l=o/Math.abs(Math.sin(a));return{x:n.x+l*Math.cos(a),y:n.y+l*Math.sin(a)}}case"hexagon":{let a=Math.atan2(s,r),c=Math.PI/3;if(Math.abs(a)<c||Math.abs(a)>Math.PI-c){let d=i/Math.abs(Math.cos(a));return{x:n.x+d*Math.cos(a),y:n.y+d*Math.sin(a)}}let l=o/Math.abs(Math.sin(a));return{x:n.x+l*Math.cos(a),y:n.y+l*Math.sin(a)}}default:{let a=Math.atan2(s,r);if(Math.abs(Math.cos(a))*o>Math.abs(Math.sin(a))*i){let l=i/Math.abs(Math.cos(a));return{x:n.x+l*Math.cos(a),y:n.y+l*Math.sin(a)}}let c=o/Math.abs(Math.sin(a));return{x:n.x+c*Math.cos(a),y:n.y+c*Math.sin(a)}}}}function Xt(t,n,e,r,s,i){let o=pn(e,i);if(o.length<2)return o;let a=o.length>2?o[1]:o[o.length-1],c=o.length>2?o[o.length-2]:o[0],l=Rt(a,t,r),d=Rt(c,n,s),h=o.length>2?o.slice(1,-1):[];return[l,...h,d]}function mt(t){if(t.length===0)return{x:0,y:0};let n=0,e=[];for(let i=0;i<t.length-1;i++){let o=t[i+1].x-t[i].x,a=t[i+1].y-t[i].y,c=Math.sqrt(o*o+a*a);e.push(c),n+=c}let r=n/2,s=0;for(let i=0;i<e.length;i++){if(s+e[i]>=r){let o=(r-s)/e[i];return{x:t[i].x+(t[i+1].x-t[i].x)*o,y:t[i].y+(t[i+1].y-t[i].y)*o}}s+=e[i]}return t[Math.floor(t.length/2)]}function mn(t,n){let e=n.padding??20,r=n.nodeSpacing??60,s=n.layerSpacing??30,i=t.participants,o=120,a=40,c=[],l=new Map;for(let g=0;g<i.length;g++){let m=i[g],b=e+g*(o+r),p=e;l.set(m.id,b),c.push({id:m.id,label:m.label,shape:m.type,x:b,y:p,width:o,height:a})}let d=[],h=e+a+s;for(let g of t.messages)if("from"in g&&"to"in g){let m=g,b=l.get(m.from)??e,p=l.get(m.to)??e,x=[{x:b+o/2,y:h},{x:p+o/2,y:h}];d.push({source:m.from,target:m.to,label:m.label,style:m.arrowType==="solid"?"solid":"dotted",hasArrowStart:!1,hasArrowEnd:!0,points:x,labelPosition:mt(x)}),h+=s}let u=e+i.length*o+(i.length-1)*r+e,f=h+e;for(let g of i){let b=(l.get(g.id)??e)+o/2;d.unshift({source:g.id,target:g.id,style:"dotted",hasArrowStart:!1,hasArrowEnd:!1,points:[{x:b,y:e+a},{x:b,y:f-e}]})}return{width:u,height:f,nodes:c,edges:d,groups:[]}}function bn(t,n){let e=n.padding??20,r=120,s=e+r,i=t.title?30:0,o=e+i+r,a=t.slices.reduce((u,f)=>u+f.value,0);if(a===0)return{width:e*2,height:e*2,nodes:[],edges:[],groups:[]};let c=[],l=-Math.PI/2;for(let u=0;u<t.slices.length;u++){let f=t.slices[u],g=f.value/a*Math.PI*2,m=l+g/2,b=r*.65,p=s+b*Math.cos(m),x=o+b*Math.sin(m);c.push({id:`slice-${u}`,label:f.label,shape:"pie-slice",x:p-30,y:x-12,width:60,height:24,inlineStyle:{cx:String(s),cy:String(o),radius:String(r),startAngle:String(l),endAngle:String(l+g),value:String(f.value),percent:String(Math.round(f.value/a*100)),index:String(u)}}),l+=g}t.title&&c.unshift({id:"pie-title",label:t.title,shape:"pie-title",x:s-80,y:e,width:160,height:24});let d=s+r+e,h=o+r+e;return{width:d,height:h,nodes:c,edges:[],groups:[]}}function Ot(t,n,e,r,s,i,o,a){let c=Math.max(t.label.length*9+20,60),l=32,d={default:"rounded",rounded:"rounded",circle:"circle",bang:"hexagon",cloud:"cloud",hexagon:"hexagon"};if(o.push({id:t.id,label:t.label,shape:d[t.shape]||"rounded",x:n-c/2,y:e-l/2,width:c,height:l}),t.children.length===0)return;let h=s/Math.max(t.children.length,1),u=r-s/2+h/2,f=120+i*30;for(let g=0;g<t.children.length;g++){let m=t.children[g],b=u+g*h,p=n+f*Math.cos(b),x=e+f*Math.sin(b);a.push({source:t.id,target:m.id,style:"solid",hasArrowStart:!1,hasArrowEnd:!1,points:[{x:n,y:e},{x:p,y:x}]}),Ot(m,p,x,b,h*1.2,i+1,o,a)}}function yn(t,n){let e=n.padding??40,r=[],s=[];Ot(t.root,300,300,0,Math.PI*2,0,r,s);let a=1/0,c=1/0,l=-1/0,d=-1/0;for(let m of r)a=Math.min(a,m.x),c=Math.min(c,m.y),l=Math.max(l,m.x+m.width),d=Math.max(d,m.y+m.height);let h=e-a,u=e-c;for(let m of r)m.x+=h,m.y+=u;for(let m of s)for(let b of m.points)b.x+=h,b.y+=u;let f=l-a+e*2,g=d-c+e*2;return{width:f,height:g,nodes:r,edges:s,groups:[]}}function xn(t,n){let e=n.padding??20,r=28,s=6,i=24,o=140,a=8,c=t.title?30:0;if(t.sections.flatMap(w=>w.tasks).length===0)return{width:e*2,height:e*2,nodes:[],edges:[],groups:[]};let d=0,h=100,u=0,f=new Map;for(let w of t.sections)for(let k of w.tasks){let v=u*15,S=30;if(k.afterId&&f.has(k.afterId)&&(v=f.get(k.afterId)),k.duration){let C=k.duration.match(/(\d+)d/);C?.[1]&&(S=parseInt(C[1]))}let _=v+S;k.id&&f.set(k.id,_),h=Math.max(h,_),u++}let g=(h-d)*a,m=[],b=[],p=e+c;u=0,t.title&&m.push({id:"gantt-title",label:t.title,shape:"gantt-title",x:e,y:e,width:o+g,height:24});for(let w of t.sections){let k=p;m.push({id:`section-${w.name}`,label:w.name,shape:"gantt-section",x:e,y:p,width:o+g,height:i}),p+=i+s;for(let S of w.tasks){let _=u*15,C=30;if(S.afterId&&f.has(S.afterId)?_=f.get(S.afterId):S.startDate&&(_=u*15),S.duration){let P=S.duration.match(/(\d+)d/);P?.[1]&&(C=parseInt(P[1]))}let $=e+o+(_-d)*a,M=C*a;m.push({id:S.id||`task-${u}`,label:S.label,shape:"gantt-bar",x:$,y:p,width:M,height:r,inlineStyle:{status:S.status||"default",labelX:String(e),labelWidth:String(o)}}),p+=r+s,u++}let v=p-k;b.push({id:`group-${w.name}`,label:w.name,x:e,y:k,width:o+g,height:v,children:[]})}let x=e+o+g+e,y=p+e;return{width:x,height:y,nodes:m,edges:[],groups:[]}}function wn(t){let n=Array.from(t.nodes.values()).map(r=>{let s=t.classAssignments.get(r.id),i=s?t.classDefs.get(s):void 0,o=t.nodeStyles.get(r.id),a={...i,...o};return{id:r.id,label:r.label,shape:r.shape,inlineStyle:Object.keys(a).length>0?a:void 0}}),e=t.edges.map(r=>({source:r.source,target:r.target,label:r.label,style:r.style,hasArrowStart:r.hasArrowStart,hasArrowEnd:r.hasArrowEnd}));return{nodes:n,edges:e}}function Wt(t){let n=t.visibility||"";if(t.isMethod){let r=t.returnType?`: ${t.returnType}`:"";return`${n}${t.name}()${r}`}let e=t.type?`: ${t.type}`:"";return`${n}${t.name}${e}`}function kn(t){let n=Array.from(t.classes.values()).map(r=>{let s=r.label||r.id,i=r.members.filter(h=>!h.isMethod).map(Wt),o=r.members.filter(h=>h.isMethod).map(Wt),a=[s];(i.length>0||o.length>0)&&(a.push("---"),a.push(...i)),o.length>0&&(a.push("---"),a.push(...o));let c=a.join(`
`),l=i.length,d=o.length;return{id:r.id,label:c,shape:"class-box",inlineStyle:{className:s,attrCount:String(l),methodCount:String(d)}}}),e=t.relations.map(r=>({source:r.from,target:r.to,label:r.label,style:r.type==="dependency"||r.type==="realization"?"dotted":"solid",hasArrowStart:!1,hasArrowEnd:r.type==="association"||r.type==="dependency",inlineStyle:{relationType:r.type}}));return{nodes:n,edges:e}}function $n(t){let n=t.keys.length>0?t.keys.join(","):"";return n?`${n} ${t.type} ${t.name}`:`${t.type} ${t.name}`}function An(t){let n=Array.from(t.entities.values()).map(r=>{let s=r.attributes.map($n),i=[r.id];s.length>0&&(i.push("---"),i.push(...s));let o=i.join(`
`);return{id:r.id,label:o,shape:"er-entity",inlineStyle:{entityName:r.id,attrCount:String(r.attributes.length)}}}),e=t.relations.map(r=>({source:r.from,target:r.to,label:r.label,style:r.identifying?"solid":"dotted",hasArrowStart:!1,hasArrowEnd:!1,inlineStyle:{fromCardinality:r.fromCardinality,toCardinality:r.toCardinality}}));return{nodes:n,edges:e}}function bt(t){let n=[...t.nodeIds];for(let e of t.children)n.push(...bt(e));return n}function Bt(t){let n=new Set;for(let e of t){for(let r of e.nodeIds)n.add(r);for(let r of Bt(e.children))n.add(r)}return n}function Sn(t,n,e,r,s){let i=Bt(e),o=new Map,a=new Set(e.map(f=>f.id)),c=16,l=24;for(let f of e){let g=new Set(bt(f)),m=t.filter(x=>g.has(x.id)),b=n.filter(x=>g.has(x.source)&&g.has(x.target)),p=pt(m,b,r,s);o.set(f.id,p)}let d=[],h=[],u=[];for(let f of t)if(!i.has(f.id))if(a.has(f.id)){let g=o.get(f.id);d.push({id:f.id,label:f.label,shape:f.shape,inlineStyle:{...f.inlineStyle,__megaNode:"true",__groupId:f.id,__innerWidth:String(g.width+c*2),__innerHeight:String(g.height+c*2+l)}})}else d.push(f);for(let f of e)if(!t.some(m=>m.id===f.id)){let m=o.get(f.id);d.push({id:f.id,label:f.label,shape:"rectangle",inlineStyle:{__megaNode:"true",__groupId:f.id,__innerWidth:String(m.width+c*2),__innerHeight:String(m.height+c*2+l)}})}for(let f of n){let g=i.has(f.source)&&!a.has(f.source),m=i.has(f.target)&&!a.has(f.target),b=g?Yt(f.source,e):void 0,p=m?Yt(f.target,e):void 0;if(g&&m){if(b===p)continue;h.push({...f,source:b,target:p})}else g?(u.push(f),h.push({...f,source:b})):m?(u.push(f),h.push({...f,target:p})):h.push(f)}return{innerLayouts:o,outerNodes:d,outerEdges:h,bridgeEdges:u,sgIds:a}}function Yt(t,n){for(let e of n)if(bt(e).includes(t))return e.id}function pt(t,n,e,r){let s=r??"TB",i=t.map(p=>{if(p.inlineStyle?.__megaNode)return{id:p.id,width:Number(p.inlineStyle.__innerWidth),height:Number(p.inlineStyle.__innerHeight)};let x=Dt(p.label,p.shape);return{id:p.id,width:x.width,height:x.height}}),o=n.map(p=>({source:p.source,target:p.target,weight:1})),a=fn(i,o,{...e,direction:s}),c=t.map(p=>{let x=a.nodePositions.get(p.id)??{x:0,y:0},y,w;if(p.inlineStyle?.__megaNode)y=Number(p.inlineStyle.__innerWidth),w=Number(p.inlineStyle.__innerHeight);else{let k=Dt(p.label,p.shape);y=k.width,w=k.height}return{id:p.id,label:p.label,shape:p.shape,x:x.x-y/2,y:x.y-w/2,width:y,height:w,inlineStyle:p.inlineStyle}}),l=new Map(c.map(p=>[p.id,p])),d=n.map(p=>{let x=l.get(p.source),y=l.get(p.target);if(!x||!y)return{source:p.source,target:p.target,label:p.label,style:p.style,hasArrowStart:p.hasArrowStart,hasArrowEnd:p.hasArrowEnd,points:[],inlineStyle:p.inlineStyle};let w=a.edgeRoutes.get(`${p.source}->${p.target}`)??[{x:x.x+x.width/2,y:x.y+x.height/2},{x:y.x+y.width/2,y:y.y+y.height/2}],k={x:x.x+x.width/2,y:x.y+x.height/2,width:x.width,height:x.height},v={x:y.x+y.width/2,y:y.y+y.height/2,width:y.width,height:y.height},S=Xt(k,v,w,x.shape,y.shape,s);return{source:p.source,target:p.target,label:p.label,style:p.style,hasArrowStart:p.hasArrowStart,hasArrowEnd:p.hasArrowEnd,points:S,labelPosition:p.label?mt(S):void 0,inlineStyle:p.inlineStyle}}),h=1/0,u=1/0,f=-1/0,g=-1/0;for(let p of c)h=Math.min(h,p.x),u=Math.min(u,p.y),f=Math.max(f,p.x+p.width),g=Math.max(g,p.y+p.height);for(let p of d)for(let x of p.points)h=Math.min(h,x.x),u=Math.min(u,x.y),f=Math.max(f,x.x),g=Math.max(g,x.y);if(!Number.isFinite(h))return{nodes:c,edges:d,width:0,height:0,groups:[]};let m=-h,b=-u;for(let p of c)p.x+=m,p.y+=b;for(let p of d){for(let x of p.points)x.x+=m,x.y+=b;p.labelPosition&&(p.labelPosition.x+=m,p.labelPosition.y+=b)}return{nodes:c,edges:d,width:f-h,height:g-u,groups:[]}}function gt(t,n,e,r,s){let i=e.direction??r??"TB";if(!s||s.length===0){let $=pt(t,n,e,i),M=e.padding??20;for(let P of $.nodes)P.x+=M,P.y+=M;for(let P of $.edges){for(let T of P.points)T.x+=M,T.y+=M;P.labelPosition&&(P.labelPosition.x+=M,P.labelPosition.y+=M)}return{width:$.width+M*2,height:$.height+M*2,nodes:$.nodes,edges:$.edges,groups:[]}}let{innerLayouts:o,outerNodes:a,outerEdges:c,sgIds:l}=Sn(t,n,s,e,i),d=pt(a,c,e,i),h=[],u=[],f=[],g=16,m=24;for(let $ of s){let M=d.nodes.find(E=>E.id===$.id);if(!M)continue;let P=o.get($.id),T=M.x+g,D=M.y+g+m;for(let E of P.nodes)h.push({...E,x:E.x+T,y:E.y+D});for(let E of P.edges)u.push({...E,points:E.points.map(I=>({x:I.x+T,y:I.y+D})),labelPosition:E.labelPosition?{x:E.labelPosition.x+T,y:E.labelPosition.y+D}:void 0});f.push({id:$.id,label:$.label,x:M.x,y:M.y,width:M.width,height:M.height,children:[]})}for(let $ of d.nodes)$.inlineStyle?.__megaNode||h.push($);let b=new Map(f.map($=>[$.id,{x:$.x,y:$.y,width:$.width,height:$.height}]));for(let $ of d.edges){let M=l.has($.source),P=l.has($.target);M||P||u.push($)}let p=new Map(h.map($=>[$.id,$])),x=new Set;for(let $ of d.edges){let M=l.has($.source),P=l.has($.target);if(!M&&!P)continue;let T=$.source,D=$.target,E=p.get(T),I=p.get(D),R=b.get(T),W=b.get(D),B=E?{x:E.x+E.width/2,y:E.y+E.height/2,width:E.width,height:E.height}:R?{x:R.x+R.width/2,y:R.y+R.height/2,width:R.width,height:R.height}:null,F=I?{x:I.x+I.width/2,y:I.y+I.height/2,width:I.width,height:I.height}:W?{x:W.x+W.width/2,y:W.y+W.height/2,width:W.width,height:W.height}:null;if(!B||!F)continue;let nt=`${T}->${D}`;if(x.has(nt))continue;x.add(nt);let rt=Xt(B,F,[{x:B.x,y:B.y},{x:F.x,y:F.y}],E?.shape??"rectangle",I?.shape??"rectangle",i);u.push({source:T,target:D,label:$.label,style:$.style,hasArrowStart:$.hasArrowStart,hasArrowEnd:$.hasArrowEnd,points:rt,labelPosition:$.label?mt(rt):void 0,inlineStyle:$.inlineStyle})}let y=e.padding??20,w=1/0,k=1/0,v=-1/0,S=-1/0;for(let $ of h)w=Math.min(w,$.x),k=Math.min(k,$.y),v=Math.max(v,$.x+$.width),S=Math.max(S,$.y+$.height);for(let $ of f)w=Math.min(w,$.x),k=Math.min(k,$.y),v=Math.max(v,$.x+$.width),S=Math.max(S,$.y+$.height);for(let $ of u)for(let M of $.points)w=Math.min(w,M.x),k=Math.min(k,M.y),v=Math.max(v,M.x),S=Math.max(S,M.y);let _=y-w,C=y-k;for(let $ of h)$.x+=_,$.y+=C;for(let $ of f)$.x+=_,$.y+=C;for(let $ of u){for(let M of $.points)M.x+=_,M.y+=C;$.labelPosition&&($.labelPosition.x+=_,$.labelPosition.y+=C)}return{width:v-w+y*2,height:S-k+y*2,nodes:h,edges:u,groups:f}}function q(t,n={}){let e={nodeSpacing:40,layerSpacing:60,padding:20,...n};if(t.type==="sequence")return mn(t,e);if(t.type==="flowchart"){let{nodes:r,edges:s}=wn(t),o=r.some(a=>a.shape==="state-start"||a.shape==="state-end")?{...e,layerSpacing:45,nodeSpacing:30}:e;return gt(r,s,o,t.direction,t.subgraphs)}if(t.type==="class"){let{nodes:r,edges:s}=kn(t);return gt(r,s,e,"TB")}if(t.type==="er"){let{nodes:r,edges:s}=An(t);return gt(r,s,e,"TB")}if(t.type==="pie")return bn(t,e);if(t.type==="gantt")return xn(t,e);if(t.type==="mindmap")return yn(t,e);throw new Error(`Unsupported diagram type: ${t.type}`)}function X(t,n,e){let r=Ft(t),s=Ft(n),i=e/100,o=Math.round(r.r*i+s.r*(1-i)),a=Math.round(r.g*i+s.g*(1-i)),c=Math.round(r.b*i+s.b*(1-i));return vn(o,a,c)}function Ft(t){let n=t.replace("#",""),e=Number.parseInt(n.slice(0,2),16),r=Number.parseInt(n.slice(2,4),16),s=Number.parseInt(n.slice(4,6),16);return{r:e,g:r,b:s}}function vn(t,n,e){return`#${[t,n,e].map(r=>r.toString(16).padStart(2,"0")).join("")}`}function Q(t){let n=t.bg,e=t.fg,r=t.accent??X(e,n,50);return{bg:n,fg:e,text:e,line:t.line??X(e,n,30),arrow:r,muted:t.muted??X(e,n,50),nodeFill:t.surface??X(e,n,12),nodeStroke:t.border??X(r,n,65),groupFill:X(e,n,5),groupStroke:X(e,n,15),groupText:X(e,n,60),font:t.font??"ui-sans-serif, system-ui, sans-serif",monoFont:t.monoFont??"ui-monospace, monospace"}}var yt={"zinc-dark":{bg:"#18181B",fg:"#FAFAFA"},"zinc-light":{bg:"#FAFAFA",fg:"#18181B"},"tokyo-night":{bg:"#1a1b26",fg:"#a9b1d6",line:"#3d59a1",accent:"#7aa2f7"},"catppuccin-mocha":{bg:"#1e1e2e",fg:"#cdd6f4",accent:"#cba6f7",line:"#585b70"},"catppuccin-latte":{bg:"#eff1f5",fg:"#4c4f69",accent:"#8839ef",line:"#9ca0b0"},nord:{bg:"#2e3440",fg:"#d8dee9",accent:"#88c0d0",line:"#4c566a"},dracula:{bg:"#282a36",fg:"#f8f8f2",accent:"#bd93f9",line:"#6272a4"},"github-light":{bg:"#ffffff",fg:"#1f2328",accent:"#0969da",line:"#d1d9e0"},"github-dark":{bg:"#0d1117",fg:"#e6edf3",accent:"#58a6ff",line:"#30363d"},"one-dark":{bg:"#282c34",fg:"#abb2bf",accent:"#c678dd",line:"#3e4451"},"solarized-dark":{bg:"#002b36",fg:"#839496",accent:"#268bd2",line:"#073642"},"solarized-light":{bg:"#fdf6e3",fg:"#657b83",accent:"#268bd2",line:"#eee8d5"},monokai:{bg:"#272822",fg:"#f8f8f2",accent:"#a6e22e",line:"#49483e"},"gruvbox-dark":{bg:"#282828",fg:"#ebdbb2",accent:"#fabd2f",line:"#504945"},"gruvbox-light":{bg:"#fbf1c7",fg:"#3c3836",accent:"#d79921",line:"#d5c4a1"},"rose-pine":{bg:"#191724",fg:"#e0def4",accent:"#c4a7e7",line:"#26233a"},"rose-pine-dawn":{bg:"#faf4ed",fg:"#575279",accent:"#907aa9",line:"#f2e9e1"},"ayu-dark":{bg:"#0a0e14",fg:"#b3b1ad",accent:"#ffb454",line:"#11151c"},"ayu-light":{bg:"#fafafa",fg:"#575f66",accent:"#ff9940",line:"#f0f0f0"},vesper:{bg:"#101010",fg:"#ffffff",accent:"#ffc799",line:"#232323"},"vitesse-dark":{bg:"#121212",fg:"#dbd7caee",accent:"#4d9375",line:"#282828"},"vitesse-light":{bg:"#ffffff",fg:"#393a34",accent:"#1e754f",line:"#f1f1f1"},kanagawa:{bg:"#1f1f28",fg:"#dcd7ba",accent:"#7e9cd8",line:"#2a2a37"},"everforest-dark":{bg:"#2d353b",fg:"#d3c6aa",accent:"#a7c080",line:"#3d484d"},"everforest-light":{bg:"#fdf6e3",fg:"#5c6a72",accent:"#8da101",line:"#efebd4"},"material-dark":{bg:"#263238",fg:"#eeffff",accent:"#82aaff",line:"#37474f"},"material-light":{bg:"#fafafa",fg:"#546e7a",accent:"#6182b8",line:"#e7e7e8"},poimandres:{bg:"#1b1e28",fg:"#a6accd",accent:"#add7ff",line:"#303340"},"night-owl":{bg:"#011627",fg:"#d6deeb",accent:"#82aaff",line:"#122d42"},"one-hunter":{bg:"#1e2127",fg:"#c0c5cf",accent:"#e06c75",line:"#2c313a",surface:"#282c34",border:"#3e4451"}},O={bg:"#ffffff",fg:"#27272a"};var ot={one:{start:"er-one-start",end:"er-one"},many:{start:"er-many-start",end:"er-many"},"zero-one":{start:"er-zero-one-start",end:"er-zero-one"},"zero-many":{start:"er-zero-many-start",end:"er-zero-many"}},Ut={inheritance:"cls-inheritance",realization:"cls-inheritance",composition:"cls-composition",aggregation:"cls-aggregation"};function Mn(t,n){let{points:e,style:r,hasArrowStart:s,hasArrowEnd:i}=t;if(e.length<2)return"";let o=e.map((g,m)=>`${m===0?"M":"L"} ${g.x} ${g.y}`).join(" "),a="",c="1.5";r==="dotted"?a='stroke-dasharray="6 4"':r==="thick"&&(c="2.5");let l=t.inlineStyle?.fromCardinality,d=t.inlineStyle?.toCardinality,h=t.inlineStyle?.relationType,u="",f="";return h&&Ut[h]?u=`marker-start="url(#${Ut[h]})"`:l&&ot[l]?u=`marker-start="url(#${ot[l].start})"`:s&&(u='marker-start="url(#arrowhead-start)"'),d&&ot[d]?f=`marker-end="url(#${ot[d].end})"`:i&&(f='marker-end="url(#arrowhead)"'),`<path d="${o}" stroke="var(--_line)" stroke-width="${c}" fill="none" stroke-linejoin="round" stroke-linecap="round" ${a} ${u} ${f}/>`}function kt(t){return t.split(/<br\s*\/?>|\n/)}function _n(t,n){if(t.shape==="state-start"||t.shape==="state-end")return"";if(t.shape==="pie-slice"){let l=t.x+t.width/2,d=t.y+t.height/2,h=t.inlineStyle?.percent||"";return`<text x="${l}" y="${d}" text-anchor="middle" dominant-baseline="middle" fill="var(--_text)" font-family="${n.font}" font-size="11" font-weight="600">${N(t.label)} ${h}%</text>`}if(t.shape==="pie-title"){let l=t.x+t.width/2,d=t.y+t.height/2;return`<text x="${l}" y="${d}" text-anchor="middle" dominant-baseline="middle" fill="var(--_text)" font-family="${n.font}" font-size="16" font-weight="600">${N(t.label)}</text>`}if(t.shape==="gantt-title"){let l=t.x+t.width/2,d=t.y+t.height/2;return`<text x="${l}" y="${d}" text-anchor="middle" dominant-baseline="middle" fill="var(--_text)" font-family="${n.font}" font-size="16" font-weight="600">${N(t.label)}</text>`}if(t.shape==="gantt-section"){let l=t.x+8,d=t.y+t.height/2;return`<text x="${l}" y="${d}" dominant-baseline="middle" fill="var(--_group-text)" font-family="${n.font}" font-size="12" font-weight="600">${N(t.label)}</text>`}if(t.shape==="gantt-bar"){let l=parseFloat(t.inlineStyle?.labelX||"0")+4,d=t.y+t.height/2,h=`<text x="${t.x+6}" y="${d}" dominant-baseline="middle" fill="var(--bg)" font-family="${n.font}" font-size="11" font-weight="500">${N(t.label)}</text>`;return`<text x="${l}" y="${d}" dominant-baseline="middle" fill="var(--_text)" font-family="${n.font}" font-size="11" font-weight="400">${N(t.label)}</text>`+h}if(t.shape==="class-box")return En(t,n);if(t.shape==="er-entity")return Pn(t,n);let e=kt(t.label),r=t.x+t.width/2,s=t.y+t.height/2,i=16,o=e.length*i,a=s-o/2+i/2,c=e.map((l,d)=>{let h=a+d*i;return`<tspan x="${r}" y="${h}" text-anchor="middle" dominant-baseline="middle">${N(l)}</tspan>`}).join("");return`<text fill="var(--_text)" font-family="${n.font}" font-size="14" font-weight="400">${c}</text>`}function En(t,n){let e=t.label.split(`
`),r=16,s=12,i=t.x,o=t.x+t.width/2,a=t.y,c="",l=0,d=e[l]||"";if(a+=s/2+r/2,c+=`<text x="${o}" y="${a}" text-anchor="middle" dominant-baseline="middle" fill="var(--_text)" font-family="${n.font}" font-size="14" font-weight="600">${N(d)}</text>`,l++,l<e.length&&e[l]==="---")for(l++,a=t.y+r+s;l<e.length&&e[l]!=="---";)a+=r*.8,c+=`<text x="${i+s}" y="${a}" dominant-baseline="middle" fill="var(--_text)" font-family="${n.font}" font-size="12" font-weight="400">${N(e[l])}</text>`,l++;if(l<e.length&&e[l]==="---"){l++;let h=parseInt(t.inlineStyle?.attrCount||"0"),u=h>0?h*r+s:0;for(a=t.y+r+s+u;l<e.length;)a+=r*.8,c+=`<text x="${i+s}" y="${a}" dominant-baseline="middle" fill="var(--_text)" font-family="${n.font}" font-size="12" font-weight="400">${N(e[l])}</text>`,l++}return c}function Cn(t,n){if(!t.label||!t.labelPosition)return"";let{x:e,y:r}=t.labelPosition,s=kt(t.label),i=14,o=s.length*i,a=4,c=Math.max(...s.map(b=>b.length*7))+a*2,l=o+a*2,d=e-c/2,h=r-l/2,u=`<rect x="${d}" y="${h}" width="${c}" height="${l}" fill="var(--bg)" stroke="var(--_line)" stroke-width="0.75" rx="3"/>`,f=r-o/2+i/2,g=s.map((b,p)=>{let x=f+p*i;return`<tspan x="${e}" y="${x}" text-anchor="middle" dominant-baseline="middle">${N(b)}</tspan>`}).join(""),m=`<text fill="var(--_text)" font-family="${n.font}" font-size="11" font-weight="500">${g}</text>`;return u+m}function Ln(t,n){let e=kt(t.label),r=t.x+8,s=t.y+8,i=14,o=e.map((a,c)=>{let l=s+c*i;return`<tspan x="${r}" y="${l}">${N(a)}</tspan>`}).join("");return`<text fill="var(--_group-text)" font-family="${n.font}" font-size="12" font-weight="600">${o}</text>`}function Pn(t,n){let e=t.label.split(`
`),r=t.x,s=t.width,i=r+s/2,o=14,a=12,c=o*1.2+16,l="",d=e[0]||"",h=t.y+c/2;l+=`<text x="${i}" y="${h}" text-anchor="middle" dominant-baseline="middle" fill="var(--_text)" font-family="${n.font}" font-size="${o}" font-weight="600">${N(d)}</text>`;let u=1;if(u<e.length&&e[u]==="---"){u++;let g=t.y+c+8,m=a*1.4,b=0;for(;u<e.length&&e[u]!=="---";){let p=e[u]||"",x=g+b*m+a/2,y=p.match(/^(PK|FK|UK|PK,FK|FK,PK)\s+/);if(y){let w=y[1],k=p.slice(y[0].length);l+=`<text x="${r+8}" y="${x}" dominant-baseline="middle" fill="var(--_node-stroke)" font-family="${n.font}" font-size="10" font-weight="600">${N(w)}</text>`,l+=`<text x="${r+34}" y="${x}" dominant-baseline="middle" fill="var(--_text)" font-family="${n.font}" font-size="${a}" font-weight="400">${N(k)}</text>`}else l+=`<text x="${r+34}" y="${x}" dominant-baseline="middle" fill="var(--_text)" font-family="${n.font}" font-size="${a}" font-weight="400">${N(p)}</text>`;b++,u++}}if(parseInt(t.inlineStyle?.attrCount||"0")===0){let g=t.y+c+10;l+=`<text x="${i}" y="${g}" text-anchor="middle" dominant-baseline="middle" fill="var(--_muted)" font-family="${n.font}" font-size="11" font-style="italic">(no attributes)</text>`}return l}function N(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}function In(t){return`
		<defs>
			<marker id="arrowhead" markerWidth="12" markerHeight="8" refX="11" refY="4" orient="auto" markerUnits="userSpaceOnUse">
				<path d="M1,1 L11,4 L1,7 z" fill="var(--_arrow)" />
			</marker>
			<marker id="arrowhead-start" markerWidth="12" markerHeight="8" refX="1" refY="4" orient="auto" markerUnits="userSpaceOnUse">
				<path d="M11,1 L1,4 L11,7 z" fill="var(--_arrow)" />
			</marker>
			<marker id="arrowhead-open" markerWidth="12" markerHeight="8" refX="11" refY="4" orient="auto" markerUnits="userSpaceOnUse">
				<path d="M1,1 L11,4 L1,7" fill="none" stroke="var(--_arrow)" stroke-width="1.5" stroke-linejoin="round" />
			</marker>
			<marker id="arrowhead-cross" markerWidth="12" markerHeight="12" refX="6" refY="6" orient="auto" markerUnits="userSpaceOnUse">
				<path d="M3,3 L9,9 M9,3 L3,9" stroke="var(--_arrow)" stroke-width="1.5" stroke-linecap="round" />
			</marker>
			<marker id="er-one" markerWidth="20" markerHeight="16" refX="18" refY="8" orient="auto" markerUnits="userSpaceOnUse">
				<line x1="18" y1="2" x2="18" y2="14" stroke="var(--_line)" stroke-width="1.5"/>
				<line x1="14" y1="2" x2="14" y2="14" stroke="var(--_line)" stroke-width="1.5"/>
			</marker>
			<marker id="er-one-start" markerWidth="20" markerHeight="16" refX="2" refY="8" orient="auto" markerUnits="userSpaceOnUse">
				<line x1="2" y1="2" x2="2" y2="14" stroke="var(--_line)" stroke-width="1.5"/>
				<line x1="6" y1="2" x2="6" y2="14" stroke="var(--_line)" stroke-width="1.5"/>
			</marker>
			<marker id="er-many" markerWidth="20" markerHeight="16" refX="18" refY="8" orient="auto" markerUnits="userSpaceOnUse">
				<line x1="18" y1="2" x2="18" y2="14" stroke="var(--_line)" stroke-width="1.5"/>
				<path d="M18,8 L6,2 M18,8 L6,14" stroke="var(--_line)" stroke-width="1.5" fill="none"/>
			</marker>
			<marker id="er-many-start" markerWidth="20" markerHeight="16" refX="2" refY="8" orient="auto" markerUnits="userSpaceOnUse">
				<line x1="2" y1="2" x2="2" y2="14" stroke="var(--_line)" stroke-width="1.5"/>
				<path d="M2,8 L14,2 M2,8 L14,14" stroke="var(--_line)" stroke-width="1.5" fill="none"/>
			</marker>
			<marker id="er-zero-one" markerWidth="24" markerHeight="16" refX="22" refY="8" orient="auto" markerUnits="userSpaceOnUse">
				<line x1="22" y1="2" x2="22" y2="14" stroke="var(--_line)" stroke-width="1.5"/>
				<circle cx="14" cy="8" r="4" fill="none" stroke="var(--_line)" stroke-width="1.5"/>
			</marker>
			<marker id="er-zero-one-start" markerWidth="24" markerHeight="16" refX="2" refY="8" orient="auto" markerUnits="userSpaceOnUse">
				<line x1="2" y1="2" x2="2" y2="14" stroke="var(--_line)" stroke-width="1.5"/>
				<circle cx="10" cy="8" r="4" fill="none" stroke="var(--_line)" stroke-width="1.5"/>
			</marker>
			<marker id="er-zero-many" markerWidth="24" markerHeight="16" refX="22" refY="8" orient="auto" markerUnits="userSpaceOnUse">
				<path d="M22,8 L10,2 M22,8 L10,14" stroke="var(--_line)" stroke-width="1.5" fill="none"/>
				<circle cx="6" cy="8" r="4" fill="none" stroke="var(--_line)" stroke-width="1.5"/>
			</marker>
			<marker id="er-zero-many-start" markerWidth="24" markerHeight="16" refX="2" refY="8" orient="auto" markerUnits="userSpaceOnUse">
				<path d="M2,8 L14,2 M2,8 L14,14" stroke="var(--_line)" stroke-width="1.5" fill="none"/>
				<circle cx="18" cy="8" r="4" fill="none" stroke="var(--_line)" stroke-width="1.5"/>
			</marker>
			<marker id="cls-inheritance" markerWidth="16" markerHeight="14" refX="1" refY="7" orient="auto" markerUnits="userSpaceOnUse">
				<path d="M15,1 L1,7 L15,13 z" fill="var(--_node-fill)" stroke="var(--_line)" stroke-width="1.5" stroke-linejoin="round"/>
			</marker>
			<marker id="cls-composition" markerWidth="14" markerHeight="14" refX="1" refY="7" orient="auto" markerUnits="userSpaceOnUse">
				<path d="M1,7 L7,1 L13,7 L7,13 z" fill="var(--_line)" stroke="var(--_line)" stroke-width="1"/>
			</marker>
			<marker id="cls-aggregation" markerWidth="14" markerHeight="14" refX="1" refY="7" orient="auto" markerUnits="userSpaceOnUse">
				<path d="M1,7 L7,1 L13,7 L7,13 z" fill="var(--_node-fill)" stroke="var(--_line)" stroke-width="1.5"/>
			</marker>
		</defs>
	`}function Nn(t,n){return`<rect x="${t.x}" y="${t.y}" width="${t.width}" height="${t.height}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="1.5" rx="0"/>`}function qt(t,n){return`<rect x="${t.x}" y="${t.y}" width="${t.width}" height="${t.height}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="1.5" rx="8"/>`}function Tn(t,n){let e=t.x+t.width/2,r=t.y+t.height/2,s=t.width/2,i=t.height/2;return`<polygon points="${`${e},${r-i} ${e+s},${r} ${e},${r+i} ${e-s},${r}`}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="1.5"/>`}function Dn(t,n){let e=Math.min(t.height/2,t.width/2);return`<rect x="${t.x}" y="${t.y}" width="${t.width}" height="${t.height}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="1.5" rx="${e}"/>`}function zn(t,n){let e=t.x+t.width/2,r=t.y+t.height/2,s=Math.min(t.width,t.height)/2;return`<circle cx="${e}" cy="${r}" r="${s}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="1.5"/>`}function Hn(t,n){let e=`<rect x="${t.x}" y="${t.y}" width="${t.width}" height="${t.height}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="1.5" rx="0"/>`,r=4,s=`<rect x="${t.x+r}" y="${t.y+r}" width="${t.width-r*2}" height="${t.height-r*2}" fill="none" stroke="var(--_node-stroke)" stroke-width="1.5" rx="0"/>`;return e+s}function Rn(t,n){let e=t.x+t.width/2,r=t.y+t.height/2,s=Math.min(t.width,t.height)/2,i=s-4;return`<circle cx="${e}" cy="${r}" r="${s}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="1.5"/><circle cx="${e}" cy="${r}" r="${i}" fill="none" stroke="var(--_node-stroke)" stroke-width="1.5"/>`}function Wn(t,n){let e=t.x+t.width/2,r=t.y+t.height/2,s=t.width/2,i=t.height/2,o=s*.3;return`<polygon points="${`${e-s+o},${r-i} ${e+s-o},${r-i} ${e+s},${r} ${e+s-o},${r+i} ${e-s+o},${r+i} ${e-s},${r}`}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="1.5"/>`}function Yn(t,n){let e=t.height*.1,r=t.x,s=t.y,i=t.width,o=t.height,a=`M ${r} ${s+e}
		Q ${r} ${s}, ${r+i/2} ${s}
		T ${r+i} ${s+e}
		L ${r+i} ${s+o-e}
		Q ${r+i} ${s+o}, ${r+i/2} ${s+o}
		T ${r} ${s+o-e}
		Z`,c=`<ellipse cx="${r+i/2}" cy="${s+e}" rx="${i/2}" ry="${e}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="1.5"/>`;return`<path d="${a}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="1.5"/>`+c}function Xn(t,n){let e=t.x,r=t.y,s=t.width,i=t.height,o=s*.15;return`<polygon points="${`${e},${r+i/2} ${e+o},${r} ${e+s},${r} ${e+s-o},${r+i} ${e},${r+i}`}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="1.5"/>`}function On(t,n){let e=t.x,r=t.y,s=t.width,i=t.height,o=s*.15;return`<polygon points="${`${e+o},${r} ${e+s-o},${r} ${e+s},${r+i} ${e},${r+i}`}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="1.5"/>`}function Bn(t,n){let e=t.x,r=t.y,s=t.width,i=t.height,o=s*.15;return`<polygon points="${`${e},${r} ${e+s},${r} ${e+s-o},${r+i} ${e+o},${r+i}`}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="1.5"/>`}function Fn(t,n){let e=t.x,r=t.y,s=t.width,i=t.height,o=s*.15;return`<polygon points="${`${e+o},${r} ${e+s},${r} ${e+s-o},${r+i} ${e},${r+i}`}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="1.5"/>`}function Un(t,n){let e=t.x,r=t.y,s=t.width,i=t.height,o=Math.min(s,i)*.15;return`<path d="${`M ${e} ${r} L ${e+s-o} ${r} L ${e+s} ${r+o} L ${e+s} ${r+i} L ${e} ${r+i} Z M ${e+s-o} ${r} L ${e+s-o} ${r+o} L ${e+s} ${r+o}`}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="1.5"/>`}function Gn(t,n){let e=t.x,r=t.y,s=t.width,i=t.height;return`<path d="${`M ${e+s*.25} ${r+i*.4}
		Q ${e} ${r+i*.4}, ${e} ${r+i*.6}
		Q ${e} ${r+i}, ${e+s*.2} ${r+i}
		Q ${e+s*.3} ${r+i}, ${e+s*.5} ${r+i*.95}
		Q ${e+s*.7} ${r+i}, ${e+s*.8} ${r+i}
		Q ${e+s} ${r+i}, ${e+s} ${r+i*.6}
		Q ${e+s} ${r+i*.4}, ${e+s*.75} ${r+i*.4}
		Q ${e+s*.8} ${r}, ${e+s*.5} ${r}
		Q ${e+s*.2} ${r}, ${e+s*.25} ${r+i*.4}
		Z`}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="1.5"/>`}function Kn(t,n){let e=t.x+t.width/2,r=t.y+t.height/2,s=Math.min(t.width,t.height)/4;return`<circle cx="${e}" cy="${r}" r="${s}" fill="var(--_text)" stroke="none"/>`}function jn(t,n){let e=t.x+t.width/2,r=t.y+t.height/2,s=Math.min(t.width,t.height)/3,i=s*.6;return`<circle cx="${e}" cy="${r}" r="${s}" fill="none" stroke="var(--_text)" stroke-width="2"/><circle cx="${e}" cy="${r}" r="${i}" fill="var(--_text)" stroke="none"/>`}var Gt=["#4e79a7","#f28e2b","#e15759","#76b7b2","#59a14f","#edc948","#b07aa1","#ff9da7","#9c755f","#bab0ac"];function qn(t,n){if(!t.inlineStyle)return"";let e=parseFloat(t.inlineStyle.cx),r=parseFloat(t.inlineStyle.cy),s=parseFloat(t.inlineStyle.radius),i=parseFloat(t.inlineStyle.startAngle),o=parseFloat(t.inlineStyle.endAngle),a=parseInt(t.inlineStyle.index),c=Gt[a%Gt.length],l=e+s*Math.cos(i),d=r+s*Math.sin(i),h=e+s*Math.cos(o),u=r+s*Math.sin(o),f=o-i>Math.PI?1:0;return`<path d="${`M ${e} ${r} L ${l} ${d} A ${s} ${s} 0 ${f} 1 ${h} ${u} Z`}" fill="${c}" stroke="var(--bg)" stroke-width="2"/>`}function Vn(t,n){return""}function Qn(t,n){return`<rect x="${t.x}" y="${t.y}" width="${t.width}" height="${t.height}" fill="var(--_group-fill)" stroke="none" rx="2"/>`}function Zn(t,n){let e=t.inlineStyle?.status||"default",r="var(--_node-fill)",s="var(--_node-stroke)";return e==="done"&&(r="var(--_muted)"),e==="active"&&(r="var(--_node-stroke)"),e==="crit"&&(r="#e15759",s="#c44040"),`<rect x="${t.x}" y="${t.y}" width="${t.width}" height="${t.height}" fill="${r}" stroke="${s}" stroke-width="1" rx="4"/>`}function Jn(t,n){return""}function tr(t,n){let e=t.x,r=t.y,s=t.width,i=t.height,o=parseInt(t.inlineStyle?.attrCount||"0"),a=`<rect x="${e}" y="${r}" width="${s}" height="${i}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="1.5" rx="0"/>`;if(o>0){let l=r+32.8;a+=`<line x1="${e}" y1="${l}" x2="${e+s}" y2="${l}" stroke="var(--_node-stroke)" stroke-width="1"/>`}return a}function er(t,n){let e=t.x,r=t.y,s=t.width,i=t.height,o=16,a=12,c=parseInt(t.inlineStyle?.attrCount||"0"),l=parseInt(t.inlineStyle?.methodCount||"0"),d=`<rect x="${e}" y="${r}" width="${s}" height="${i}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="1.5" rx="0"/>`,h=o+a,u=c>0?c*o+a:0;if(c>0||l>0){let f=r+h;d+=`<line x1="${e}" y1="${f}" x2="${e+s}" y2="${f}" stroke="var(--_node-stroke)" stroke-width="1"/>`}if(l>0&&c>0){let f=r+h+u;d+=`<line x1="${e}" y1="${f}" x2="${e+s}" y2="${f}" stroke="var(--_node-stroke)" stroke-width="1"/>`}return d}var nr={rectangle:Nn,rounded:qt,diamond:Tn,stadium:Dn,circle:zn,subroutine:Hn,doublecircle:Rn,hexagon:Wn,cylinder:Yn,asymmetric:Xn,trapezoid:On,"trapezoid-alt":Bn,parallelogram:Fn,note:Un,cloud:Gn,"state-start":Kn,"state-end":jn,"pie-slice":qn,"pie-title":Vn,"gantt-section":Qn,"gantt-bar":Zn,"gantt-title":Jn,"class-box":er,"er-entity":tr};function rr(t,n){let e=nr[t.shape];return e?e(t,n):qt(t)}function ir(t,n){return`<rect x="${t.x}" y="${t.y}" width="${t.width}" height="${t.height}" fill="var(--_group-fill)" stroke="var(--_group-stroke)" stroke-width="1.5" rx="4"/>`}function Vt(t,n){return t.flatMap(e=>{let r=e.children.length>0?Vt(e.children,n):"";return ir(e)+Ln(e,n)+r}).join("")}function sr(t,n){if(!n.debug)return"";let e=[],r=50,s=t.width+n.padding*2,i=t.height+n.padding*2;for(let o=0;o<=s;o+=r)e.push(`<line x1="${o}" y1="0" x2="${o}" y2="${i}" stroke="rgba(255,255,255,0.08)" stroke-width="0.5"/>`),e.push(`<text x="${o+2}" y="10" fill="rgba(255,255,255,0.3)" font-size="8" font-family="monospace">${o}</text>`);for(let o=0;o<=i;o+=r)e.push(`<line x1="0" y1="${o}" x2="${s}" y2="${o}" stroke="rgba(255,255,255,0.08)" stroke-width="0.5"/>`),e.push(`<text x="2" y="${o-2}" fill="rgba(255,255,255,0.3)" font-size="8" font-family="monospace">${o}</text>`);for(let o of t.nodes)e.push(`<rect x="${o.x}" y="${o.y}" width="${o.width}" height="${o.height}" fill="none" stroke="rgba(239,68,68,0.5)" stroke-width="0.5" stroke-dasharray="3 2"/>`),e.push(`<text x="${o.x}" y="${o.y-4}" fill="rgba(239,68,68,0.7)" font-size="9" font-family="monospace">${o.id}</text>`);for(let o of t.edges)for(let a of o.points)e.push(`<circle cx="${a.x}" cy="${a.y}" r="3" fill="rgba(59,130,246,0.6)" stroke="rgba(59,130,246,0.8)" stroke-width="0.5"/>`);return`<g class="debug-overlays">${e.join("")}</g>`}function ct(t,n){let e=n?.theme??O,r=n?.padding??16,s=n?.transparent??!1,i=n?.debug??!1,o=Q(e),a={colors:o,padding:r,transparent:s,debug:i,font:o.font},c=t.width+r*2,l=t.height+r*2,d=s?"none":o.bg,h=`cm-${Math.random().toString(36).slice(2,8)}`,f=`
		<style>
			@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap');
			#${h} {
				--bg: ${o.bg};
				--fg: ${o.fg};
				--_text: ${o.text};
				--_line: ${o.line};
				--_arrow: ${o.arrow};
				--_node-fill: ${o.nodeFill};
				--_node-stroke: ${o.nodeStroke};
				--_muted: ${o.muted};
				--_group-fill: ${o.groupFill};
				--_group-stroke: ${o.groupStroke};
				--_group-text: ${o.groupText};
			}
		</style>
	`,g=In(),m=Vt(t.groups,a),b=t.edges.map(k=>Mn(k)).join(""),p=t.edges.map(k=>Cn(k,a)).join(""),x=t.nodes.map(k=>{let v=rr(k,a),S=_n(k,a);return v+S}).join(""),y=sr(t,a);return`
		<svg id="${h}" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 ${c} ${l}" width="${c}" height="${l}">
			${f}
			<rect width="${c}" height="${l}" fill="${d}"/>
			${g}
			<g transform="translate(${r}, ${r})">
				${m}
				${b}
				${p}
				${x}
			</g>
			${y}
		</svg>
	`.split(`
`).map(k=>k.trim()).filter(Boolean).join(`
`)}var Qt="http://www.w3.org/2000/svg";function A(t){return document.createElementNS(Qt,t)}function tt(t){return t.split(/<br\s*\/?>|\n/)}function or(t,n){let e=A("rect");return e.setAttribute("x",String(t.x)),e.setAttribute("y",String(t.y)),e.setAttribute("width",String(t.width)),e.setAttribute("height",String(t.height)),e.setAttribute("fill","var(--_group-fill)"),e.setAttribute("stroke","var(--_group-stroke)"),e.setAttribute("stroke-width","1.5"),e.setAttribute("rx","4"),e}function ar(t,n){let e=tt(t.label),r=t.x+8,s=t.y+8,i=14,o=A("text");return o.setAttribute("fill","var(--_group-text)"),o.setAttribute("font-family",n.font),o.setAttribute("font-size","12"),o.setAttribute("font-weight","600"),e.forEach((a,c)=>{let l=A("tspan");l.setAttribute("x",String(r)),l.setAttribute("y",String(s+c*i)),l.textContent=a,o.appendChild(l)}),o}function Zt(t,n,e){t.forEach(r=>{e.appendChild(or(r)),e.appendChild(ar(r,n)),r.children.length>0&&Zt(r.children,n,e)})}function cr(t,n){let e=t.x,r=t.y,s=t.width,i=t.height,o=e+s/2,a=r+i/2;switch(t.shape){case"rectangle":{let c=A("rect");return c.setAttribute("x",String(e)),c.setAttribute("y",String(r)),c.setAttribute("width",String(s)),c.setAttribute("height",String(i)),c.setAttribute("fill","var(--_node-fill)"),c.setAttribute("stroke","var(--_node-stroke)"),c.setAttribute("stroke-width","1.5"),c.setAttribute("rx","0"),c}case"rounded":{let c=A("rect");return c.setAttribute("x",String(e)),c.setAttribute("y",String(r)),c.setAttribute("width",String(s)),c.setAttribute("height",String(i)),c.setAttribute("fill","var(--_node-fill)"),c.setAttribute("stroke","var(--_node-stroke)"),c.setAttribute("stroke-width","1.5"),c.setAttribute("rx","8"),c}case"diamond":{let c=s/2,l=i/2,d=`${o},${a-l} ${o+c},${a} ${o},${a+l} ${o-c},${a}`,h=A("polygon");return h.setAttribute("points",d),h.setAttribute("fill","var(--_node-fill)"),h.setAttribute("stroke","var(--_node-stroke)"),h.setAttribute("stroke-width","1.5"),h}case"stadium":{let c=Math.min(i/2,s/2),l=A("rect");return l.setAttribute("x",String(e)),l.setAttribute("y",String(r)),l.setAttribute("width",String(s)),l.setAttribute("height",String(i)),l.setAttribute("fill","var(--_node-fill)"),l.setAttribute("stroke","var(--_node-stroke)"),l.setAttribute("stroke-width","1.5"),l.setAttribute("rx",String(c)),l}case"circle":{let c=Math.min(s,i)/2,l=A("circle");return l.setAttribute("cx",String(o)),l.setAttribute("cy",String(a)),l.setAttribute("r",String(c)),l.setAttribute("fill","var(--_node-fill)"),l.setAttribute("stroke","var(--_node-stroke)"),l.setAttribute("stroke-width","1.5"),l}case"subroutine":{let c=A("g"),l=A("rect");l.setAttribute("x",String(e)),l.setAttribute("y",String(r)),l.setAttribute("width",String(s)),l.setAttribute("height",String(i)),l.setAttribute("fill","var(--_node-fill)"),l.setAttribute("stroke","var(--_node-stroke)"),l.setAttribute("stroke-width","1.5"),l.setAttribute("rx","0");let d=4,h=A("rect");return h.setAttribute("x",String(e+d)),h.setAttribute("y",String(r+d)),h.setAttribute("width",String(s-d*2)),h.setAttribute("height",String(i-d*2)),h.setAttribute("fill","none"),h.setAttribute("stroke","var(--_node-stroke)"),h.setAttribute("stroke-width","1.5"),h.setAttribute("rx","0"),c.appendChild(l),c.appendChild(h),c}case"doublecircle":{let c=A("g"),l=Math.min(s,i)/2,d=l-4,h=A("circle");h.setAttribute("cx",String(o)),h.setAttribute("cy",String(a)),h.setAttribute("r",String(l)),h.setAttribute("fill","var(--_node-fill)"),h.setAttribute("stroke","var(--_node-stroke)"),h.setAttribute("stroke-width","1.5");let u=A("circle");return u.setAttribute("cx",String(o)),u.setAttribute("cy",String(a)),u.setAttribute("r",String(d)),u.setAttribute("fill","none"),u.setAttribute("stroke","var(--_node-stroke)"),u.setAttribute("stroke-width","1.5"),c.appendChild(h),c.appendChild(u),c}case"hexagon":{let c=s/2,l=i/2,d=c*.3,h=`${o-c+d},${a-l} ${o+c-d},${a-l} ${o+c},${a} ${o+c-d},${a+l} ${o-c+d},${a+l} ${o-c},${a}`,u=A("polygon");return u.setAttribute("points",h),u.setAttribute("fill","var(--_node-fill)"),u.setAttribute("stroke","var(--_node-stroke)"),u.setAttribute("stroke-width","1.5"),u}case"cylinder":{let c=A("g"),l=i*.1,d=`M ${e} ${r+l}
				Q ${e} ${r}, ${e+s/2} ${r}
				T ${e+s} ${r+l}
				L ${e+s} ${r+i-l}
				Q ${e+s} ${r+i}, ${e+s/2} ${r+i}
				T ${e} ${r+i-l}
				Z`,h=A("path");h.setAttribute("d",d),h.setAttribute("fill","var(--_node-fill)"),h.setAttribute("stroke","var(--_node-stroke)"),h.setAttribute("stroke-width","1.5");let u=A("ellipse");return u.setAttribute("cx",String(e+s/2)),u.setAttribute("cy",String(r+l)),u.setAttribute("rx",String(s/2)),u.setAttribute("ry",String(l)),u.setAttribute("fill","var(--_node-fill)"),u.setAttribute("stroke","var(--_node-stroke)"),u.setAttribute("stroke-width","1.5"),c.appendChild(h),c.appendChild(u),c}case"asymmetric":{let c=s*.15,l=`${e},${r+i/2} ${e+c},${r} ${e+s},${r} ${e+s-c},${r+i} ${e},${r+i}`,d=A("polygon");return d.setAttribute("points",l),d.setAttribute("fill","var(--_node-fill)"),d.setAttribute("stroke","var(--_node-stroke)"),d.setAttribute("stroke-width","1.5"),d}case"trapezoid":{let c=s*.15,l=`${e+c},${r} ${e+s-c},${r} ${e+s},${r+i} ${e},${r+i}`,d=A("polygon");return d.setAttribute("points",l),d.setAttribute("fill","var(--_node-fill)"),d.setAttribute("stroke","var(--_node-stroke)"),d.setAttribute("stroke-width","1.5"),d}case"trapezoid-alt":{let c=s*.15,l=`${e},${r} ${e+s},${r} ${e+s-c},${r+i} ${e+c},${r+i}`,d=A("polygon");return d.setAttribute("points",l),d.setAttribute("fill","var(--_node-fill)"),d.setAttribute("stroke","var(--_node-stroke)"),d.setAttribute("stroke-width","1.5"),d}case"parallelogram":{let c=s*.15,l=`${e+c},${r} ${e+s},${r} ${e+s-c},${r+i} ${e},${r+i}`,d=A("polygon");return d.setAttribute("points",l),d.setAttribute("fill","var(--_node-fill)"),d.setAttribute("stroke","var(--_node-stroke)"),d.setAttribute("stroke-width","1.5"),d}case"note":{let c=Math.min(s,i)*.15,l=`M ${e} ${r} L ${e+s-c} ${r} L ${e+s} ${r+c} L ${e+s} ${r+i} L ${e} ${r+i} Z M ${e+s-c} ${r} L ${e+s-c} ${r+c} L ${e+s} ${r+c}`,d=A("path");return d.setAttribute("d",l),d.setAttribute("fill","var(--_node-fill)"),d.setAttribute("stroke","var(--_node-stroke)"),d.setAttribute("stroke-width","1.5"),d}case"cloud":{let c=`M ${e+s*.25} ${r+i*.4}
				Q ${e} ${r+i*.4}, ${e} ${r+i*.6}
				Q ${e} ${r+i}, ${e+s*.2} ${r+i}
				Q ${e+s*.3} ${r+i}, ${e+s*.5} ${r+i*.95}
				Q ${e+s*.7} ${r+i}, ${e+s*.8} ${r+i}
				Q ${e+s} ${r+i}, ${e+s} ${r+i*.6}
				Q ${e+s} ${r+i*.4}, ${e+s*.75} ${r+i*.4}
				Q ${e+s*.8} ${r}, ${e+s*.5} ${r}
				Q ${e+s*.2} ${r}, ${e+s*.25} ${r+i*.4}
				Z`,l=A("path");return l.setAttribute("d",c),l.setAttribute("fill","var(--_node-fill)"),l.setAttribute("stroke","var(--_node-stroke)"),l.setAttribute("stroke-width","1.5"),l}case"state-start":{let c=Math.min(s,i)/4,l=A("circle");return l.setAttribute("cx",String(o)),l.setAttribute("cy",String(a)),l.setAttribute("r",String(c)),l.setAttribute("fill","var(--_text)"),l.setAttribute("stroke","none"),l}case"er-entity":{let c=A("g"),l=A("rect");if(l.setAttribute("x",String(e)),l.setAttribute("y",String(r)),l.setAttribute("width",String(s)),l.setAttribute("height",String(i)),l.setAttribute("fill","var(--_node-fill)"),l.setAttribute("stroke","var(--_node-stroke)"),l.setAttribute("stroke-width","1.5"),l.setAttribute("rx","0"),c.appendChild(l),parseInt(t.inlineStyle?.attrCount||"0")>0){let u=A("line");u.setAttribute("x1",String(e)),u.setAttribute("y1",String(r+32.8)),u.setAttribute("x2",String(e+s)),u.setAttribute("y2",String(r+32.8)),u.setAttribute("stroke","var(--_node-stroke)"),u.setAttribute("stroke-width","1"),c.appendChild(u)}return c}case"class-box":{let c=A("g"),l=A("rect");l.setAttribute("x",String(e)),l.setAttribute("y",String(r)),l.setAttribute("width",String(s)),l.setAttribute("height",String(i)),l.setAttribute("fill","var(--_node-fill)"),l.setAttribute("stroke","var(--_node-stroke)"),l.setAttribute("stroke-width","1.5"),l.setAttribute("rx","0"),c.appendChild(l);let d=16,h=12,u=parseInt(t.inlineStyle?.attrCount||"0"),f=parseInt(t.inlineStyle?.methodCount||"0"),g=d+h,m=u>0?u*d+h:0;if(u>0||f>0){let b=A("line");b.setAttribute("x1",String(e)),b.setAttribute("y1",String(r+g)),b.setAttribute("x2",String(e+s)),b.setAttribute("y2",String(r+g)),b.setAttribute("stroke","var(--_node-stroke)"),b.setAttribute("stroke-width","1"),c.appendChild(b)}if(f>0&&u>0){let b=A("line");b.setAttribute("x1",String(e)),b.setAttribute("y1",String(r+g+m)),b.setAttribute("x2",String(e+s)),b.setAttribute("y2",String(r+g+m)),b.setAttribute("stroke","var(--_node-stroke)"),b.setAttribute("stroke-width","1"),c.appendChild(b)}return c}case"state-end":{let c=A("g"),l=Math.min(s,i)/3,d=l*.6,h=A("circle");h.setAttribute("cx",String(o)),h.setAttribute("cy",String(a)),h.setAttribute("r",String(l)),h.setAttribute("fill","none"),h.setAttribute("stroke","var(--_text)"),h.setAttribute("stroke-width","2");let u=A("circle");return u.setAttribute("cx",String(o)),u.setAttribute("cy",String(a)),u.setAttribute("r",String(d)),u.setAttribute("fill","var(--_text)"),u.setAttribute("stroke","none"),c.appendChild(h),c.appendChild(u),c}default:{let c=A("rect");return c.setAttribute("x",String(e)),c.setAttribute("y",String(r)),c.setAttribute("width",String(s)),c.setAttribute("height",String(i)),c.setAttribute("fill","var(--_node-fill)"),c.setAttribute("stroke","var(--_node-stroke)"),c.setAttribute("stroke-width","1.5"),c.setAttribute("rx","8"),c}}}function lr(t,n){let e=A("g"),r=tt(t.label),s=t.x,i=t.width,o=s+i/2,a=14,c=12,l=a*1.2+16,d=r[0]||"",h=A("text");h.setAttribute("x",String(o)),h.setAttribute("y",String(t.y+l/2)),h.setAttribute("text-anchor","middle"),h.setAttribute("dominant-baseline","middle"),h.setAttribute("fill","var(--_text)"),h.setAttribute("font-family",n.font),h.setAttribute("font-size",String(a)),h.setAttribute("font-weight","600"),h.textContent=d,e.appendChild(h);let u=1;if(u<r.length&&r[u]==="---"){u++;let g=t.y+l+8,m=c*1.4,b=0;for(;u<r.length&&r[u]!=="---";){let p=r[u]??"",x=g+b*m+c/2,y=p.match(/^(PK|FK|UK|PK,FK|FK,PK)\s+/);if(y){let w=y[1],k=p.slice(y[0].length),v=A("text");v.setAttribute("x",String(s+8)),v.setAttribute("y",String(x)),v.setAttribute("dominant-baseline","middle"),v.setAttribute("fill","var(--_node-stroke)"),v.setAttribute("font-family",n.font),v.setAttribute("font-size","10"),v.setAttribute("font-weight","600"),v.textContent=w,e.appendChild(v);let S=A("text");S.setAttribute("x",String(s+34)),S.setAttribute("y",String(x)),S.setAttribute("dominant-baseline","middle"),S.setAttribute("fill","var(--_text)"),S.setAttribute("font-family",n.font),S.setAttribute("font-size",String(c)),S.setAttribute("font-weight","400"),S.textContent=k,e.appendChild(S)}else{let w=A("text");w.setAttribute("x",String(s+34)),w.setAttribute("y",String(x)),w.setAttribute("dominant-baseline","middle"),w.setAttribute("fill","var(--_text)"),w.setAttribute("font-family",n.font),w.setAttribute("font-size",String(c)),w.setAttribute("font-weight","400"),w.textContent=p,e.appendChild(w)}b++,u++}}if(parseInt(t.inlineStyle?.attrCount||"0")===0){let g=A("text");g.setAttribute("x",String(o)),g.setAttribute("y",String(t.y+l+10)),g.setAttribute("text-anchor","middle"),g.setAttribute("dominant-baseline","middle"),g.setAttribute("fill","var(--_muted)"),g.setAttribute("font-family",n.font),g.setAttribute("font-size","11"),g.setAttribute("font-style","italic"),g.textContent="(no attributes)",e.appendChild(g)}return e}function dr(t,n){let e=A("g"),r=tt(t.label),s=16,i=12,o=t.x,a=t.x+t.width/2,c=t.y,l=0,d=r[l]||"";c+=i/2+s/2;let h=A("text");if(h.setAttribute("x",String(a)),h.setAttribute("y",String(c)),h.setAttribute("text-anchor","middle"),h.setAttribute("dominant-baseline","middle"),h.setAttribute("fill","var(--_text)"),h.setAttribute("font-family",n.font),h.setAttribute("font-size","14"),h.setAttribute("font-weight","600"),h.textContent=d,e.appendChild(h),l++,l<r.length&&r[l]==="---")for(l++,c=t.y+s+i;l<r.length&&r[l]!=="---";){c+=s*.8;let u=A("text");u.setAttribute("x",String(o+i)),u.setAttribute("y",String(c)),u.setAttribute("dominant-baseline","middle"),u.setAttribute("fill","var(--_text)"),u.setAttribute("font-family",n.font),u.setAttribute("font-size","12"),u.setAttribute("font-weight","400"),u.textContent=r[l]??"",e.appendChild(u),l++}if(l<r.length&&r[l]==="---"){l++;let u=parseInt(t.inlineStyle?.attrCount||"0"),f=u>0?u*s+i:0;for(c=t.y+s+i+f;l<r.length;){c+=s*.8;let g=A("text");g.setAttribute("x",String(o+i)),g.setAttribute("y",String(c)),g.setAttribute("dominant-baseline","middle"),g.setAttribute("fill","var(--_text)"),g.setAttribute("font-family",n.font),g.setAttribute("font-size","12"),g.setAttribute("font-weight","400"),g.textContent=r[l]??"",e.appendChild(g),l++}}return e}function hr(t,n){if(t.shape==="state-start"||t.shape==="state-end")return A("g");if(t.shape==="class-box")return dr(t,n);if(t.shape==="er-entity")return lr(t,n);let e=tt(t.label),r=t.x+t.width/2,s=t.y+t.height/2,i=16,o=e.length*i,a=s-o/2+i/2,c=A("text");return c.setAttribute("fill","var(--_text)"),c.setAttribute("font-family",n.font),c.setAttribute("font-size","14"),c.setAttribute("font-weight","400"),e.forEach((l,d)=>{let h=A("tspan");h.setAttribute("x",String(r)),h.setAttribute("y",String(a+d*i)),h.setAttribute("text-anchor","middle"),h.setAttribute("dominant-baseline","middle"),h.textContent=l,c.appendChild(h)}),c}function ur(t,n,e){let r=A("g");return r.setAttribute("data-node-id",t.id),r.setAttribute("role","img"),r.setAttribute("aria-label",t.label),e.interactive&&(r.style.cursor="pointer",e.onNodeClick&&r.addEventListener("click",s=>{e.onNodeClick?.(t.id,s)}),e.onNodeHover&&(r.addEventListener("mouseenter",s=>{e.onNodeHover?.(t.id,s)}),r.addEventListener("mouseleave",s=>{e.onNodeHover?.(null,s)}))),r.appendChild(cr(t)),r.appendChild(hr(t,n)),r}function fr(t,n,e){let r=A("g");if(r.setAttribute("data-edge-source",t.source),r.setAttribute("data-edge-target",t.target),t.points.length<2)return r;let s=t.points.map((h,u)=>`${u===0?"M":"L"} ${h.x} ${h.y}`).join(" "),i=A("path");i.setAttribute("d",s),i.setAttribute("stroke","var(--_line)"),i.setAttribute("fill","none"),i.setAttribute("stroke-linejoin","round"),i.setAttribute("stroke-linecap","round"),t.style==="dotted"?(i.setAttribute("stroke-dasharray","6 4"),i.setAttribute("stroke-width","1.5")):t.style==="thick"?i.setAttribute("stroke-width","2.5"):i.setAttribute("stroke-width","1.5");let o=t.inlineStyle?.fromCardinality,a=t.inlineStyle?.toCardinality,c=t.inlineStyle?.relationType,l={one:{start:"er-one-start",end:"er-one"},many:{start:"er-many-start",end:"er-many"},"zero-one":{start:"er-zero-one-start",end:"er-zero-one"},"zero-many":{start:"er-zero-many-start",end:"er-zero-many"}},d={inheritance:"cls-inheritance",realization:"cls-inheritance",composition:"cls-composition",aggregation:"cls-aggregation"};return c&&d[c]?i.setAttribute("marker-start",`url(#${d[c]})`):o&&l[o]?i.setAttribute("marker-start",`url(#${l[o].start})`):t.hasArrowStart&&i.setAttribute("marker-start","url(#arrowhead-start)"),a&&l[a]?i.setAttribute("marker-end",`url(#${l[a].end})`):t.hasArrowEnd&&i.setAttribute("marker-end","url(#arrowhead)"),e.interactive&&e.onEdgeClick&&(i.style.cursor="pointer",i.addEventListener("click",h=>{e.onEdgeClick?.(t.source,t.target,h)})),r.appendChild(i),r}function gr(t,n){let e=A("g");if(!t.label||!t.labelPosition)return e;let{x:r,y:s}=t.labelPosition,i=tt(t.label),o=14,a=i.length*o,c=4,l=Math.max(...i.map(b=>b.length*7))+c*2,d=a+c*2,h=r-l/2,u=s-d/2,f=A("rect");f.setAttribute("x",String(h)),f.setAttribute("y",String(u)),f.setAttribute("width",String(l)),f.setAttribute("height",String(d)),f.setAttribute("fill","var(--bg)"),f.setAttribute("stroke","var(--_line)"),f.setAttribute("stroke-width","0.75"),f.setAttribute("rx","3");let g=A("text");g.setAttribute("fill","var(--_text)"),g.setAttribute("font-family",n.font),g.setAttribute("font-size","11"),g.setAttribute("font-weight","500");let m=s-a/2+o/2;return i.forEach((b,p)=>{let x=A("tspan");x.setAttribute("x",String(r)),x.setAttribute("y",String(m+p*o)),x.setAttribute("text-anchor","middle"),x.setAttribute("dominant-baseline","middle"),x.textContent=b,g.appendChild(x)}),e.appendChild(f),e.appendChild(g),e}function pr(t){let n=A("defs"),e=A("marker");e.setAttribute("id","arrowhead"),e.setAttribute("markerWidth","12"),e.setAttribute("markerHeight","8"),e.setAttribute("refX","11"),e.setAttribute("refY","4"),e.setAttribute("orient","auto"),e.setAttribute("markerUnits","userSpaceOnUse");let r=A("path");r.setAttribute("d","M1,1 L11,4 L1,7 z"),r.setAttribute("fill","var(--_arrow)"),e.appendChild(r);let s=A("marker");s.setAttribute("id","arrowhead-start"),s.setAttribute("markerWidth","12"),s.setAttribute("markerHeight","8"),s.setAttribute("refX","1"),s.setAttribute("refY","4"),s.setAttribute("orient","auto"),s.setAttribute("markerUnits","userSpaceOnUse");let i=A("path");i.setAttribute("d","M11,1 L1,4 L11,7 z"),i.setAttribute("fill","var(--_arrow)"),s.appendChild(i);let o=A("marker");o.setAttribute("id","arrowhead-open"),o.setAttribute("markerWidth","12"),o.setAttribute("markerHeight","8"),o.setAttribute("refX","11"),o.setAttribute("refY","4"),o.setAttribute("orient","auto"),o.setAttribute("markerUnits","userSpaceOnUse");let a=A("path");a.setAttribute("d","M1,1 L11,4 L1,7"),a.setAttribute("fill","none"),a.setAttribute("stroke","var(--_arrow)"),a.setAttribute("stroke-width","1.5"),a.setAttribute("stroke-linejoin","round"),o.appendChild(a);let c=A("marker");c.setAttribute("id","arrowhead-cross"),c.setAttribute("markerWidth","12"),c.setAttribute("markerHeight","12"),c.setAttribute("refX","6"),c.setAttribute("refY","6"),c.setAttribute("orient","auto"),c.setAttribute("markerUnits","userSpaceOnUse");let l=A("path");l.setAttribute("d","M3,3 L9,9 M9,3 L3,9"),l.setAttribute("stroke","var(--_arrow)"),l.setAttribute("stroke-width","1.5"),l.setAttribute("stroke-linecap","round"),c.appendChild(l),n.appendChild(e),n.appendChild(s),n.appendChild(o),n.appendChild(c);let h=[...[{id:"er-one",w:20,h:16,refX:18,refY:8,content:'<line x1="18" y1="2" x2="18" y2="14" stroke="var(--_line)" stroke-width="1.5"/><line x1="14" y1="2" x2="14" y2="14" stroke="var(--_line)" stroke-width="1.5"/>'},{id:"er-one-start",w:20,h:16,refX:2,refY:8,content:'<line x1="2" y1="2" x2="2" y2="14" stroke="var(--_line)" stroke-width="1.5"/><line x1="6" y1="2" x2="6" y2="14" stroke="var(--_line)" stroke-width="1.5"/>'},{id:"er-many",w:20,h:16,refX:18,refY:8,content:'<line x1="18" y1="2" x2="18" y2="14" stroke="var(--_line)" stroke-width="1.5"/><path d="M18,8 L6,2 M18,8 L6,14" stroke="var(--_line)" stroke-width="1.5" fill="none"/>'},{id:"er-many-start",w:20,h:16,refX:2,refY:8,content:'<line x1="2" y1="2" x2="2" y2="14" stroke="var(--_line)" stroke-width="1.5"/><path d="M2,8 L14,2 M2,8 L14,14" stroke="var(--_line)" stroke-width="1.5" fill="none"/>'},{id:"er-zero-one",w:24,h:16,refX:22,refY:8,content:'<line x1="22" y1="2" x2="22" y2="14" stroke="var(--_line)" stroke-width="1.5"/><circle cx="14" cy="8" r="4" fill="none" stroke="var(--_line)" stroke-width="1.5"/>'},{id:"er-zero-one-start",w:24,h:16,refX:2,refY:8,content:'<line x1="2" y1="2" x2="2" y2="14" stroke="var(--_line)" stroke-width="1.5"/><circle cx="10" cy="8" r="4" fill="none" stroke="var(--_line)" stroke-width="1.5"/>'},{id:"er-zero-many",w:24,h:16,refX:22,refY:8,content:'<path d="M22,8 L10,2 M22,8 L10,14" stroke="var(--_line)" stroke-width="1.5" fill="none"/><circle cx="6" cy="8" r="4" fill="none" stroke="var(--_line)" stroke-width="1.5"/>'},{id:"er-zero-many-start",w:24,h:16,refX:2,refY:8,content:'<path d="M2,8 L14,2 M2,8 L14,14" stroke="var(--_line)" stroke-width="1.5" fill="none"/><circle cx="18" cy="8" r="4" fill="none" stroke="var(--_line)" stroke-width="1.5"/>'}],{id:"cls-inheritance",w:16,h:14,refX:1,refY:7,content:'<path d="M15,1 L1,7 L15,13 z" fill="var(--_node-fill)" stroke="var(--_line)" stroke-width="1.5" stroke-linejoin="round"/>'},{id:"cls-composition",w:14,h:14,refX:1,refY:7,content:'<path d="M1,7 L7,1 L13,7 L7,13 z" fill="var(--_line)" stroke="var(--_line)" stroke-width="1"/>'},{id:"cls-aggregation",w:14,h:14,refX:1,refY:7,content:'<path d="M1,7 L7,1 L13,7 L7,13 z" fill="var(--_node-fill)" stroke="var(--_line)" stroke-width="1.5"/>'}];for(let u of h){let f=A("marker");f.setAttribute("id",u.id),f.setAttribute("markerWidth",String(u.w)),f.setAttribute("markerHeight",String(u.h)),f.setAttribute("refX",String(u.refX)),f.setAttribute("refY",String(u.refY)),f.setAttribute("orient","auto"),f.setAttribute("markerUnits","userSpaceOnUse"),f.innerHTML=u.content,n.appendChild(f)}return n}function Jt(t,n){if(typeof document>"u")throw new Error("renderToDOM can only be used in browser environments");let e=n?.theme??O,r=n?.padding??16,s=n?.transparent??!1;n?.debug;let i=Q(e),o={font:i.font},a=t.width+r*2,c=t.height+r*2,l=s?"none":i.bg,d=A("svg"),h=`cm-${Math.random().toString(36).slice(2,8)}`;d.setAttribute("id",h),d.setAttribute("xmlns",Qt),d.setAttribute("viewBox",`0 0 ${a} ${c}`),d.setAttribute("width",String(a)),d.setAttribute("height",String(c));let u="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap",f=A("style");f.textContent=`
		@import url('${u}');
		#${h} {
			--bg: ${i.bg};
			--fg: ${i.fg};
			--_text: ${i.text};
			--_line: ${i.line};
			--_arrow: ${i.arrow};
			--_node-fill: ${i.nodeFill};
			--_node-stroke: ${i.nodeStroke};
			--_muted: ${i.muted};
			--_group-fill: ${i.groupFill};
			--_group-stroke: ${i.groupStroke};
			--_group-text: ${i.groupText};
		}
	`,d.appendChild(f);let g=A("rect");g.setAttribute("width",String(a)),g.setAttribute("height",String(c)),g.setAttribute("fill",l),d.appendChild(g),d.appendChild(pr());let m=A("g");return m.setAttribute("transform",`translate(${r}, ${r})`),Zt(t.groups,o,m),t.edges.forEach(b=>{m.appendChild(fr(b,o,n||{}))}),t.edges.forEach(b=>{m.appendChild(gr(b,o))}),t.nodes.forEach(b=>{m.appendChild(ur(b,o,n||{}))}),d.appendChild(m),n?.container&&n.container.appendChild(d),d}function V(t){let n=t.getAttribute("viewBox");if(!n){let r=Number.parseFloat(t.getAttribute("width")||"0"),s=Number.parseFloat(t.getAttribute("height")||"0");return{x:0,y:0,width:r,height:s}}let e=n.split(/\s+/).map(Number.parseFloat);return{x:e[0]??0,y:e[1]??0,width:e[2]??0,height:e[3]??0}}function Z(t,n){t.setAttribute("viewBox",`${n.x} ${n.y} ${n.width} ${n.height}`)}function J(t,n){let e=t.getBoundingClientRect(),r=V(t),s=r.width/e.width,i=r.height/e.height,o=(n.clientX-e.left)*s+r.x,a=(n.clientY-e.top)*i+r.y;return{x:o,y:a}}function Kt(t,n){let e=n.clientX-t.clientX,r=n.clientY-t.clientY;return Math.sqrt(e*e+r*r)}function mr(t,n){return{x:(t.clientX+n.clientX)/2,y:(t.clientY+n.clientY)/2}}function te(t,n){let e=n?.minZoom??.1,r=n?.maxZoom??5,s=n?.zoomSpeed??.1,i=V(t),o=!1,a={x:0,y:0},c={...i},l=0,d={...i};function h(y){y.preventDefault();let w=V(t),k=J(t,y),v=y.deltaY>0?1+s:1-s,S=w.width*v,_=w.height*v,C=i.width*r,$=i.height*r,M=i.width*e,P=i.height*e;if(S>C||S<M||_>$||_<P)return;let T=k.x-(k.x-w.x)*S/w.width,D=k.y-(k.y-w.y)*_/w.height;Z(t,{x:T,y:D,width:S,height:_})}function u(y){y.button===0&&(o=!0,a=J(t,y),c=V(t),t.style.cursor="grabbing")}function f(y){if(!o)return;let w=J(t,y),k=w.x-a.x,v=w.y-a.y;Z(t,{x:c.x-k,y:c.y-v,width:c.width,height:c.height})}function g(){o=!1,t.style.cursor="grab"}function m(){Z(t,i)}function b(y){if(y.touches.length===2){y.preventDefault();let w=y.touches[0],k=y.touches[1];l=Kt(w,k),d=V(t)}else if(y.touches.length===1){let w=y.touches[0];a=J(t,{clientX:w.clientX,clientY:w.clientY}),c=V(t),o=!0}}function p(y){if(y.touches.length===2){y.preventDefault();let w=y.touches[0],k=y.touches[1],v=Kt(w,k),S=l/v,_=d.width*S,C=d.height*S,$=i.width*r,M=i.height*r,P=i.width*e,T=i.height*e;if(_>$||_<P||C>M||C<T)return;let D=mr(w,k),E=t.getBoundingClientRect(),I=d,R=I.width/E.width,W=I.height/E.height,B=(D.x-E.left)*R+I.x,F=(D.y-E.top)*W+I.y,nt=B-(B-I.x)*_/I.width,rt=F-(F-I.y)*C/I.height;Z(t,{x:nt,y:rt,width:_,height:C})}else if(y.touches.length===1&&o){y.preventDefault();let w=y.touches[0],k=J(t,{clientX:w.clientX,clientY:w.clientY}),v=k.x-a.x,S=k.y-a.y;Z(t,{x:c.x-v,y:c.y-S,width:c.width,height:c.height})}}function x(){o=!1,l=0}return t.style.cursor="grab",t.addEventListener("wheel",h,{passive:!1}),t.addEventListener("mousedown",u),document.addEventListener("mousemove",f),document.addEventListener("mouseup",g),t.addEventListener("dblclick",m),t.addEventListener("touchstart",b,{passive:!1}),t.addEventListener("touchmove",p,{passive:!1}),t.addEventListener("touchend",x),()=>{t.style.cursor="",t.removeEventListener("wheel",h),t.removeEventListener("mousedown",u),document.removeEventListener("mousemove",f),document.removeEventListener("mouseup",g),t.removeEventListener("dblclick",m),t.removeEventListener("touchstart",b),t.removeEventListener("touchmove",p),t.removeEventListener("touchend",x)}}function br(t){let n=new Map,e=[];return t.querySelectorAll("[data-node-id]").forEach(r=>{let s=r.getAttribute("data-node-id");s&&n.set(s,{element:r,connections:new Set})}),t.querySelectorAll("[data-edge-source]").forEach(r=>{let s=r.getAttribute("data-edge-source"),i=r.getAttribute("data-edge-target");s&&i&&(e.push({source:s,target:i}),n.get(s)?.connections.add(i),n.get(i)?.connections.add(s))}),{nodes:n,edges:e}}function xt(t){if(t.setAttribute("tabindex","0"),t.focus(),t.querySelector(".focus-ring"))return;let r=t.getBBox(),s=4,i=document.createElementNS("http://www.w3.org/2000/svg","rect");i.classList.add("focus-ring"),i.setAttribute("x",String(r.x-s)),i.setAttribute("y",String(r.y-s)),i.setAttribute("width",String(r.width+s*2)),i.setAttribute("height",String(r.height+s*2)),i.setAttribute("fill","none"),i.setAttribute("stroke","#3b82f6"),i.setAttribute("stroke-width","2"),i.setAttribute("stroke-dasharray","4 2"),i.setAttribute("rx","4"),i.setAttribute("pointer-events","none"),t.insertBefore(i,t.firstChild)}function at(t){t.removeAttribute("tabindex");let n=t.querySelector(".focus-ring");n&&n.remove()}function yr(t){let n=new CustomEvent("nodeselect",{detail:{nodeId:t.getAttribute("data-node-id")},bubbles:!0});t.dispatchEvent(n)}function xr(t,n,e){let r=e.nodes.get(t);if(!r)return null;let s=r.element.getBoundingClientRect(),i=[];for(let o of r.connections){let a=e.nodes.get(o);if(!a)continue;let c=a.element.getBoundingClientRect(),l=!1,d=0;switch(n){case"up":l=c.top<s.top,d=s.top-c.top;break;case"down":l=c.bottom>s.bottom,d=c.bottom-s.bottom;break;case"left":l=c.left<s.left,d=s.left-c.left;break;case"right":l=c.right>s.right,d=c.right-s.right;break}l&&d>0&&i.push({id:o,distance:d})}return i.length===0?null:(i.sort((o,a)=>o.distance-a.distance),i[0].id)}function ee(t){let n=br(t),e=null,r=Array.from(n.nodes.keys());if(r.length===0)return()=>{};let s={ArrowUp:"up",ArrowDown:"down",ArrowLeft:"left",ArrowRight:"right"};function i(o){switch(o.key){case"Tab":{if(o.preventDefault(),e){let l=n.nodes.get(e);l&&at(l.element)}let a=e?r.indexOf(e):-1,c=o.shiftKey?a<=0?r.length-1:a-1:(a+1)%r.length;if(e=r[c]??null,e){let l=n.nodes.get(e);l&&xt(l.element)}break}case"Enter":{if(e){let a=n.nodes.get(e);a&&yr(a.element)}break}case"Escape":{if(e){let a=n.nodes.get(e);a&&at(a.element),e=null}break}case"ArrowUp":case"ArrowDown":case"ArrowLeft":case"ArrowRight":{if(o.preventDefault(),!e){if(e=r[0]??null,e){let l=n.nodes.get(e);l&&xt(l.element)}return}let a=s[o.key];if(!a)return;let c=xr(e,a,n);if(c){let l=n.nodes.get(e);l&&at(l.element),e=c;let d=n.nodes.get(e);d&&xt(d.element)}break}}}return t.addEventListener("keydown",i),t.setAttribute("tabindex","0"),()=>{t.removeEventListener("keydown",i),t.removeAttribute("tabindex"),n.nodes.forEach(({element:o})=>{at(o)})}}function wr(t){let n=new Map;return t.querySelectorAll("[data-node-id]").forEach(e=>{let r=e.getAttribute("data-node-id");r&&n.set(r,{id:r,element:e,connectedEdges:new Set})}),t.querySelectorAll("[data-edge-source]").forEach(e=>{let r=e.getAttribute("data-edge-source"),s=e.getAttribute("data-edge-target");if(r&&s){let i=e;n.get(r)?.connectedEdges.add(i),n.get(s)?.connectedEdges.add(i)}}),n}function kr(){let t=document.createElement("div");return t.style.position="absolute",t.style.padding="8px 12px",t.style.background="rgba(0, 0, 0, 0.9)",t.style.color="white",t.style.fontSize="12px",t.style.fontFamily="Inter, system-ui, sans-serif",t.style.borderRadius="6px",t.style.pointerEvents="none",t.style.zIndex="10000",t.style.opacity="0",t.style.transition="opacity 0.2s ease",t.style.maxWidth="300px",t.style.wordWrap="break-word",t.style.boxShadow="0 4px 6px rgba(0, 0, 0, 0.3)",t}function $r(t,n,e){t.textContent=n,t.style.left=`${e.pageX+10}px`,t.style.top=`${e.pageY+10}px`,t.style.opacity="1"}function Ar(t){t.style.opacity="0"}function Sr(t,n){let e=new Set;t.connectedEdges.forEach(r=>{let s=r.getAttribute("data-edge-source"),i=r.getAttribute("data-edge-target");s&&s!==t.id&&e.add(s),i&&i!==t.id&&e.add(i)}),n.forEach(r=>{r.id===t.id||e.has(r.id)?r.element.style.opacity="1":r.element.style.opacity="0.3"}),t.connectedEdges.forEach(r=>{r.style.opacity="1",r.style.strokeWidth="2.5"})}function jt(t,n){t.forEach(e=>{e.element.style.opacity="1"}),n.querySelectorAll("[data-edge-source]").forEach(e=>{let r=e;r.style.opacity="1",r.style.strokeWidth=""})}function ne(t){let n=wr(t),e=kr();document.body.appendChild(e);let r=null;function s(a){let c=a.currentTarget,l=c.getAttribute("data-node-id");if(!l)return;r=l;let d=n.get(l);if(!d)return;let h=c.getAttribute("aria-label")||l;$r(e,h,a),Sr(d,n)}function i(a){if(r){let c=a;e.style.left=`${c.pageX+10}px`,e.style.top=`${c.pageY+10}px`}}function o(){r=null,Ar(e),jt(n,t)}return n.forEach(a=>{a.element.addEventListener("mouseenter",s),a.element.addEventListener("mousemove",i),a.element.addEventListener("mouseleave",o)}),()=>{n.forEach(a=>{a.element.removeEventListener("mouseenter",s),a.element.removeEventListener("mousemove",i),a.element.removeEventListener("mouseleave",o)}),e.remove(),jt(n,t)}}function wt(t){let n=t.getAttribute("viewBox");if(!n){let r=Number.parseFloat(t.getAttribute("width")||"0"),s=Number.parseFloat(t.getAttribute("height")||"0");return{x:0,y:0,width:r,height:s}}let e=n.split(/\s+/).map(Number.parseFloat);return{x:e[0]??0,y:e[1]??0,width:e[2]??0,height:e[3]??0}}function vr(t){let n=t.querySelector("g");if(!n)return wt(t);let e=n.getBBox(),r=20;return{x:e.x-r,y:e.y-r,width:e.width+r*2,height:e.height+r*2}}function Mr(t){return getComputedStyle(t).position==="static"?(t.style.position="relative",!0):!1}function _r(t,n,e){let r=document.createElement("div");r.style.position="absolute",r.style.width=`${t}px`,r.style.height=`${n}px`,r.style.border="1px solid rgba(255, 255, 255, 0.2)",r.style.borderRadius="4px",r.style.overflow="hidden",r.style.background="rgba(0, 0, 0, 0.8)",r.style.zIndex="9999",r.style.pointerEvents="auto";let s="8px";switch(e){case"top-left":r.style.top=s,r.style.left=s;break;case"top-right":r.style.top=s,r.style.right=s;break;case"bottom-left":r.style.bottom=s,r.style.left=s;break;case"bottom-right":r.style.bottom=s,r.style.right=s;break}return r}function Er(t,n,e){let r=document.createElementNS("http://www.w3.org/2000/svg","svg");return r.setAttribute("width",String(n)),r.setAttribute("height",String(e)),r.setAttribute("viewBox",`${t.x} ${t.y} ${t.width} ${t.height}`),r.style.display="block",r.style.pointerEvents="none",r}function Cr(t,n){let e=t.querySelector("g");if(!e)return;let r=e.cloneNode(!0);r.style.pointerEvents="none",n.appendChild(r)}function Lr(){let t=document.createElementNS("http://www.w3.org/2000/svg","rect");return t.setAttribute("fill","rgba(59, 130, 246, 0.3)"),t.setAttribute("stroke","#3b82f6"),t.setAttribute("stroke-width","2"),t.style.pointerEvents="none",t}function Pr(t,n){t.setAttribute("x",String(n.x)),t.setAttribute("y",String(n.y)),t.setAttribute("width",String(n.width)),t.setAttribute("height",String(n.height))}function Ir(t,n,e,r,s,i){let o=n.getBoundingClientRect(),a=(t.clientX-o.left)/s,c=(t.clientY-o.top)/i,l=e.x+a*e.width,d=e.y+c*e.height;return{x:l-r.width/2,y:d-r.height/2,width:r.width,height:r.height}}function re(t,n){let e=n?.width??150,r=n?.height??100,s=n?.position??"bottom-right",i=t.parentElement;if(!i)return()=>{};let o=Mr(i),a=vr(t),c=_r(e,r,s),l=Er(a,e,r),d=Lr();Cr(t,l),l.appendChild(d),c.appendChild(l),i.appendChild(c);let h=()=>{let g=wt(t);Pr(d,g)};h();let u=new MutationObserver(g=>{for(let m of g)m.type==="attributes"&&m.attributeName==="viewBox"&&h()});u.observe(t,{attributes:!0,attributeFilter:["viewBox"]});let f=g=>{let m=wt(t),b=Ir(g,c,a,m,e,r);t.setAttribute("viewBox",`${b.x} ${b.y} ${b.width} ${b.height}`)};return c.addEventListener("click",f),c.style.cursor="pointer",()=>{u.disconnect(),c.removeEventListener("click",f),c.remove(),o&&(i.style.position="")}}function Nr(t,n){let e=[];return t.querySelectorAll("[data-node-id]").forEach(s=>{let i=s.getAttribute("data-node-id");if(i){if(s.style.cursor="pointer",n.onNodeClick){let o=(a=>{n.onNodeClick?.(i,a)});e.push({element:s,type:"click",handler:o})}if(n.onNodeHover){let o=(c=>{n.onNodeHover?.(i,c)});e.push({element:s,type:"mouseenter",handler:o});let a=(c=>{n.onNodeHover?.(null,c)});e.push({element:s,type:"mouseleave",handler:a})}}}),e}function Tr(t,n){let e=[];return t.querySelectorAll("[data-edge-source]").forEach(s=>{let i=s.getAttribute("data-edge-source"),o=s.getAttribute("data-edge-target");if(!(!i||!o)){if(s.style.cursor="pointer",n.onEdgeClick){let a=(c=>{n.onEdgeClick?.(i,o,c)});e.push({element:s,type:"click",handler:a})}if(n.onEdgeHover){let a=(l=>{n.onEdgeHover?.(i,o,l)});e.push({element:s,type:"mouseenter",handler:a});let c=(l=>{n.onEdgeHover?.(i,null,l)});e.push({element:s,type:"mouseleave",handler:c})}}}),e}function ie(t,n){let e=Nr(t,n),r=Tr(t,n),s=[...e,...r];for(let{element:i,type:o,handler:a}of s)i.addEventListener(o,a);return()=>{for(let{element:i,type:o,handler:a}of s)i.removeEventListener(o,a);t.querySelectorAll("[data-node-id]").forEach(i=>{i.style.cursor=""}),t.querySelectorAll("[data-edge-source]").forEach(i=>{i.style.cursor=""})}}function Dr(){let t=document.createElement("div");return t.style.position="absolute",t.style.top="8px",t.style.left="50%",t.style.transform="translateX(-50%)",t.style.background="rgba(0, 0, 0, 0.9)",t.style.border="1px solid #3b82f6",t.style.borderRadius="8px",t.style.padding="8px 12px",t.style.display="flex",t.style.alignItems="center",t.style.gap="8px",t.style.zIndex="10000",t}function zr(){let t=document.createElement("input");return t.type="text",t.placeholder="Search nodes...",t.style.background="transparent",t.style.border="none",t.style.color="white",t.style.outline="none",t.style.fontSize="14px",t.style.fontFamily="Inter, system-ui, sans-serif",t.style.width="200px",t}function Hr(){let t=document.createElement("span");return t.style.color="rgba(255, 255, 255, 0.6)",t.style.fontSize="12px",t.style.whiteSpace="nowrap",t}function Rr(t,n){let r=t.getBBox(),s=4,i=document.createElementNS("http://www.w3.org/2000/svg","rect");return i.setAttribute("x",String(r.x-s)),i.setAttribute("y",String(r.y-s)),i.setAttribute("width",String(r.width+s*2)),i.setAttribute("height",String(r.height+s*2)),i.setAttribute("fill","none"),i.setAttribute("stroke",n),i.setAttribute("stroke-width","3"),i.setAttribute("rx","4"),i.setAttribute("pointer-events","none"),i.classList.add("search-highlight"),i}function Wr(t,n){let e=[],r=n.toLowerCase();return t.querySelectorAll("[data-node-id]").forEach(s=>{let i=s,o=i.getAttribute("data-node-id");if(!o)return;(i.getAttribute("aria-label")||o).toLowerCase().includes(r)&&e.push({element:i,nodeId:o})}),e}function Yr(t,n,e){t.querySelectorAll("[data-node-id]").forEach(r=>{let s=r,i=s.getAttribute("data-node-id");s.style.opacity=i&&n.has(i)?"1":String(e)}),t.querySelectorAll("[data-edge-source]").forEach(r=>{let s=r,i=s.getAttribute("data-edge-source"),o=s.getAttribute("data-edge-target"),a=i&&n.has(i)||o&&n.has(o);s.style.opacity=a?"1":String(e)})}function Xr(t){t.querySelectorAll("[data-node-id]").forEach(n=>{n.style.opacity="1"}),t.querySelectorAll("[data-edge-source]").forEach(n=>{n.style.opacity="1"})}function Or(t){t.querySelectorAll(".search-highlight").forEach(n=>n.remove())}function se(t,n){let e=n?.highlightColor??"#3b82f6",r=n?.dimOpacity??.2,s=t.parentElement;if(!s)return()=>{};let i=getComputedStyle(s),o=!1;i.position==="static"&&(s.style.position="relative",o=!0);let a=null,c=null,l=null,d=[],h=-1,u=!1;function f(){l&&(d.length===0&&c&&c.value.length>0?l.textContent="No results":d.length>0?l.textContent=`${h+1} of ${d.length}`:l.textContent="")}function g(){Or(t),Xr(t),d=[],h=-1}function m(w){if(g(),w.length===0){f();return}let k=Wr(t,w),v=new Set(k.map(S=>S.nodeId));d=k.map(({element:S,nodeId:_})=>{let C=Rr(S,e);return S.appendChild(C),{element:S,nodeId:_,highlight:C}}),d.length>0&&(h=0,Yr(t,v,r),d[0]?.element.scrollIntoView({behavior:"smooth",block:"center"})),f()}function b(){if(d.length===0)return;h=(h+1)%d.length;let w=d[h];w&&w.element.scrollIntoView({behavior:"smooth",block:"center"}),f()}function p(){if(u){c?.focus();return}u=!0,a=Dr(),c=zr(),l=Hr(),a.appendChild(c),a.appendChild(l),s?.appendChild(a),c.focus(),c.addEventListener("input",()=>{c&&m(c.value)}),c.addEventListener("keydown",w=>{w.key==="Enter"&&(w.preventDefault(),b()),w.key==="Escape"&&(w.preventDefault(),x())})}function x(){u&&(u=!1,g(),a&&(a.remove(),a=null),c=null,l=null)}function y(w){(w.metaKey||w.ctrlKey)&&w.key==="f"&&(w.preventDefault(),p())}return t.addEventListener("keydown",y),document.addEventListener("keydown",y),()=>{t.removeEventListener("keydown",y),document.removeEventListener("keydown",y),x(),o&&(s.style.position="")}}var G={shapes:new Map,diagrams:new Map,themes:new Map};function $t(t){if(t.shapes)for(let n of t.shapes)G.shapes.set(n.name,n);if(t.diagrams)for(let n of t.diagrams)G.diagrams.set(n.type,n);if(t.themes)for(let n of t.themes)G.themes.set(n.name,n)}function et(){return G}function At(){G.shapes.clear(),G.diagrams.clear(),G.themes.clear()}function oe(t,n={}){let{theme:e,padding:r,transparent:s,debug:i,...o}=n,a=et(),c=null,l=null,d=t.split(/[\n;]/)[0]?.trim()||"";for(let[,h]of a.diagrams)if(h.detect(d)&&(c=h.parse(t),c?.ast)){h.layout&&(l=h.layout(c.ast,{direction:o.direction,nodeSpacing:o.nodeSpacing,layerSpacing:o.layerSpacing,padding:r}));break}if(!c&&(c=j(t),!c.ast)){let h=c.diagnostics.map(u=>u.message).join(`
`);throw new Error(`Failed to parse diagram:
${h}`)}return l||(l=q(c.ast,{direction:o.direction,nodeSpacing:o.nodeSpacing,layerSpacing:o.layerSpacing,padding:r})),ct(l,{theme:e,padding:r,transparent:s,debug:i})}var St=class{buffer;width;height;constructor(n,e){this.width=n,this.height=e,this.buffer=Array.from({length:e},()=>Array.from({length:n},()=>({char:" "})))}set(n,e,r,s){let i=Math.round(n),o=Math.round(e);i<0||i>=this.width||o<0||o>=this.height||(this.buffer[o][i]={char:r,color:s})}line(n,e,r,s,i,o){let a=Math.round(n),c=Math.round(e),l=Math.round(r),d=Math.round(s),h=Math.abs(l-a),u=Math.abs(d-c),f=a<l?1:-1,g=c<d?1:-1,m=h-u,b=a,p=c;for(;;){let x=i??(h>u?"\u2500":u>h?"\u2502":"\u2500");if(this.set(b,p,x,o),b===l&&p===d)break;let y=2*m;y>-u&&(m-=u,b+=f),y<h&&(m+=h,p+=g)}}box(n,e,r,s,i){let o=Math.round(n),a=Math.round(e),c=Math.round(r),l=Math.round(s);this.set(o,a,"\u250C",i),this.set(o+c-1,a,"\u2510",i),this.set(o,a+l-1,"\u2514",i),this.set(o+c-1,a+l-1,"\u2518",i);for(let d=1;d<c-1;d++)this.set(o+d,a,"\u2500",i),this.set(o+d,a+l-1,"\u2500",i);for(let d=1;d<l-1;d++)this.set(o,a+d,"\u2502",i),this.set(o+c-1,a+d,"\u2502",i)}roundedBox(n,e,r,s,i){let o=Math.round(n),a=Math.round(e),c=Math.round(r),l=Math.round(s);this.set(o,a,"\u256D",i),this.set(o+c-1,a,"\u256E",i),this.set(o,a+l-1,"\u2570",i),this.set(o+c-1,a+l-1,"\u256F",i);for(let d=1;d<c-1;d++)this.set(o+d,a,"\u2500",i),this.set(o+d,a+l-1,"\u2500",i);for(let d=1;d<l-1;d++)this.set(o,a+d,"\u2502",i),this.set(o+c-1,a+d,"\u2502",i)}diamond(n,e,r,s,i){let o=Math.round(n),a=Math.round(e),c=Math.max(1,Math.floor(Math.round(r)/2)),l=Math.max(1,Math.floor(Math.round(s)/2)),d=o-c,h=a-l,u=c*2+1,f=l*2+1;this.set(d,h,"\u25C6",i),this.set(d+u-1,h,"\u25C6",i),this.set(d,h+f-1,"\u25C6",i),this.set(d+u-1,h+f-1,"\u25C6",i);for(let g=1;g<u-1;g++)this.set(d+g,h,"\u2500",i),this.set(d+g,h+f-1,"\u2500",i);for(let g=1;g<f-1;g++)this.set(d,h+g,"\u2502",i),this.set(d+u-1,h+g,"\u2502",i)}text(n,e,r,s){let i=Math.round(n),o=Math.round(e);for(let a=0;a<r.length;a++)this.set(i+a,o,r[a],s)}toHtml(){let n=[];for(let e of this.buffer){let r="",s;for(let i of e){let o=i.char==="<"?"&lt;":i.char===">"?"&gt;":i.char==="&"?"&amp;":i.char;i.color!==s&&(s&&(r+="</span>"),s=i.color,i.color&&(r+=`<span style="color:${i.color}">`)),r+=o}s&&(r+="</span>"),n.push(r)}return n.join(`
`)}};function Br(t,n,e,r){let s=e-t,i=r-n;return Math.abs(s)>Math.abs(i)?s>0?"\u2192":"\u2190":i>0?"\u2193":"\u2191"}function Fr(t,n,e,r){let s=n.x*e,i=n.y*e,o=n.width*e,a=n.height*e,c=r.nodeStroke,l=r.text;switch(n.shape){case"state-start":{let f=Math.round(s+o/2),g=Math.round(i+a/2);t.set(f,g,"\u25CF",c);return}case"state-end":{let f=Math.round(s+o/2),g=Math.round(i+a/2);t.set(f,g,"\u25C9",c);return}case"rounded":case"stadium":t.roundedBox(s,i,o,a,c);break;case"diamond":t.diamond(s+o/2,i+a/2,o,a,c);break;case"circle":t.roundedBox(s,i,o,a,c);break;case"hexagon":t.diamond(s+o/2,i+a/2,o,a,c);break;default:t.box(s,i,o,a,c);break}let h=(n.label||n.id).split(`
`),u=i+Math.floor(a/2)-Math.floor(h.length/2);for(let f=0;f<h.length;f++){let g=h[f],m=s+Math.floor(o/2)-Math.floor(g.length/2);t.text(m,u+f,g,l)}}function Ur(t,n,e,r){if(!(n.points.length<2)){for(let s=0;s<n.points.length-1;s++){let i=n.points[s],o=n.points[s+1];t.line(i.x*e,i.y*e,o.x*e,o.y*e,n.style==="dotted"?"\xB7":void 0,r.line)}if(n.hasArrowEnd&&n.points.length>=2){let s=n.points[n.points.length-1],i=n.points[n.points.length-2];t.set(s.x*e,s.y*e,Br(i.x*e,i.y*e,s.x*e,s.y*e),r.arrow)}n.label&&n.labelPosition&&t.text(n.labelPosition.x*e,n.labelPosition.y*e,n.label,r.muted)}}function ae(t,n,e,r){t.roundedBox(n.x*e,n.y*e,n.width*e,n.height*e,r.groupStroke),n.label&&t.text(n.x*e+2,n.y*e,n.label,r.groupText);for(let s of n.children)ae(t,s,e,r)}function ce(t,n={}){let e=j(t);if(!e.ast){let h=e.diagnostics.map(u=>u.message).join(`
`);throw new Error(`Parse error:
${h}`)}let r=q(e.ast),s=n.width??80,i=Math.min(.15,s/r.width),o=Math.ceil(r.width*i),a=Math.ceil(r.height*i),c=new St(o,a),l=n.theme??O,d=Q(l);for(let h of r.groups)ae(c,h,i,d);for(let h of r.edges)Ur(c,h,i,d);for(let h of r.nodes)Fr(c,h,i,d);return c.toHtml()}return ge(Gr);})();
