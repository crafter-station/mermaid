"use strict";var crafterMermaid=(()=>{var ht=Object.defineProperty;var he=Object.getOwnPropertyDescriptor;var de=Object.getOwnPropertyNames;var ue=Object.prototype.hasOwnProperty;var fe=(t,n)=>{for(var e in n)ht(t,e,{get:n[e],enumerable:!0})},ge=(t,n,e,r)=>{if(n&&typeof n=="object"||typeof n=="function")for(let s of de(n))!ue.call(t,s)&&s!==e&&ht(t,s,{get:()=>n[s],enumerable:!(r=he(n,s))||r.enumerable});return t};var pe=t=>ge(ht({},"__esModule",{value:!0}),t);var qr={};fe(qr,{DEFAULTS:()=>B,THEMES:()=>yt,enableEvents:()=>se,enableHover:()=>re,enableKeyboard:()=>ne,enableMinimap:()=>ie,enableSearch:()=>oe,enableZoomPan:()=>ee,getRegistry:()=>nt,layout:()=>V,parse:()=>K,render:()=>ae,renderToAscii:()=>le,renderToDOM:()=>te,renderToString:()=>lt,resetRegistry:()=>At,use:()=>$t});var me=[[/^\s*sequenceDiagram\s*$/i,"sequence"],[/^\s*classDiagram\s*$/i,"class"],[/^\s*erDiagram\s*$/i,"er"],[/^\s*stateDiagram-v2\s*$/i,"state"],[/^\s*(?:graph|flowchart)\s+(?:TD|TB|LR|BT|RL)\s*$/i,"flowchart"],[/^\s*pie\s+(?:title\s+.+)?$/i,"pie"],[/^\s*gantt\s*$/i,"gantt"],[/^\s*mindmap\s*$/i,"mindmap"]];function It(t){let n=t.split(/[\n;]/);for(let e of n){let r=e.trim();if(!(!r||r.startsWith("%%"))){for(let[s,i]of me)if(s.test(r))return i;break}}return null}function T(t,n,e){return{severity:"error",message:t,span:n,suggestions:e}}function R(t,n,e){return{severity:"warning",message:t,span:n,suggestions:e}}function H(t,n,e,r){return{start:{line:t,column:n,offset:e},end:{line:t,column:n+r,offset:e+r}}}function O(t,n){let e=t.split(/[\n;]/),r=0;for(let i=0;i<n&&i<e.length;i++)r+=(e[i]?.length??0)+1;let s=e[n]?.length??0;return H(n+1,1,r,s)}var Nt=[[/<\|--/,"inheritance"],[/\*--/,"composition"],[/o--/,"aggregation"],[/-->/,"association"],[/\.\.>/,"dependency"],[/\.\.\|>/,"realization"]];function be(t){let n={classes:new Map,relations:[],namespaces:[],diagnostics:[],currentClass:null,currentNamespace:null},e=t.split(`
`);for(let s=0;s<e.length;s++){let o=e[s].trim();if(!o||o.startsWith("%%")||s===0&&/^classDiagram\s*$/i.test(o))continue;let a=O(t,s);if(o.startsWith("class "))ye(o,a,n);else if(o==="{")n.currentClass||n.diagnostics.push(T("Unexpected '{' outside class definition",a));else if(o==="}")n.currentClass=null;else if(n.currentClass)xe(o,a,n);else if(o.startsWith("namespace"))ke(o,a,n);else if(Nt.some(([c])=>c.test(o)))we(o,a,n);else{let c=o.indexOf(":");if(c>0){let l=o.slice(0,c).trim(),h=o.slice(c+1).trim();ut(l,a,n);let d=n.classes.get(l),u=Tt(h,a);u&&d.members.push(u)}else n.diagnostics.push(R(`Skipping unrecognized line: ${o}`,a))}}return{ast:{type:"class",classes:n.classes,relations:n.relations,namespaces:n.namespaces,span:H(1,1,0,t.length)},diagnostics:n.diagnostics}}function ye(t,n,e){let r=t.match(/^class\s+(\w+)(?:\s+<<([^>]+)>>)?(?:\s+as\s+(.+?))?(?:\s*\{)?$/);if(!r){e.diagnostics.push(T("Invalid class definition syntax",n));return}let[,s,i,o]=r,a={id:s,label:o,annotation:i,members:[],span:n};e.classes.set(s,a),e.currentNamespace&&e.currentNamespace.classIds.push(s),t.includes("{")&&(e.currentClass=a)}function xe(t,n,e){let r=Tt(t,n);r&&e.currentClass&&e.currentClass.members.push(r)}function Tt(t,n){let e=t.match(/^([+\-#~])?(.+)$/);if(!e)return null;let[,r,s]=e,i=r||"",o=s.trim(),a=o.includes("$"),c=o.includes("*");o=o.replace(/[$*]/g,"").trim();let l=o.match(/^(\w+)\(([^)]*)\)(?:\s*:\s*(.+))?$/);if(l){let[,u,,f]=l;return{name:u,visibility:i,isStatic:a,isAbstract:c,returnType:f,isMethod:!0,span:n}}let h=o.match(/^(\w+)\s+(\w+)$/);if(h){let[,u,f]=h;return{name:f,type:u,visibility:i,isStatic:a,isAbstract:c,isMethod:!1,span:n}}let d=o.match(/^(\w+)(?:\s*:\s*(.+))?$/);if(d){let[,u,f]=d;return{name:u,type:f,visibility:i,isStatic:a,isAbstract:c,isMethod:!1,span:n}}return null}function we(t,n,e){for(let[r,s]of Nt)if(r.test(t)){let i=t.split(r);if(i.length!==2){e.diagnostics.push(T("Invalid relation syntax",n));return}let o=i[0].trim(),a=i[1].trim(),c,l,h,d=o.match(/^"([^"]+)"\s+(\w+)$/);d&&(l=d[1],o=d[2]);let u=a.match(/^(\w+)\s+"([^"]+)"$/);u&&(a=u[1],h=u[2]);let f=a.match(/^(\w+)\s*:\s*(.+)$/);f&&(a=f[1],c=f[2]),ut(o,n,e),ut(a,n,e),e.relations.push({from:o,to:a,type:s,label:c,fromCardinality:l,toCardinality:h,span:n});return}}function ke(t,n,e){let r=t.match(/^namespace\s+(\w+)(?:\s+as\s+(.+?))?(?:\s*\{)?$/);if(!r){e.diagnostics.push(T("Invalid namespace syntax",n));return}let[,s,i]=r,o={id:s,label:i||s,classIds:[],span:n};e.namespaces.push(o),t.includes("{")&&(e.currentNamespace=o)}function ut(t,n,e){e.classes.has(t)||e.classes.set(t,{id:t,members:[],span:n})}var vt={"||":"one","o|":"zero-one","}|":"many","|{":"many","o{":"zero-many","{o":"zero-many"};function $e(t){let n={entities:new Map,relations:[],diagnostics:[],currentEntity:null},e=t.split(`
`);for(let s=0;s<e.length;s++){let o=e[s].trim();if(!o||o.startsWith("%%")||s===0&&/^erDiagram\s*$/i.test(o))continue;let a=O(t,s);/^(\w+)\s*\{/.test(o)?Ae(o,a,n):o==="}"?n.currentEntity=null:n.currentEntity?Se(o,a,n):/\|\||o\||}\||o\{|\|{|{o/.test(o)&&(o.includes("--")||o.includes(".."))?ve(o,a,n):n.diagnostics.push(R(`Skipping unrecognized line: ${o}`,a))}return{ast:{type:"er",entities:n.entities,relations:n.relations,span:H(1,1,0,t.length)},diagnostics:n.diagnostics}}function Ae(t,n,e){let r=t.match(/^(\w+)\s*\{/);if(!r){e.diagnostics.push(T("Invalid entity definition syntax",n));return}let s=r[1],i={id:s,attributes:[],span:n};e.entities.set(s,i),e.currentEntity=i}function Se(t,n,e){if(!e.currentEntity)return;let r=t.match(/^(\w+)\s+(\w+)(?:\s+(PK|FK|UK|PK,FK|FK,PK))?(?:\s+"([^"]+)")?$/);if(!r){e.diagnostics.push(T("Invalid attribute syntax",n,['Expected: type name [PK|FK|UK] ["comment"]']));return}let[,s,i,o,a]=r,c=o?o.split(","):[];e.currentEntity.attributes.push({name:i,type:s,keys:c,comment:a,span:n})}function ve(t,n,e){let r=/^(\w+)\s+((?:\|\||o\||\}\||o\{|\|\{|\{o))(--|\.\.)(\|\||o\||\}\||o\{|\|\{|\{o)\s+(\w+)\s*:\s*(.+)$/,s=t.match(r);if(!s){e.diagnostics.push(T("Invalid relation syntax",n,["Expected: Entity1 ||--|| Entity2 : label"]));return}let[,i,o,a,c,l,h]=s,d=vt[o],u=vt[c],f=a==="--";if(!d||!u){e.diagnostics.push(T("Invalid cardinality syntax",n,["Expected: ||, o|, }|, |{, o{, or {o"]));return}Mt(i,n,e),Mt(l,n,e),e.relations.push({from:i,to:l,fromCardinality:d,toCardinality:u,label:h,identifying:f,span:n})}function Mt(t,n,e){e.entities.has(t)||e.entities.set(t,{id:t,attributes:[],span:n})}var Me=[{regex:/^([\w-]+)\(\(\((.+?)\)\)\)/,shape:"doublecircle"},{regex:/^([\w-]+)\(\[(.+?)\]\)/,shape:"stadium"},{regex:/^([\w-]+)\(\((.+?)\)\)/,shape:"circle"},{regex:/^([\w-]+)\[\[(.+?)\]\]/,shape:"subroutine"},{regex:/^([\w-]+)\[\((.+?)\)\]/,shape:"cylinder"},{regex:/^([\w-]+)\[\/(.+?)\\\]/,shape:"trapezoid"},{regex:/^([\w-]+)\[\\(.+?)\/\]/,shape:"trapezoid-alt"},{regex:/^([\w-]+)>(.+?)\]/,shape:"asymmetric"},{regex:/^([\w-]+)\{\{(.+?)\}\}/,shape:"hexagon"},{regex:/^([\w-]+)\[(.+?)\]/,shape:"rectangle"},{regex:/^([\w-]+)\((.+?)\)/,shape:"rounded"},{regex:/^([\w-]+)\{(.+?)\}/,shape:"diamond"}],_e=/^([\w-]+)/,Ee=/^:::([\w][\w-]*)/,Ce=/^(<)?(-->|-.->|==>|---|-\.-|===)(?:\|([^|]*)\|)?/;function _t(t,n=!1){let e=t.split(/[\n;]/).map(i=>i.trim()).filter(i=>i.length>0&&!i.startsWith("%%"));if(e.length===0)return{ast:null,diagnostics:[T("Empty diagram",H(1,1,0,0))]};let r={nodes:new Map,edges:[],subgraphs:[],classDefs:new Map,classAssignments:new Map,nodeStyles:new Map,diagnostics:[],direction:"TD",subgraphStack:[],startCount:0,endCount:0},s=e[0];if(n)Pe(e,r,t);else{let i=s.match(/^(?:graph|flowchart)\s+(TD|TB|LR|BT|RL)\s*$/i);i?r.direction=i[1].toUpperCase():r.diagnostics.push(R(`Invalid header: "${s}". Expected "graph TD", "flowchart LR", etc.`,O(t,0))),Le(e,r,t)}if(r.subgraphStack.length>0)for(r.diagnostics.push(R(`Unclosed subgraph: ${r.subgraphStack[r.subgraphStack.length-1].id}`,H(1,1,0,0)));r.subgraphStack.length>0;){let i=r.subgraphStack.pop();r.subgraphStack.length>0?r.subgraphStack[r.subgraphStack.length-1].children.push(i):r.subgraphs.push(i)}return{ast:{type:"flowchart",direction:r.direction,nodes:r.nodes,edges:r.edges,subgraphs:r.subgraphs,classDefs:r.classDefs,classAssignments:r.classAssignments,nodeStyles:r.nodeStyles,span:H(1,1,0,t.length)},diagnostics:r.diagnostics}}function Le(t,n,e){for(let r=1;r<t.length;r++){let s=t[r],i=O(e,r),o=s.match(/^classDef\s+(\w+)\s+(.+)$/);if(o){n.classDefs.set(o[1],Pt(o[2]));continue}let a=s.match(/^class\s+([\w,-]+)\s+(\w+)$/);if(a){for(let d of a[1].split(",").map(u=>u.trim()))n.classAssignments.set(d,a[2]);continue}let c=s.match(/^style\s+([\w,-]+)\s+(.+)$/);if(c){let d=Pt(c[2]);for(let u of c[1].split(",").map(f=>f.trim()))n.nodeStyles.set(u,{...n.nodeStyles.get(u),...d});continue}let l=s.match(/^direction\s+(TD|TB|LR|BT|RL)\s*$/i);if(l&&n.subgraphStack.length>0){n.subgraphStack[n.subgraphStack.length-1].direction=l[1].toUpperCase();continue}let h=s.match(/^subgraph\s+(.+)$/);if(h){let d=h[1].trim(),u=d.match(/^([\w-]+)\s*\[(.+)\]$/),f,g;u?(f=u[1],g=u[2]):(g=d,f=d.replace(/\s+/g,"_").replace(/[^\w]/g,""));let m={id:f,label:g,nodeIds:[],children:[],span:i};n.subgraphStack.push(m);continue}if(s==="end"){let d=n.subgraphStack.pop();d&&(n.subgraphStack.length>0?n.subgraphStack[n.subgraphStack.length-1].children.push(d):n.subgraphs.push(d));continue}Ie(s,i,n)}}function Pe(t,n,e){for(let r=1;r<t.length;r++){let s=t[r],i=O(e,r),o=s.match(/^direction\s+(TD|TB|LR|BT|RL)\s*$/i);if(o){n.subgraphStack.length>0?n.subgraphStack[n.subgraphStack.length-1].direction=o[1].toUpperCase():n.direction=o[1].toUpperCase();continue}let a=s.match(/^state\s+(?:"([^"]+)"\s+as\s+)?(\w+)\s*\{$/);if(a){let d=a[1]??a[2],f={id:a[2],label:d,nodeIds:[],children:[],span:i};n.subgraphStack.push(f);continue}if(s==="}"){let d=n.subgraphStack.pop();d&&(n.subgraphStack.length>0?n.subgraphStack[n.subgraphStack.length-1].children.push(d):n.subgraphs.push(d));continue}let c=s.match(/^state\s+"([^"]+)"\s+as\s+(\w+)\s*$/);if(c){G(n,{id:c[2],label:c[1],shape:"rounded",span:i});continue}let l=s.match(/^(\[\*\]|[\w-]+)\s*(-->)\s*(\[\*\]|[\w-]+)(?:\s*:\s*(.+))?$/);if(l){let d=l[1],u=l[3],f=l[4]?.trim()||void 0;d==="[*]"?(n.startCount++,d=`_start${n.startCount>1?n.startCount:""}`,G(n,{id:d,label:"",shape:"state-start",span:i})):Lt(n,d,i),u==="[*]"?(n.endCount++,u=`_end${n.endCount>1?n.endCount:""}`,G(n,{id:u,label:"",shape:"state-end",span:i})):Lt(n,u,i),n.edges.push({source:d,target:u,label:f,style:"solid",hasArrowStart:!1,hasArrowEnd:!0,span:i});continue}let h=s.match(/^([\w-]+)\s*:\s*(.+)$/);if(h){G(n,{id:h[1],label:h[2].trim(),shape:"rounded",span:i});continue}}}function Ie(t,n,e){let r=t.trim(),s=Et(r,n,e);if(!s||s.ids.length===0){r.length>0&&e.diagnostics.push(R(`Skipping unrecognized line: ${t}`,n));return}r=s.remaining.trim();let i=s.ids,o=!1;for(;r.length>0;){let a=r.match(Ce);if(!a)break;let c=!!a[1],l=a[2],h=a[3]?.trim()||void 0;r=r.slice(a[0].length).trim();let d=Ne(l),u=l.endsWith(">"),f=Et(r,n,e);if(!f||f.ids.length===0)break;r=f.remaining.trim();for(let g of i)for(let m of f.ids)e.edges.push({source:g,target:m,label:h,style:d,hasArrowStart:c,hasArrowEnd:u,span:n});o=!0,i=f.ids}(r.length>0||!o&&s.remaining.trim().length>0)&&e.diagnostics.push(R(`Skipping unrecognized line: ${t}`,n))}function Et(t,n,e){let r=Ct(t,n,e);if(!r)return null;let s=[r.id],i=r.remaining.trim();for(;i.startsWith("&");){i=i.slice(1).trim();let o=Ct(i,n,e);if(!o)break;s.push(o.id),i=o.remaining.trim()}return{ids:s,remaining:i}}function Ct(t,n,e){let r=null,s=t;for(let{regex:o,shape:a}of Me){let c=t.match(o);if(c){r=c[1];let l=c[2];G(e,{id:r,label:l,shape:a,span:n}),s=t.slice(c[0].length);break}}if(r===null){let o=t.match(_e);o&&(r=o[1],e.nodes.has(r)?ft(e,r):G(e,{id:r,label:r,shape:"rectangle",span:n}),s=t.slice(o[0].length))}if(r===null)return null;let i=s.match(Ee);return i&&(e.classAssignments.set(r,i[1]),s=s.slice(i[0].length)),{id:r,remaining:s}}function G(t,n){t.nodes.has(n.id)||t.nodes.set(n.id,n),ft(t,n.id)}function ft(t,n){if(t.subgraphStack.length>0){let e=t.subgraphStack[t.subgraphStack.length-1];e.nodeIds.includes(n)||e.nodeIds.push(n)}}function Lt(t,n,e){t.nodes.has(n)?ft(t,n):G(t,{id:n,label:n,shape:"rounded",span:e})}function Ne(t){return t==="-.->"||t==="-.-"?"dotted":t==="==>"||t==="==="?"thick":"solid"}function Pt(t){let n={};for(let e of t.split(",")){let r=e.indexOf(":");if(r>0){let s=e.slice(0,r).trim(),i=e.slice(r+1).trim();s&&i&&(n[s]=i)}}return n}function Te(t){let n={sections:new Map,currentSection:"",diagnostics:[]},e=t.split(`
`);for(let i=0;i<e.length;i++){let a=e[i].trim();if(!a||a.startsWith("%%")||i===0&&/^gantt\s*$/i.test(a))continue;let c=O(t,i);if(/^title\s+(.+)$/i.test(a)){let l=a.match(/^title\s+(.+)$/i);l&&(n.title=l[1].trim());continue}if(/^dateFormat\s+(.+)$/i.test(a)){let l=a.match(/^dateFormat\s+(.+)$/i);l&&(n.dateFormat=l[1].trim());continue}if(/^section\s+(.+)$/i.test(a)){let l=a.match(/^section\s+(.+)$/i);l&&(n.currentSection=l[1].trim(),n.sections.has(n.currentSection)||n.sections.set(n.currentSection,[]));continue}n.currentSection?De(a,c,n):n.diagnostics.push(R(`Task defined before any section: ${a}`,c))}let r=Array.from(n.sections.entries()).map(([i,o])=>({name:i,tasks:o}));return{ast:{type:"gantt",title:n.title,dateFormat:n.dateFormat,sections:r,span:H(1,1,0,t.length)},diagnostics:n.diagnostics}}function De(t,n,e){let r=/^(?:(done|active|crit|milestone)\s+)?([^:]+)\s*:\s*(?:(\w+),\s*)?(.+)$/,s=t.match(r);if(!s){e.diagnostics.push(T("Invalid task syntax",n,["Expected: [status] label : [id,] timing"]));return}let[,i,o,a,c]=s,l=i,h={label:o.trim(),status:l,id:a,section:e.currentSection,span:n},d=c.match(/^after\s+(\w+)(?:,\s*(.+))?$/);if(d)h.afterId=d[1],d[2]&&(h.duration=d[2].trim());else{let f=c.split(",").map(g=>g.trim());if(f.length===2){let[g,m]=f;h.startDate=g,/^\d+d$/.test(m)?h.duration=m:h.endDate=m}else f.length===1&&(h.startDate=f[0])}let u=e.sections.get(e.currentSection);u&&u.push(h)}function ze(t){let n={root:null,nodeStack:[],diagnostics:[],nodeIdCounter:0},e=t.split(`
`);for(let s=0;s<e.length;s++){let i=e[s],o=i.trim();if(!o||o.startsWith("%%")||s===0&&/^mindmap\s*$/i.test(o))continue;let a=O(t,s),c=Re(i),l=He(o,a,n);l&&(n.root===null?(n.root=l,n.nodeStack=[{node:l,indent:c}]):We(l,c,n))}return n.root?{ast:{type:"mindmap",root:n.root,span:H(1,1,0,t.length)},diagnostics:n.diagnostics}:(n.diagnostics.push(T("Mindmap must have at least one root node",H(1,1,0,0))),{ast:null,diagnostics:n.diagnostics})}function He(t,n,e){let r={"((":"circle","(":"rounded","))":"bang",")":"cloud","{{":"hexagon"},s=t,i="default";for(let[o,a]of Object.entries(r)){let c=o.split("").reverse().join(""),l=new RegExp(`^\\${o.split("").join("\\")}(.+?)\\${c.split("").join("\\")}$`),h=t.match(l);if(h){s=h[1],i=a;break}}return s?{id:`node-${e.nodeIdCounter++}`,label:s,shape:i,children:[],span:n}:(e.diagnostics.push(R(`Empty node label: ${t}`,n)),null)}function Re(t){let n=0;for(let e of t)if(e===" ")n++;else if(e==="	")n+=2;else break;return n}function We(t,n,e){for(;e.nodeStack.length>0&&e.nodeStack[e.nodeStack.length-1].indent>=n;)e.nodeStack.pop();if(e.nodeStack.length===0){e.diagnostics.push(R(`Node at same or lower indent than root: ${t.label}`,t.span));return}e.nodeStack[e.nodeStack.length-1].node.children.push(t),e.nodeStack.push({node:t,indent:n})}function Ye(t){let n={slices:[],showData:!1,diagnostics:[]},e=t.split(`
`);for(let s=0;s<e.length;s++){let o=e[s].trim();if(!o||o.startsWith("%%")||s===0&&/^pie\s*$/i.test(o))continue;let a=O(t,s);if(/^pie\s+showData\s*$/i.test(o)){n.showData=!0;continue}if(/^title\s+(.+)$/i.test(o)){let l=o.match(/^title\s+(.+)$/i);l&&(n.title=l[1].trim());continue}let c=o.match(/^"([^"]+)"\s*:\s*(\d+(?:\.\d+)?)$/);if(c){let[,l,h]=c,d=Number.parseFloat(h);if(Number.isNaN(d)||d<0){n.diagnostics.push(T("Slice value must be a non-negative number",a));continue}n.slices.push({label:l,value:d,span:a});continue}n.diagnostics.push(R(`Skipping unrecognized line: ${o}`,a))}return{ast:{type:"pie",title:n.title,showData:n.showData,slices:n.slices,span:H(1,1,0,t.length)},diagnostics:n.diagnostics}}var Xe=[{pattern:/-->>/,type:"dashed"},{pattern:/->>/,type:"solid"},{pattern:/-\)/,type:"open"},{pattern:/-x/,type:"cross"}];function Oe(t){let n={participants:new Map,messages:[],diagnostics:[],blockStack:[]},e=t.split(`
`);for(let s=0;s<e.length;s++){let o=e[s].trim();if(!o||o.startsWith("%%")||s===0&&/^sequenceDiagram\s*$/i.test(o))continue;let a=O(t,s);o.startsWith("participant")||o.startsWith("actor")?Fe(o,a,n):o.startsWith("Note")?Ue(o,a,n):o.startsWith("loop")||o.startsWith("alt")||o.startsWith("opt")||o.startsWith("par")||o.startsWith("critical")||o.startsWith("break")||o.startsWith("rect")?Ge(o,a,n):o==="end"?qe(a,n):o.startsWith("else")||o.startsWith("and")?je(o,a,n):o.includes("-->>")||o.includes("->>")||o.includes("-x")||o.includes("-)")?Be(o,a,n):o.startsWith("activate")||o.startsWith("deactivate")?Ke(o,a,n):n.diagnostics.push(R(`Skipping unrecognized line: ${o}`,a))}return n.blockStack.length>0&&n.diagnostics.push(R(`Unclosed block: ${n.blockStack[n.blockStack.length-1].block.type}`,H(1,1,0,0))),{ast:{type:"sequence",participants:Array.from(n.participants.values()),messages:n.messages,span:H(1,1,0,t.length)},diagnostics:n.diagnostics}}function Fe(t,n,e){let r=t.match(/^(participant|actor)\s+(\w+)(?:\s+as\s+(.+))?$/);if(!r){e.diagnostics.push(T("Invalid participant syntax",n,["Expected: participant id as label"]));return}let[,s,i,o]=r,a={id:i,label:o||i,type:s,span:n};e.participants.set(i,a)}function Be(t,n,e){for(let{pattern:r,type:s}of Xe)if(r.test(t)){let i=t.split(r);if(i.length!==2){e.diagnostics.push(T("Invalid message syntax",n,["Expected: participant1 ->> participant2: message"]));return}let o=i[0].trim(),a=i[1].trim(),c,l,h=!1,d=!1;if(a.includes(":")){let[f,...g]=a.split(":");c=f.trim(),l=g.join(":").trim()}else c=a,l="";o.endsWith("+")&&(o=o.slice(0,-1).trim(),h=!0),o.endsWith("-")&&(o=o.slice(0,-1).trim(),d=!0),q(o,n,e),q(c,n,e);let u={from:o,to:c,label:l,arrowType:s,activate:h||void 0,deactivate:d||void 0,span:n};e.blockStack.length>0?e.blockStack[e.blockStack.length-1].currentSection.messages.push(u):e.messages.push(u);return}e.diagnostics.push(T("Invalid message arrow",n,["Expected one of: ->>, -->>, -), -x"]))}function Ue(t,n,e){let r=t.match(/^Note\s+left\s+of\s+(\w+):\s*(.+)$/);if(r){let[,o,a]=r;q(o,n,e),dt({placement:"left",participants:[o],text:a,span:n},e);return}let s=t.match(/^Note\s+right\s+of\s+(\w+):\s*(.+)$/);if(s){let[,o,a]=s;q(o,n,e),dt({placement:"right",participants:[o],text:a,span:n},e);return}let i=t.match(/^Note\s+over\s+([\w,\s]+):\s*(.+)$/);if(i){let[,o,a]=i,c=o.split(",").map(h=>h.trim());for(let h of c)q(h,n,e);dt({placement:"over",participants:c,text:a,span:n},e);return}e.diagnostics.push(T("Invalid note syntax",n))}function Ge(t,n,e){let r=t.match(/^(loop|alt|opt|par|critical|break|rect)(?:\s+(.+))?$/);if(!r){e.diagnostics.push(T("Invalid block syntax",n));return}let[,s,i]=r,o={type:s,label:i||"",sections:[],span:n},a={label:void 0,messages:[]};o.sections.push(a),e.blockStack.push({block:o,currentSection:a})}function je(t,n,e){if(e.blockStack.length===0){e.diagnostics.push(T("Unexpected block section outside block",n));return}let r=t.match(/^(else|and)(?:\s+(.+))?$/);if(!r){e.diagnostics.push(T("Invalid block section syntax",n));return}let[,,s]=r,i={label:s,messages:[]},o=e.blockStack[e.blockStack.length-1];o.block.sections.push(i),o.currentSection=i}function qe(t,n){if(n.blockStack.length===0){n.diagnostics.push(T("Unexpected 'end' without block",t));return}let{block:e}=n.blockStack.pop();n.blockStack.length>0?n.blockStack[n.blockStack.length-1].currentSection.messages.push(e):n.messages.push(e)}function Ke(t,n,e){let r=t.match(/^(activate|deactivate)\s+(\w+)$/);if(!r){e.diagnostics.push(T("Invalid activation syntax",n));return}let[,s,i]=r;q(i,n,e),e.diagnostics.push(R(`Standalone ${s} not fully supported, use +/- on messages`,n))}function q(t,n,e){e.participants.has(t)||e.participants.set(t,{id:t,label:t,type:"participant",span:n})}function dt(t,n){n.blockStack.length>0?n.blockStack[n.blockStack.length-1].currentSection.messages.push(t):n.messages.push(t)}function K(t){let n=It(t);if(!n)return{ast:null,diagnostics:[T("Unable to detect diagram type",H(1,1,0,0),["Expected first line to be one of: graph/flowchart, sequenceDiagram, classDiagram, erDiagram, stateDiagram-v2"])]};switch(n){case"flowchart":return _t(t,!1);case"state":return _t(t,!0);case"sequence":return Oe(t);case"class":return be(t);case"er":return $e(t);case"pie":return Ye(t);case"gantt":return Te(t);case"mindmap":return ze(t)}}var gt={normal:.52,medium:.55,bold:.58};function it(t,n,e=400){let r=e>=600?gt.bold:e>=500?gt.medium:gt.normal;return t.length*n*r}function pt(t,n,e=14){let r=t.split(`
`),s=Math.max(...r.map(c=>it(c,e))),i=r.length*e*1.2,o,a;switch(n){case"state-start":{o=28,a=28;break}case"state-end":{o=32,a=32;break}case"diamond":case"rhombus":{o=s*1.6+32,a=i*1.6+24;break}case"circle":case"doublecircle":{let c=Math.max(s,i)+32;o=c,a=c;break}case"stadium":case"pill":{o=s+i+16,a=i+16;break}case"hexagon":{o=s+48,a=i+24;break}case"trapezoid":case"inv-trapezoid":{o=s+56,a=i+24;break}case"odd":case"lean-right":case"lean-left":{o=s+40,a=i+24;break}case"class-box":{o=s+32,a=i+24;break}case"er-entity":{let c=t.split(`
`),l=c.includes("---"),h=e*1.2+16;if(l){let d=c.filter(b=>b!=="---"&&b!==c[0]),u=it(c[0]||"",e,600),f=d.map(b=>it(b,e-2)),g=f.length>0?Math.max(...f):0;o=Math.max(u,g)+48;let m=d.length*(e-2)*1.4+12;a=h+m}else{let d=it(c[0]||"",e,600);o=Math.max(d+40,120),a=h+24}break}default:{o=s+24,a=i+16;break}}return{width:o,height:a}}var Ve=class{nodes=new Map;edges=new Map;inEdges=new Map;outEdges=new Map;children=new Map;addNode(t,n,e=0,r=0){this.nodes.set(t,{id:t,data:n,width:e,height:r}),this.inEdges.has(t)||this.inEdges.set(t,new Set),this.outEdges.has(t)||this.outEdges.set(t,new Set)}removeNode(t){let n=this.inEdges.get(t);if(n)for(let s of n)this.removeEdge(s,t);let e=this.outEdges.get(t);if(e)for(let s of e)this.removeEdge(t,s);this.nodes.delete(t),this.inEdges.delete(t),this.outEdges.delete(t);let r=this.nodes.get(t)?.parent;r&&this.children.get(r)?.delete(t)}addEdge(t,n,e,r=1){let s=`${t}->${n}`;this.edges.set(s,{source:t,target:n,data:e,weight:r}),this.outEdges.has(t)||this.outEdges.set(t,new Set),this.inEdges.has(n)||this.inEdges.set(n,new Set),this.outEdges.get(t).add(n),this.inEdges.get(n).add(t)}removeEdge(t,n){let e=`${t}->${n}`;this.edges.delete(e),this.outEdges.get(t)?.delete(n),this.inEdges.get(n)?.delete(t)}setParent(t,n){let e=this.nodes.get(t);e&&(e.parent=n,this.children.has(n)||this.children.set(n,new Set),this.children.get(n).add(t))}getNode(t){return this.nodes.get(t)}getEdge(t,n){return this.edges.get(`${t}->${n}`)}predecessors(t){return Array.from(this.inEdges.get(t)||[])}successors(t){return Array.from(this.outEdges.get(t)||[])}sources(){let t=[];for(let n of this.nodes.keys())(this.inEdges.get(n)?.size||0)===0&&t.push(n);return t}sinks(){let t=[];for(let n of this.nodes.keys())(this.outEdges.get(n)?.size||0)===0&&t.push(n);return t}nodeIds(){return Array.from(this.nodes.keys())}getEdges(){return Array.from(this.edges.values())}getChildren(t){return Array.from(this.children.get(t)||[])}reverseEdge(t,n){let e=this.getEdge(t,n);e&&(this.removeEdge(t,n),this.addEdge(n,t,e.data,e.weight))}hasEdge(t,n){return this.edges.has(`${t}->${n}`)}nodeCount(){return this.nodes.size}edgeCount(){return this.edges.size}};function Qe(t){let n=new Set,e=new Set,r=[];function s(o){n.add(o),e.add(o);let a=t.successors(o);for(let c of a)n.has(c)?e.has(c)&&(t.reverseEdge(o,c),r.push({source:o,target:c})):s(c);e.delete(o)}let i=t.sources();if(i.length===0){let o=t.nodeIds();o.length>0&&s(o[0])}else for(let o of i)n.has(o)||s(o);for(let o of t.nodeIds())n.has(o)||s(o);return r}function Ze(t,n){for(let e of n)t.reverseEdge(e.target,e.source)}function Je(t){let n=new Map,e=[],r=[];for(let s of t.nodeIds()){let i=t.predecessors(s).length;n.set(s,i),i===0&&e.push(s)}for(;e.length>0;){e.sort();let s=e.shift();r.push(s);for(let i of t.successors(s)){let o=n.get(i)-1;n.set(i,o),o===0&&e.push(i)}}return r}function tn(t){let n=new Map,e=Je(t);for(let s of e){let i=t.predecessors(s);if(i.length===0)n.set(s,0);else{let o=Math.max(...i.map(a=>n.get(a)??0));n.set(s,o+1)}}let r=Math.max(...Array.from(n.values()));return{layers:n,maxLayer:r}}function en(t,n){let e=new Map,r=t.getEdges(),s=0;for(let i of r){let o=n.get(i.source)??0,c=(n.get(i.target)??0)-o;if(c>1){let l=[],h=i.source;for(let d=1;d<c;d++){let u=`__virtual_${s++}`;t.addNode(u,i.data,0,0),n.set(u,o+d),t.addEdge(h,u,i.data,i.weight),l.push(u),h=u}t.addEdge(h,i.target,i.data,i.weight),t.removeEdge(i.source,i.target),e.set(`${i.source}->${i.target}`,l)}}return e}function nn(t,n){let e=Array.from({length:n+1},()=>[]);for(let[r,s]of t)e[s].push(r);for(let r of e)r.sort();return e}function Dt(t,n){let e=0;for(let r=0;r<n.length-1;r++){let s=n[r],i=n[r+1],o=new Map;for(let a=0;a<i.length;a++)o.set(i[a],a);for(let a=0;a<s.length;a++){let c=s[a],l=t.successors(c);for(let h=a+1;h<s.length;h++){let d=s[h],u=t.successors(d);for(let f of l){let g=o.get(f);if(g!==void 0)for(let m of u){let b=o.get(m);b!==void 0&&g>b&&e++}}}}}return e}function zt(t,n,e,r){let s=new Map;for(let o=0;o<e.length;o++)s.set(e[o],o);let i=n.map(o=>{let c=(r?t.predecessors(o):t.successors(o)).filter(h=>s.has(h));if(c.length===0)return{nodeId:o,weight:0};let l=c.reduce((h,d)=>h+s.get(d),0);return{nodeId:o,weight:l/c.length}});return i.sort((o,a)=>o.weight!==a.weight?o.weight-a.weight:o.nodeId.localeCompare(a.nodeId)),i.map(o=>o.nodeId)}function rn(t,n){let e=n.map(o=>[...o]),r=Dt(t,e);if(r===0)return e;let s=24,i=e.map(o=>[...o]);for(let o=0;o<s;o++){if(o%2===0)for(let l=1;l<i.length;l++)i[l]=zt(t,i[l],i[l-1],!0);else for(let l=i.length-2;l>=0;l--)i[l]=zt(t,i[l],i[l+1],!1);let c=Dt(t,i);if(c<r&&(r=c,e=i.map(l=>[...l]),r===0))break}return e}function sn(t){return t==="LR"||t==="RL"}function on(t,n,e,r){let s=new Map,i=[];for(let a=0;a<n.length;a++){let c=Math.max(...n[a].map(l=>{let h=t.getNode(l);return h?r?h.width:h.height:0}));i.push(c)}let o=i[0]/2;for(let a=0;a<n.length;a++)a>0&&(o+=i[a-1]/2+e+i[a]/2),s.set(a,o);return s}function an(t,n,e,r){let s=new Map;for(let i of n){let o=0;for(let l of i){let h=t.getNode(l);if(!h)continue;let d=r?h.height:h.width;s.set(l,o+d/2),o+=d+e}let c=(o-e)/2;for(let l of i)s.set(l,s.get(l)-c)}return s}function st(t,n,e,r,s){for(let i of n){let o=i.map(a=>({nodeId:a,pos:e.get(a)})).sort((a,c)=>a.pos-c.pos);for(let a=1;a<o.length;a++){let c=t.getNode(o[a-1].nodeId),l=t.getNode(o[a].nodeId);if(!c||!l)continue;let h=s?c.height:c.width,d=s?l.height:l.width,u=o[a-1].pos+h/2+r+d/2;o[a].pos<u&&(o[a].pos=u,e.set(o[a].nodeId,u))}}}function cn(t,n,e,r,s){let i=new Map(e),o=24,a=.5,c=h=>h.startsWith("__virtual_"),l=.2;for(let h=0;h<o;h++){let d=new Map;for(let u of n)for(let f of u){let g=[...t.predecessors(f),...t.successors(f)];if(g.length===0){d.set(f,i.get(f));continue}let m=0,b=0;for(let k of g){let A=c(k)&&!c(f)?l:1;m+=(i.get(k)??0)*A,b+=A}let p=m/b,w=i.get(f),y=w+(p-w)*a;d.set(f,y)}st(t,n,d,r,s),i.clear();for(let[u,f]of d)i.set(u,f)}return i}function ln(t,n,e,r,s){let i=new Map(e);for(let o=0;o<4;o++){for(let a of n)for(let c of a){let l=t.predecessors(c),h=t.successors(c),d=null;if(l.length===1){let u=l[0];t.successors(u).length===1&&(d=i.get(u))}if(d===null&&h.length===1){let u=h[0];t.predecessors(u).length===1&&(d=i.get(u))}d!==null&&i.set(c,d)}st(t,n,i,r,s)}return i}function hn(t,n,e,r,s){let i=new Map(e),o=a=>a.startsWith("__virtual_");for(let a=0;a<8;a++){if(a%2===0)for(let l=0;l<n.length;l++){let h=n[l];for(let d of h){let u=t.successors(d);if(u.length<2)continue;let f=n[l+1];if(!f)continue;let g=u.filter(A=>f.includes(A));if(g.length<2)continue;let m=g.filter(A=>!o(A)),b=m.length>=2?m:g,p=i.get(d),w=b.map(A=>i.get(A)),y=(Math.min(...w)+Math.max(...w))/2,k=p-y;if(!(Math.abs(k)<1))for(let A of g)i.set(A,i.get(A)+k)}}else for(let l=n.length-1;l>=0;l--){let h=n[l];for(let d of h){if(o(d))continue;let u=t.predecessors(d);if(u.length<2)continue;let f=n[l-1];if(!f)continue;let g=u.filter(y=>f.includes(y)),m=g.filter(y=>!o(y)),b=m.length>=2?m:g;if(b.length<2)continue;let p=b.map(y=>i.get(y)),w=(Math.min(...p)+Math.max(...p))/2;i.set(d,w)}}st(t,n,i,r,s)}return i}function dn(t,n,e,r,s){let i=new Map(e),o=a=>a.startsWith("__virtual_");for(let a=0;a<8;a++){for(let c=0;c<n.length;c++){let l=n[c];for(let h of l){if(o(h))continue;let u=t.successors(h).filter(f=>!o(f)&&n[c+1]?.includes(f));if(u.length>=2){let f=i.get(h),g=u.map(p=>i.get(p)),m=(Math.min(...g)+Math.max(...g))/2,b=f-m;if(Math.abs(b)>1)for(let p of u)i.set(p,i.get(p)+b)}}}for(let c=n.length-1;c>=0;c--){let l=n[c];for(let h of l){if(o(h))continue;let d=t.predecessors(h),u=d.filter(f=>!o(f)&&n[c-1]?.includes(f));if(u.length>=2){let f=u.map(m=>i.get(m)),g=(Math.min(...f)+Math.max(...f))/2;i.set(h,g)}if(l.length===1){let f=d.filter(b=>!o(b)),g=t.successors(h).filter(b=>!o(b)),m=[...f,...g];if(m.length>0){let b=m.reduce((w,y)=>w+(i.get(y)??0),0)/m.length,p=i.get(h);i.set(h,p+(b-p)*.5)}}}}st(t,n,i,r,s)}return i}function un(t,n){let e=Array.from(t.values()),r=Math.min(...e),s=new Map;for(let[i,o]of t)s.set(i,o-r+n);return s}function fn(t,n,e,r,s,i){let o=sn(i),a=on(t,n,r,o),c=an(t,n,e,o),l=cn(t,n,c,e,o),h=ln(t,n,l,e,o),d=hn(t,n,h,e,o),u=dn(t,n,d,e,o),f=un(u,s),g=new Map;for(let p=0;p<n.length;p++){let w=a.get(p)+s;for(let y of n[p]){let k=f.get(y);o?g.set(y,{x:w,y:k}):g.set(y,{x:k,y:w})}}if(i==="BT"||i==="RL"){let p=Math.max(...o?Array.from(g.values()).map(w=>w.x):Array.from(g.values()).map(w=>w.y));for(let[w,y]of g)o?g.set(w,{x:p-y.x+2*s,y:y.y}):g.set(w,{x:y.x,y:p-y.y+2*s})}let m=0,b=0;for(let[p,w]of g){let y=t.getNode(p);if(!y)continue;let k=w.x+y.width/2+s,A=w.y+y.height/2+s;k>m&&(m=k),A>b&&(b=A)}return{positions:g,width:m,height:b}}function gn(t,n,e){let r=new Ve;for(let y of t)r.addNode(y.id,{},y.width,y.height);for(let y of n)r.addEdge(y.source,y.target,{},y.weight??1);let s=Qe(r),{layers:i,maxLayer:o}=tn(r),a=en(r,i),c=nn(i,o),l=rn(r,c),h=e.direction??"TB",d=e.nodeSpacing??50,u=e.layerSpacing??100,f=e.padding??20,{positions:g,width:m,height:b}=fn(r,l,d,u,f,h);Ze(r,s);let p=new Map;for(let y of t){let k=g.get(y.id);k&&p.set(y.id,k)}let w=new Map;for(let y of n){let k=g.get(y.source),A=g.get(y.target);if(!k||!A)continue;let E=a.get(`${y.source}->${y.target}`)??[],x=[k];for(let v of E){let _=g.get(v);_&&x.push(_)}x.push(A),w.set(`${y.source}->${y.target}`,x)}return{nodePositions:p,edgeRoutes:w,width:m,height:b}}function pn(t){return t==="LR"||t==="RL"}function mn(t,n){if(t.length<2)return t;let e=t[0],r=t[t.length-1],s=pn(n);if(t.length===2||t.length===3){if(s){if(Math.abs(e.y-r.y)<8)return[e,r];let a=(e.x+r.x)/2;return[e,{x:a,y:e.y},{x:a,y:r.y},r]}if(Math.abs(e.x-r.x)<8)return[e,r];let o=(e.y+r.y)/2;return[e,{x:e.x,y:o},{x:r.x,y:o},r]}let i=[e];for(let o=1;o<t.length-1;o++){let a=i[i.length-1],c=t[o];s?(i.push({x:c.x,y:a.y}),Math.abs(c.y-a.y)>1&&i.push({x:c.x,y:c.y})):(i.push({x:a.x,y:c.y}),Math.abs(c.x-a.x)>1&&i.push({x:c.x,y:c.y}))}return i.push(r),i}function Ht(t,n,e){let r=t.x-n.x,s=t.y-n.y,i=n.width/2,o=n.height/2;switch(e){case"circle":case"doublecircle":case"state-start":case"state-end":{let a=Math.max(i,o),c=Math.atan2(s,r);return{x:n.x+a*Math.cos(c),y:n.y+a*Math.sin(c)}}case"diamond":case"rhombus":{let a=Math.atan2(s,r),c=Math.abs(a);if(c<Math.PI/4||c>3*Math.PI/4){let h=i/Math.abs(Math.cos(a)),d=n.x+h*Math.cos(a),u=n.y+h*Math.sin(a);if(Math.abs(u-n.y)<=o)return{x:d,y:u}}let l=o/Math.abs(Math.sin(a));return{x:n.x+l*Math.cos(a),y:n.y+l*Math.sin(a)}}case"hexagon":{let a=Math.atan2(s,r),c=Math.PI/3;if(Math.abs(a)<c||Math.abs(a)>Math.PI-c){let h=i/Math.abs(Math.cos(a));return{x:n.x+h*Math.cos(a),y:n.y+h*Math.sin(a)}}let l=o/Math.abs(Math.sin(a));return{x:n.x+l*Math.cos(a),y:n.y+l*Math.sin(a)}}default:{let a=Math.atan2(s,r);if(Math.abs(Math.cos(a))*o>Math.abs(Math.sin(a))*i){let l=i/Math.abs(Math.cos(a));return{x:n.x+l*Math.cos(a),y:n.y+l*Math.sin(a)}}let c=o/Math.abs(Math.sin(a));return{x:n.x+c*Math.cos(a),y:n.y+c*Math.sin(a)}}}}function Ot(t,n,e,r,s,i){let o=mn(e,i);if(o.length<2)return o;let a=o.length>2?o[1]:o[o.length-1],c=o.length>2?o[o.length-2]:o[0],l=Ht(a,t,r),h=Ht(c,n,s),d=o.length>2?o.slice(1,-1):[];return[l,...d,h]}function ot(t){if(t.length===0)return{x:0,y:0};let n=0,e=[];for(let i=0;i<t.length-1;i++){let o=t[i+1].x-t[i].x,a=t[i+1].y-t[i].y,c=Math.sqrt(o*o+a*a);e.push(c),n+=c}let r=n/2,s=0;for(let i=0;i<e.length;i++){if(s+e[i]>=r){let o=(r-s)/e[i];return{x:t[i].x+(t[i+1].x-t[i].x)*o,y:t[i].y+(t[i+1].y-t[i].y)*o}}s+=e[i]}return t[Math.floor(t.length/2)]}function bn(t,n){let e=n.padding??20,r=n.nodeSpacing??60,s=n.layerSpacing??30,i=t.participants,o=120,a=40,c=[],l=new Map;for(let g=0;g<i.length;g++){let m=i[g],b=e+g*(o+r),p=e;l.set(m.id,b),c.push({id:m.id,label:m.label,shape:m.type,x:b,y:p,width:o,height:a})}let h=[],d=e+a+s;for(let g of t.messages)if("from"in g&&"to"in g){let m=g,b=l.get(m.from)??e,p=l.get(m.to)??e,w=[{x:b+o/2,y:d},{x:p+o/2,y:d}];h.push({source:m.from,target:m.to,label:m.label,style:m.arrowType==="solid"?"solid":"dotted",hasArrowStart:!1,hasArrowEnd:!0,points:w,labelPosition:ot(w)}),d+=s}let u=e+i.length*o+(i.length-1)*r+e,f=d+e;for(let g of i){let b=(l.get(g.id)??e)+o/2;h.unshift({source:g.id,target:g.id,style:"dotted",hasArrowStart:!1,hasArrowEnd:!1,points:[{x:b,y:e+a},{x:b,y:f-e}]})}return{width:u,height:f,nodes:c,edges:h,groups:[]}}function Rt(t,n,e,r,s,i){let o=s-t,a=i-n;if(o===0&&a===0)return{x:t,y:n};let c=e/2,l=r/2,h=Math.abs(o),d=Math.abs(a),u;return h*l>d*c?u=c/h:u=l/d,{x:t+o*u,y:n+a*u}}function yn(t,n,e){let r=e.padding??20,s=e.nodeSpacing??80,i=t.map((x,v)=>{let _=pt(x.label,x.shape),$=v/t.length*Math.PI*2,M=s*Math.sqrt(t.length);return{id:x.id,label:x.label,shape:x.shape,x:M*Math.cos($),y:M*Math.sin($),vx:0,vy:0,width:_.width,height:_.height,inlineStyle:x.inlineStyle}}),o=new Map(i.map(x=>[x.id,x])),a=150,c=8e3,l=.008,h=.85,d=20;for(let x=0;x<a;x++){for(let v=0;v<i.length;v++)for(let _=v+1;_<i.length;_++){let $=i[v],M=i[_],C=M.x-$.x,P=M.y-$.y,N=Math.max(Math.sqrt(C*C+P*P),1),L=($.width+M.width)/2+d,I=Math.max(N,1),z=c/(I*I),W=N<L?(L-N)*.5:0,Y=z+W,X=C/N*Y,U=P/N*Y;$.vx-=X,$.vy-=U,M.vx+=X,M.vy+=U}for(let v of n){let _=o.get(v.source),$=o.get(v.target);if(!_||!$)continue;let M=$.x-_.x,C=$.y-_.y,P=Math.sqrt(M*M+C*C),N=(_.width+$.width)/2+s,L=(P-N)*l,I=M/Math.max(P,1)*L,z=C/Math.max(P,1)*L;_.vx+=I,_.vy+=z,$.vx-=I,$.vy-=z}for(let v of i)v.vx*=h,v.vy*=h,v.x+=v.vx,v.y+=v.vy}let u=1/0,f=1/0,g=-1/0,m=-1/0;for(let x of i)u=Math.min(u,x.x-x.width/2),f=Math.min(f,x.y-x.height/2),g=Math.max(g,x.x+x.width/2),m=Math.max(m,x.y+x.height/2);let b=r-u,p=r-f,w=i.map(x=>({id:x.id,label:x.label,shape:x.shape,x:x.x-x.width/2+b,y:x.y-x.height/2+p,width:x.width,height:x.height,inlineStyle:x.inlineStyle})),y=new Map(w.map(x=>[x.id,x])),k=n.map(x=>{let v=y.get(x.source),_=y.get(x.target);if(!v||!_)return{source:x.source,target:x.target,label:x.label,style:x.style,hasArrowStart:x.hasArrowStart,hasArrowEnd:x.hasArrowEnd,points:[],inlineStyle:x.inlineStyle};let $=v.x+v.width/2,M=v.y+v.height/2,C=_.x+_.width/2,P=_.y+_.height/2,N=[Rt($,M,v.width,v.height,C,P),Rt(C,P,_.width,_.height,$,M)];return{source:x.source,target:x.target,label:x.label,style:x.style,hasArrowStart:x.hasArrowStart,hasArrowEnd:x.hasArrowEnd,points:N,labelPosition:x.label?ot(N):void 0,inlineStyle:x.inlineStyle}}),A=g-u+r*2,E=m-f+r*2;return{width:A,height:E,nodes:w,edges:k,groups:[]}}function xn(t,n){let e=n.padding??20,r=120,s=e+r,i=t.title?30:0,o=e+i+r,a=t.slices.reduce((u,f)=>u+f.value,0);if(a===0)return{width:e*2,height:e*2,nodes:[],edges:[],groups:[]};let c=[],l=-Math.PI/2;for(let u=0;u<t.slices.length;u++){let f=t.slices[u],g=f.value/a*Math.PI*2,m=l+g/2,b=r*.65,p=s+b*Math.cos(m),w=o+b*Math.sin(m);c.push({id:`slice-${u}`,label:f.label,shape:"pie-slice",x:p-30,y:w-12,width:60,height:24,inlineStyle:{cx:String(s),cy:String(o),radius:String(r),startAngle:String(l),endAngle:String(l+g),value:String(f.value),percent:String(Math.round(f.value/a*100)),index:String(u)}}),l+=g}t.title&&c.unshift({id:"pie-title",label:t.title,shape:"pie-title",x:s-80,y:e,width:160,height:24});let h=s+r+e,d=o+r+e;return{width:h,height:d,nodes:c,edges:[],groups:[]}}function Ft(t,n,e,r,s,i,o,a){let c=Math.max(t.label.length*9+20,60),l=32,h={default:"rounded",rounded:"rounded",circle:"circle",bang:"hexagon",cloud:"cloud",hexagon:"hexagon"};if(o.push({id:t.id,label:t.label,shape:h[t.shape]||"rounded",x:n-c/2,y:e-l/2,width:c,height:l}),t.children.length===0)return;let d=s/Math.max(t.children.length,1),u=r-s/2+d/2,f=120+i*30;for(let g=0;g<t.children.length;g++){let m=t.children[g],b=u+g*d,p=n+f*Math.cos(b),w=e+f*Math.sin(b);a.push({source:t.id,target:m.id,style:"solid",hasArrowStart:!1,hasArrowEnd:!1,points:[{x:n,y:e},{x:p,y:w}]}),Ft(m,p,w,b,d*1.2,i+1,o,a)}}function wn(t,n){let e=n.padding??40,r=[],s=[];Ft(t.root,300,300,0,Math.PI*2,0,r,s);let a=1/0,c=1/0,l=-1/0,h=-1/0;for(let m of r)a=Math.min(a,m.x),c=Math.min(c,m.y),l=Math.max(l,m.x+m.width),h=Math.max(h,m.y+m.height);let d=e-a,u=e-c;for(let m of r)m.x+=d,m.y+=u;for(let m of s)for(let b of m.points)b.x+=d,b.y+=u;let f=l-a+e*2,g=h-c+e*2;return{width:f,height:g,nodes:r,edges:s,groups:[]}}function kn(t,n){let e=n.padding??20,r=28,s=6,i=24,o=140,a=8,c=t.title?30:0;if(t.sections.flatMap(k=>k.tasks).length===0)return{width:e*2,height:e*2,nodes:[],edges:[],groups:[]};let h=0,d=100,u=0,f=new Map;for(let k of t.sections)for(let A of k.tasks){let E=u*15,x=30;if(A.afterId&&f.has(A.afterId)&&(E=f.get(A.afterId)),A.duration){let _=A.duration.match(/(\d+)d/);_?.[1]&&(x=parseInt(_[1]))}let v=E+x;A.id&&f.set(A.id,v),d=Math.max(d,v),u++}let g=(d-h)*a,m=[],b=[],p=e+c;u=0,t.title&&m.push({id:"gantt-title",label:t.title,shape:"gantt-title",x:e,y:e,width:o+g,height:24});for(let k of t.sections){let A=p;m.push({id:`section-${k.name}`,label:k.name,shape:"gantt-section",x:e,y:p,width:o+g,height:i}),p+=i+s;for(let x of k.tasks){let v=u*15,_=30;if(x.afterId&&f.has(x.afterId)?v=f.get(x.afterId):x.startDate&&(v=u*15),x.duration){let C=x.duration.match(/(\d+)d/);C?.[1]&&(_=parseInt(C[1]))}let $=e+o+(v-h)*a,M=_*a;m.push({id:x.id||`task-${u}`,label:x.label,shape:"gantt-bar",x:$,y:p,width:M,height:r,inlineStyle:{status:x.status||"default",labelX:String(e),labelWidth:String(o)}}),p+=r+s,u++}let E=p-A;b.push({id:`group-${k.name}`,label:k.name,x:e,y:A,width:o+g,height:E,children:[]})}let w=e+o+g+e,y=p+e;return{width:w,height:y,nodes:m,edges:[],groups:[]}}function $n(t){let n=Array.from(t.nodes.values()).map(r=>{let s=t.classAssignments.get(r.id),i=s?t.classDefs.get(s):void 0,o=t.nodeStyles.get(r.id),a={...i,...o};return{id:r.id,label:r.label,shape:r.shape,inlineStyle:Object.keys(a).length>0?a:void 0}}),e=t.edges.map(r=>({source:r.source,target:r.target,label:r.label,style:r.style,hasArrowStart:r.hasArrowStart,hasArrowEnd:r.hasArrowEnd}));return{nodes:n,edges:e}}function Wt(t){let n=t.visibility||"";if(t.isMethod){let r=t.returnType?`: ${t.returnType}`:"";return`${n}${t.name}()${r}`}let e=t.type?`: ${t.type}`:"";return`${n}${t.name}${e}`}function An(t){let n=Array.from(t.classes.values()).map(r=>{let s=r.label||r.id,i=r.members.filter(d=>!d.isMethod).map(Wt),o=r.members.filter(d=>d.isMethod).map(Wt),a=[s];(i.length>0||o.length>0)&&(a.push("---"),a.push(...i)),o.length>0&&(a.push("---"),a.push(...o));let c=a.join(`
`),l=i.length,h=o.length;return{id:r.id,label:c,shape:"class-box",inlineStyle:{className:s,attrCount:String(l),methodCount:String(h)}}}),e=t.relations.map(r=>({source:r.from,target:r.to,label:r.label,style:r.type==="dependency"||r.type==="realization"?"dotted":"solid",hasArrowStart:!1,hasArrowEnd:r.type==="association"||r.type==="dependency",inlineStyle:{relationType:r.type}}));return{nodes:n,edges:e}}function Sn(t){let n=t.keys.length>0?t.keys.join(","):"";return n?`${n} ${t.type} ${t.name}`:`${t.type} ${t.name}`}function vn(t){let n=Array.from(t.entities.values()).map(r=>{let s=r.attributes.map(Sn),i=[r.id];s.length>0&&(i.push("---"),i.push(...s));let o=i.join(`
`);return{id:r.id,label:o,shape:"er-entity",inlineStyle:{entityName:r.id,attrCount:String(r.attributes.length)}}}),e=t.relations.map(r=>({source:r.from,target:r.to,label:r.label,style:r.identifying?"solid":"dotted",hasArrowStart:!1,hasArrowEnd:!1,inlineStyle:{fromCardinality:r.fromCardinality,toCardinality:r.toCardinality}}));return{nodes:n,edges:e}}function bt(t){let n=[...t.nodeIds];for(let e of t.children)n.push(...bt(e));return n}function Bt(t){let n=new Set;for(let e of t){for(let r of e.nodeIds)n.add(r);for(let r of Bt(e.children))n.add(r)}return n}function Mn(t,n,e,r,s){let i=Bt(e),o=new Map,a=new Set(e.map(f=>f.id)),c=16,l=24;for(let f of e){let g=new Set(bt(f)),m=t.filter(w=>g.has(w.id)),b=n.filter(w=>g.has(w.source)&&g.has(w.target)),p=mt(m,b,r,s);o.set(f.id,p)}let h=[],d=[],u=[];for(let f of t)if(!i.has(f.id))if(a.has(f.id)){let g=o.get(f.id);h.push({id:f.id,label:f.label,shape:f.shape,inlineStyle:{...f.inlineStyle,__megaNode:"true",__groupId:f.id,__innerWidth:String(g.width+c*2),__innerHeight:String(g.height+c*2+l)}})}else h.push(f);for(let f of e)if(!t.some(m=>m.id===f.id)){let m=o.get(f.id);h.push({id:f.id,label:f.label,shape:"rectangle",inlineStyle:{__megaNode:"true",__groupId:f.id,__innerWidth:String(m.width+c*2),__innerHeight:String(m.height+c*2+l)}})}for(let f of n){let g=i.has(f.source)&&!a.has(f.source),m=i.has(f.target)&&!a.has(f.target),b=g?Yt(f.source,e):void 0,p=m?Yt(f.target,e):void 0;if(g&&m){if(b===p)continue;d.push({...f,source:b,target:p})}else g?(u.push(f),d.push({...f,source:b})):m?(u.push(f),d.push({...f,target:p})):d.push(f)}return{innerLayouts:o,outerNodes:h,outerEdges:d,bridgeEdges:u,sgIds:a}}function Yt(t,n){for(let e of n)if(bt(e).includes(t))return e.id}function mt(t,n,e,r){let s=r??"TB",i=t.map(p=>{if(p.inlineStyle?.__megaNode)return{id:p.id,width:Number(p.inlineStyle.__innerWidth),height:Number(p.inlineStyle.__innerHeight)};let w=pt(p.label,p.shape);return{id:p.id,width:w.width,height:w.height}}),o=n.map(p=>({source:p.source,target:p.target,weight:1})),a=gn(i,o,{...e,direction:s}),c=t.map(p=>{let w=a.nodePositions.get(p.id)??{x:0,y:0},y,k;if(p.inlineStyle?.__megaNode)y=Number(p.inlineStyle.__innerWidth),k=Number(p.inlineStyle.__innerHeight);else{let A=pt(p.label,p.shape);y=A.width,k=A.height}return{id:p.id,label:p.label,shape:p.shape,x:w.x-y/2,y:w.y-k/2,width:y,height:k,inlineStyle:p.inlineStyle}}),l=new Map(c.map(p=>[p.id,p])),h=n.map(p=>{let w=l.get(p.source),y=l.get(p.target);if(!w||!y)return{source:p.source,target:p.target,label:p.label,style:p.style,hasArrowStart:p.hasArrowStart,hasArrowEnd:p.hasArrowEnd,points:[],inlineStyle:p.inlineStyle};let k=a.edgeRoutes.get(`${p.source}->${p.target}`)??[{x:w.x+w.width/2,y:w.y+w.height/2},{x:y.x+y.width/2,y:y.y+y.height/2}],A={x:w.x+w.width/2,y:w.y+w.height/2,width:w.width,height:w.height},E={x:y.x+y.width/2,y:y.y+y.height/2,width:y.width,height:y.height},x=Ot(A,E,k,w.shape,y.shape,s);return{source:p.source,target:p.target,label:p.label,style:p.style,hasArrowStart:p.hasArrowStart,hasArrowEnd:p.hasArrowEnd,points:x,labelPosition:p.label?ot(x):void 0,inlineStyle:p.inlineStyle}}),d=1/0,u=1/0,f=-1/0,g=-1/0;for(let p of c)d=Math.min(d,p.x),u=Math.min(u,p.y),f=Math.max(f,p.x+p.width),g=Math.max(g,p.y+p.height);for(let p of h)for(let w of p.points)d=Math.min(d,w.x),u=Math.min(u,w.y),f=Math.max(f,w.x),g=Math.max(g,w.y);if(!Number.isFinite(d))return{nodes:c,edges:h,width:0,height:0,groups:[]};let m=-d,b=-u;for(let p of c)p.x+=m,p.y+=b;for(let p of h){for(let w of p.points)w.x+=m,w.y+=b;p.labelPosition&&(p.labelPosition.x+=m,p.labelPosition.y+=b)}return{nodes:c,edges:h,width:f-d,height:g-u,groups:[]}}function Xt(t,n,e,r,s){let i=e.direction??r??"TB";if(!s||s.length===0){let $=mt(t,n,e,i),M=e.padding??20;for(let C of $.nodes)C.x+=M,C.y+=M;for(let C of $.edges){for(let P of C.points)P.x+=M,P.y+=M;C.labelPosition&&(C.labelPosition.x+=M,C.labelPosition.y+=M)}return{width:$.width+M*2,height:$.height+M*2,nodes:$.nodes,edges:$.edges,groups:[]}}let{innerLayouts:o,outerNodes:a,outerEdges:c,sgIds:l}=Mn(t,n,s,e,i),h=mt(a,c,e,i),d=[],u=[],f=[],g=16,m=24;for(let $ of s){let M=h.nodes.find(L=>L.id===$.id);if(!M)continue;let C=o.get($.id),P=M.x+g,N=M.y+g+m;for(let L of C.nodes)d.push({...L,x:L.x+P,y:L.y+N});for(let L of C.edges)u.push({...L,points:L.points.map(I=>({x:I.x+P,y:I.y+N})),labelPosition:L.labelPosition?{x:L.labelPosition.x+P,y:L.labelPosition.y+N}:void 0});f.push({id:$.id,label:$.label,x:M.x,y:M.y,width:M.width,height:M.height,children:[]})}for(let $ of h.nodes)$.inlineStyle?.__megaNode||d.push($);let b=new Map(f.map($=>[$.id,{x:$.x,y:$.y,width:$.width,height:$.height}]));for(let $ of h.edges){let M=l.has($.source),C=l.has($.target);M||C||u.push($)}let p=new Map(d.map($=>[$.id,$])),w=new Set;for(let $ of h.edges){let M=l.has($.source),C=l.has($.target);if(!M&&!C)continue;let P=$.source,N=$.target,L=p.get(P),I=p.get(N),z=b.get(P),W=b.get(N),Y=L?{x:L.x+L.width/2,y:L.y+L.height/2,width:L.width,height:L.height}:z?{x:z.x+z.width/2,y:z.y+z.height/2,width:z.width,height:z.height}:null,X=I?{x:I.x+I.width/2,y:I.y+I.height/2,width:I.width,height:I.height}:W?{x:W.x+W.width/2,y:W.y+W.height/2,width:W.width,height:W.height}:null;if(!Y||!X)continue;let U=`${P}->${N}`;if(w.has(U))continue;w.add(U);let rt=Ot(Y,X,[{x:Y.x,y:Y.y},{x:X.x,y:X.y}],L?.shape??"rectangle",I?.shape??"rectangle",i);u.push({source:P,target:N,label:$.label,style:$.style,hasArrowStart:$.hasArrowStart,hasArrowEnd:$.hasArrowEnd,points:rt,labelPosition:$.label?ot(rt):void 0,inlineStyle:$.inlineStyle})}let y=e.padding??20,k=1/0,A=1/0,E=-1/0,x=-1/0;for(let $ of d)k=Math.min(k,$.x),A=Math.min(A,$.y),E=Math.max(E,$.x+$.width),x=Math.max(x,$.y+$.height);for(let $ of f)k=Math.min(k,$.x),A=Math.min(A,$.y),E=Math.max(E,$.x+$.width),x=Math.max(x,$.y+$.height);for(let $ of u)for(let M of $.points)k=Math.min(k,M.x),A=Math.min(A,M.y),E=Math.max(E,M.x),x=Math.max(x,M.y);let v=y-k,_=y-A;for(let $ of d)$.x+=v,$.y+=_;for(let $ of f)$.x+=v,$.y+=_;for(let $ of u){for(let M of $.points)M.x+=v,M.y+=_;$.labelPosition&&($.labelPosition.x+=v,$.labelPosition.y+=_)}return{width:E-k+y*2,height:x-A+y*2,nodes:d,edges:u,groups:f}}function V(t,n={}){let e={nodeSpacing:40,layerSpacing:60,padding:20,...n};if(t.type==="sequence")return bn(t,e);if(t.type==="flowchart"){let{nodes:r,edges:s}=$n(t),o=r.some(a=>a.shape==="state-start"||a.shape==="state-end")?{...e,layerSpacing:45,nodeSpacing:30}:e;return Xt(r,s,o,t.direction,t.subgraphs)}if(t.type==="class"){let{nodes:r,edges:s}=An(t);return Xt(r,s,e,"TB")}if(t.type==="er"){let{nodes:r,edges:s}=vn(t);return yn(r,s,e)}if(t.type==="pie")return xn(t,e);if(t.type==="gantt")return kn(t,e);if(t.type==="mindmap")return wn(t,e);throw new Error(`Unsupported diagram type: ${t.type}`)}function F(t,n,e){let r=Ut(t),s=Ut(n),i=e/100,o=Math.round(r.r*i+s.r*(1-i)),a=Math.round(r.g*i+s.g*(1-i)),c=Math.round(r.b*i+s.b*(1-i));return _n(o,a,c)}function Ut(t){let n=t.replace("#",""),e=Number.parseInt(n.slice(0,2),16),r=Number.parseInt(n.slice(2,4),16),s=Number.parseInt(n.slice(4,6),16);return{r:e,g:r,b:s}}function _n(t,n,e){return`#${[t,n,e].map(r=>r.toString(16).padStart(2,"0")).join("")}`}function Z(t){let n=t.bg,e=t.fg,r=t.accent??F(e,n,50);return{bg:n,fg:e,text:e,line:t.line??F(e,n,30),arrow:r,muted:t.muted??F(e,n,50),nodeFill:t.surface??F(e,n,12),nodeStroke:t.border??F(r,n,65),groupFill:F(e,n,5),groupStroke:F(e,n,15),groupText:F(e,n,60),font:t.font??"ui-sans-serif, system-ui, sans-serif",monoFont:t.monoFont??"ui-monospace, monospace"}}var yt={"zinc-dark":{bg:"#18181B",fg:"#FAFAFA"},"zinc-light":{bg:"#FAFAFA",fg:"#18181B"},"tokyo-night":{bg:"#1a1b26",fg:"#a9b1d6",line:"#3d59a1",accent:"#7aa2f7"},"catppuccin-mocha":{bg:"#1e1e2e",fg:"#cdd6f4",accent:"#cba6f7",line:"#585b70"},"catppuccin-latte":{bg:"#eff1f5",fg:"#4c4f69",accent:"#8839ef",line:"#9ca0b0"},nord:{bg:"#2e3440",fg:"#d8dee9",accent:"#88c0d0",line:"#4c566a"},dracula:{bg:"#282a36",fg:"#f8f8f2",accent:"#bd93f9",line:"#6272a4"},"github-light":{bg:"#ffffff",fg:"#1f2328",accent:"#0969da",line:"#d1d9e0"},"github-dark":{bg:"#0d1117",fg:"#e6edf3",accent:"#58a6ff",line:"#30363d"},"one-dark":{bg:"#282c34",fg:"#abb2bf",accent:"#c678dd",line:"#3e4451"},"solarized-dark":{bg:"#002b36",fg:"#839496",accent:"#268bd2",line:"#073642"},"solarized-light":{bg:"#fdf6e3",fg:"#657b83",accent:"#268bd2",line:"#eee8d5"},monokai:{bg:"#272822",fg:"#f8f8f2",accent:"#a6e22e",line:"#49483e"},"gruvbox-dark":{bg:"#282828",fg:"#ebdbb2",accent:"#fabd2f",line:"#504945"},"gruvbox-light":{bg:"#fbf1c7",fg:"#3c3836",accent:"#d79921",line:"#d5c4a1"},"rose-pine":{bg:"#191724",fg:"#e0def4",accent:"#c4a7e7",line:"#26233a"},"rose-pine-dawn":{bg:"#faf4ed",fg:"#575279",accent:"#907aa9",line:"#f2e9e1"},"ayu-dark":{bg:"#0a0e14",fg:"#b3b1ad",accent:"#ffb454",line:"#11151c"},"ayu-light":{bg:"#fafafa",fg:"#575f66",accent:"#ff9940",line:"#f0f0f0"},vesper:{bg:"#101010",fg:"#ffffff",accent:"#ffc799",line:"#232323"},"vitesse-dark":{bg:"#121212",fg:"#dbd7caee",accent:"#4d9375",line:"#282828"},"vitesse-light":{bg:"#ffffff",fg:"#393a34",accent:"#1e754f",line:"#f1f1f1"},kanagawa:{bg:"#1f1f28",fg:"#dcd7ba",accent:"#7e9cd8",line:"#2a2a37"},"everforest-dark":{bg:"#2d353b",fg:"#d3c6aa",accent:"#a7c080",line:"#3d484d"},"everforest-light":{bg:"#fdf6e3",fg:"#5c6a72",accent:"#8da101",line:"#efebd4"},"material-dark":{bg:"#263238",fg:"#eeffff",accent:"#82aaff",line:"#37474f"},"material-light":{bg:"#fafafa",fg:"#546e7a",accent:"#6182b8",line:"#e7e7e8"},poimandres:{bg:"#1b1e28",fg:"#a6accd",accent:"#add7ff",line:"#303340"},"night-owl":{bg:"#011627",fg:"#d6deeb",accent:"#82aaff",line:"#122d42"},"one-hunter":{bg:"#1e2127",fg:"#c0c5cf",accent:"#e06c75",line:"#2c313a",surface:"#282c34",border:"#3e4451"}},B={bg:"#ffffff",fg:"#27272a"};var at={one:{start:"er-one-start",end:"er-one"},many:{start:"er-many-start",end:"er-many"},"zero-one":{start:"er-zero-one-start",end:"er-zero-one"},"zero-many":{start:"er-zero-many-start",end:"er-zero-many"}},Gt={inheritance:"cls-inheritance",realization:"cls-inheritance",composition:"cls-composition",aggregation:"cls-aggregation"};function En(t,n){let{points:e,style:r,hasArrowStart:s,hasArrowEnd:i}=t;if(e.length<2)return"";let o=e.map((g,m)=>`${m===0?"M":"L"} ${g.x} ${g.y}`).join(" "),a="",c="1.5";r==="dotted"?a='stroke-dasharray="6 4"':r==="thick"&&(c="2.5");let l=t.inlineStyle?.fromCardinality,h=t.inlineStyle?.toCardinality,d=t.inlineStyle?.relationType,u="",f="";return d&&Gt[d]?u=`marker-start="url(#${Gt[d]})"`:l&&at[l]?u=`marker-start="url(#${at[l].start})"`:s&&(u='marker-start="url(#arrowhead-start)"'),h&&at[h]?f=`marker-end="url(#${at[h].end})"`:i&&(f='marker-end="url(#arrowhead)"'),`<path d="${o}" stroke="var(--_line)" stroke-width="${c}" fill="none" stroke-linejoin="round" stroke-linecap="round" ${a} ${u} ${f}/>`}function kt(t){return t.split(/<br\s*\/?>|\n/)}function Cn(t,n){if(t.shape==="state-start"||t.shape==="state-end")return"";if(t.shape==="pie-slice"){let l=t.x+t.width/2,h=t.y+t.height/2,d=t.inlineStyle?.percent||"";return`<text x="${l}" y="${h}" text-anchor="middle" dominant-baseline="middle" fill="var(--_text)" font-family="${n.font}" font-size="11" font-weight="600">${D(t.label)} ${d}%</text>`}if(t.shape==="pie-title"){let l=t.x+t.width/2,h=t.y+t.height/2;return`<text x="${l}" y="${h}" text-anchor="middle" dominant-baseline="middle" fill="var(--_text)" font-family="${n.font}" font-size="16" font-weight="600">${D(t.label)}</text>`}if(t.shape==="gantt-title"){let l=t.x+t.width/2,h=t.y+t.height/2;return`<text x="${l}" y="${h}" text-anchor="middle" dominant-baseline="middle" fill="var(--_text)" font-family="${n.font}" font-size="16" font-weight="600">${D(t.label)}</text>`}if(t.shape==="gantt-section"){let l=t.x+8,h=t.y+t.height/2;return`<text x="${l}" y="${h}" dominant-baseline="middle" fill="var(--_group-text)" font-family="${n.font}" font-size="12" font-weight="600">${D(t.label)}</text>`}if(t.shape==="gantt-bar"){let l=parseFloat(t.inlineStyle?.labelX||"0")+4,h=t.y+t.height/2,d=`<text x="${t.x+6}" y="${h}" dominant-baseline="middle" fill="var(--bg)" font-family="${n.font}" font-size="11" font-weight="500">${D(t.label)}</text>`;return`<text x="${l}" y="${h}" dominant-baseline="middle" fill="var(--_text)" font-family="${n.font}" font-size="11" font-weight="400">${D(t.label)}</text>`+d}if(t.shape==="class-box")return Ln(t,n);if(t.shape==="er-entity")return Nn(t,n);let e=kt(t.label),r=t.x+t.width/2,s=t.y+t.height/2,i=16,o=e.length*i,a=s-o/2+i/2,c=e.map((l,h)=>{let d=a+h*i;return`<tspan x="${r}" y="${d}" text-anchor="middle" dominant-baseline="middle">${D(l)}</tspan>`}).join("");return`<text fill="var(--_text)" font-family="${n.font}" font-size="14" font-weight="400">${c}</text>`}function Ln(t,n){let e=t.label.split(`
`),r=16,s=12,i=t.x,o=t.x+t.width/2,a=t.y,c="",l=0,h=e[l]||"";if(a+=s/2+r/2,c+=`<text x="${o}" y="${a}" text-anchor="middle" dominant-baseline="middle" fill="var(--_text)" font-family="${n.font}" font-size="14" font-weight="600">${D(h)}</text>`,l++,l<e.length&&e[l]==="---")for(l++,a=t.y+r+s;l<e.length&&e[l]!=="---";)a+=r*.8,c+=`<text x="${i+s}" y="${a}" dominant-baseline="middle" fill="var(--_text)" font-family="${n.font}" font-size="12" font-weight="400">${D(e[l])}</text>`,l++;if(l<e.length&&e[l]==="---"){l++;let d=parseInt(t.inlineStyle?.attrCount||"0"),u=d>0?d*r+s:0;for(a=t.y+r+s+u;l<e.length;)a+=r*.8,c+=`<text x="${i+s}" y="${a}" dominant-baseline="middle" fill="var(--_text)" font-family="${n.font}" font-size="12" font-weight="400">${D(e[l])}</text>`,l++}return c}function Pn(t,n){if(!t.label||!t.labelPosition)return"";let{x:e,y:r}=t.labelPosition,s=kt(t.label),i=14,o=s.length*i,a=4,c=Math.max(...s.map(b=>b.length*7))+a*2,l=o+a*2,h=e-c/2,d=r-l/2,u=`<rect x="${h}" y="${d}" width="${c}" height="${l}" fill="var(--bg)" stroke="var(--_line)" stroke-width="0.75" rx="3"/>`,f=r-o/2+i/2,g=s.map((b,p)=>{let w=f+p*i;return`<tspan x="${e}" y="${w}" text-anchor="middle" dominant-baseline="middle">${D(b)}</tspan>`}).join(""),m=`<text fill="var(--_text)" font-family="${n.font}" font-size="11" font-weight="500">${g}</text>`;return u+m}function In(t,n){let e=kt(t.label),r=t.x+8,s=t.y+8,i=14,o=e.map((a,c)=>{let l=s+c*i;return`<tspan x="${r}" y="${l}">${D(a)}</tspan>`}).join("");return`<text fill="var(--_group-text)" font-family="${n.font}" font-size="12" font-weight="600">${o}</text>`}function Nn(t,n){let e=t.label.split(`
`),r=t.x,s=t.width,i=r+s/2,o=14,a=12,c=o*1.2+16,l="",h=e[0]||"",d=t.y+c/2;l+=`<text x="${i}" y="${d}" text-anchor="middle" dominant-baseline="middle" fill="var(--_text)" font-family="${n.font}" font-size="${o}" font-weight="600">${D(h)}</text>`;let u=1;if(u<e.length&&e[u]==="---"){u++;let g=t.y+c+8,m=a*1.4,b=0;for(;u<e.length&&e[u]!=="---";){let p=e[u]||"",w=g+b*m+a/2,y=p.match(/^(PK|FK|UK|PK,FK|FK,PK)\s+/);if(y){let k=y[1],A=p.slice(y[0].length);l+=`<text x="${r+8}" y="${w}" dominant-baseline="middle" fill="var(--_node-stroke)" font-family="${n.font}" font-size="10" font-weight="600">${D(k)}</text>`,l+=`<text x="${r+34}" y="${w}" dominant-baseline="middle" fill="var(--_text)" font-family="${n.font}" font-size="${a}" font-weight="400">${D(A)}</text>`}else l+=`<text x="${r+34}" y="${w}" dominant-baseline="middle" fill="var(--_text)" font-family="${n.font}" font-size="${a}" font-weight="400">${D(p)}</text>`;b++,u++}}if(parseInt(t.inlineStyle?.attrCount||"0")===0){let g=t.y+c+10;l+=`<text x="${i}" y="${g}" text-anchor="middle" dominant-baseline="middle" fill="var(--_muted)" font-family="${n.font}" font-size="11" font-style="italic">(no attributes)</text>`}return l}function D(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}function Tn(t){return`
		<defs>
			<marker id="arrowhead" markerWidth="12" markerHeight="8" refX="11" refY="4" orient="auto" markerUnits="userSpaceOnUse">
				<path d="M1,1 L11,4 L1,7 z" fill="var(--_arrow)" />
			</marker>
			<marker id="arrowhead-start" markerWidth="12" markerHeight="8" refX="1" refY="4" orient="auto" markerUnits="userSpaceOnUse">
				<path d="M11,1 L1,4 L11,7 z" fill="var(--_arrow)" />
			</marker>
			<marker id="arrowhead-open" markerWidth="12" markerHeight="8" refX="11" refY="4" orient="auto" markerUnits="userSpaceOnUse">
				<path d="M1,1 L11,4 L1,7" fill="none" stroke="var(--_arrow)" stroke-width="1.5" stroke-linejoin="round" />
			</marker>
			<marker id="arrowhead-cross" markerWidth="12" markerHeight="12" refX="6" refY="6" orient="auto" markerUnits="userSpaceOnUse">
				<path d="M3,3 L9,9 M9,3 L3,9" stroke="var(--_arrow)" stroke-width="1.5" stroke-linecap="round" />
			</marker>
			<marker id="er-one" markerWidth="20" markerHeight="16" refX="18" refY="8" orient="auto" markerUnits="userSpaceOnUse">
				<line x1="18" y1="2" x2="18" y2="14" stroke="var(--_line)" stroke-width="1.5"/>
				<line x1="14" y1="2" x2="14" y2="14" stroke="var(--_line)" stroke-width="1.5"/>
			</marker>
			<marker id="er-one-start" markerWidth="20" markerHeight="16" refX="2" refY="8" orient="auto" markerUnits="userSpaceOnUse">
				<line x1="2" y1="2" x2="2" y2="14" stroke="var(--_line)" stroke-width="1.5"/>
				<line x1="6" y1="2" x2="6" y2="14" stroke="var(--_line)" stroke-width="1.5"/>
			</marker>
			<marker id="er-many" markerWidth="20" markerHeight="16" refX="18" refY="8" orient="auto" markerUnits="userSpaceOnUse">
				<line x1="18" y1="2" x2="18" y2="14" stroke="var(--_line)" stroke-width="1.5"/>
				<path d="M18,8 L6,2 M18,8 L6,14" stroke="var(--_line)" stroke-width="1.5" fill="none"/>
			</marker>
			<marker id="er-many-start" markerWidth="20" markerHeight="16" refX="2" refY="8" orient="auto" markerUnits="userSpaceOnUse">
				<line x1="2" y1="2" x2="2" y2="14" stroke="var(--_line)" stroke-width="1.5"/>
				<path d="M2,8 L14,2 M2,8 L14,14" stroke="var(--_line)" stroke-width="1.5" fill="none"/>
			</marker>
			<marker id="er-zero-one" markerWidth="24" markerHeight="16" refX="22" refY="8" orient="auto" markerUnits="userSpaceOnUse">
				<line x1="22" y1="2" x2="22" y2="14" stroke="var(--_line)" stroke-width="1.5"/>
				<circle cx="14" cy="8" r="4" fill="none" stroke="var(--_line)" stroke-width="1.5"/>
			</marker>
			<marker id="er-zero-one-start" markerWidth="24" markerHeight="16" refX="2" refY="8" orient="auto" markerUnits="userSpaceOnUse">
				<line x1="2" y1="2" x2="2" y2="14" stroke="var(--_line)" stroke-width="1.5"/>
				<circle cx="10" cy="8" r="4" fill="none" stroke="var(--_line)" stroke-width="1.5"/>
			</marker>
			<marker id="er-zero-many" markerWidth="24" markerHeight="16" refX="22" refY="8" orient="auto" markerUnits="userSpaceOnUse">
				<path d="M22,8 L10,2 M22,8 L10,14" stroke="var(--_line)" stroke-width="1.5" fill="none"/>
				<circle cx="6" cy="8" r="4" fill="none" stroke="var(--_line)" stroke-width="1.5"/>
			</marker>
			<marker id="er-zero-many-start" markerWidth="24" markerHeight="16" refX="2" refY="8" orient="auto" markerUnits="userSpaceOnUse">
				<path d="M2,8 L14,2 M2,8 L14,14" stroke="var(--_line)" stroke-width="1.5" fill="none"/>
				<circle cx="18" cy="8" r="4" fill="none" stroke="var(--_line)" stroke-width="1.5"/>
			</marker>
			<marker id="cls-inheritance" markerWidth="16" markerHeight="14" refX="1" refY="7" orient="auto" markerUnits="userSpaceOnUse">
				<path d="M15,1 L1,7 L15,13 z" fill="var(--_node-fill)" stroke="var(--_line)" stroke-width="1.5" stroke-linejoin="round"/>
			</marker>
			<marker id="cls-composition" markerWidth="14" markerHeight="14" refX="1" refY="7" orient="auto" markerUnits="userSpaceOnUse">
				<path d="M1,7 L7,1 L13,7 L7,13 z" fill="var(--_line)" stroke="var(--_line)" stroke-width="1"/>
			</marker>
			<marker id="cls-aggregation" markerWidth="14" markerHeight="14" refX="1" refY="7" orient="auto" markerUnits="userSpaceOnUse">
				<path d="M1,7 L7,1 L13,7 L7,13 z" fill="var(--_node-fill)" stroke="var(--_line)" stroke-width="1.5"/>
			</marker>
		</defs>
	`}function Dn(t,n){return`<rect x="${t.x}" y="${t.y}" width="${t.width}" height="${t.height}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="1.5" rx="0"/>`}function Vt(t,n){return`<rect x="${t.x}" y="${t.y}" width="${t.width}" height="${t.height}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="1.5" rx="8"/>`}function zn(t,n){let e=t.x+t.width/2,r=t.y+t.height/2,s=t.width/2,i=t.height/2;return`<polygon points="${`${e},${r-i} ${e+s},${r} ${e},${r+i} ${e-s},${r}`}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="1.5"/>`}function Hn(t,n){let e=Math.min(t.height/2,t.width/2);return`<rect x="${t.x}" y="${t.y}" width="${t.width}" height="${t.height}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="1.5" rx="${e}"/>`}function Rn(t,n){let e=t.x+t.width/2,r=t.y+t.height/2,s=Math.min(t.width,t.height)/2;return`<circle cx="${e}" cy="${r}" r="${s}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="1.5"/>`}function Wn(t,n){let e=`<rect x="${t.x}" y="${t.y}" width="${t.width}" height="${t.height}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="1.5" rx="0"/>`,r=4,s=`<rect x="${t.x+r}" y="${t.y+r}" width="${t.width-r*2}" height="${t.height-r*2}" fill="none" stroke="var(--_node-stroke)" stroke-width="1.5" rx="0"/>`;return e+s}function Yn(t,n){let e=t.x+t.width/2,r=t.y+t.height/2,s=Math.min(t.width,t.height)/2,i=s-4;return`<circle cx="${e}" cy="${r}" r="${s}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="1.5"/><circle cx="${e}" cy="${r}" r="${i}" fill="none" stroke="var(--_node-stroke)" stroke-width="1.5"/>`}function Xn(t,n){let e=t.x+t.width/2,r=t.y+t.height/2,s=t.width/2,i=t.height/2,o=s*.3;return`<polygon points="${`${e-s+o},${r-i} ${e+s-o},${r-i} ${e+s},${r} ${e+s-o},${r+i} ${e-s+o},${r+i} ${e-s},${r}`}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="1.5"/>`}function On(t,n){let e=t.height*.1,r=t.x,s=t.y,i=t.width,o=t.height,a=`M ${r} ${s+e}
		Q ${r} ${s}, ${r+i/2} ${s}
		T ${r+i} ${s+e}
		L ${r+i} ${s+o-e}
		Q ${r+i} ${s+o}, ${r+i/2} ${s+o}
		T ${r} ${s+o-e}
		Z`,c=`<ellipse cx="${r+i/2}" cy="${s+e}" rx="${i/2}" ry="${e}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="1.5"/>`;return`<path d="${a}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="1.5"/>`+c}function Fn(t,n){let e=t.x,r=t.y,s=t.width,i=t.height,o=s*.15;return`<polygon points="${`${e},${r+i/2} ${e+o},${r} ${e+s},${r} ${e+s-o},${r+i} ${e},${r+i}`}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="1.5"/>`}function Bn(t,n){let e=t.x,r=t.y,s=t.width,i=t.height,o=s*.15;return`<polygon points="${`${e+o},${r} ${e+s-o},${r} ${e+s},${r+i} ${e},${r+i}`}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="1.5"/>`}function Un(t,n){let e=t.x,r=t.y,s=t.width,i=t.height,o=s*.15;return`<polygon points="${`${e},${r} ${e+s},${r} ${e+s-o},${r+i} ${e+o},${r+i}`}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="1.5"/>`}function Gn(t,n){let e=t.x,r=t.y,s=t.width,i=t.height,o=s*.15;return`<polygon points="${`${e+o},${r} ${e+s},${r} ${e+s-o},${r+i} ${e},${r+i}`}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="1.5"/>`}function jn(t,n){let e=t.x,r=t.y,s=t.width,i=t.height,o=Math.min(s,i)*.15;return`<path d="${`M ${e} ${r} L ${e+s-o} ${r} L ${e+s} ${r+o} L ${e+s} ${r+i} L ${e} ${r+i} Z M ${e+s-o} ${r} L ${e+s-o} ${r+o} L ${e+s} ${r+o}`}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="1.5"/>`}function qn(t,n){let e=t.x,r=t.y,s=t.width,i=t.height;return`<path d="${`M ${e+s*.25} ${r+i*.4}
		Q ${e} ${r+i*.4}, ${e} ${r+i*.6}
		Q ${e} ${r+i}, ${e+s*.2} ${r+i}
		Q ${e+s*.3} ${r+i}, ${e+s*.5} ${r+i*.95}
		Q ${e+s*.7} ${r+i}, ${e+s*.8} ${r+i}
		Q ${e+s} ${r+i}, ${e+s} ${r+i*.6}
		Q ${e+s} ${r+i*.4}, ${e+s*.75} ${r+i*.4}
		Q ${e+s*.8} ${r}, ${e+s*.5} ${r}
		Q ${e+s*.2} ${r}, ${e+s*.25} ${r+i*.4}
		Z`}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="1.5"/>`}function Kn(t,n){let e=t.x+t.width/2,r=t.y+t.height/2,s=Math.min(t.width,t.height)/4;return`<circle cx="${e}" cy="${r}" r="${s}" fill="var(--_text)" stroke="none"/>`}function Vn(t,n){let e=t.x+t.width/2,r=t.y+t.height/2,s=Math.min(t.width,t.height)/3,i=s*.6;return`<circle cx="${e}" cy="${r}" r="${s}" fill="none" stroke="var(--_text)" stroke-width="2"/><circle cx="${e}" cy="${r}" r="${i}" fill="var(--_text)" stroke="none"/>`}var jt=["#4e79a7","#f28e2b","#e15759","#76b7b2","#59a14f","#edc948","#b07aa1","#ff9da7","#9c755f","#bab0ac"];function Qn(t,n){if(!t.inlineStyle)return"";let e=parseFloat(t.inlineStyle.cx),r=parseFloat(t.inlineStyle.cy),s=parseFloat(t.inlineStyle.radius),i=parseFloat(t.inlineStyle.startAngle),o=parseFloat(t.inlineStyle.endAngle),a=parseInt(t.inlineStyle.index),c=jt[a%jt.length],l=e+s*Math.cos(i),h=r+s*Math.sin(i),d=e+s*Math.cos(o),u=r+s*Math.sin(o),f=o-i>Math.PI?1:0;return`<path d="${`M ${e} ${r} L ${l} ${h} A ${s} ${s} 0 ${f} 1 ${d} ${u} Z`}" fill="${c}" stroke="var(--bg)" stroke-width="2"/>`}function Zn(t,n){return""}function Jn(t,n){return`<rect x="${t.x}" y="${t.y}" width="${t.width}" height="${t.height}" fill="var(--_group-fill)" stroke="none" rx="2"/>`}function tr(t,n){let e=t.inlineStyle?.status||"default",r="var(--_node-fill)",s="var(--_node-stroke)";return e==="done"&&(r="var(--_muted)"),e==="active"&&(r="var(--_node-stroke)"),e==="crit"&&(r="#e15759",s="#c44040"),`<rect x="${t.x}" y="${t.y}" width="${t.width}" height="${t.height}" fill="${r}" stroke="${s}" stroke-width="1" rx="4"/>`}function er(t,n){return""}function nr(t,n){let e=t.x,r=t.y,s=t.width,i=t.height,o=parseInt(t.inlineStyle?.attrCount||"0"),a=`<rect x="${e}" y="${r}" width="${s}" height="${i}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="1.5" rx="0"/>`;if(o>0){let l=r+32.8;a+=`<line x1="${e}" y1="${l}" x2="${e+s}" y2="${l}" stroke="var(--_node-stroke)" stroke-width="1"/>`}return a}function rr(t,n){let e=t.x,r=t.y,s=t.width,i=t.height,o=16,a=12,c=parseInt(t.inlineStyle?.attrCount||"0"),l=parseInt(t.inlineStyle?.methodCount||"0"),h=`<rect x="${e}" y="${r}" width="${s}" height="${i}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="1.5" rx="0"/>`,d=o+a,u=c>0?c*o+a:0;if(c>0||l>0){let f=r+d;h+=`<line x1="${e}" y1="${f}" x2="${e+s}" y2="${f}" stroke="var(--_node-stroke)" stroke-width="1"/>`}if(l>0&&c>0){let f=r+d+u;h+=`<line x1="${e}" y1="${f}" x2="${e+s}" y2="${f}" stroke="var(--_node-stroke)" stroke-width="1"/>`}return h}var ir={rectangle:Dn,rounded:Vt,diamond:zn,stadium:Hn,circle:Rn,subroutine:Wn,doublecircle:Yn,hexagon:Xn,cylinder:On,asymmetric:Fn,trapezoid:Bn,"trapezoid-alt":Un,parallelogram:Gn,note:jn,cloud:qn,"state-start":Kn,"state-end":Vn,"pie-slice":Qn,"pie-title":Zn,"gantt-section":Jn,"gantt-bar":tr,"gantt-title":er,"class-box":rr,"er-entity":nr};function sr(t,n){let e=ir[t.shape];return e?e(t,n):Vt(t)}function or(t,n){return`<rect x="${t.x}" y="${t.y}" width="${t.width}" height="${t.height}" fill="var(--_group-fill)" stroke="var(--_group-stroke)" stroke-width="1.5" rx="4"/>`}function Qt(t,n){return t.flatMap(e=>{let r=e.children.length>0?Qt(e.children,n):"";return or(e)+In(e,n)+r}).join("")}function ar(t,n){if(!n.debug)return"";let e=[],r=50,s=t.width+n.padding*2,i=t.height+n.padding*2;for(let o=0;o<=s;o+=r)e.push(`<line x1="${o}" y1="0" x2="${o}" y2="${i}" stroke="rgba(255,255,255,0.08)" stroke-width="0.5"/>`),e.push(`<text x="${o+2}" y="10" fill="rgba(255,255,255,0.3)" font-size="8" font-family="monospace">${o}</text>`);for(let o=0;o<=i;o+=r)e.push(`<line x1="0" y1="${o}" x2="${s}" y2="${o}" stroke="rgba(255,255,255,0.08)" stroke-width="0.5"/>`),e.push(`<text x="2" y="${o-2}" fill="rgba(255,255,255,0.3)" font-size="8" font-family="monospace">${o}</text>`);for(let o of t.nodes)e.push(`<rect x="${o.x}" y="${o.y}" width="${o.width}" height="${o.height}" fill="none" stroke="rgba(239,68,68,0.5)" stroke-width="0.5" stroke-dasharray="3 2"/>`),e.push(`<text x="${o.x}" y="${o.y-4}" fill="rgba(239,68,68,0.7)" font-size="9" font-family="monospace">${o.id}</text>`);for(let o of t.edges)for(let a of o.points)e.push(`<circle cx="${a.x}" cy="${a.y}" r="3" fill="rgba(59,130,246,0.6)" stroke="rgba(59,130,246,0.8)" stroke-width="0.5"/>`);return`<g class="debug-overlays">${e.join("")}</g>`}function lt(t,n){let e=n?.theme??B,r=n?.padding??16,s=n?.transparent??!1,i=n?.debug??!1,o=Z(e),a={colors:o,padding:r,transparent:s,debug:i,font:o.font},c=t.width+r*2,l=t.height+r*2,h=s?"none":o.bg,d=`cm-${Math.random().toString(36).slice(2,8)}`,f=`
		<style>
			@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap');
			#${d} {
				--bg: ${o.bg};
				--fg: ${o.fg};
				--_text: ${o.text};
				--_line: ${o.line};
				--_arrow: ${o.arrow};
				--_node-fill: ${o.nodeFill};
				--_node-stroke: ${o.nodeStroke};
				--_muted: ${o.muted};
				--_group-fill: ${o.groupFill};
				--_group-stroke: ${o.groupStroke};
				--_group-text: ${o.groupText};
			}
		</style>
	`,g=Tn(),m=Qt(t.groups,a),b=t.edges.map(A=>En(A)).join(""),p=t.edges.map(A=>Pn(A,a)).join(""),w=t.nodes.map(A=>{let E=sr(A,a),x=Cn(A,a);return E+x}).join(""),y=ar(t,a);return`
		<svg id="${d}" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 ${c} ${l}" width="${c}" height="${l}">
			${f}
			<rect width="${c}" height="${l}" fill="${h}"/>
			${g}
			<g transform="translate(${r}, ${r})">
				${m}
				${b}
				${p}
				${w}
			</g>
			${y}
		</svg>
	`.split(`
`).map(A=>A.trim()).filter(Boolean).join(`
`)}var Zt="http://www.w3.org/2000/svg";function S(t){return document.createElementNS(Zt,t)}function et(t){return t.split(/<br\s*\/?>|\n/)}function cr(t,n){let e=S("rect");return e.setAttribute("x",String(t.x)),e.setAttribute("y",String(t.y)),e.setAttribute("width",String(t.width)),e.setAttribute("height",String(t.height)),e.setAttribute("fill","var(--_group-fill)"),e.setAttribute("stroke","var(--_group-stroke)"),e.setAttribute("stroke-width","1.5"),e.setAttribute("rx","4"),e}function lr(t,n){let e=et(t.label),r=t.x+8,s=t.y+8,i=14,o=S("text");return o.setAttribute("fill","var(--_group-text)"),o.setAttribute("font-family",n.font),o.setAttribute("font-size","12"),o.setAttribute("font-weight","600"),e.forEach((a,c)=>{let l=S("tspan");l.setAttribute("x",String(r)),l.setAttribute("y",String(s+c*i)),l.textContent=a,o.appendChild(l)}),o}function Jt(t,n,e){t.forEach(r=>{e.appendChild(cr(r)),e.appendChild(lr(r,n)),r.children.length>0&&Jt(r.children,n,e)})}function hr(t,n){let e=t.x,r=t.y,s=t.width,i=t.height,o=e+s/2,a=r+i/2;switch(t.shape){case"rectangle":{let c=S("rect");return c.setAttribute("x",String(e)),c.setAttribute("y",String(r)),c.setAttribute("width",String(s)),c.setAttribute("height",String(i)),c.setAttribute("fill","var(--_node-fill)"),c.setAttribute("stroke","var(--_node-stroke)"),c.setAttribute("stroke-width","1.5"),c.setAttribute("rx","0"),c}case"rounded":{let c=S("rect");return c.setAttribute("x",String(e)),c.setAttribute("y",String(r)),c.setAttribute("width",String(s)),c.setAttribute("height",String(i)),c.setAttribute("fill","var(--_node-fill)"),c.setAttribute("stroke","var(--_node-stroke)"),c.setAttribute("stroke-width","1.5"),c.setAttribute("rx","8"),c}case"diamond":{let c=s/2,l=i/2,h=`${o},${a-l} ${o+c},${a} ${o},${a+l} ${o-c},${a}`,d=S("polygon");return d.setAttribute("points",h),d.setAttribute("fill","var(--_node-fill)"),d.setAttribute("stroke","var(--_node-stroke)"),d.setAttribute("stroke-width","1.5"),d}case"stadium":{let c=Math.min(i/2,s/2),l=S("rect");return l.setAttribute("x",String(e)),l.setAttribute("y",String(r)),l.setAttribute("width",String(s)),l.setAttribute("height",String(i)),l.setAttribute("fill","var(--_node-fill)"),l.setAttribute("stroke","var(--_node-stroke)"),l.setAttribute("stroke-width","1.5"),l.setAttribute("rx",String(c)),l}case"circle":{let c=Math.min(s,i)/2,l=S("circle");return l.setAttribute("cx",String(o)),l.setAttribute("cy",String(a)),l.setAttribute("r",String(c)),l.setAttribute("fill","var(--_node-fill)"),l.setAttribute("stroke","var(--_node-stroke)"),l.setAttribute("stroke-width","1.5"),l}case"subroutine":{let c=S("g"),l=S("rect");l.setAttribute("x",String(e)),l.setAttribute("y",String(r)),l.setAttribute("width",String(s)),l.setAttribute("height",String(i)),l.setAttribute("fill","var(--_node-fill)"),l.setAttribute("stroke","var(--_node-stroke)"),l.setAttribute("stroke-width","1.5"),l.setAttribute("rx","0");let h=4,d=S("rect");return d.setAttribute("x",String(e+h)),d.setAttribute("y",String(r+h)),d.setAttribute("width",String(s-h*2)),d.setAttribute("height",String(i-h*2)),d.setAttribute("fill","none"),d.setAttribute("stroke","var(--_node-stroke)"),d.setAttribute("stroke-width","1.5"),d.setAttribute("rx","0"),c.appendChild(l),c.appendChild(d),c}case"doublecircle":{let c=S("g"),l=Math.min(s,i)/2,h=l-4,d=S("circle");d.setAttribute("cx",String(o)),d.setAttribute("cy",String(a)),d.setAttribute("r",String(l)),d.setAttribute("fill","var(--_node-fill)"),d.setAttribute("stroke","var(--_node-stroke)"),d.setAttribute("stroke-width","1.5");let u=S("circle");return u.setAttribute("cx",String(o)),u.setAttribute("cy",String(a)),u.setAttribute("r",String(h)),u.setAttribute("fill","none"),u.setAttribute("stroke","var(--_node-stroke)"),u.setAttribute("stroke-width","1.5"),c.appendChild(d),c.appendChild(u),c}case"hexagon":{let c=s/2,l=i/2,h=c*.3,d=`${o-c+h},${a-l} ${o+c-h},${a-l} ${o+c},${a} ${o+c-h},${a+l} ${o-c+h},${a+l} ${o-c},${a}`,u=S("polygon");return u.setAttribute("points",d),u.setAttribute("fill","var(--_node-fill)"),u.setAttribute("stroke","var(--_node-stroke)"),u.setAttribute("stroke-width","1.5"),u}case"cylinder":{let c=S("g"),l=i*.1,h=`M ${e} ${r+l}
				Q ${e} ${r}, ${e+s/2} ${r}
				T ${e+s} ${r+l}
				L ${e+s} ${r+i-l}
				Q ${e+s} ${r+i}, ${e+s/2} ${r+i}
				T ${e} ${r+i-l}
				Z`,d=S("path");d.setAttribute("d",h),d.setAttribute("fill","var(--_node-fill)"),d.setAttribute("stroke","var(--_node-stroke)"),d.setAttribute("stroke-width","1.5");let u=S("ellipse");return u.setAttribute("cx",String(e+s/2)),u.setAttribute("cy",String(r+l)),u.setAttribute("rx",String(s/2)),u.setAttribute("ry",String(l)),u.setAttribute("fill","var(--_node-fill)"),u.setAttribute("stroke","var(--_node-stroke)"),u.setAttribute("stroke-width","1.5"),c.appendChild(d),c.appendChild(u),c}case"asymmetric":{let c=s*.15,l=`${e},${r+i/2} ${e+c},${r} ${e+s},${r} ${e+s-c},${r+i} ${e},${r+i}`,h=S("polygon");return h.setAttribute("points",l),h.setAttribute("fill","var(--_node-fill)"),h.setAttribute("stroke","var(--_node-stroke)"),h.setAttribute("stroke-width","1.5"),h}case"trapezoid":{let c=s*.15,l=`${e+c},${r} ${e+s-c},${r} ${e+s},${r+i} ${e},${r+i}`,h=S("polygon");return h.setAttribute("points",l),h.setAttribute("fill","var(--_node-fill)"),h.setAttribute("stroke","var(--_node-stroke)"),h.setAttribute("stroke-width","1.5"),h}case"trapezoid-alt":{let c=s*.15,l=`${e},${r} ${e+s},${r} ${e+s-c},${r+i} ${e+c},${r+i}`,h=S("polygon");return h.setAttribute("points",l),h.setAttribute("fill","var(--_node-fill)"),h.setAttribute("stroke","var(--_node-stroke)"),h.setAttribute("stroke-width","1.5"),h}case"parallelogram":{let c=s*.15,l=`${e+c},${r} ${e+s},${r} ${e+s-c},${r+i} ${e},${r+i}`,h=S("polygon");return h.setAttribute("points",l),h.setAttribute("fill","var(--_node-fill)"),h.setAttribute("stroke","var(--_node-stroke)"),h.setAttribute("stroke-width","1.5"),h}case"note":{let c=Math.min(s,i)*.15,l=`M ${e} ${r} L ${e+s-c} ${r} L ${e+s} ${r+c} L ${e+s} ${r+i} L ${e} ${r+i} Z M ${e+s-c} ${r} L ${e+s-c} ${r+c} L ${e+s} ${r+c}`,h=S("path");return h.setAttribute("d",l),h.setAttribute("fill","var(--_node-fill)"),h.setAttribute("stroke","var(--_node-stroke)"),h.setAttribute("stroke-width","1.5"),h}case"cloud":{let c=`M ${e+s*.25} ${r+i*.4}
				Q ${e} ${r+i*.4}, ${e} ${r+i*.6}
				Q ${e} ${r+i}, ${e+s*.2} ${r+i}
				Q ${e+s*.3} ${r+i}, ${e+s*.5} ${r+i*.95}
				Q ${e+s*.7} ${r+i}, ${e+s*.8} ${r+i}
				Q ${e+s} ${r+i}, ${e+s} ${r+i*.6}
				Q ${e+s} ${r+i*.4}, ${e+s*.75} ${r+i*.4}
				Q ${e+s*.8} ${r}, ${e+s*.5} ${r}
				Q ${e+s*.2} ${r}, ${e+s*.25} ${r+i*.4}
				Z`,l=S("path");return l.setAttribute("d",c),l.setAttribute("fill","var(--_node-fill)"),l.setAttribute("stroke","var(--_node-stroke)"),l.setAttribute("stroke-width","1.5"),l}case"state-start":{let c=Math.min(s,i)/4,l=S("circle");return l.setAttribute("cx",String(o)),l.setAttribute("cy",String(a)),l.setAttribute("r",String(c)),l.setAttribute("fill","var(--_text)"),l.setAttribute("stroke","none"),l}case"er-entity":{let c=S("g"),l=S("rect");if(l.setAttribute("x",String(e)),l.setAttribute("y",String(r)),l.setAttribute("width",String(s)),l.setAttribute("height",String(i)),l.setAttribute("fill","var(--_node-fill)"),l.setAttribute("stroke","var(--_node-stroke)"),l.setAttribute("stroke-width","1.5"),l.setAttribute("rx","0"),c.appendChild(l),parseInt(t.inlineStyle?.attrCount||"0")>0){let u=S("line");u.setAttribute("x1",String(e)),u.setAttribute("y1",String(r+32.8)),u.setAttribute("x2",String(e+s)),u.setAttribute("y2",String(r+32.8)),u.setAttribute("stroke","var(--_node-stroke)"),u.setAttribute("stroke-width","1"),c.appendChild(u)}return c}case"class-box":{let c=S("g"),l=S("rect");l.setAttribute("x",String(e)),l.setAttribute("y",String(r)),l.setAttribute("width",String(s)),l.setAttribute("height",String(i)),l.setAttribute("fill","var(--_node-fill)"),l.setAttribute("stroke","var(--_node-stroke)"),l.setAttribute("stroke-width","1.5"),l.setAttribute("rx","0"),c.appendChild(l);let h=16,d=12,u=parseInt(t.inlineStyle?.attrCount||"0"),f=parseInt(t.inlineStyle?.methodCount||"0"),g=h+d,m=u>0?u*h+d:0;if(u>0||f>0){let b=S("line");b.setAttribute("x1",String(e)),b.setAttribute("y1",String(r+g)),b.setAttribute("x2",String(e+s)),b.setAttribute("y2",String(r+g)),b.setAttribute("stroke","var(--_node-stroke)"),b.setAttribute("stroke-width","1"),c.appendChild(b)}if(f>0&&u>0){let b=S("line");b.setAttribute("x1",String(e)),b.setAttribute("y1",String(r+g+m)),b.setAttribute("x2",String(e+s)),b.setAttribute("y2",String(r+g+m)),b.setAttribute("stroke","var(--_node-stroke)"),b.setAttribute("stroke-width","1"),c.appendChild(b)}return c}case"state-end":{let c=S("g"),l=Math.min(s,i)/3,h=l*.6,d=S("circle");d.setAttribute("cx",String(o)),d.setAttribute("cy",String(a)),d.setAttribute("r",String(l)),d.setAttribute("fill","none"),d.setAttribute("stroke","var(--_text)"),d.setAttribute("stroke-width","2");let u=S("circle");return u.setAttribute("cx",String(o)),u.setAttribute("cy",String(a)),u.setAttribute("r",String(h)),u.setAttribute("fill","var(--_text)"),u.setAttribute("stroke","none"),c.appendChild(d),c.appendChild(u),c}default:{let c=S("rect");return c.setAttribute("x",String(e)),c.setAttribute("y",String(r)),c.setAttribute("width",String(s)),c.setAttribute("height",String(i)),c.setAttribute("fill","var(--_node-fill)"),c.setAttribute("stroke","var(--_node-stroke)"),c.setAttribute("stroke-width","1.5"),c.setAttribute("rx","8"),c}}}function dr(t,n){let e=S("g"),r=et(t.label),s=t.x,i=t.width,o=s+i/2,a=14,c=12,l=a*1.2+16,h=r[0]||"",d=S("text");d.setAttribute("x",String(o)),d.setAttribute("y",String(t.y+l/2)),d.setAttribute("text-anchor","middle"),d.setAttribute("dominant-baseline","middle"),d.setAttribute("fill","var(--_text)"),d.setAttribute("font-family",n.font),d.setAttribute("font-size",String(a)),d.setAttribute("font-weight","600"),d.textContent=h,e.appendChild(d);let u=1;if(u<r.length&&r[u]==="---"){u++;let g=t.y+l+8,m=c*1.4,b=0;for(;u<r.length&&r[u]!=="---";){let p=r[u]??"",w=g+b*m+c/2,y=p.match(/^(PK|FK|UK|PK,FK|FK,PK)\s+/);if(y){let k=y[1],A=p.slice(y[0].length),E=S("text");E.setAttribute("x",String(s+8)),E.setAttribute("y",String(w)),E.setAttribute("dominant-baseline","middle"),E.setAttribute("fill","var(--_node-stroke)"),E.setAttribute("font-family",n.font),E.setAttribute("font-size","10"),E.setAttribute("font-weight","600"),E.textContent=k,e.appendChild(E);let x=S("text");x.setAttribute("x",String(s+34)),x.setAttribute("y",String(w)),x.setAttribute("dominant-baseline","middle"),x.setAttribute("fill","var(--_text)"),x.setAttribute("font-family",n.font),x.setAttribute("font-size",String(c)),x.setAttribute("font-weight","400"),x.textContent=A,e.appendChild(x)}else{let k=S("text");k.setAttribute("x",String(s+34)),k.setAttribute("y",String(w)),k.setAttribute("dominant-baseline","middle"),k.setAttribute("fill","var(--_text)"),k.setAttribute("font-family",n.font),k.setAttribute("font-size",String(c)),k.setAttribute("font-weight","400"),k.textContent=p,e.appendChild(k)}b++,u++}}if(parseInt(t.inlineStyle?.attrCount||"0")===0){let g=S("text");g.setAttribute("x",String(o)),g.setAttribute("y",String(t.y+l+10)),g.setAttribute("text-anchor","middle"),g.setAttribute("dominant-baseline","middle"),g.setAttribute("fill","var(--_muted)"),g.setAttribute("font-family",n.font),g.setAttribute("font-size","11"),g.setAttribute("font-style","italic"),g.textContent="(no attributes)",e.appendChild(g)}return e}function ur(t,n){let e=S("g"),r=et(t.label),s=16,i=12,o=t.x,a=t.x+t.width/2,c=t.y,l=0,h=r[l]||"";c+=i/2+s/2;let d=S("text");if(d.setAttribute("x",String(a)),d.setAttribute("y",String(c)),d.setAttribute("text-anchor","middle"),d.setAttribute("dominant-baseline","middle"),d.setAttribute("fill","var(--_text)"),d.setAttribute("font-family",n.font),d.setAttribute("font-size","14"),d.setAttribute("font-weight","600"),d.textContent=h,e.appendChild(d),l++,l<r.length&&r[l]==="---")for(l++,c=t.y+s+i;l<r.length&&r[l]!=="---";){c+=s*.8;let u=S("text");u.setAttribute("x",String(o+i)),u.setAttribute("y",String(c)),u.setAttribute("dominant-baseline","middle"),u.setAttribute("fill","var(--_text)"),u.setAttribute("font-family",n.font),u.setAttribute("font-size","12"),u.setAttribute("font-weight","400"),u.textContent=r[l]??"",e.appendChild(u),l++}if(l<r.length&&r[l]==="---"){l++;let u=parseInt(t.inlineStyle?.attrCount||"0"),f=u>0?u*s+i:0;for(c=t.y+s+i+f;l<r.length;){c+=s*.8;let g=S("text");g.setAttribute("x",String(o+i)),g.setAttribute("y",String(c)),g.setAttribute("dominant-baseline","middle"),g.setAttribute("fill","var(--_text)"),g.setAttribute("font-family",n.font),g.setAttribute("font-size","12"),g.setAttribute("font-weight","400"),g.textContent=r[l]??"",e.appendChild(g),l++}}return e}function fr(t,n){if(t.shape==="state-start"||t.shape==="state-end")return S("g");if(t.shape==="class-box")return ur(t,n);if(t.shape==="er-entity")return dr(t,n);let e=et(t.label),r=t.x+t.width/2,s=t.y+t.height/2,i=16,o=e.length*i,a=s-o/2+i/2,c=S("text");return c.setAttribute("fill","var(--_text)"),c.setAttribute("font-family",n.font),c.setAttribute("font-size","14"),c.setAttribute("font-weight","400"),e.forEach((l,h)=>{let d=S("tspan");d.setAttribute("x",String(r)),d.setAttribute("y",String(a+h*i)),d.setAttribute("text-anchor","middle"),d.setAttribute("dominant-baseline","middle"),d.textContent=l,c.appendChild(d)}),c}function gr(t,n,e){let r=S("g");return r.setAttribute("data-node-id",t.id),r.setAttribute("role","img"),r.setAttribute("aria-label",t.label),e.interactive&&(r.style.cursor="pointer",e.onNodeClick&&r.addEventListener("click",s=>{e.onNodeClick?.(t.id,s)}),e.onNodeHover&&(r.addEventListener("mouseenter",s=>{e.onNodeHover?.(t.id,s)}),r.addEventListener("mouseleave",s=>{e.onNodeHover?.(null,s)}))),r.appendChild(hr(t)),r.appendChild(fr(t,n)),r}function pr(t,n,e){let r=S("g");if(r.setAttribute("data-edge-source",t.source),r.setAttribute("data-edge-target",t.target),t.points.length<2)return r;let s=t.points.map((d,u)=>`${u===0?"M":"L"} ${d.x} ${d.y}`).join(" "),i=S("path");i.setAttribute("d",s),i.setAttribute("stroke","var(--_line)"),i.setAttribute("fill","none"),i.setAttribute("stroke-linejoin","round"),i.setAttribute("stroke-linecap","round"),t.style==="dotted"?(i.setAttribute("stroke-dasharray","6 4"),i.setAttribute("stroke-width","1.5")):t.style==="thick"?i.setAttribute("stroke-width","2.5"):i.setAttribute("stroke-width","1.5");let o=t.inlineStyle?.fromCardinality,a=t.inlineStyle?.toCardinality,c=t.inlineStyle?.relationType,l={one:{start:"er-one-start",end:"er-one"},many:{start:"er-many-start",end:"er-many"},"zero-one":{start:"er-zero-one-start",end:"er-zero-one"},"zero-many":{start:"er-zero-many-start",end:"er-zero-many"}},h={inheritance:"cls-inheritance",realization:"cls-inheritance",composition:"cls-composition",aggregation:"cls-aggregation"};return c&&h[c]?i.setAttribute("marker-start",`url(#${h[c]})`):o&&l[o]?i.setAttribute("marker-start",`url(#${l[o].start})`):t.hasArrowStart&&i.setAttribute("marker-start","url(#arrowhead-start)"),a&&l[a]?i.setAttribute("marker-end",`url(#${l[a].end})`):t.hasArrowEnd&&i.setAttribute("marker-end","url(#arrowhead)"),e.interactive&&e.onEdgeClick&&(i.style.cursor="pointer",i.addEventListener("click",d=>{e.onEdgeClick?.(t.source,t.target,d)})),r.appendChild(i),r}function mr(t,n){let e=S("g");if(!t.label||!t.labelPosition)return e;let{x:r,y:s}=t.labelPosition,i=et(t.label),o=14,a=i.length*o,c=4,l=Math.max(...i.map(b=>b.length*7))+c*2,h=a+c*2,d=r-l/2,u=s-h/2,f=S("rect");f.setAttribute("x",String(d)),f.setAttribute("y",String(u)),f.setAttribute("width",String(l)),f.setAttribute("height",String(h)),f.setAttribute("fill","var(--bg)"),f.setAttribute("stroke","var(--_line)"),f.setAttribute("stroke-width","0.75"),f.setAttribute("rx","3");let g=S("text");g.setAttribute("fill","var(--_text)"),g.setAttribute("font-family",n.font),g.setAttribute("font-size","11"),g.setAttribute("font-weight","500");let m=s-a/2+o/2;return i.forEach((b,p)=>{let w=S("tspan");w.setAttribute("x",String(r)),w.setAttribute("y",String(m+p*o)),w.setAttribute("text-anchor","middle"),w.setAttribute("dominant-baseline","middle"),w.textContent=b,g.appendChild(w)}),e.appendChild(f),e.appendChild(g),e}function br(t){let n=S("defs"),e=S("marker");e.setAttribute("id","arrowhead"),e.setAttribute("markerWidth","12"),e.setAttribute("markerHeight","8"),e.setAttribute("refX","11"),e.setAttribute("refY","4"),e.setAttribute("orient","auto"),e.setAttribute("markerUnits","userSpaceOnUse");let r=S("path");r.setAttribute("d","M1,1 L11,4 L1,7 z"),r.setAttribute("fill","var(--_arrow)"),e.appendChild(r);let s=S("marker");s.setAttribute("id","arrowhead-start"),s.setAttribute("markerWidth","12"),s.setAttribute("markerHeight","8"),s.setAttribute("refX","1"),s.setAttribute("refY","4"),s.setAttribute("orient","auto"),s.setAttribute("markerUnits","userSpaceOnUse");let i=S("path");i.setAttribute("d","M11,1 L1,4 L11,7 z"),i.setAttribute("fill","var(--_arrow)"),s.appendChild(i);let o=S("marker");o.setAttribute("id","arrowhead-open"),o.setAttribute("markerWidth","12"),o.setAttribute("markerHeight","8"),o.setAttribute("refX","11"),o.setAttribute("refY","4"),o.setAttribute("orient","auto"),o.setAttribute("markerUnits","userSpaceOnUse");let a=S("path");a.setAttribute("d","M1,1 L11,4 L1,7"),a.setAttribute("fill","none"),a.setAttribute("stroke","var(--_arrow)"),a.setAttribute("stroke-width","1.5"),a.setAttribute("stroke-linejoin","round"),o.appendChild(a);let c=S("marker");c.setAttribute("id","arrowhead-cross"),c.setAttribute("markerWidth","12"),c.setAttribute("markerHeight","12"),c.setAttribute("refX","6"),c.setAttribute("refY","6"),c.setAttribute("orient","auto"),c.setAttribute("markerUnits","userSpaceOnUse");let l=S("path");l.setAttribute("d","M3,3 L9,9 M9,3 L3,9"),l.setAttribute("stroke","var(--_arrow)"),l.setAttribute("stroke-width","1.5"),l.setAttribute("stroke-linecap","round"),c.appendChild(l),n.appendChild(e),n.appendChild(s),n.appendChild(o),n.appendChild(c);let d=[...[{id:"er-one",w:20,h:16,refX:18,refY:8,content:'<line x1="18" y1="2" x2="18" y2="14" stroke="var(--_line)" stroke-width="1.5"/><line x1="14" y1="2" x2="14" y2="14" stroke="var(--_line)" stroke-width="1.5"/>'},{id:"er-one-start",w:20,h:16,refX:2,refY:8,content:'<line x1="2" y1="2" x2="2" y2="14" stroke="var(--_line)" stroke-width="1.5"/><line x1="6" y1="2" x2="6" y2="14" stroke="var(--_line)" stroke-width="1.5"/>'},{id:"er-many",w:20,h:16,refX:18,refY:8,content:'<line x1="18" y1="2" x2="18" y2="14" stroke="var(--_line)" stroke-width="1.5"/><path d="M18,8 L6,2 M18,8 L6,14" stroke="var(--_line)" stroke-width="1.5" fill="none"/>'},{id:"er-many-start",w:20,h:16,refX:2,refY:8,content:'<line x1="2" y1="2" x2="2" y2="14" stroke="var(--_line)" stroke-width="1.5"/><path d="M2,8 L14,2 M2,8 L14,14" stroke="var(--_line)" stroke-width="1.5" fill="none"/>'},{id:"er-zero-one",w:24,h:16,refX:22,refY:8,content:'<line x1="22" y1="2" x2="22" y2="14" stroke="var(--_line)" stroke-width="1.5"/><circle cx="14" cy="8" r="4" fill="none" stroke="var(--_line)" stroke-width="1.5"/>'},{id:"er-zero-one-start",w:24,h:16,refX:2,refY:8,content:'<line x1="2" y1="2" x2="2" y2="14" stroke="var(--_line)" stroke-width="1.5"/><circle cx="10" cy="8" r="4" fill="none" stroke="var(--_line)" stroke-width="1.5"/>'},{id:"er-zero-many",w:24,h:16,refX:22,refY:8,content:'<path d="M22,8 L10,2 M22,8 L10,14" stroke="var(--_line)" stroke-width="1.5" fill="none"/><circle cx="6" cy="8" r="4" fill="none" stroke="var(--_line)" stroke-width="1.5"/>'},{id:"er-zero-many-start",w:24,h:16,refX:2,refY:8,content:'<path d="M2,8 L14,2 M2,8 L14,14" stroke="var(--_line)" stroke-width="1.5" fill="none"/><circle cx="18" cy="8" r="4" fill="none" stroke="var(--_line)" stroke-width="1.5"/>'}],{id:"cls-inheritance",w:16,h:14,refX:1,refY:7,content:'<path d="M15,1 L1,7 L15,13 z" fill="var(--_node-fill)" stroke="var(--_line)" stroke-width="1.5" stroke-linejoin="round"/>'},{id:"cls-composition",w:14,h:14,refX:1,refY:7,content:'<path d="M1,7 L7,1 L13,7 L7,13 z" fill="var(--_line)" stroke="var(--_line)" stroke-width="1"/>'},{id:"cls-aggregation",w:14,h:14,refX:1,refY:7,content:'<path d="M1,7 L7,1 L13,7 L7,13 z" fill="var(--_node-fill)" stroke="var(--_line)" stroke-width="1.5"/>'}];for(let u of d){let f=S("marker");f.setAttribute("id",u.id),f.setAttribute("markerWidth",String(u.w)),f.setAttribute("markerHeight",String(u.h)),f.setAttribute("refX",String(u.refX)),f.setAttribute("refY",String(u.refY)),f.setAttribute("orient","auto"),f.setAttribute("markerUnits","userSpaceOnUse"),f.innerHTML=u.content,n.appendChild(f)}return n}function te(t,n){if(typeof document>"u")throw new Error("renderToDOM can only be used in browser environments");let e=n?.theme??B,r=n?.padding??16,s=n?.transparent??!1;n?.debug;let i=Z(e),o={font:i.font},a=t.width+r*2,c=t.height+r*2,l=s?"none":i.bg,h=S("svg"),d=`cm-${Math.random().toString(36).slice(2,8)}`;h.setAttribute("id",d),h.setAttribute("xmlns",Zt),h.setAttribute("viewBox",`0 0 ${a} ${c}`),h.setAttribute("width",String(a)),h.setAttribute("height",String(c));let u="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap",f=S("style");f.textContent=`
		@import url('${u}');
		#${d} {
			--bg: ${i.bg};
			--fg: ${i.fg};
			--_text: ${i.text};
			--_line: ${i.line};
			--_arrow: ${i.arrow};
			--_node-fill: ${i.nodeFill};
			--_node-stroke: ${i.nodeStroke};
			--_muted: ${i.muted};
			--_group-fill: ${i.groupFill};
			--_group-stroke: ${i.groupStroke};
			--_group-text: ${i.groupText};
		}
	`,h.appendChild(f);let g=S("rect");g.setAttribute("width",String(a)),g.setAttribute("height",String(c)),g.setAttribute("fill",l),h.appendChild(g),h.appendChild(br());let m=S("g");return m.setAttribute("transform",`translate(${r}, ${r})`),Jt(t.groups,o,m),t.edges.forEach(b=>{m.appendChild(pr(b,o,n||{}))}),t.edges.forEach(b=>{m.appendChild(mr(b,o))}),t.nodes.forEach(b=>{m.appendChild(gr(b,o,n||{}))}),h.appendChild(m),n?.container&&n.container.appendChild(h),h}function Q(t){let n=t.getAttribute("viewBox");if(!n){let r=Number.parseFloat(t.getAttribute("width")||"0"),s=Number.parseFloat(t.getAttribute("height")||"0");return{x:0,y:0,width:r,height:s}}let e=n.split(/\s+/).map(Number.parseFloat);return{x:e[0]??0,y:e[1]??0,width:e[2]??0,height:e[3]??0}}function J(t,n){t.setAttribute("viewBox",`${n.x} ${n.y} ${n.width} ${n.height}`)}function tt(t,n){let e=t.getBoundingClientRect(),r=Q(t),s=r.width/e.width,i=r.height/e.height,o=(n.clientX-e.left)*s+r.x,a=(n.clientY-e.top)*i+r.y;return{x:o,y:a}}function qt(t,n){let e=n.clientX-t.clientX,r=n.clientY-t.clientY;return Math.sqrt(e*e+r*r)}function yr(t,n){return{x:(t.clientX+n.clientX)/2,y:(t.clientY+n.clientY)/2}}function ee(t,n){let e=n?.minZoom??.1,r=n?.maxZoom??5,s=n?.zoomSpeed??.1,i=Q(t),o=!1,a={x:0,y:0},c={...i},l=0,h={...i};function d(y){y.preventDefault();let k=Q(t),A=tt(t,y),E=y.deltaY>0?1+s:1-s,x=k.width*E,v=k.height*E,_=i.width*r,$=i.height*r,M=i.width*e,C=i.height*e;if(x>_||x<M||v>$||v<C)return;let P=A.x-(A.x-k.x)*x/k.width,N=A.y-(A.y-k.y)*v/k.height;J(t,{x:P,y:N,width:x,height:v})}function u(y){y.button===0&&(o=!0,a=tt(t,y),c=Q(t),t.style.cursor="grabbing")}function f(y){if(!o)return;let k=tt(t,y),A=k.x-a.x,E=k.y-a.y;J(t,{x:c.x-A,y:c.y-E,width:c.width,height:c.height})}function g(){o=!1,t.style.cursor="grab"}function m(){J(t,i)}function b(y){if(y.touches.length===2){y.preventDefault();let k=y.touches[0],A=y.touches[1];l=qt(k,A),h=Q(t)}else if(y.touches.length===1){let k=y.touches[0];a=tt(t,{clientX:k.clientX,clientY:k.clientY}),c=Q(t),o=!0}}function p(y){if(y.touches.length===2){y.preventDefault();let k=y.touches[0],A=y.touches[1],E=qt(k,A),x=l/E,v=h.width*x,_=h.height*x,$=i.width*r,M=i.height*r,C=i.width*e,P=i.height*e;if(v>$||v<C||_>M||_<P)return;let N=yr(k,A),L=t.getBoundingClientRect(),I=h,z=I.width/L.width,W=I.height/L.height,Y=(N.x-L.left)*z+I.x,X=(N.y-L.top)*W+I.y,U=Y-(Y-I.x)*v/I.width,rt=X-(X-I.y)*_/I.height;J(t,{x:U,y:rt,width:v,height:_})}else if(y.touches.length===1&&o){y.preventDefault();let k=y.touches[0],A=tt(t,{clientX:k.clientX,clientY:k.clientY}),E=A.x-a.x,x=A.y-a.y;J(t,{x:c.x-E,y:c.y-x,width:c.width,height:c.height})}}function w(){o=!1,l=0}return t.style.cursor="grab",t.addEventListener("wheel",d,{passive:!1}),t.addEventListener("mousedown",u),document.addEventListener("mousemove",f),document.addEventListener("mouseup",g),t.addEventListener("dblclick",m),t.addEventListener("touchstart",b,{passive:!1}),t.addEventListener("touchmove",p,{passive:!1}),t.addEventListener("touchend",w),()=>{t.style.cursor="",t.removeEventListener("wheel",d),t.removeEventListener("mousedown",u),document.removeEventListener("mousemove",f),document.removeEventListener("mouseup",g),t.removeEventListener("dblclick",m),t.removeEventListener("touchstart",b),t.removeEventListener("touchmove",p),t.removeEventListener("touchend",w)}}function xr(t){let n=new Map,e=[];return t.querySelectorAll("[data-node-id]").forEach(r=>{let s=r.getAttribute("data-node-id");s&&n.set(s,{element:r,connections:new Set})}),t.querySelectorAll("[data-edge-source]").forEach(r=>{let s=r.getAttribute("data-edge-source"),i=r.getAttribute("data-edge-target");s&&i&&(e.push({source:s,target:i}),n.get(s)?.connections.add(i),n.get(i)?.connections.add(s))}),{nodes:n,edges:e}}function xt(t){if(t.setAttribute("tabindex","0"),t.focus(),t.querySelector(".focus-ring"))return;let r=t.getBBox(),s=4,i=document.createElementNS("http://www.w3.org/2000/svg","rect");i.classList.add("focus-ring"),i.setAttribute("x",String(r.x-s)),i.setAttribute("y",String(r.y-s)),i.setAttribute("width",String(r.width+s*2)),i.setAttribute("height",String(r.height+s*2)),i.setAttribute("fill","none"),i.setAttribute("stroke","#3b82f6"),i.setAttribute("stroke-width","2"),i.setAttribute("stroke-dasharray","4 2"),i.setAttribute("rx","4"),i.setAttribute("pointer-events","none"),t.insertBefore(i,t.firstChild)}function ct(t){t.removeAttribute("tabindex");let n=t.querySelector(".focus-ring");n&&n.remove()}function wr(t){let n=new CustomEvent("nodeselect",{detail:{nodeId:t.getAttribute("data-node-id")},bubbles:!0});t.dispatchEvent(n)}function kr(t,n,e){let r=e.nodes.get(t);if(!r)return null;let s=r.element.getBoundingClientRect(),i=[];for(let o of r.connections){let a=e.nodes.get(o);if(!a)continue;let c=a.element.getBoundingClientRect(),l=!1,h=0;switch(n){case"up":l=c.top<s.top,h=s.top-c.top;break;case"down":l=c.bottom>s.bottom,h=c.bottom-s.bottom;break;case"left":l=c.left<s.left,h=s.left-c.left;break;case"right":l=c.right>s.right,h=c.right-s.right;break}l&&h>0&&i.push({id:o,distance:h})}return i.length===0?null:(i.sort((o,a)=>o.distance-a.distance),i[0].id)}function ne(t){let n=xr(t),e=null,r=Array.from(n.nodes.keys());if(r.length===0)return()=>{};let s={ArrowUp:"up",ArrowDown:"down",ArrowLeft:"left",ArrowRight:"right"};function i(o){switch(o.key){case"Tab":{if(o.preventDefault(),e){let l=n.nodes.get(e);l&&ct(l.element)}let a=e?r.indexOf(e):-1,c=o.shiftKey?a<=0?r.length-1:a-1:(a+1)%r.length;if(e=r[c]??null,e){let l=n.nodes.get(e);l&&xt(l.element)}break}case"Enter":{if(e){let a=n.nodes.get(e);a&&wr(a.element)}break}case"Escape":{if(e){let a=n.nodes.get(e);a&&ct(a.element),e=null}break}case"ArrowUp":case"ArrowDown":case"ArrowLeft":case"ArrowRight":{if(o.preventDefault(),!e){if(e=r[0]??null,e){let l=n.nodes.get(e);l&&xt(l.element)}return}let a=s[o.key];if(!a)return;let c=kr(e,a,n);if(c){let l=n.nodes.get(e);l&&ct(l.element),e=c;let h=n.nodes.get(e);h&&xt(h.element)}break}}}return t.addEventListener("keydown",i),t.setAttribute("tabindex","0"),()=>{t.removeEventListener("keydown",i),t.removeAttribute("tabindex"),n.nodes.forEach(({element:o})=>{ct(o)})}}function $r(t){let n=new Map;return t.querySelectorAll("[data-node-id]").forEach(e=>{let r=e.getAttribute("data-node-id");r&&n.set(r,{id:r,element:e,connectedEdges:new Set})}),t.querySelectorAll("[data-edge-source]").forEach(e=>{let r=e.getAttribute("data-edge-source"),s=e.getAttribute("data-edge-target");if(r&&s){let i=e;n.get(r)?.connectedEdges.add(i),n.get(s)?.connectedEdges.add(i)}}),n}function Ar(){let t=document.createElement("div");return t.style.position="absolute",t.style.padding="8px 12px",t.style.background="rgba(0, 0, 0, 0.9)",t.style.color="white",t.style.fontSize="12px",t.style.fontFamily="Inter, system-ui, sans-serif",t.style.borderRadius="6px",t.style.pointerEvents="none",t.style.zIndex="10000",t.style.opacity="0",t.style.transition="opacity 0.2s ease",t.style.maxWidth="300px",t.style.wordWrap="break-word",t.style.boxShadow="0 4px 6px rgba(0, 0, 0, 0.3)",t}function Sr(t,n,e){t.textContent=n,t.style.left=`${e.pageX+10}px`,t.style.top=`${e.pageY+10}px`,t.style.opacity="1"}function vr(t){t.style.opacity="0"}function Mr(t,n){let e=new Set;t.connectedEdges.forEach(r=>{let s=r.getAttribute("data-edge-source"),i=r.getAttribute("data-edge-target");s&&s!==t.id&&e.add(s),i&&i!==t.id&&e.add(i)}),n.forEach(r=>{r.id===t.id||e.has(r.id)?r.element.style.opacity="1":r.element.style.opacity="0.3"}),t.connectedEdges.forEach(r=>{r.style.opacity="1",r.style.strokeWidth="2.5"})}function Kt(t,n){t.forEach(e=>{e.element.style.opacity="1"}),n.querySelectorAll("[data-edge-source]").forEach(e=>{let r=e;r.style.opacity="1",r.style.strokeWidth=""})}function re(t){let n=$r(t),e=Ar();document.body.appendChild(e);let r=null;function s(a){let c=a.currentTarget,l=c.getAttribute("data-node-id");if(!l)return;r=l;let h=n.get(l);if(!h)return;let d=c.getAttribute("aria-label")||l;Sr(e,d,a),Mr(h,n)}function i(a){if(r){let c=a;e.style.left=`${c.pageX+10}px`,e.style.top=`${c.pageY+10}px`}}function o(){r=null,vr(e),Kt(n,t)}return n.forEach(a=>{a.element.addEventListener("mouseenter",s),a.element.addEventListener("mousemove",i),a.element.addEventListener("mouseleave",o)}),()=>{n.forEach(a=>{a.element.removeEventListener("mouseenter",s),a.element.removeEventListener("mousemove",i),a.element.removeEventListener("mouseleave",o)}),e.remove(),Kt(n,t)}}function wt(t){let n=t.getAttribute("viewBox");if(!n){let r=Number.parseFloat(t.getAttribute("width")||"0"),s=Number.parseFloat(t.getAttribute("height")||"0");return{x:0,y:0,width:r,height:s}}let e=n.split(/\s+/).map(Number.parseFloat);return{x:e[0]??0,y:e[1]??0,width:e[2]??0,height:e[3]??0}}function _r(t){let n=t.querySelector("g");if(!n)return wt(t);let e=n.getBBox(),r=20;return{x:e.x-r,y:e.y-r,width:e.width+r*2,height:e.height+r*2}}function Er(t){return getComputedStyle(t).position==="static"?(t.style.position="relative",!0):!1}function Cr(t,n,e){let r=document.createElement("div");r.style.position="absolute",r.style.width=`${t}px`,r.style.height=`${n}px`,r.style.border="1px solid rgba(255, 255, 255, 0.2)",r.style.borderRadius="4px",r.style.overflow="hidden",r.style.background="rgba(0, 0, 0, 0.8)",r.style.zIndex="9999",r.style.pointerEvents="auto";let s="8px";switch(e){case"top-left":r.style.top=s,r.style.left=s;break;case"top-right":r.style.top=s,r.style.right=s;break;case"bottom-left":r.style.bottom=s,r.style.left=s;break;case"bottom-right":r.style.bottom=s,r.style.right=s;break}return r}function Lr(t,n,e){let r=document.createElementNS("http://www.w3.org/2000/svg","svg");return r.setAttribute("width",String(n)),r.setAttribute("height",String(e)),r.setAttribute("viewBox",`${t.x} ${t.y} ${t.width} ${t.height}`),r.style.display="block",r.style.pointerEvents="none",r}function Pr(t,n){let e=t.querySelector("g");if(!e)return;let r=e.cloneNode(!0);r.style.pointerEvents="none",n.appendChild(r)}function Ir(){let t=document.createElementNS("http://www.w3.org/2000/svg","rect");return t.setAttribute("fill","rgba(59, 130, 246, 0.3)"),t.setAttribute("stroke","#3b82f6"),t.setAttribute("stroke-width","2"),t.style.pointerEvents="none",t}function Nr(t,n){t.setAttribute("x",String(n.x)),t.setAttribute("y",String(n.y)),t.setAttribute("width",String(n.width)),t.setAttribute("height",String(n.height))}function Tr(t,n,e,r,s,i){let o=n.getBoundingClientRect(),a=(t.clientX-o.left)/s,c=(t.clientY-o.top)/i,l=e.x+a*e.width,h=e.y+c*e.height;return{x:l-r.width/2,y:h-r.height/2,width:r.width,height:r.height}}function ie(t,n){let e=n?.width??150,r=n?.height??100,s=n?.position??"bottom-right",i=t.parentElement;if(!i)return()=>{};let o=Er(i),a=_r(t),c=Cr(e,r,s),l=Lr(a,e,r),h=Ir();Pr(t,l),l.appendChild(h),c.appendChild(l),i.appendChild(c);let d=()=>{let g=wt(t);Nr(h,g)};d();let u=new MutationObserver(g=>{for(let m of g)m.type==="attributes"&&m.attributeName==="viewBox"&&d()});u.observe(t,{attributes:!0,attributeFilter:["viewBox"]});let f=g=>{let m=wt(t),b=Tr(g,c,a,m,e,r);t.setAttribute("viewBox",`${b.x} ${b.y} ${b.width} ${b.height}`)};return c.addEventListener("click",f),c.style.cursor="pointer",()=>{u.disconnect(),c.removeEventListener("click",f),c.remove(),o&&(i.style.position="")}}function Dr(t,n){let e=[];return t.querySelectorAll("[data-node-id]").forEach(s=>{let i=s.getAttribute("data-node-id");if(i){if(s.style.cursor="pointer",n.onNodeClick){let o=(a=>{n.onNodeClick?.(i,a)});e.push({element:s,type:"click",handler:o})}if(n.onNodeHover){let o=(c=>{n.onNodeHover?.(i,c)});e.push({element:s,type:"mouseenter",handler:o});let a=(c=>{n.onNodeHover?.(null,c)});e.push({element:s,type:"mouseleave",handler:a})}}}),e}function zr(t,n){let e=[];return t.querySelectorAll("[data-edge-source]").forEach(s=>{let i=s.getAttribute("data-edge-source"),o=s.getAttribute("data-edge-target");if(!(!i||!o)){if(s.style.cursor="pointer",n.onEdgeClick){let a=(c=>{n.onEdgeClick?.(i,o,c)});e.push({element:s,type:"click",handler:a})}if(n.onEdgeHover){let a=(l=>{n.onEdgeHover?.(i,o,l)});e.push({element:s,type:"mouseenter",handler:a});let c=(l=>{n.onEdgeHover?.(i,null,l)});e.push({element:s,type:"mouseleave",handler:c})}}}),e}function se(t,n){let e=Dr(t,n),r=zr(t,n),s=[...e,...r];for(let{element:i,type:o,handler:a}of s)i.addEventListener(o,a);return()=>{for(let{element:i,type:o,handler:a}of s)i.removeEventListener(o,a);t.querySelectorAll("[data-node-id]").forEach(i=>{i.style.cursor=""}),t.querySelectorAll("[data-edge-source]").forEach(i=>{i.style.cursor=""})}}function Hr(){let t=document.createElement("div");return t.style.position="absolute",t.style.top="8px",t.style.left="50%",t.style.transform="translateX(-50%)",t.style.background="rgba(0, 0, 0, 0.9)",t.style.border="1px solid #3b82f6",t.style.borderRadius="8px",t.style.padding="8px 12px",t.style.display="flex",t.style.alignItems="center",t.style.gap="8px",t.style.zIndex="10000",t}function Rr(){let t=document.createElement("input");return t.type="text",t.placeholder="Search nodes...",t.style.background="transparent",t.style.border="none",t.style.color="white",t.style.outline="none",t.style.fontSize="14px",t.style.fontFamily="Inter, system-ui, sans-serif",t.style.width="200px",t}function Wr(){let t=document.createElement("span");return t.style.color="rgba(255, 255, 255, 0.6)",t.style.fontSize="12px",t.style.whiteSpace="nowrap",t}function Yr(t,n){let r=t.getBBox(),s=4,i=document.createElementNS("http://www.w3.org/2000/svg","rect");return i.setAttribute("x",String(r.x-s)),i.setAttribute("y",String(r.y-s)),i.setAttribute("width",String(r.width+s*2)),i.setAttribute("height",String(r.height+s*2)),i.setAttribute("fill","none"),i.setAttribute("stroke",n),i.setAttribute("stroke-width","3"),i.setAttribute("rx","4"),i.setAttribute("pointer-events","none"),i.classList.add("search-highlight"),i}function Xr(t,n){let e=[],r=n.toLowerCase();return t.querySelectorAll("[data-node-id]").forEach(s=>{let i=s,o=i.getAttribute("data-node-id");if(!o)return;(i.getAttribute("aria-label")||o).toLowerCase().includes(r)&&e.push({element:i,nodeId:o})}),e}function Or(t,n,e){t.querySelectorAll("[data-node-id]").forEach(r=>{let s=r,i=s.getAttribute("data-node-id");s.style.opacity=i&&n.has(i)?"1":String(e)}),t.querySelectorAll("[data-edge-source]").forEach(r=>{let s=r,i=s.getAttribute("data-edge-source"),o=s.getAttribute("data-edge-target"),a=i&&n.has(i)||o&&n.has(o);s.style.opacity=a?"1":String(e)})}function Fr(t){t.querySelectorAll("[data-node-id]").forEach(n=>{n.style.opacity="1"}),t.querySelectorAll("[data-edge-source]").forEach(n=>{n.style.opacity="1"})}function Br(t){t.querySelectorAll(".search-highlight").forEach(n=>n.remove())}function oe(t,n){let e=n?.highlightColor??"#3b82f6",r=n?.dimOpacity??.2,s=t.parentElement;if(!s)return()=>{};let i=getComputedStyle(s),o=!1;i.position==="static"&&(s.style.position="relative",o=!0);let a=null,c=null,l=null,h=[],d=-1,u=!1;function f(){l&&(h.length===0&&c&&c.value.length>0?l.textContent="No results":h.length>0?l.textContent=`${d+1} of ${h.length}`:l.textContent="")}function g(){Br(t),Fr(t),h=[],d=-1}function m(k){if(g(),k.length===0){f();return}let A=Xr(t,k),E=new Set(A.map(x=>x.nodeId));h=A.map(({element:x,nodeId:v})=>{let _=Yr(x,e);return x.appendChild(_),{element:x,nodeId:v,highlight:_}}),h.length>0&&(d=0,Or(t,E,r),h[0]?.element.scrollIntoView({behavior:"smooth",block:"center"})),f()}function b(){if(h.length===0)return;d=(d+1)%h.length;let k=h[d];k&&k.element.scrollIntoView({behavior:"smooth",block:"center"}),f()}function p(){if(u){c?.focus();return}u=!0,a=Hr(),c=Rr(),l=Wr(),a.appendChild(c),a.appendChild(l),s?.appendChild(a),c.focus(),c.addEventListener("input",()=>{c&&m(c.value)}),c.addEventListener("keydown",k=>{k.key==="Enter"&&(k.preventDefault(),b()),k.key==="Escape"&&(k.preventDefault(),w())})}function w(){u&&(u=!1,g(),a&&(a.remove(),a=null),c=null,l=null)}function y(k){(k.metaKey||k.ctrlKey)&&k.key==="f"&&(k.preventDefault(),p())}return t.addEventListener("keydown",y),document.addEventListener("keydown",y),()=>{t.removeEventListener("keydown",y),document.removeEventListener("keydown",y),w(),o&&(s.style.position="")}}var j={shapes:new Map,diagrams:new Map,themes:new Map};function $t(t){if(t.shapes)for(let n of t.shapes)j.shapes.set(n.name,n);if(t.diagrams)for(let n of t.diagrams)j.diagrams.set(n.type,n);if(t.themes)for(let n of t.themes)j.themes.set(n.name,n)}function nt(){return j}function At(){j.shapes.clear(),j.diagrams.clear(),j.themes.clear()}function ae(t,n={}){let{theme:e,padding:r,transparent:s,debug:i,...o}=n,a=nt(),c=null,l=null,h=t.split(/[\n;]/)[0]?.trim()||"";for(let[,d]of a.diagrams)if(d.detect(h)&&(c=d.parse(t),c?.ast)){d.layout&&(l=d.layout(c.ast,{direction:o.direction,nodeSpacing:o.nodeSpacing,layerSpacing:o.layerSpacing,padding:r}));break}if(!c&&(c=K(t),!c.ast)){let d=c.diagnostics.map(u=>u.message).join(`
`);throw new Error(`Failed to parse diagram:
${d}`)}return l||(l=V(c.ast,{direction:o.direction,nodeSpacing:o.nodeSpacing,layerSpacing:o.layerSpacing,padding:r})),lt(l,{theme:e,padding:r,transparent:s,debug:i})}var St=class{buffer;width;height;constructor(n,e){this.width=n,this.height=e,this.buffer=Array.from({length:e},()=>Array.from({length:n},()=>({char:" "})))}set(n,e,r,s){let i=Math.round(n),o=Math.round(e);i<0||i>=this.width||o<0||o>=this.height||(this.buffer[o][i]={char:r,color:s})}line(n,e,r,s,i,o){let a=Math.round(n),c=Math.round(e),l=Math.round(r),h=Math.round(s),d=Math.abs(l-a),u=Math.abs(h-c),f=a<l?1:-1,g=c<h?1:-1,m=d-u,b=a,p=c;for(;;){let w=i??(d>u?"\u2500":u>d?"\u2502":"\u2500");if(this.set(b,p,w,o),b===l&&p===h)break;let y=2*m;y>-u&&(m-=u,b+=f),y<d&&(m+=d,p+=g)}}box(n,e,r,s,i){let o=Math.round(n),a=Math.round(e),c=Math.round(r),l=Math.round(s);this.set(o,a,"\u250C",i),this.set(o+c-1,a,"\u2510",i),this.set(o,a+l-1,"\u2514",i),this.set(o+c-1,a+l-1,"\u2518",i);for(let h=1;h<c-1;h++)this.set(o+h,a,"\u2500",i),this.set(o+h,a+l-1,"\u2500",i);for(let h=1;h<l-1;h++)this.set(o,a+h,"\u2502",i),this.set(o+c-1,a+h,"\u2502",i)}roundedBox(n,e,r,s,i){let o=Math.round(n),a=Math.round(e),c=Math.round(r),l=Math.round(s);this.set(o,a,"\u256D",i),this.set(o+c-1,a,"\u256E",i),this.set(o,a+l-1,"\u2570",i),this.set(o+c-1,a+l-1,"\u256F",i);for(let h=1;h<c-1;h++)this.set(o+h,a,"\u2500",i),this.set(o+h,a+l-1,"\u2500",i);for(let h=1;h<l-1;h++)this.set(o,a+h,"\u2502",i),this.set(o+c-1,a+h,"\u2502",i)}diamond(n,e,r,s,i){let o=Math.round(n),a=Math.round(e),c=Math.max(1,Math.floor(Math.round(r)/2)),l=Math.max(1,Math.floor(Math.round(s)/2)),h=o-c,d=a-l,u=c*2+1,f=l*2+1;this.set(h,d,"\u25C6",i),this.set(h+u-1,d,"\u25C6",i),this.set(h,d+f-1,"\u25C6",i),this.set(h+u-1,d+f-1,"\u25C6",i);for(let g=1;g<u-1;g++)this.set(h+g,d,"\u2500",i),this.set(h+g,d+f-1,"\u2500",i);for(let g=1;g<f-1;g++)this.set(h,d+g,"\u2502",i),this.set(h+u-1,d+g,"\u2502",i)}text(n,e,r,s){let i=Math.round(n),o=Math.round(e);for(let a=0;a<r.length;a++)this.set(i+a,o,r[a],s)}toHtml(){let n=[];for(let e of this.buffer){let r="",s;for(let i of e){let o=i.char==="<"?"&lt;":i.char===">"?"&gt;":i.char==="&"?"&amp;":i.char;i.color!==s&&(s&&(r+="</span>"),s=i.color,i.color&&(r+=`<span style="color:${i.color}">`)),r+=o}s&&(r+="</span>"),n.push(r)}return n.join(`
`)}};function Ur(t,n,e,r){let s=e-t,i=r-n;return Math.abs(s)>Math.abs(i)?s>0?"\u2192":"\u2190":i>0?"\u2193":"\u2191"}function Gr(t,n,e,r){let s=n.x*e,i=n.y*e,o=n.width*e,a=n.height*e,c=r.nodeStroke,l=r.text;switch(n.shape){case"state-start":{let f=Math.round(s+o/2),g=Math.round(i+a/2);t.set(f,g,"\u25CF",c);return}case"state-end":{let f=Math.round(s+o/2),g=Math.round(i+a/2);t.set(f,g,"\u25C9",c);return}case"rounded":case"stadium":t.roundedBox(s,i,o,a,c);break;case"diamond":t.diamond(s+o/2,i+a/2,o,a,c);break;case"circle":t.roundedBox(s,i,o,a,c);break;case"hexagon":t.diamond(s+o/2,i+a/2,o,a,c);break;default:t.box(s,i,o,a,c);break}let d=(n.label||n.id).split(`
`),u=i+Math.floor(a/2)-Math.floor(d.length/2);for(let f=0;f<d.length;f++){let g=d[f],m=s+Math.floor(o/2)-Math.floor(g.length/2);t.text(m,u+f,g,l)}}function jr(t,n,e,r){if(!(n.points.length<2)){for(let s=0;s<n.points.length-1;s++){let i=n.points[s],o=n.points[s+1];t.line(i.x*e,i.y*e,o.x*e,o.y*e,n.style==="dotted"?"\xB7":void 0,r.line)}if(n.hasArrowEnd&&n.points.length>=2){let s=n.points[n.points.length-1],i=n.points[n.points.length-2];t.set(s.x*e,s.y*e,Ur(i.x*e,i.y*e,s.x*e,s.y*e),r.arrow)}n.label&&n.labelPosition&&t.text(n.labelPosition.x*e,n.labelPosition.y*e,n.label,r.muted)}}function ce(t,n,e,r){t.roundedBox(n.x*e,n.y*e,n.width*e,n.height*e,r.groupStroke),n.label&&t.text(n.x*e+2,n.y*e,n.label,r.groupText);for(let s of n.children)ce(t,s,e,r)}function le(t,n={}){let e=K(t);if(!e.ast){let d=e.diagnostics.map(u=>u.message).join(`
`);throw new Error(`Parse error:
${d}`)}let r=V(e.ast),s=n.width??80,i=Math.min(.15,s/r.width),o=Math.ceil(r.width*i),a=Math.ceil(r.height*i),c=new St(o,a),l=n.theme??B,h=Z(l);for(let d of r.groups)ce(c,d,i,h);for(let d of r.edges)jr(c,d,i,h);for(let d of r.nodes)Gr(c,d,i,h);return c.toHtml()}return pe(qr);})();
