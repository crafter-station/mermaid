"use strict";var crafterMermaid=(()=>{var q=Object.defineProperty;var Et=Object.getOwnPropertyDescriptor;var _t=Object.getOwnPropertyNames;var Lt=Object.prototype.hasOwnProperty;var Ct=(t,e)=>{for(var n in e)q(t,n,{get:e[n],enumerable:!0})},It=(t,e,n,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of _t(e))!Lt.call(t,i)&&i!==n&&q(t,i,{get:()=>e[i],enumerable:!(s=Et(e,i))||s.enumerable});return t};var Nt=t=>It(q({},"__esModule",{value:!0}),t);var xn={};Ct(xn,{DEFAULTS:()=>X,THEMES:()=>J,getRegistry:()=>Y,layout:()=>O,parse:()=>F,render:()=>Mt,renderToString:()=>U,resetRegistry:()=>nt,use:()=>et});var Pt=[[/^\s*sequenceDiagram\s*$/i,"sequence"],[/^\s*classDiagram\s*$/i,"class"],[/^\s*erDiagram\s*$/i,"er"],[/^\s*stateDiagram-v2\s*$/i,"state"],[/^\s*(?:graph|flowchart)\s+(?:TD|TB|LR|BT|RL)\s*$/i,"flowchart"],[/^\s*pie\s+(?:title\s+.+)?$/i,"pie"],[/^\s*gantt\s*$/i,"gantt"],[/^\s*mindmap\s*$/i,"mindmap"]];function ht(t){let e=t.split(/[\n;]/);for(let n of e){let s=n.trim();if(!(!s||s.startsWith("%%"))){for(let[i,o]of Pt)if(i.test(s))return o;break}}return null}function v(t,e,n){return{severity:"error",message:t,span:e,suggestions:n}}function C(t,e,n){return{severity:"warning",message:t,span:e,suggestions:n}}function L(t,e,n,s){return{start:{line:t,column:e,offset:n},end:{line:t,column:e+s,offset:n+s}}}function N(t,e){let n=t.split(/[\n;]/),s=0;for(let o=0;o<e&&o<n.length;o++)s+=(n[o]?.length??0)+1;let i=n[e]?.length??0;return L(e+1,1,s,i)}var ut=[[/<\|--/,"inheritance"],[/\*--/,"composition"],[/o--/,"aggregation"],[/-->/,"association"],[/\.\.>/,"dependency"],[/\.\.\|>/,"realization"]];function Dt(t){let e={classes:new Map,relations:[],namespaces:[],diagnostics:[],currentClass:null,currentNamespace:null},n=t.split(`
`);for(let i=0;i<n.length;i++){let r=n[i].trim();if(!r||r.startsWith("%%")||i===0&&/^classDiagram\s*$/i.test(r))continue;let a=N(t,i);if(r.startsWith("class "))Tt(r,a,e);else if(r==="{")e.currentClass||e.diagnostics.push(v("Unexpected '{' outside class definition",a));else if(r==="}")e.currentClass=null;else if(e.currentClass)Rt(r,a,e);else if(r.startsWith("namespace"))Ht(r,a,e);else if(ut.some(([c])=>c.test(r)))zt(r,a,e);else{let c=r.indexOf(":");if(c>0){let l=r.slice(0,c).trim(),u=r.slice(c+1).trim();j(l,a,e);let d=e.classes.get(l),h=ft(u,a);h&&d.members.push(h)}else e.diagnostics.push(C(`Skipping unrecognized line: ${r}`,a))}}return{ast:{type:"class",classes:e.classes,relations:e.relations,namespaces:e.namespaces,span:L(1,1,0,t.length)},diagnostics:e.diagnostics}}function Tt(t,e,n){let s=t.match(/^class\s+(\w+)(?:\s+<<([^>]+)>>)?(?:\s+as\s+(.+?))?(?:\s*\{)?$/);if(!s){n.diagnostics.push(v("Invalid class definition syntax",e));return}let[,i,o,r]=s,a={id:i,label:r,annotation:o,members:[],span:e};n.classes.set(i,a),n.currentNamespace&&n.currentNamespace.classIds.push(i),t.includes("{")&&(n.currentClass=a)}function Rt(t,e,n){let s=ft(t,e);s&&n.currentClass&&n.currentClass.members.push(s)}function ft(t,e){let n=t.match(/^([+\-#~])?(.+)$/);if(!n)return null;let[,s,i]=n,o=s||"",r=i.trim(),a=r.includes("$"),c=r.includes("*");r=r.replace(/[$*]/g,"").trim();let l=r.match(/^(\w+)\(([^)]*)\)(?:\s*:\s*(.+))?$/);if(l){let[,h,,g]=l;return{name:h,visibility:o,isStatic:a,isAbstract:c,returnType:g,isMethod:!0,span:e}}let u=r.match(/^(\w+)\s+(\w+)$/);if(u){let[,h,g]=u;return{name:g,type:h,visibility:o,isStatic:a,isAbstract:c,isMethod:!1,span:e}}let d=r.match(/^(\w+)(?:\s*:\s*(.+))?$/);if(d){let[,h,g]=d;return{name:h,type:g,visibility:o,isStatic:a,isAbstract:c,isMethod:!1,span:e}}return null}function zt(t,e,n){for(let[s,i]of ut)if(s.test(t)){let o=t.split(s);if(o.length!==2){n.diagnostics.push(v("Invalid relation syntax",e));return}let r=o[0].trim(),a=o[1].trim(),c,l,u,d=r.match(/^"([^"]+)"\s+(\w+)$/);d&&(l=d[1],r=d[2]);let h=a.match(/^(\w+)\s+"([^"]+)"$/);h&&(a=h[1],u=h[2]);let g=a.match(/^(\w+)\s*:\s*(.+)$/);g&&(a=g[1],c=g[2]),j(r,e,n),j(a,e,n),n.relations.push({from:r,to:a,type:i,label:c,fromCardinality:l,toCardinality:u,span:e});return}}function Ht(t,e,n){let s=t.match(/^namespace\s+(\w+)(?:\s+as\s+(.+?))?(?:\s*\{)?$/);if(!s){n.diagnostics.push(v("Invalid namespace syntax",e));return}let[,i,o]=s,r={id:i,label:o||i,classIds:[],span:e};n.namespaces.push(r),t.includes("{")&&(n.currentNamespace=r)}function j(t,e,n){n.classes.has(t)||n.classes.set(t,{id:t,members:[],span:e})}var rt={"||":"one","o|":"zero-one","}|":"many","|{":"many","o{":"zero-many","{o":"zero-many"};function Wt(t){let e={entities:new Map,relations:[],diagnostics:[],currentEntity:null},n=t.split(`
`);for(let i=0;i<n.length;i++){let r=n[i].trim();if(!r||r.startsWith("%%")||i===0&&/^erDiagram\s*$/i.test(r))continue;let a=N(t,i);/^(\w+)\s*\{/.test(r)?Bt(r,a,e):r==="}"?e.currentEntity=null:e.currentEntity?Xt(r,a,e):/\|\||o\||}\||o\{|\|{|{o/.test(r)&&(r.includes("--")||r.includes(".."))?Yt(r,a,e):e.diagnostics.push(C(`Skipping unrecognized line: ${r}`,a))}return{ast:{type:"er",entities:e.entities,relations:e.relations,span:L(1,1,0,t.length)},diagnostics:e.diagnostics}}function Bt(t,e,n){let s=t.match(/^(\w+)\s*\{/);if(!s){n.diagnostics.push(v("Invalid entity definition syntax",e));return}let i=s[1],o={id:i,attributes:[],span:e};n.entities.set(i,o),n.currentEntity=o}function Xt(t,e,n){if(!n.currentEntity)return;let s=t.match(/^(\w+)\s+(\w+)(?:\s+(PK|FK|UK|PK,FK|FK,PK))?(?:\s+"([^"]+)")?$/);if(!s){n.diagnostics.push(v("Invalid attribute syntax",e,['Expected: type name [PK|FK|UK] ["comment"]']));return}let[,i,o,r,a]=s,c=r?r.split(","):[];n.currentEntity.attributes.push({name:o,type:i,keys:c,comment:a,span:e})}function Yt(t,e,n){let s=/^(\w+)\s+((?:\|\||o\||\}\||o\{|\|\{|\{o))(--|\.\.)(\|\||o\||\}\||o\{|\|\{|\{o)\s+(\w+)\s*:\s*(.+)$/,i=t.match(s);if(!i){n.diagnostics.push(v("Invalid relation syntax",e,["Expected: Entity1 ||--|| Entity2 : label"]));return}let[,o,r,a,c,l,u]=i,d=rt[r],h=rt[c],g=a==="--";if(!d||!h){n.diagnostics.push(v("Invalid cardinality syntax",e,["Expected: ||, o|, }|, |{, o{, or {o"]));return}it(o,e,n),it(l,e,n),n.relations.push({from:o,to:l,fromCardinality:d,toCardinality:h,label:u,identifying:g,span:e})}function it(t,e,n){n.entities.has(t)||n.entities.set(t,{id:t,attributes:[],span:e})}var Ft=[{regex:/^([\w-]+)\(\(\((.+?)\)\)\)/,shape:"doublecircle"},{regex:/^([\w-]+)\(\[(.+?)\]\)/,shape:"stadium"},{regex:/^([\w-]+)\(\((.+?)\)\)/,shape:"circle"},{regex:/^([\w-]+)\[\[(.+?)\]\]/,shape:"subroutine"},{regex:/^([\w-]+)\[\((.+?)\)\]/,shape:"cylinder"},{regex:/^([\w-]+)\[\/(.+?)\\\]/,shape:"trapezoid"},{regex:/^([\w-]+)\[\\(.+?)\/\]/,shape:"trapezoid-alt"},{regex:/^([\w-]+)>(.+?)\]/,shape:"asymmetric"},{regex:/^([\w-]+)\{\{(.+?)\}\}/,shape:"hexagon"},{regex:/^([\w-]+)\[(.+?)\]/,shape:"rectangle"},{regex:/^([\w-]+)\((.+?)\)/,shape:"rounded"},{regex:/^([\w-]+)\{(.+?)\}/,shape:"diamond"}],Ot=/^([\w-]+)/,Ut=/^:::([\w][\w-]*)/,qt=/^(<)?(-->|-.->|==>|---|-\.-|===)(?:\|([^|]*)\|)?/;function ot(t,e=!1){let n=t.split(/[\n;]/).map(o=>o.trim()).filter(o=>o.length>0&&!o.startsWith("%%"));if(n.length===0)return{ast:null,diagnostics:[v("Empty diagram",L(1,1,0,0))]};let s={nodes:new Map,edges:[],subgraphs:[],classDefs:new Map,classAssignments:new Map,nodeStyles:new Map,diagnostics:[],direction:"TD",subgraphStack:[],startCount:0,endCount:0},i=n[0];if(e)jt(n,s,t);else{let o=i.match(/^(?:graph|flowchart)\s+(TD|TB|LR|BT|RL)\s*$/i);o?s.direction=o[1].toUpperCase():s.diagnostics.push(C(`Invalid header: "${i}". Expected "graph TD", "flowchart LR", etc.`,N(t,0))),Gt(n,s,t)}if(s.subgraphStack.length>0)for(s.diagnostics.push(C(`Unclosed subgraph: ${s.subgraphStack[s.subgraphStack.length-1].id}`,L(1,1,0,0)));s.subgraphStack.length>0;){let o=s.subgraphStack.pop();s.subgraphStack.length>0?s.subgraphStack[s.subgraphStack.length-1].children.push(o):s.subgraphs.push(o)}return{ast:{type:"flowchart",direction:s.direction,nodes:s.nodes,edges:s.edges,subgraphs:s.subgraphs,classDefs:s.classDefs,classAssignments:s.classAssignments,nodeStyles:s.nodeStyles,span:L(1,1,0,t.length)},diagnostics:s.diagnostics}}function Gt(t,e,n){for(let s=1;s<t.length;s++){let i=t[s],o=N(n,s),r=i.match(/^classDef\s+(\w+)\s+(.+)$/);if(r){e.classDefs.set(r[1],dt(r[2]));continue}let a=i.match(/^class\s+([\w,-]+)\s+(\w+)$/);if(a){for(let d of a[1].split(",").map(h=>h.trim()))e.classAssignments.set(d,a[2]);continue}let c=i.match(/^style\s+([\w,-]+)\s+(.+)$/);if(c){let d=dt(c[2]);for(let h of c[1].split(",").map(g=>g.trim()))e.nodeStyles.set(h,{...e.nodeStyles.get(h),...d});continue}let l=i.match(/^direction\s+(TD|TB|LR|BT|RL)\s*$/i);if(l&&e.subgraphStack.length>0){e.subgraphStack[e.subgraphStack.length-1].direction=l[1].toUpperCase();continue}let u=i.match(/^subgraph\s+(.+)$/);if(u){let d=u[1].trim(),h=d.match(/^([\w-]+)\s*\[(.+)\]$/),g,p;h?(g=h[1],p=h[2]):(p=d,g=d.replace(/\s+/g,"_").replace(/[^\w]/g,""));let m={id:g,label:p,nodeIds:[],children:[],span:o};e.subgraphStack.push(m);continue}if(i==="end"){let d=e.subgraphStack.pop();d&&(e.subgraphStack.length>0?e.subgraphStack[e.subgraphStack.length-1].children.push(d):e.subgraphs.push(d));continue}Qt(i,o,e)}}function jt(t,e,n){for(let s=1;s<t.length;s++){let i=t[s],o=N(n,s),r=i.match(/^direction\s+(TD|TB|LR|BT|RL)\s*$/i);if(r){e.subgraphStack.length>0?e.subgraphStack[e.subgraphStack.length-1].direction=r[1].toUpperCase():e.direction=r[1].toUpperCase();continue}let a=i.match(/^state\s+(?:"([^"]+)"\s+as\s+)?(\w+)\s*\{$/);if(a){let d=a[1]??a[2],g={id:a[2],label:d,nodeIds:[],children:[],span:o};e.subgraphStack.push(g);continue}if(i==="}"){let d=e.subgraphStack.pop();d&&(e.subgraphStack.length>0?e.subgraphStack[e.subgraphStack.length-1].children.push(d):e.subgraphs.push(d));continue}let c=i.match(/^state\s+"([^"]+)"\s+as\s+(\w+)\s*$/);if(c){R(e,{id:c[2],label:c[1],shape:"rounded",span:o});continue}let l=i.match(/^(\[\*\]|[\w-]+)\s*(-->)\s*(\[\*\]|[\w-]+)(?:\s*:\s*(.+))?$/);if(l){let d=l[1],h=l[3],g=l[4]?.trim()||void 0;d==="[*]"?(e.startCount++,d=`_start${e.startCount>1?e.startCount:""}`,R(e,{id:d,label:"",shape:"state-start",span:o})):lt(e,d,o),h==="[*]"?(e.endCount++,h=`_end${e.endCount>1?e.endCount:""}`,R(e,{id:h,label:"",shape:"state-end",span:o})):lt(e,h,o),e.edges.push({source:d,target:h,label:g,style:"solid",hasArrowStart:!1,hasArrowEnd:!0,span:o});continue}let u=i.match(/^([\w-]+)\s*:\s*(.+)$/);if(u){R(e,{id:u[1],label:u[2].trim(),shape:"rounded",span:o});continue}}}function Qt(t,e,n){let s=t.trim(),i=at(s,e,n);if(!i||i.ids.length===0){s.length>0&&n.diagnostics.push(C(`Skipping unrecognized line: ${t}`,e));return}s=i.remaining.trim();let o=i.ids,r=!1;for(;s.length>0;){let a=s.match(qt);if(!a)break;let c=!!a[1],l=a[2],u=a[3]?.trim()||void 0;s=s.slice(a[0].length).trim();let d=Vt(l),h=l.endsWith(">"),g=at(s,e,n);if(!g||g.ids.length===0)break;s=g.remaining.trim();for(let p of o)for(let m of g.ids)n.edges.push({source:p,target:m,label:u,style:d,hasArrowStart:c,hasArrowEnd:h,span:e});r=!0,o=g.ids}(s.length>0||!r&&i.remaining.trim().length>0)&&n.diagnostics.push(C(`Skipping unrecognized line: ${t}`,e))}function at(t,e,n){let s=ct(t,e,n);if(!s)return null;let i=[s.id],o=s.remaining.trim();for(;o.startsWith("&");){o=o.slice(1).trim();let r=ct(o,e,n);if(!r)break;i.push(r.id),o=r.remaining.trim()}return{ids:i,remaining:o}}function ct(t,e,n){let s=null,i=t;for(let{regex:r,shape:a}of Ft){let c=t.match(r);if(c){s=c[1];let l=c[2];R(n,{id:s,label:l,shape:a,span:e}),i=t.slice(c[0].length);break}}if(s===null){let r=t.match(Ot);r&&(s=r[1],n.nodes.has(s)?Q(n,s):R(n,{id:s,label:s,shape:"rectangle",span:e}),i=t.slice(r[0].length))}if(s===null)return null;let o=i.match(Ut);return o&&(n.classAssignments.set(s,o[1]),i=i.slice(o[0].length)),{id:s,remaining:i}}function R(t,e){t.nodes.has(e.id)||t.nodes.set(e.id,e),Q(t,e.id)}function Q(t,e){if(t.subgraphStack.length>0){let n=t.subgraphStack[t.subgraphStack.length-1];n.nodeIds.includes(e)||n.nodeIds.push(e)}}function lt(t,e,n){t.nodes.has(e)?Q(t,e):R(t,{id:e,label:e,shape:"rounded",span:n})}function Vt(t){return t==="-.->"||t==="-.-"?"dotted":t==="==>"||t==="==="?"thick":"solid"}function dt(t){let e={};for(let n of t.split(",")){let s=n.indexOf(":");if(s>0){let i=n.slice(0,s).trim(),o=n.slice(s+1).trim();i&&o&&(e[i]=o)}}return e}function Kt(t){let e={sections:new Map,currentSection:"",diagnostics:[]},n=t.split(`
`);for(let o=0;o<n.length;o++){let a=n[o].trim();if(!a||a.startsWith("%%")||o===0&&/^gantt\s*$/i.test(a))continue;let c=N(t,o);if(/^title\s+(.+)$/i.test(a)){let l=a.match(/^title\s+(.+)$/i);l&&(e.title=l[1].trim());continue}if(/^dateFormat\s+(.+)$/i.test(a)){let l=a.match(/^dateFormat\s+(.+)$/i);l&&(e.dateFormat=l[1].trim());continue}if(/^section\s+(.+)$/i.test(a)){let l=a.match(/^section\s+(.+)$/i);l&&(e.currentSection=l[1].trim(),e.sections.has(e.currentSection)||e.sections.set(e.currentSection,[]));continue}e.currentSection?Zt(a,c,e):e.diagnostics.push(C(`Task defined before any section: ${a}`,c))}let s=Array.from(e.sections.entries()).map(([o,r])=>({name:o,tasks:r}));return{ast:{type:"gantt",title:e.title,dateFormat:e.dateFormat,sections:s,span:L(1,1,0,t.length)},diagnostics:e.diagnostics}}function Zt(t,e,n){let s=/^(?:(done|active|crit|milestone)\s+)?([^:]+)\s*:\s*(?:(\w+),\s*)?(.+)$/,i=t.match(s);if(!i){n.diagnostics.push(v("Invalid task syntax",e,["Expected: [status] label : [id,] timing"]));return}let[,o,r,a,c]=i,l=o,u={label:r.trim(),status:l,id:a,section:n.currentSection,span:e},d=c.match(/^after\s+(\w+)(?:,\s*(.+))?$/);if(d)u.afterId=d[1],d[2]&&(u.duration=d[2].trim());else{let g=c.split(",").map(p=>p.trim());if(g.length===2){let[p,m]=g;u.startDate=p,/^\d+d$/.test(m)?u.duration=m:u.endDate=m}else g.length===1&&(u.startDate=g[0])}let h=n.sections.get(n.currentSection);h&&h.push(u)}function Jt(t){let e={root:null,nodeStack:[],diagnostics:[],nodeIdCounter:0},n=t.split(`
`);for(let i=0;i<n.length;i++){let o=n[i],r=o.trim();if(!r||r.startsWith("%%")||i===0&&/^mindmap\s*$/i.test(r))continue;let a=N(t,i),c=ee(o),l=te(r,a,e);l&&(e.root===null?(e.root=l,e.nodeStack=[{node:l,indent:c}]):ne(l,c,e))}return e.root?{ast:{type:"mindmap",root:e.root,span:L(1,1,0,t.length)},diagnostics:e.diagnostics}:(e.diagnostics.push(v("Mindmap must have at least one root node",L(1,1,0,0))),{ast:null,diagnostics:e.diagnostics})}function te(t,e,n){let s={"((":"circle","(":"rounded","))":"bang",")":"cloud","{{":"hexagon"},i=t,o="default";for(let[r,a]of Object.entries(s)){let c=r.split("").reverse().join(""),l=new RegExp(`^\\${r.split("").join("\\")}(.+?)\\${c.split("").join("\\")}$`),u=t.match(l);if(u){i=u[1],o=a;break}}return i?{id:`node-${n.nodeIdCounter++}`,label:i,shape:o,children:[],span:e}:(n.diagnostics.push(C(`Empty node label: ${t}`,e)),null)}function ee(t){let e=0;for(let n of t)if(n===" ")e++;else if(n==="	")e+=2;else break;return e}function ne(t,e,n){for(;n.nodeStack.length>0&&n.nodeStack[n.nodeStack.length-1].indent>=e;)n.nodeStack.pop();if(n.nodeStack.length===0){n.diagnostics.push(C(`Node at same or lower indent than root: ${t.label}`,t.span));return}n.nodeStack[n.nodeStack.length-1].node.children.push(t),n.nodeStack.push({node:t,indent:e})}function se(t){let e={slices:[],showData:!1,diagnostics:[]},n=t.split(`
`);for(let i=0;i<n.length;i++){let r=n[i].trim();if(!r||r.startsWith("%%")||i===0&&/^pie\s*$/i.test(r))continue;let a=N(t,i);if(/^pie\s+showData\s*$/i.test(r)){e.showData=!0;continue}if(/^title\s+(.+)$/i.test(r)){let l=r.match(/^title\s+(.+)$/i);l&&(e.title=l[1].trim());continue}let c=r.match(/^"([^"]+)"\s*:\s*(\d+(?:\.\d+)?)$/);if(c){let[,l,u]=c,d=Number.parseFloat(u);if(Number.isNaN(d)||d<0){e.diagnostics.push(v("Slice value must be a non-negative number",a));continue}e.slices.push({label:l,value:d,span:a});continue}e.diagnostics.push(C(`Skipping unrecognized line: ${r}`,a))}return{ast:{type:"pie",title:e.title,showData:e.showData,slices:e.slices,span:L(1,1,0,t.length)},diagnostics:e.diagnostics}}var re=[{pattern:/-->>/,type:"dashed"},{pattern:/->>/,type:"solid"},{pattern:/-\)/,type:"open"},{pattern:/-x/,type:"cross"}];function ie(t){let e={participants:new Map,messages:[],diagnostics:[],blockStack:[]},n=t.split(`
`);for(let i=0;i<n.length;i++){let r=n[i].trim();if(!r||r.startsWith("%%")||i===0&&/^sequenceDiagram\s*$/i.test(r))continue;let a=N(t,i);r.startsWith("participant")||r.startsWith("actor")?oe(r,a,e):r.startsWith("Note")?ce(r,a,e):r.startsWith("loop")||r.startsWith("alt")||r.startsWith("opt")||r.startsWith("par")||r.startsWith("critical")||r.startsWith("break")||r.startsWith("rect")?le(r,a,e):r==="end"?he(a,e):r.startsWith("else")||r.startsWith("and")?de(r,a,e):r.includes("-->>")||r.includes("->>")||r.includes("-x")||r.includes("-)")?ae(r,a,e):r.startsWith("activate")||r.startsWith("deactivate")?ue(r,a,e):e.diagnostics.push(C(`Skipping unrecognized line: ${r}`,a))}return e.blockStack.length>0&&e.diagnostics.push(C(`Unclosed block: ${e.blockStack[e.blockStack.length-1].block.type}`,L(1,1,0,0))),{ast:{type:"sequence",participants:Array.from(e.participants.values()),messages:e.messages,span:L(1,1,0,t.length)},diagnostics:e.diagnostics}}function oe(t,e,n){let s=t.match(/^(participant|actor)\s+(\w+)(?:\s+as\s+(.+))?$/);if(!s){n.diagnostics.push(v("Invalid participant syntax",e,["Expected: participant id as label"]));return}let[,i,o,r]=s,a={id:o,label:r||o,type:i,span:e};n.participants.set(o,a)}function ae(t,e,n){for(let{pattern:s,type:i}of re)if(s.test(t)){let o=t.split(s);if(o.length!==2){n.diagnostics.push(v("Invalid message syntax",e,["Expected: participant1 ->> participant2: message"]));return}let r=o[0].trim(),a=o[1].trim(),c,l,u=!1,d=!1;if(a.includes(":")){let[g,...p]=a.split(":");c=g.trim(),l=p.join(":").trim()}else c=a,l="";r.endsWith("+")&&(r=r.slice(0,-1).trim(),u=!0),r.endsWith("-")&&(r=r.slice(0,-1).trim(),d=!0),H(r,e,n),H(c,e,n);let h={from:r,to:c,label:l,arrowType:i,activate:u||void 0,deactivate:d||void 0,span:e};n.blockStack.length>0?n.blockStack[n.blockStack.length-1].currentSection.messages.push(h):n.messages.push(h);return}n.diagnostics.push(v("Invalid message arrow",e,["Expected one of: ->>, -->>, -), -x"]))}function ce(t,e,n){let s=t.match(/^Note\s+left\s+of\s+(\w+):\s*(.+)$/);if(s){let[,r,a]=s;H(r,e,n),G({placement:"left",participants:[r],text:a,span:e},n);return}let i=t.match(/^Note\s+right\s+of\s+(\w+):\s*(.+)$/);if(i){let[,r,a]=i;H(r,e,n),G({placement:"right",participants:[r],text:a,span:e},n);return}let o=t.match(/^Note\s+over\s+([\w,\s]+):\s*(.+)$/);if(o){let[,r,a]=o,c=r.split(",").map(u=>u.trim());for(let u of c)H(u,e,n);G({placement:"over",participants:c,text:a,span:e},n);return}n.diagnostics.push(v("Invalid note syntax",e))}function le(t,e,n){let s=t.match(/^(loop|alt|opt|par|critical|break|rect)(?:\s+(.+))?$/);if(!s){n.diagnostics.push(v("Invalid block syntax",e));return}let[,i,o]=s,r={type:i,label:o||"",sections:[],span:e},a={label:void 0,messages:[]};r.sections.push(a),n.blockStack.push({block:r,currentSection:a})}function de(t,e,n){if(n.blockStack.length===0){n.diagnostics.push(v("Unexpected block section outside block",e));return}let s=t.match(/^(else|and)(?:\s+(.+))?$/);if(!s){n.diagnostics.push(v("Invalid block section syntax",e));return}let[,,i]=s,o={label:i,messages:[]},r=n.blockStack[n.blockStack.length-1];r.block.sections.push(o),r.currentSection=o}function he(t,e){if(e.blockStack.length===0){e.diagnostics.push(v("Unexpected 'end' without block",t));return}let{block:n}=e.blockStack.pop();e.blockStack.length>0?e.blockStack[e.blockStack.length-1].currentSection.messages.push(n):e.messages.push(n)}function ue(t,e,n){let s=t.match(/^(activate|deactivate)\s+(\w+)$/);if(!s){n.diagnostics.push(v("Invalid activation syntax",e));return}let[,i,o]=s;H(o,e,n),n.diagnostics.push(C(`Standalone ${i} not fully supported, use +/- on messages`,e))}function H(t,e,n){n.participants.has(t)||n.participants.set(t,{id:t,label:t,type:"participant",span:e})}function G(t,e){e.blockStack.length>0?e.blockStack[e.blockStack.length-1].currentSection.messages.push(t):e.messages.push(t)}function F(t){let e=ht(t);if(!e)return{ast:null,diagnostics:[v("Unable to detect diagram type",L(1,1,0,0),["Expected first line to be one of: graph/flowchart, sequenceDiagram, classDiagram, erDiagram, stateDiagram-v2"])]};switch(e){case"flowchart":return ot(t,!1);case"state":return ot(t,!0);case"sequence":return ie(t);case"class":return Dt(t);case"er":return Wt(t);case"pie":return se(t);case"gantt":return Kt(t);case"mindmap":return Jt(t)}}var V={normal:.52,medium:.55,bold:.58};function fe(t,e,n=400){let s=n>=600?V.bold:n>=500?V.medium:V.normal;return t.length*e*s}function K(t,e,n=14){let s=t.split(`
`),i=Math.max(...s.map(c=>fe(c,n))),o=s.length*n*1.2,r,a;switch(e){case"diamond":case"rhombus":{r=i*1.6+32,a=o*1.6+24;break}case"circle":case"doublecircle":{let c=Math.max(i,o)+32;r=c,a=c;break}case"stadium":case"pill":{r=i+o+16,a=o+16;break}case"hexagon":{r=i+48,a=o+24;break}case"trapezoid":case"inv-trapezoid":{r=i+56,a=o+24;break}case"odd":case"lean-right":case"lean-left":{r=i+40,a=o+24;break}default:{r=i+24,a=o+16;break}}return{width:r,height:a}}var ge=class{nodes=new Map;edges=new Map;inEdges=new Map;outEdges=new Map;children=new Map;addNode(t,e,n=0,s=0){this.nodes.set(t,{id:t,data:e,width:n,height:s}),this.inEdges.has(t)||this.inEdges.set(t,new Set),this.outEdges.has(t)||this.outEdges.set(t,new Set)}removeNode(t){let e=this.inEdges.get(t);if(e)for(let i of e)this.removeEdge(i,t);let n=this.outEdges.get(t);if(n)for(let i of n)this.removeEdge(t,i);this.nodes.delete(t),this.inEdges.delete(t),this.outEdges.delete(t);let s=this.nodes.get(t)?.parent;s&&this.children.get(s)?.delete(t)}addEdge(t,e,n,s=1){let i=`${t}->${e}`;this.edges.set(i,{source:t,target:e,data:n,weight:s}),this.outEdges.has(t)||this.outEdges.set(t,new Set),this.inEdges.has(e)||this.inEdges.set(e,new Set),this.outEdges.get(t).add(e),this.inEdges.get(e).add(t)}removeEdge(t,e){let n=`${t}->${e}`;this.edges.delete(n),this.outEdges.get(t)?.delete(e),this.inEdges.get(e)?.delete(t)}setParent(t,e){let n=this.nodes.get(t);n&&(n.parent=e,this.children.has(e)||this.children.set(e,new Set),this.children.get(e).add(t))}getNode(t){return this.nodes.get(t)}getEdge(t,e){return this.edges.get(`${t}->${e}`)}predecessors(t){return Array.from(this.inEdges.get(t)||[])}successors(t){return Array.from(this.outEdges.get(t)||[])}sources(){let t=[];for(let e of this.nodes.keys())(this.inEdges.get(e)?.size||0)===0&&t.push(e);return t}sinks(){let t=[];for(let e of this.nodes.keys())(this.outEdges.get(e)?.size||0)===0&&t.push(e);return t}nodeIds(){return Array.from(this.nodes.keys())}getEdges(){return Array.from(this.edges.values())}getChildren(t){return Array.from(this.children.get(t)||[])}reverseEdge(t,e){let n=this.getEdge(t,e);n&&(this.removeEdge(t,e),this.addEdge(e,t,n.data,n.weight))}hasEdge(t,e){return this.edges.has(`${t}->${e}`)}nodeCount(){return this.nodes.size}edgeCount(){return this.edges.size}};function pe(t){let e=new Set,n=new Set,s=[];function i(r){e.add(r),n.add(r);let a=t.successors(r);for(let c of a)e.has(c)?n.has(c)&&(t.reverseEdge(r,c),s.push({source:r,target:c})):i(c);n.delete(r)}let o=t.sources();if(o.length===0){let r=t.nodeIds();r.length>0&&i(r[0])}else for(let r of o)e.has(r)||i(r);for(let r of t.nodeIds())e.has(r)||i(r);return s}function me(t,e){for(let n of e)t.reverseEdge(n.target,n.source)}function be(t){let e=new Map,n=[],s=[];for(let i of t.nodeIds()){let o=t.predecessors(i).length;e.set(i,o),o===0&&n.push(i)}for(;n.length>0;){n.sort();let i=n.shift();s.push(i);for(let o of t.successors(i)){let r=e.get(o)-1;e.set(o,r),r===0&&n.push(o)}}return s}function ye(t){let e=new Map,n=be(t);for(let i of n){let o=t.predecessors(i);if(o.length===0)e.set(i,0);else{let r=Math.max(...o.map(a=>e.get(a)??0));e.set(i,r+1)}}let s=Math.max(...Array.from(e.values()));return{layers:e,maxLayer:s}}function xe(t,e){let n=new Map,s=t.getEdges(),i=0;for(let o of s){let r=e.get(o.source)??0,c=(e.get(o.target)??0)-r;if(c>1){let l=[],u=o.source;for(let d=1;d<c;d++){let h=`__virtual_${i++}`;t.addNode(h,o.data,0,0),e.set(h,r+d),t.addEdge(u,h,o.data,o.weight),l.push(h),u=h}t.addEdge(u,o.target,o.data,o.weight),t.removeEdge(o.source,o.target),n.set(`${o.source}->${o.target}`,l)}}return n}function we(t,e){let n=Array.from({length:e+1},()=>[]);for(let[s,i]of t)n[i].push(s);for(let s of n)s.sort();return n}function gt(t,e){let n=0;for(let s=0;s<e.length-1;s++){let i=e[s],o=e[s+1],r=new Map;for(let a=0;a<o.length;a++)r.set(o[a],a);for(let a=0;a<i.length;a++){let c=i[a],l=t.successors(c);for(let u=a+1;u<i.length;u++){let d=i[u],h=t.successors(d);for(let g of l){let p=r.get(g);if(p!==void 0)for(let m of h){let y=r.get(m);y!==void 0&&p>y&&n++}}}}}return n}function pt(t,e,n,s){let i=new Map;for(let r=0;r<n.length;r++)i.set(n[r],r);let o=e.map(r=>{let c=(s?t.predecessors(r):t.successors(r)).filter(u=>i.has(u));if(c.length===0)return{nodeId:r,weight:0};let l=c.reduce((u,d)=>u+i.get(d),0);return{nodeId:r,weight:l/c.length}});return o.sort((r,a)=>r.weight!==a.weight?r.weight-a.weight:r.nodeId.localeCompare(a.nodeId)),o.map(r=>r.nodeId)}function $e(t,e){let n=e.map(r=>[...r]),s=gt(t,n);if(s===0)return n;let i=24,o=n.map(r=>[...r]);for(let r=0;r<i;r++){if(r%2===0)for(let l=1;l<o.length;l++)o[l]=pt(t,o[l],o[l-1],!0);else for(let l=o.length-2;l>=0;l--)o[l]=pt(t,o[l],o[l+1],!1);let c=gt(t,o);if(c<s&&(s=c,n=o.map(l=>[...l]),s===0))break}return n}function ke(t){return t==="LR"||t==="RL"}function Ae(t,e,n,s){let i=new Map,o=0;for(let r=0;r<e.length;r++){i.set(r,o);let a=Math.max(...e[r].map(c=>{let l=t.getNode(c);return l?s?l.width:l.height:0}));o+=a+n}return i}function Se(t,e,n,s){let i=new Map;for(let o of e){let r=0;for(let l of o){let u=t.getNode(l);if(!u)continue;let d=s?u.height:u.width;i.set(l,r+d/2),r+=d+n}let c=(r-n)/2;for(let l of o)i.set(l,i.get(l)-c)}return i}function ve(t,e,n,s,i){let o=new Map(n),r=24,a=.5;for(let c=0;c<r;c++){let l=new Map;for(let u of e)for(let d of u){let h=[...t.predecessors(d),...t.successors(d)];if(h.length===0){l.set(d,o.get(d));continue}let g=h.reduce((y,x)=>y+(o.get(x)??0),0)/h.length,p=o.get(d),m=p+(g-p)*a;l.set(d,m)}for(let u of e){let d=u.map(h=>({nodeId:h,pos:l.get(h)})).sort((h,g)=>h.pos-g.pos);for(let h=1;h<d.length;h++){let g=t.getNode(d[h-1].nodeId),p=t.getNode(d[h].nodeId);if(!g||!p)continue;let m=i?g.height:g.width,y=i?p.height:p.width,x=d[h-1].pos+m/2+s+y/2;d[h].pos<x&&(d[h].pos=x,l.set(d[h].nodeId,x))}}o.clear();for(let[u,d]of l)o.set(u,d)}return o}function Me(t,e,n,s,i){let o=new Map(n);for(let r=0;r<4;r++){for(let a of e)for(let c of a){let l=t.predecessors(c),u=t.successors(c),d=null;if(l.length===1){let h=l[0];t.successors(h).length===1&&(d=o.get(h))}if(d===null&&u.length===1){let h=u[0];t.predecessors(h).length===1&&(d=o.get(h))}d!==null&&o.set(c,d)}for(let a of e){let c=a.map(l=>({nodeId:l,pos:o.get(l)})).sort((l,u)=>l.pos-u.pos);for(let l=1;l<c.length;l++){let u=t.getNode(c[l-1].nodeId),d=t.getNode(c[l].nodeId);if(!u||!d)continue;let h=i?u.height:u.width,g=i?d.height:d.width,p=c[l-1].pos+h/2+s+g/2;c[l].pos<p&&(c[l].pos=p,o.set(c[l].nodeId,p))}}}return o}function Ee(t,e){let n=Array.from(t.values()),s=Math.min(...n),i=new Map;for(let[o,r]of t)i.set(o,r-s+e);return i}function _e(t,e,n,s,i,o){let r=ke(o),a=Ae(t,e,s,r),c=Se(t,e,n,r),l=ve(t,e,c,n,r),u=Me(t,e,l,n,r),d=Ee(u,i),h=new Map;for(let m=0;m<e.length;m++){let y=a.get(m)+i;for(let x of e[m]){let $=d.get(x);r?h.set(x,{x:y,y:$}):h.set(x,{x:$,y})}}if(o==="BT"||o==="RL"){let m=Math.max(...r?Array.from(h.values()).map(y=>y.x):Array.from(h.values()).map(y=>y.y));for(let[y,x]of h)r?h.set(y,{x:m-x.x+2*i,y:x.y}):h.set(y,{x:x.x,y:m-x.y+2*i})}let g=0,p=0;for(let[m,y]of h){let x=t.getNode(m);if(!x)continue;let $=y.x+x.width/2+i,k=y.y+x.height/2+i;$>g&&(g=$),k>p&&(p=k)}return{positions:h,width:g,height:p}}function Le(t,e,n){let s=new ge;for(let k of t)s.addNode(k.id,{},k.width,k.height);for(let k of e)s.addEdge(k.source,k.target,{},k.weight??1);let i=pe(s),{layers:o,maxLayer:r}=ye(s),a=xe(s,o),c=we(o,r),l=$e(s,c),u=n.direction??"TB",d=n.nodeSpacing??50,h=n.layerSpacing??100,g=n.padding??20,{positions:p,width:m,height:y}=_e(s,l,d,h,g,u);me(s,i);let x=new Map;for(let k of t){let M=p.get(k.id);M&&x.set(k.id,M)}let $=new Map;for(let k of e){let M=p.get(k.source),S=p.get(k.target);if(!M||!S)continue;let f=a.get(`${k.source}->${k.target}`)??[],b=[M];for(let w of f){let A=p.get(w);A&&b.push(A)}b.push(S),$.set(`${k.source}->${k.target}`,b)}return{nodePositions:x,edgeRoutes:$,width:m,height:y}}function Ce(t){return t==="LR"||t==="RL"}function Ie(t,e){if(t.length<2)return t;let n=t[0],s=t[t.length-1],i=Ce(e);if(t.length===2||t.length===3){if(i){if(Math.abs(n.y-s.y)<8)return[n,s];let a=(n.x+s.x)/2;return[n,{x:a,y:n.y},{x:a,y:s.y},s]}if(Math.abs(n.x-s.x)<8)return[n,s];let r=(n.y+s.y)/2;return[n,{x:n.x,y:r},{x:s.x,y:r},s]}let o=[n];for(let r=1;r<t.length-1;r++){let a=o[o.length-1],c=t[r];i?(o.push({x:c.x,y:a.y}),Math.abs(c.y-a.y)>1&&o.push({x:c.x,y:c.y})):(o.push({x:a.x,y:c.y}),Math.abs(c.x-a.x)>1&&o.push({x:c.x,y:c.y}))}return o.push(s),o}function mt(t,e,n){let s=t.x-e.x,i=t.y-e.y,o=e.width/2,r=e.height/2;switch(n){case"circle":case"doublecircle":{let a=Math.max(o,r),c=Math.atan2(i,s);return{x:e.x+a*Math.cos(c),y:e.y+a*Math.sin(c)}}case"diamond":case"rhombus":{let a=Math.atan2(i,s),c=Math.abs(a);if(c<Math.PI/4||c>3*Math.PI/4){let u=o/Math.abs(Math.cos(a)),d=e.x+u*Math.cos(a),h=e.y+u*Math.sin(a);if(Math.abs(h-e.y)<=r)return{x:d,y:h}}let l=r/Math.abs(Math.sin(a));return{x:e.x+l*Math.cos(a),y:e.y+l*Math.sin(a)}}case"hexagon":{let a=Math.atan2(i,s),c=Math.PI/3;if(Math.abs(a)<c||Math.abs(a)>Math.PI-c){let u=o/Math.abs(Math.cos(a));return{x:e.x+u*Math.cos(a),y:e.y+u*Math.sin(a)}}let l=r/Math.abs(Math.sin(a));return{x:e.x+l*Math.cos(a),y:e.y+l*Math.sin(a)}}default:{let a=Math.atan2(i,s);if(Math.abs(Math.cos(a))*r>Math.abs(Math.sin(a))*o){let l=o/Math.abs(Math.cos(a));return{x:e.x+l*Math.cos(a),y:e.y+l*Math.sin(a)}}let c=r/Math.abs(Math.sin(a));return{x:e.x+c*Math.cos(a),y:e.y+c*Math.sin(a)}}}}function Ne(t,e,n,s,i,o){let r=Ie(n,o);if(r.length<2)return r;let a=r.length>2?r[1]:r[r.length-1],c=r.length>2?r[r.length-2]:r[0],l=mt(a,t,s),u=mt(c,e,i),d=r.length>2?r.slice(1,-1):[];return[l,...d,u]}function Z(t){if(t.length===0)return{x:0,y:0};let e=0,n=[];for(let o=0;o<t.length-1;o++){let r=t[o+1].x-t[o].x,a=t[o+1].y-t[o].y,c=Math.sqrt(r*r+a*a);n.push(c),e+=c}let s=e/2,i=0;for(let o=0;o<n.length;o++){if(i+n[o]>=s){let r=(s-i)/n[o];return{x:t[o].x+(t[o+1].x-t[o].x)*r,y:t[o].y+(t[o+1].y-t[o].y)*r}}i+=n[o]}return t[Math.floor(t.length/2)]}function Pe(t,e){let n=e.padding??20,s=e.nodeSpacing??60,i=e.layerSpacing??50,o=t.participants,r=120,a=60,c=[],l=new Map;for(let p=0;p<o.length;p++){let m=o[p],y=n+p*(r+s),x=n;l.set(m.id,y),c.push({id:m.id,label:m.label,shape:m.type,x:y,y:x,width:r,height:a})}let u=[],d=n+a+i;for(let p of t.messages)if("from"in p&&"to"in p){let m=p,y=l.get(m.from)??n,x=l.get(m.to)??n,$=[{x:y+r/2,y:d},{x:x+r/2,y:d}];u.push({source:m.from,target:m.to,label:m.label,style:m.arrowType==="solid"?"solid":"dotted",hasArrowStart:!1,hasArrowEnd:!0,points:$,labelPosition:Z($)}),d+=i}let h=n+o.length*r+(o.length-1)*s+n,g=d+n;for(let p of o){let y=(l.get(p.id)??n)+r/2;u.unshift({source:p.id,target:p.id,style:"dotted",hasArrowStart:!1,hasArrowEnd:!1,points:[{x:y,y:n+a},{x:y,y:g-n}]})}return{width:h,height:g,nodes:c,edges:u,groups:[]}}function De(t,e,n){let s=n.padding??20,i=n.nodeSpacing??80,o=t.map((f,b)=>{let w=K(f.label,f.shape),A=b/t.length*Math.PI*2,E=i*Math.sqrt(t.length);return{id:f.id,label:f.label,shape:f.shape,x:E*Math.cos(A),y:E*Math.sin(A),vx:0,vy:0,width:w.width,height:w.height}}),r=new Map(o.map(f=>[f.id,f])),a=100,c=5e3,l=.01,u=.9;for(let f=0;f<a;f++){for(let b=0;b<o.length;b++)for(let w=b+1;w<o.length;w++){let A=o[b],E=o[w],I=E.x-A.x,_=E.y-A.y,T=Math.max(Math.sqrt(I*I+_*_),1),W=c/(T*T),B=I/T*W,st=_/T*W;A.vx-=B,A.vy-=st,E.vx+=B,E.vy+=st}for(let b of e){let w=r.get(b.source),A=r.get(b.target);if(!w||!A)continue;let E=A.x-w.x,I=A.y-w.y,_=Math.sqrt(E*E+I*I),T=(_-i)*l,W=E/Math.max(_,1)*T,B=I/Math.max(_,1)*T;w.vx+=W,w.vy+=B,A.vx-=W,A.vy-=B}for(let b of o)b.vx*=u,b.vy*=u,b.x+=b.vx,b.y+=b.vy}let d=1/0,h=1/0,g=-1/0,p=-1/0;for(let f of o)d=Math.min(d,f.x-f.width/2),h=Math.min(h,f.y-f.height/2),g=Math.max(g,f.x+f.width/2),p=Math.max(p,f.y+f.height/2);let m=s-d,y=s-h,x=o.map(f=>({id:f.id,label:f.label,shape:f.shape,x:f.x-f.width/2+m,y:f.y-f.height/2+y,width:f.width,height:f.height})),$=new Map(x.map(f=>[f.id,f])),k=e.map(f=>{let b=$.get(f.source),w=$.get(f.target);if(!b||!w)return{source:f.source,target:f.target,label:f.label,style:f.style,hasArrowStart:f.hasArrowStart,hasArrowEnd:f.hasArrowEnd,points:[]};let A=[{x:b.x+b.width/2,y:b.y+b.height/2},{x:w.x+w.width/2,y:w.y+w.height/2}];return{source:f.source,target:f.target,label:f.label,style:f.style,hasArrowStart:f.hasArrowStart,hasArrowEnd:f.hasArrowEnd,points:A,labelPosition:f.label?Z(A):void 0}}),M=g-d+s*2,S=p-h+s*2;return{width:M,height:S,nodes:x,edges:k,groups:[]}}function Te(t,e){let n=e.padding??20,s=120,i=n+s,o=t.title?30:0,r=n+o+s,a=t.slices.reduce((h,g)=>h+g.value,0);if(a===0)return{width:n*2,height:n*2,nodes:[],edges:[],groups:[]};let c=[],l=-Math.PI/2;for(let h=0;h<t.slices.length;h++){let g=t.slices[h],p=g.value/a*Math.PI*2,m=l+p/2,y=s*.65,x=i+y*Math.cos(m),$=r+y*Math.sin(m);c.push({id:`slice-${h}`,label:g.label,shape:"pie-slice",x:x-30,y:$-12,width:60,height:24,inlineStyle:{cx:String(i),cy:String(r),radius:String(s),startAngle:String(l),endAngle:String(l+p),value:String(g.value),percent:String(Math.round(g.value/a*100)),index:String(h)}}),l+=p}t.title&&c.unshift({id:"pie-title",label:t.title,shape:"pie-title",x:i-80,y:n,width:160,height:24});let u=i+s+n,d=r+s+n;return{width:u,height:d,nodes:c,edges:[],groups:[]}}function yt(t,e,n,s,i,o,r,a){let c=Math.max(t.label.length*9+20,60),l=32,u={default:"rounded",rounded:"rounded",circle:"circle",bang:"hexagon",cloud:"cloud",hexagon:"hexagon"};if(r.push({id:t.id,label:t.label,shape:u[t.shape]||"rounded",x:e-c/2,y:n-l/2,width:c,height:l}),t.children.length===0)return;let d=i/Math.max(t.children.length,1),h=s-i/2+d/2,g=120+o*30;for(let p=0;p<t.children.length;p++){let m=t.children[p],y=h+p*d,x=e+g*Math.cos(y),$=n+g*Math.sin(y);a.push({source:t.id,target:m.id,style:"solid",hasArrowStart:!1,hasArrowEnd:!1,points:[{x:e,y:n},{x,y:$}]}),yt(m,x,$,y,d*1.2,o+1,r,a)}}function Re(t,e){let n=e.padding??40,s=[],i=[];yt(t.root,300,300,0,Math.PI*2,0,s,i);let a=1/0,c=1/0,l=-1/0,u=-1/0;for(let m of s)a=Math.min(a,m.x),c=Math.min(c,m.y),l=Math.max(l,m.x+m.width),u=Math.max(u,m.y+m.height);let d=n-a,h=n-c;for(let m of s)m.x+=d,m.y+=h;for(let m of i)for(let y of m.points)y.x+=d,y.y+=h;let g=l-a+n*2,p=u-c+n*2;return{width:g,height:p,nodes:s,edges:i,groups:[]}}function ze(t,e){let n=e.padding??20,s=28,i=6,o=24,r=140,a=8,c=t.title?30:0;if(t.sections.flatMap(M=>M.tasks).length===0)return{width:n*2,height:n*2,nodes:[],edges:[],groups:[]};let u=0,d=100,h=0,g=new Map;for(let M of t.sections)for(let S of M.tasks){let f=h*15,b=30;if(S.afterId&&g.has(S.afterId)&&(f=g.get(S.afterId)),S.duration){let A=S.duration.match(/(\d+)d/);A?.[1]&&(b=parseInt(A[1]))}let w=f+b;S.id&&g.set(S.id,w),d=Math.max(d,w),h++}let p=(d-u)*a,m=[],y=[],x=n+c;h=0,t.title&&m.push({id:"gantt-title",label:t.title,shape:"gantt-title",x:n,y:n,width:r+p,height:24});for(let M of t.sections){let S=x;m.push({id:`section-${M.name}`,label:M.name,shape:"gantt-section",x:n,y:x,width:r+p,height:o}),x+=o+i;for(let b of M.tasks){let w=h*15,A=30;if(b.afterId&&g.has(b.afterId)?w=g.get(b.afterId):b.startDate&&(w=h*15),b.duration){let _=b.duration.match(/(\d+)d/);_?.[1]&&(A=parseInt(_[1]))}let E=n+r+(w-u)*a,I=A*a;m.push({id:b.id||`task-${h}`,label:b.label,shape:"gantt-bar",x:E,y:x,width:I,height:s,inlineStyle:{status:b.status||"default",labelX:String(n),labelWidth:String(r)}}),x+=s+i,h++}let f=x-S;y.push({id:`group-${M.name}`,label:M.name,x:n,y:S,width:r+p,height:f,children:[]})}let $=n+r+p+n,k=x+n;return{width:$,height:k,nodes:m,edges:[],groups:[]}}function He(t){let e=Array.from(t.nodes.values()).map(s=>{let i=t.classAssignments.get(s.id),o=i?t.classDefs.get(i):void 0,r=t.nodeStyles.get(s.id),a={...o,...r};return{id:s.id,label:s.label,shape:s.shape,inlineStyle:Object.keys(a).length>0?a:void 0}}),n=t.edges.map(s=>({source:s.source,target:s.target,label:s.label,style:s.style,hasArrowStart:s.hasArrowStart,hasArrowEnd:s.hasArrowEnd}));return{nodes:e,edges:n}}function We(t){let e=Array.from(t.classes.values()).map(s=>{let i=s.label||s.id;return{id:s.id,label:i,shape:"rectangle"}}),n=t.relations.map(s=>({source:s.from,target:s.to,label:s.label,style:"solid",hasArrowStart:!1,hasArrowEnd:!0}));return{nodes:e,edges:n}}function Be(t){let e=Array.from(t.entities.values()).map(s=>({id:s.id,label:s.id,shape:"rectangle"})),n=t.relations.map(s=>({source:s.from,target:s.to,label:s.label,style:"solid",hasArrowStart:!1,hasArrowEnd:!0}));return{nodes:e,edges:n}}function xt(t){let e=[...t.nodeIds];for(let n of t.children)e.push(...xt(n));return e}function wt(t,e,n){return t.map(s=>{let i=wt(s.children,e,n),r=xt(s).map(g=>e.get(g)).filter(Boolean);if(r.length===0&&i.length===0)return null;let a=1/0,c=1/0,l=-1/0,u=-1/0;for(let g of r)a=Math.min(a,g.x),c=Math.min(c,g.y),l=Math.max(l,g.x+g.width),u=Math.max(u,g.y+g.height);for(let g of i)a=Math.min(a,g.x),c=Math.min(c,g.y),l=Math.max(l,g.x+g.width),u=Math.max(u,g.y+g.height);let d=n,h=20;return{id:s.id,label:s.label,x:a-d,y:c-d-h,width:l-a+d*2,height:u-c+d*2+h,children:i}}).filter(Boolean)}function bt(t,e,n,s,i){let o=n.direction??s??"TB",r=t.map(f=>{let b=K(f.label,f.shape);return{id:f.id,width:b.width,height:b.height}}),a=e.map(f=>({source:f.source,target:f.target,weight:1})),c=Le(r,a,{...n,direction:o}),l=t.map(f=>{let b=c.nodePositions.get(f.id)??{x:0,y:0},w=K(f.label,f.shape);return{id:f.id,label:f.label,shape:f.shape,x:b.x-w.width/2,y:b.y-w.height/2,width:w.width,height:w.height,inlineStyle:f.inlineStyle}}),u=new Map(l.map(f=>[f.id,f])),d=e.map(f=>{let b=u.get(f.source),w=u.get(f.target);if(!b||!w)return{source:f.source,target:f.target,label:f.label,style:f.style,hasArrowStart:f.hasArrowStart,hasArrowEnd:f.hasArrowEnd,points:[]};let A=c.edgeRoutes.get(`${f.source}->${f.target}`)??[{x:b.x+b.width/2,y:b.y+b.height/2},{x:w.x+w.width/2,y:w.y+w.height/2}],E={x:b.x+b.width/2,y:b.y+b.height/2,width:b.width,height:b.height},I={x:w.x+w.width/2,y:w.y+w.height/2,width:w.width,height:w.height},_=Ne(E,I,A,b.shape,w.shape,o);return{source:f.source,target:f.target,label:f.label,style:f.style,hasArrowStart:f.hasArrowStart,hasArrowEnd:f.hasArrowEnd,points:_,labelPosition:f.label?Z(_):void 0}}),h=1/0,g=1/0,p=-1/0,m=-1/0;for(let f of l)h=Math.min(h,f.x),g=Math.min(g,f.y),p=Math.max(p,f.x+f.width),m=Math.max(m,f.y+f.height);for(let f of d)for(let b of f.points)h=Math.min(h,b.x),g=Math.min(g,b.y),p=Math.max(p,b.x),m=Math.max(m,b.y);let y=n.padding??20,x=y-h,$=y-g;for(let f of l)f.x+=x,f.y+=$;for(let f of d){for(let b of f.points)b.x+=x,b.y+=$;f.labelPosition&&(f.labelPosition.x+=x,f.labelPosition.y+=$)}let k=p-h+y*2,M=m-g+y*2,S=i?wt(i,u,12):[];return{width:k,height:M,nodes:l,edges:d,groups:S}}function O(t,e={}){let n={nodeSpacing:40,layerSpacing:60,padding:20,...e};if(t.type==="sequence")return Pe(t,n);if(t.type==="flowchart"){let{nodes:s,edges:i}=He(t);return bt(s,i,n,t.direction,t.subgraphs)}if(t.type==="class"){let{nodes:s,edges:i}=We(t);return bt(s,i,n,"TB")}if(t.type==="er"){let{nodes:s,edges:i}=Be(t);return De(s,i,n)}if(t.type==="pie")return Te(t,n);if(t.type==="gantt")return ze(t,n);if(t.type==="mindmap")return Re(t,n);throw new Error(`Unsupported diagram type: ${t.type}`)}function D(t,e,n){let s=$t(t),i=$t(e),o=n/100,r=Math.round(s.r*o+i.r*(1-o)),a=Math.round(s.g*o+i.g*(1-o)),c=Math.round(s.b*o+i.b*(1-o));return Xe(r,a,c)}function $t(t){let e=t.replace("#",""),n=Number.parseInt(e.slice(0,2),16),s=Number.parseInt(e.slice(2,4),16),i=Number.parseInt(e.slice(4,6),16);return{r:n,g:s,b:i}}function Xe(t,e,n){return`#${[t,e,n].map(s=>s.toString(16).padStart(2,"0")).join("")}`}function kt(t){let e=t.bg,n=t.fg,s=t.accent??D(n,e,50);return{bg:e,fg:n,text:n,line:t.line??D(n,e,30),arrow:s,muted:t.muted??D(n,e,50),nodeFill:t.surface??D(n,e,12),nodeStroke:t.border??D(s,e,65),groupFill:D(n,e,5),groupStroke:D(n,e,15),groupText:D(n,e,60),font:t.font??"ui-sans-serif, system-ui, sans-serif",monoFont:t.monoFont??"ui-monospace, monospace"}}var J={"zinc-dark":{bg:"#18181B",fg:"#FAFAFA"},"zinc-light":{bg:"#FAFAFA",fg:"#18181B"},"tokyo-night":{bg:"#1a1b26",fg:"#a9b1d6",line:"#3d59a1",accent:"#7aa2f7"},"catppuccin-mocha":{bg:"#1e1e2e",fg:"#cdd6f4",accent:"#cba6f7",line:"#585b70"},"catppuccin-latte":{bg:"#eff1f5",fg:"#4c4f69",accent:"#8839ef",line:"#9ca0b0"},nord:{bg:"#2e3440",fg:"#d8dee9",accent:"#88c0d0",line:"#4c566a"},dracula:{bg:"#282a36",fg:"#f8f8f2",accent:"#bd93f9",line:"#6272a4"},"github-light":{bg:"#ffffff",fg:"#1f2328",accent:"#0969da",line:"#d1d9e0"},"github-dark":{bg:"#0d1117",fg:"#e6edf3",accent:"#58a6ff",line:"#30363d"},"one-dark":{bg:"#282c34",fg:"#abb2bf",accent:"#c678dd",line:"#3e4451"},"solarized-dark":{bg:"#002b36",fg:"#839496",accent:"#268bd2",line:"#073642"},"solarized-light":{bg:"#fdf6e3",fg:"#657b83",accent:"#268bd2",line:"#eee8d5"},monokai:{bg:"#272822",fg:"#f8f8f2",accent:"#a6e22e",line:"#49483e"},"gruvbox-dark":{bg:"#282828",fg:"#ebdbb2",accent:"#fabd2f",line:"#504945"},"gruvbox-light":{bg:"#fbf1c7",fg:"#3c3836",accent:"#d79921",line:"#d5c4a1"},"rose-pine":{bg:"#191724",fg:"#e0def4",accent:"#c4a7e7",line:"#26233a"},"rose-pine-dawn":{bg:"#faf4ed",fg:"#575279",accent:"#907aa9",line:"#f2e9e1"},"ayu-dark":{bg:"#0a0e14",fg:"#b3b1ad",accent:"#ffb454",line:"#11151c"},"ayu-light":{bg:"#fafafa",fg:"#575f66",accent:"#ff9940",line:"#f0f0f0"},vesper:{bg:"#101010",fg:"#ffffff",accent:"#ffc799",line:"#232323"},"vitesse-dark":{bg:"#121212",fg:"#dbd7caee",accent:"#4d9375",line:"#282828"},"vitesse-light":{bg:"#ffffff",fg:"#393a34",accent:"#1e754f",line:"#f1f1f1"},kanagawa:{bg:"#1f1f28",fg:"#dcd7ba",accent:"#7e9cd8",line:"#2a2a37"},"everforest-dark":{bg:"#2d353b",fg:"#d3c6aa",accent:"#a7c080",line:"#3d484d"},"everforest-light":{bg:"#fdf6e3",fg:"#5c6a72",accent:"#8da101",line:"#efebd4"},"material-dark":{bg:"#263238",fg:"#eeffff",accent:"#82aaff",line:"#37474f"},"material-light":{bg:"#fafafa",fg:"#546e7a",accent:"#6182b8",line:"#e7e7e8"},poimandres:{bg:"#1b1e28",fg:"#a6accd",accent:"#add7ff",line:"#303340"},"night-owl":{bg:"#011627",fg:"#d6deeb",accent:"#82aaff",line:"#122d42"},"one-hunter":{bg:"#1e2127",fg:"#c0c5cf",accent:"#e06c75",line:"#2c313a",surface:"#282c34",border:"#3e4451"}},X={bg:"#ffffff",fg:"#27272a"};function Ye(t,e){let{points:n,style:s,hasArrowStart:i,hasArrowEnd:o}=t;if(n.length<2)return"";let r=n.map((d,h)=>`${h===0?"M":"L"} ${d.x} ${d.y}`).join(" "),a="",c="1.5";return s==="dotted"?a='stroke-dasharray="6 4"':s==="thick"&&(c="2.5"),`<path d="${r}" stroke="var(--_line)" stroke-width="${c}" fill="none" stroke-linejoin="round" stroke-linecap="round" ${a} ${i?'marker-start="url(#arrowhead-start)"':""} ${o?'marker-end="url(#arrowhead)"':""}/>`}function tt(t){return t.split(/<br\s*\/?>|\n/)}function Fe(t,e){if(t.shape==="pie-slice"){let l=t.x+t.width/2,u=t.y+t.height/2,d=t.inlineStyle?.percent||"";return`<text x="${l}" y="${u}" text-anchor="middle" dominant-baseline="middle" fill="var(--_text)" font-family="${e.font}" font-size="11" font-weight="600">${P(t.label)} ${d}%</text>`}if(t.shape==="pie-title"){let l=t.x+t.width/2,u=t.y+t.height/2;return`<text x="${l}" y="${u}" text-anchor="middle" dominant-baseline="middle" fill="var(--_text)" font-family="${e.font}" font-size="16" font-weight="600">${P(t.label)}</text>`}if(t.shape==="gantt-title"){let l=t.x+t.width/2,u=t.y+t.height/2;return`<text x="${l}" y="${u}" text-anchor="middle" dominant-baseline="middle" fill="var(--_text)" font-family="${e.font}" font-size="16" font-weight="600">${P(t.label)}</text>`}if(t.shape==="gantt-section"){let l=t.x+8,u=t.y+t.height/2;return`<text x="${l}" y="${u}" dominant-baseline="middle" fill="var(--_group-text)" font-family="${e.font}" font-size="12" font-weight="600">${P(t.label)}</text>`}if(t.shape==="gantt-bar"){let l=parseFloat(t.inlineStyle?.labelX||"0")+4,u=t.y+t.height/2,d=`<text x="${t.x+6}" y="${u}" dominant-baseline="middle" fill="var(--bg)" font-family="${e.font}" font-size="11" font-weight="500">${P(t.label)}</text>`;return`<text x="${l}" y="${u}" dominant-baseline="middle" fill="var(--_text)" font-family="${e.font}" font-size="11" font-weight="400">${P(t.label)}</text>`+d}let n=tt(t.label),s=t.x+t.width/2,i=t.y+t.height/2,o=16,r=n.length*o,a=i-r/2+o/2,c=n.map((l,u)=>{let d=a+u*o;return`<tspan x="${s}" y="${d}" text-anchor="middle" dominant-baseline="middle">${P(l)}</tspan>`}).join("");return`<text fill="var(--_text)" font-family="${e.font}" font-size="14" font-weight="400">${c}</text>`}function Oe(t,e){if(!t.label||!t.labelPosition)return"";let{x:n,y:s}=t.labelPosition,i=tt(t.label),o=14,r=i.length*o,a=4,c=Math.max(...i.map(y=>y.length*7))+a*2,l=r+a*2,u=n-c/2,d=s-l/2,h=`<rect x="${u}" y="${d}" width="${c}" height="${l}" fill="var(--bg)" stroke="var(--_line)" stroke-width="0.75" rx="3"/>`,g=s-r/2+o/2,p=i.map((y,x)=>{let $=g+x*o;return`<tspan x="${n}" y="${$}" text-anchor="middle" dominant-baseline="middle">${P(y)}</tspan>`}).join(""),m=`<text fill="var(--_text)" font-family="${e.font}" font-size="11" font-weight="500">${p}</text>`;return h+m}function Ue(t,e){let n=tt(t.label),s=t.x+8,i=t.y+8,o=14,r=n.map((a,c)=>{let l=i+c*o;return`<tspan x="${s}" y="${l}">${P(a)}</tspan>`}).join("");return`<text fill="var(--_group-text)" font-family="${e.font}" font-size="12" font-weight="600">${r}</text>`}function P(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}function qe(t){return`
		<defs>
			<marker id="arrowhead" markerWidth="12" markerHeight="8" refX="11" refY="4" orient="auto" markerUnits="userSpaceOnUse">
				<path d="M1,1 L11,4 L1,7 z" fill="var(--_arrow)" />
			</marker>
			<marker id="arrowhead-start" markerWidth="12" markerHeight="8" refX="1" refY="4" orient="auto" markerUnits="userSpaceOnUse">
				<path d="M11,1 L1,4 L11,7 z" fill="var(--_arrow)" />
			</marker>
			<marker id="arrowhead-open" markerWidth="12" markerHeight="8" refX="11" refY="4" orient="auto" markerUnits="userSpaceOnUse">
				<path d="M1,1 L11,4 L1,7" fill="none" stroke="var(--_arrow)" stroke-width="1.5" stroke-linejoin="round" />
			</marker>
			<marker id="arrowhead-cross" markerWidth="12" markerHeight="12" refX="6" refY="6" orient="auto" markerUnits="userSpaceOnUse">
				<path d="M3,3 L9,9 M9,3 L3,9" stroke="var(--_arrow)" stroke-width="1.5" stroke-linecap="round" />
			</marker>
		</defs>
	`}function Ge(t,e){return`<rect x="${t.x}" y="${t.y}" width="${t.width}" height="${t.height}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="1.5" rx="0"/>`}function St(t,e){return`<rect x="${t.x}" y="${t.y}" width="${t.width}" height="${t.height}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="1.5" rx="8"/>`}function je(t,e){let n=t.x+t.width/2,s=t.y+t.height/2,i=t.width/2,o=t.height/2;return`<polygon points="${`${n},${s-o} ${n+i},${s} ${n},${s+o} ${n-i},${s}`}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="1.5"/>`}function Qe(t,e){let n=Math.min(t.height/2,t.width/2);return`<rect x="${t.x}" y="${t.y}" width="${t.width}" height="${t.height}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="1.5" rx="${n}"/>`}function Ve(t,e){let n=t.x+t.width/2,s=t.y+t.height/2,i=Math.min(t.width,t.height)/2;return`<circle cx="${n}" cy="${s}" r="${i}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="1.5"/>`}function Ke(t,e){let n=`<rect x="${t.x}" y="${t.y}" width="${t.width}" height="${t.height}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="1.5" rx="0"/>`,s=4,i=`<rect x="${t.x+s}" y="${t.y+s}" width="${t.width-s*2}" height="${t.height-s*2}" fill="none" stroke="var(--_node-stroke)" stroke-width="1.5" rx="0"/>`;return n+i}function Ze(t,e){let n=t.x+t.width/2,s=t.y+t.height/2,i=Math.min(t.width,t.height)/2,o=i-4;return`<circle cx="${n}" cy="${s}" r="${i}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="1.5"/><circle cx="${n}" cy="${s}" r="${o}" fill="none" stroke="var(--_node-stroke)" stroke-width="1.5"/>`}function Je(t,e){let n=t.x+t.width/2,s=t.y+t.height/2,i=t.width/2,o=t.height/2,r=i*.3;return`<polygon points="${`${n-i+r},${s-o} ${n+i-r},${s-o} ${n+i},${s} ${n+i-r},${s+o} ${n-i+r},${s+o} ${n-i},${s}`}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="1.5"/>`}function tn(t,e){let n=t.height*.1,s=t.x,i=t.y,o=t.width,r=t.height,a=`M ${s} ${i+n}
		Q ${s} ${i}, ${s+o/2} ${i}
		T ${s+o} ${i+n}
		L ${s+o} ${i+r-n}
		Q ${s+o} ${i+r}, ${s+o/2} ${i+r}
		T ${s} ${i+r-n}
		Z`,c=`<ellipse cx="${s+o/2}" cy="${i+n}" rx="${o/2}" ry="${n}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="1.5"/>`;return`<path d="${a}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="1.5"/>`+c}function en(t,e){let n=t.x,s=t.y,i=t.width,o=t.height,r=i*.15;return`<polygon points="${`${n},${s+o/2} ${n+r},${s} ${n+i},${s} ${n+i-r},${s+o} ${n},${s+o}`}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="1.5"/>`}function nn(t,e){let n=t.x,s=t.y,i=t.width,o=t.height,r=i*.15;return`<polygon points="${`${n+r},${s} ${n+i-r},${s} ${n+i},${s+o} ${n},${s+o}`}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="1.5"/>`}function sn(t,e){let n=t.x,s=t.y,i=t.width,o=t.height,r=i*.15;return`<polygon points="${`${n},${s} ${n+i},${s} ${n+i-r},${s+o} ${n+r},${s+o}`}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="1.5"/>`}function rn(t,e){let n=t.x,s=t.y,i=t.width,o=t.height,r=i*.15;return`<polygon points="${`${n+r},${s} ${n+i},${s} ${n+i-r},${s+o} ${n},${s+o}`}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="1.5"/>`}function on(t,e){let n=t.x,s=t.y,i=t.width,o=t.height,r=Math.min(i,o)*.15;return`<path d="${`M ${n} ${s} L ${n+i-r} ${s} L ${n+i} ${s+r} L ${n+i} ${s+o} L ${n} ${s+o} Z M ${n+i-r} ${s} L ${n+i-r} ${s+r} L ${n+i} ${s+r}`}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="1.5"/>`}function an(t,e){let n=t.x,s=t.y,i=t.width,o=t.height;return`<path d="${`M ${n+i*.25} ${s+o*.4}
		Q ${n} ${s+o*.4}, ${n} ${s+o*.6}
		Q ${n} ${s+o}, ${n+i*.2} ${s+o}
		Q ${n+i*.3} ${s+o}, ${n+i*.5} ${s+o*.95}
		Q ${n+i*.7} ${s+o}, ${n+i*.8} ${s+o}
		Q ${n+i} ${s+o}, ${n+i} ${s+o*.6}
		Q ${n+i} ${s+o*.4}, ${n+i*.75} ${s+o*.4}
		Q ${n+i*.8} ${s}, ${n+i*.5} ${s}
		Q ${n+i*.2} ${s}, ${n+i*.25} ${s+o*.4}
		Z`}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="1.5"/>`}function cn(t,e){let n=t.x+t.width/2,s=t.y+t.height/2,i=Math.min(t.width,t.height)/4;return`<circle cx="${n}" cy="${s}" r="${i}" fill="var(--_text)" stroke="none"/>`}function ln(t,e){let n=t.x+t.width/2,s=t.y+t.height/2,i=Math.min(t.width,t.height)/3,o=i*.6;return`<circle cx="${n}" cy="${s}" r="${i}" fill="none" stroke="var(--_text)" stroke-width="2"/><circle cx="${n}" cy="${s}" r="${o}" fill="var(--_text)" stroke="none"/>`}var At=["#4e79a7","#f28e2b","#e15759","#76b7b2","#59a14f","#edc948","#b07aa1","#ff9da7","#9c755f","#bab0ac"];function dn(t,e){if(!t.inlineStyle)return"";let n=parseFloat(t.inlineStyle.cx),s=parseFloat(t.inlineStyle.cy),i=parseFloat(t.inlineStyle.radius),o=parseFloat(t.inlineStyle.startAngle),r=parseFloat(t.inlineStyle.endAngle),a=parseInt(t.inlineStyle.index),c=At[a%At.length],l=n+i*Math.cos(o),u=s+i*Math.sin(o),d=n+i*Math.cos(r),h=s+i*Math.sin(r),g=r-o>Math.PI?1:0;return`<path d="${`M ${n} ${s} L ${l} ${u} A ${i} ${i} 0 ${g} 1 ${d} ${h} Z`}" fill="${c}" stroke="var(--bg)" stroke-width="2"/>`}function hn(t,e){return""}function un(t,e){return`<rect x="${t.x}" y="${t.y}" width="${t.width}" height="${t.height}" fill="var(--_group-fill)" stroke="none" rx="2"/>`}function fn(t,e){let n=t.inlineStyle?.status||"default",s="var(--_node-fill)",i="var(--_node-stroke)";return n==="done"&&(s="var(--_muted)"),n==="active"&&(s="var(--_node-stroke)"),n==="crit"&&(s="#e15759",i="#c44040"),`<rect x="${t.x}" y="${t.y}" width="${t.width}" height="${t.height}" fill="${s}" stroke="${i}" stroke-width="1" rx="4"/>`}function gn(t,e){return""}var pn={rectangle:Ge,rounded:St,diamond:je,stadium:Qe,circle:Ve,subroutine:Ke,doublecircle:Ze,hexagon:Je,cylinder:tn,asymmetric:en,trapezoid:nn,"trapezoid-alt":sn,parallelogram:rn,note:on,cloud:an,"state-start":cn,"state-end":ln,"pie-slice":dn,"pie-title":hn,"gantt-section":un,"gantt-bar":fn,"gantt-title":gn};function mn(t,e){let n=pn[t.shape];return n?n(t,e):St(t)}function bn(t,e){return`<rect x="${t.x}" y="${t.y}" width="${t.width}" height="${t.height}" fill="var(--_group-fill)" stroke="var(--_group-stroke)" stroke-width="1.5" rx="4"/>`}function vt(t,e){return t.flatMap(n=>{let s=n.children.length>0?vt(n.children,e):"";return bn(n)+Ue(n,e)+s}).join("")}function yn(t,e){if(!e.debug)return"";let n=[],s=50,i=t.width+e.padding*2,o=t.height+e.padding*2;for(let r=0;r<=i;r+=s)n.push(`<line x1="${r}" y1="0" x2="${r}" y2="${o}" stroke="rgba(255,255,255,0.08)" stroke-width="0.5"/>`),n.push(`<text x="${r+2}" y="10" fill="rgba(255,255,255,0.3)" font-size="8" font-family="monospace">${r}</text>`);for(let r=0;r<=o;r+=s)n.push(`<line x1="0" y1="${r}" x2="${i}" y2="${r}" stroke="rgba(255,255,255,0.08)" stroke-width="0.5"/>`),n.push(`<text x="2" y="${r-2}" fill="rgba(255,255,255,0.3)" font-size="8" font-family="monospace">${r}</text>`);for(let r of t.nodes)n.push(`<rect x="${r.x}" y="${r.y}" width="${r.width}" height="${r.height}" fill="none" stroke="rgba(239,68,68,0.5)" stroke-width="0.5" stroke-dasharray="3 2"/>`),n.push(`<text x="${r.x}" y="${r.y-4}" fill="rgba(239,68,68,0.7)" font-size="9" font-family="monospace">${r.id}</text>`);for(let r of t.edges)for(let a of r.points)n.push(`<circle cx="${a.x}" cy="${a.y}" r="3" fill="rgba(59,130,246,0.6)" stroke="rgba(59,130,246,0.8)" stroke-width="0.5"/>`);return`<g class="debug-overlays">${n.join("")}</g>`}function U(t,e){let n=e?.theme??X,s=e?.padding??16,i=e?.transparent??!1,o=e?.debug??!1,r=kt(n),a={colors:r,padding:s,transparent:i,debug:o,font:r.font},c=t.width+s*2,l=t.height+s*2,u=i?"none":r.bg,d=`cm-${Math.random().toString(36).slice(2,8)}`,g=`
		<style>
			@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap');
			#${d} {
				--bg: ${r.bg};
				--fg: ${r.fg};
				--_text: ${r.text};
				--_line: ${r.line};
				--_arrow: ${r.arrow};
				--_node-fill: ${r.nodeFill};
				--_node-stroke: ${r.nodeStroke};
				--_muted: ${r.muted};
				--_group-fill: ${r.groupFill};
				--_group-stroke: ${r.groupStroke};
				--_group-text: ${r.groupText};
			}
		</style>
	`,p=qe(),m=vt(t.groups,a),y=t.edges.map(S=>Ye(S)).join(""),x=t.edges.map(S=>Oe(S,a)).join(""),$=t.nodes.map(S=>{let f=mn(S,a),b=Fe(S,a);return f+b}).join(""),k=yn(t,a);return`
		<svg id="${d}" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 ${c} ${l}" width="${c}" height="${l}">
			${g}
			<rect width="${c}" height="${l}" fill="${u}"/>
			${p}
			<g transform="translate(${s}, ${s})">
				${m}
				${y}
				${x}
				${$}
			</g>
			${k}
		</svg>
	`.split(`
`).map(S=>S.trim()).filter(Boolean).join(`
`)}var z={shapes:new Map,diagrams:new Map,themes:new Map};function et(t){if(t.shapes)for(let e of t.shapes)z.shapes.set(e.name,e);if(t.diagrams)for(let e of t.diagrams)z.diagrams.set(e.type,e);if(t.themes)for(let e of t.themes)z.themes.set(e.name,e)}function Y(){return z}function nt(){z.shapes.clear(),z.diagrams.clear(),z.themes.clear()}function Mt(t,e={}){let{theme:n,padding:s,transparent:i,debug:o,...r}=e,a=Y(),c=null,l=null,u=t.split(/[\n;]/)[0]?.trim()||"";for(let[,d]of a.diagrams)if(d.detect(u)&&(c=d.parse(t),c?.ast)){d.layout&&(l=d.layout(c.ast,{direction:r.direction,nodeSpacing:r.nodeSpacing,layerSpacing:r.layerSpacing,padding:s}));break}if(!c&&(c=F(t),!c.ast)){let d=c.diagnostics.map(h=>h.message).join(`
`);throw new Error(`Failed to parse diagram:
${d}`)}return l||(l=O(c.ast,{direction:r.direction,nodeSpacing:r.nodeSpacing,layerSpacing:r.layerSpacing,padding:s})),U(l,{theme:n,padding:s,transparent:i,debug:o})}return Nt(xn);})();
